{"version":3,"file":"index.ed02c6b1.js","sources":["../../vite/modulepreload-polyfill","../../src/js/vhv-scripts/global-variables.js","../../src/js/vhv-scripts/splitter.js","../../src/js/vhv-scripts/setup.js","../../src/js/vhv-scripts/utility-humdrum.js","../../vite/preload-helper","../../src/js/AceBinding.js","../../src/js/state/layoutStateMachine.js","../../src/js/collaboration/util-collab.js","../../src/js/api/util.js","../../src/js/api/comments.js","../../images/person.svg","../../src/js/templates/comment.js","../../src/js/templates/commentReplyContainer.js","../../src/js/collaboration/templates.js","../../src/js/state/comments.js","../../src/js/api/users.js","../../src/js/yjs-setup.js","../../src/js/templates/commentForm.js","../../src/js/templates/commentsButton.js","../../src/js/templates/multiSelect.js","../../src/js/collaboration/RubberBandSelection.js","../../src/js/templates/userAwareness.js","../../src/js/templates/userList.js","../../src/js/templates/highlights.js","../../src/js/collaboration/collab-extension.js","../../src/js/util.js","../../src/js/boostrap.js","../../src/js/midifunctions.js","../../src/js/humdrum-notation-plugin-worker.js","../../src/js/vhv-scripts/highlight.js","../../src/js/vhv-scripts/editor.js","../../src/js/vhv-scripts/utility.js","../../src/js/vhv-scripts/buffer.js","../../src/js/vhv-scripts/saving.js","../../src/js/vhv-scripts/pdf.js","../../src/js/vhv-scripts/verovio-options.js","../../src/js/state/selectStateMachine.js","../../src/js/vhv-scripts/chords.js","../../src/js/vhv-scripts/file-operations.js","../../src/js/vhv-scripts/hmdindex.js","../../src/js/vhv-scripts/loading.js","../../src/js/vhv-scripts/listeners.js","../../src/js/vhv-scripts/convertToMusicXmlAndSave.js","../../src/js/menu.js","../../src/js/vhv-scripts/utility-svg.js","../../src/js/vhv-scripts/utility-ace.js","../../src/js/vhv-scripts/misc.js","../../src/js/drop.js","../../src/js/collaboration/ClassWatcher.js","../../src/js/addMenuListeners.js"],"sourcesContent":["const p = function polyfill() {\n    const relList = document.createElement('link').relList;\n    if (relList && relList.supports && relList.supports('modulepreload')) {\n        return;\n    }\n    for (const link of document.querySelectorAll('link[rel=\"modulepreload\"]')) {\n        processPreload(link);\n    }\n    new MutationObserver((mutations) => {\n        for (const mutation of mutations) {\n            if (mutation.type !== 'childList') {\n                continue;\n            }\n            for (const node of mutation.addedNodes) {\n                if (node.tagName === 'LINK' && node.rel === 'modulepreload')\n                    processPreload(node);\n            }\n        }\n    }).observe(document, { childList: true, subtree: true });\n    function getFetchOpts(script) {\n        const fetchOpts = {};\n        if (script.integrity)\n            fetchOpts.integrity = script.integrity;\n        if (script.referrerpolicy)\n            fetchOpts.referrerPolicy = script.referrerpolicy;\n        if (script.crossorigin === 'use-credentials')\n            fetchOpts.credentials = 'include';\n        else if (script.crossorigin === 'anonymous')\n            fetchOpts.credentials = 'omit';\n        else\n            fetchOpts.credentials = 'same-origin';\n        return fetchOpts;\n    }\n    function processPreload(link) {\n        if (link.ep)\n            // ep marker = processed\n            return;\n        link.ep = true;\n        // prepopulate the load record\n        const fetchOpts = getFetchOpts(link);\n        fetch(link.href, fetchOpts);\n    }\n};__VITE_IS_MODERN__&&p();","//\n// _includes/vhv-scripts/global-variables.js\n//\n// This file is loaded from _includes/vhv-scripts/main.js and\n// contains global variables used by VHV.\n//\n\n// CGI: lookup table of key/value pairs from URL parameters.\n// window.CGI = {};\n\n// OPTIONS: debugging parameter to see what options were used\n// for the last call to the verovio toolkit.\n// window.OPTIONS = {};\nexport let OPTIONS = {};\nexport function setOptions(options) {\n  OPTIONS = options;\n}\n\n// var turl = \"https://raw.githubusercontent.com/craigsapp/mozart-piano-sonatas/master/index.hmd\";\n\n// HMDINDEX: used to store a repertory index in the .hmd format.\n// window.HMDINDEX = null;\n\n// WKEY: window for displaying keyscape\n// window.WKEY = null;\n\n// window.GOTOTOPOFNOTATION = false;\n\n////////////////////////////////////////////////////////////\n//\n// Verovio variables\n//\n\n// vrvWorker: interface to the verovio toolkit via the worker interface.  The worker\n// interface allows rendering of notation to be done in a separate thread from the\n// user interface, allowing the user interface to be more responsive.  This variable\n// is configured in the setup.js file.\n// window.vrvWorker = undefined;\n\n//////////////////////////////\n//\n// verovio-related options: Primarily set in menu system and used in humdrumToSvgOptions().\n//\n\n// // SCALE: controls the size of the music notation using the verovio \"scale\" option.\n// window.SCALE          = 40;\n\n// // SPACING_STAFF: Set the minimum distance in diatonic steps between staves of music.\n// window.SPACING_STAFF  = 12;\n\n// // Need to add a variable SPACING_ADJUST_GROUP to add controls for spacing staff groups.\n\n// // SPACING_SYSTEM: Set the minimum distance in diatonc steps between systems of music.\n// // the verovio option justifyVertically may expand from this minimum distance, and\n// // musical elements extending outside of this range will also push the systems further\n// // apart.\n// window.SPACING_SYSTEM = 18;\n\n// // LYRIC_SIZE: control the relative size of lyrics in the rendered notation.  Units\n// // are in terms of diatonic steps (1/2 of the space between staff lines).\n// window.LYRIC_SIZE     = 4.5;\n\n// // FONT: controls the musical font used by verovio to render notation.  This is also\n// // the font variable used to generate PDF files.\n// window.FONT           = \"Leland\";\n\n// // BREAKS: controls whether or not verovio should use system/page breaks\n// // encoded in the data or decide on its own line breaks.\n// //     false means use \"auto\" breaking method for verovio \"breaks\" option.\n// //     true means use \"encoded\" breaking method for verovio \"breaks\" option.\n// window.BREAKS         = false;\n\n///////////////////////////////////////////////////////////\n//\n// Repertory variables --\n\n// ERASED_WORK_NAVIGATOR: HTML code for the navigator that can be restored\n// if alt-e is pressed twice.\n// window.ERASED_WORK_NAVIGATOR = \"\";\n\n// ERASED_FILEINFO: data structure containing the currently displyed\n// work from a repertory.\n// window.ERASED_FILEINFO = {};\n\n// window.PAGED = false;\n\n// window.SPREADSHEETSCRIPTID = \"\";\n// window.SPREADSHEETID = \"\";\n\n// if (localStorage.SPREADSHEETSCRIPTID) {\n// \twindow.SPREADSHEETSCRIPTID = localStorage.SPREADSHEETSCRIPTID;\n// }\n// if (localStorage.SPREADSHEETID) {\n// \twindow.SPREADSHEETID = localStorage.SPREADSHEETID;\n// }\n\n//////////////////////////////\n//\n// menu interaction variables:\n//\n\n// window.INPUT_FONT_SIZE = 1.0;   // used to set font-size in #input (1.0rem is the default);\n\n// window.FILEINFO = {};\nexport let FILEINFO = {};\nexport function setFileInfo(obj) {\n  FILEINFO = obj;\n}\n\n//////////////////////////////\n//\n// MuseData variables --\n//\n\n// window.MuseDataBuffer = \"\";\n\n//////////////////////////////\n//\n// Ace editor variables -- These are variables to control the Ace editor\n//    (https://ace.c9.io), which is the text editor used by VHV.\n//\n\n//window.EDITOR: main interface to the ace editor.  This variable is configured in the\n// setup.js file.\n// window.EDITOR = undefined;\n// window.dummyEDITOR;\n// EditorModes: list the various setup for colorizing and editing for each of the\n// known data format.  The first index is set with the EditorMode variable, and the\n// second index is set with the KeyboardMode variable.\n// window.EditorModes = {\n//   humdrum: {\n//     theme: 'ace/theme/humdrum_light',\n//   },\n//   xml: {\n//     theme: 'ace/theme/solarized_light',\n//   },\n//   musedata: {\n//     theme: 'ace/theme/solarized_light',\n//   },\n// };\n\n// EditorMode: specifies what type of data is present in the text editor.\n// Setting this will in turn control which colorizing rules to apply to the\n// data.\n// Values can be:\n//     \"humdrum\"  for Humdrum data\n//     \"xml\"      for XML data (MEI and MusicXML)\n//     \"musedata\" for XML data (MEI and MusicXML)\n//     \"mime\"     for mime-encoded data\nlet editorModeData = 'humdrum';\nexport const editorMode = () => editorModeData;\n/**\n *\n * @param {\"humdrum\"|\"xml\"|\"musedata\"} mode\n * @returns {string}\n */\nexport const setEditorMode = (mode) => {\n  if (!['humdrum', 'xml', 'musedata'].includes(mode)) {\n    console.log('Invalid editor mode');\n    return;\n  }\n  editorModeData = mode;\n  return editorModeData;\n};\n// window.EditorMode = \"humdrum\";\n\n//var EditorTheme = \"ace/theme/solarized_light\";\n// window.EditorLine = -1;\n// window.TABSIZE = 12;\n// // window.DISPLAYTIME = 0;\n// window.EDITINGID = null;\n// window.SAVEFILENAME = \"data.txt\";\n// window.SPACINGADJUSTMENT = 0.0;\n\n// window.HIGHLIGHTQUERY = null;\n// // used to highlight the current note at the location of the cursor.\n// window.CursorNote = undefined;\n\n// // RestoreCursorNote: Used to go back to a highlighted note after a redraw.\n// // This is an ID string rather than an element.\n// window.RestoreCursorNote = undefined;\n\n// window.ERASED_DATA = \"\";\n\n// window.Actiontime = 0;\n\n// see https://github.com/ajaxorg/ace/wiki/Embedding-API\n// Use EditSession instead of BufferedHumdrumFile:\n// window.BufferedHumdrumFile = \"\";\nwindow.Range = function () {\n  console.log('Range is undefined');\n};\n\n// window.IDS   = [];\n// window.ZOOM  = 0.4;\n// window.PLAY  = false;\n// window.PAUSE = false;\n\n// State variables for interface:\n// window.FirstInitialization = false;\n// window.InputVisible        = true;\n// window.LastInputWidth      = 0;\n// window.OriginalClef        = false;\n// window.UndoHide            = false;\n// window.ApplyZoom           = false;\n// window.ShowingIndex        = false;\n// window.FreezeRendering     = false;\n// window.VrvTitle            = true;\n\nexport const global_verovioOptions = {\n  GOTOTOPOFNOTATION: false,\n  // SCALE: controls the size of the music notation using the verovio \"scale\" option.\n  SCALE: 40,\n  // SPACING_STAFF: Set the minimum distance in diatonic steps between staves of music.\n  SPACING_STAFF: 12,\n  // Need to add a variable SPACING_ADJUST_GROUP to add controls for spacing staff groups.\n\n  // SPACING_SYSTEM: Set the minimum distance in diatonc steps between systems of music.\n  // the verovio option justifyVertically may expand from this minimum distance, and\n  // musical elements extending outside of this range will also push the systems further\n  // apart.\n  SPACING_SYSTEM: 18,\n\n  // LYRIC_SIZE: control the relative size of lyrics in the rendered notation.  Units\n  // are in terms of diatonic steps (1/2 of the space between staff lines).\n  LYRIC_SIZE: 4.5,\n\n  // FONT: controls the musical font used by verovio to render notation.  This is also\n  // the font variable used to generate PDF files.\n  FONT: 'Leland',\n\n  // BREAKS: controls whether or not verovio should use system/page breaks\n  // encoded in the data or decide on its own line breaks.\n  //     false means use \"auto\" breaking method for verovio \"breaks\" option.\n  //     true means use \"encoded\" breaking method for verovio \"breaks\" option.\n  BREAKS: false,\n\n  ZOOM: 0.4,\n};\n\nexport const global_editorOptions = {\n  INPUT_FONT_SIZE: 1.0, // rem\n  EditorLine: -1,\n  TABSIZE: 12,\n  EDITINGID: null,\n  SAVEFILENAME: 'data.txt',\n  SPACINGADJUSTMENT: 0.0,\n};\n\nexport const global_cursor = {\n  HIGHLIGHTQUERY: null,\n  // used to highlight the current note at the location of the cursor.\n  CursorNote: null,\n  // RestoreCursorNote: Used to go back to a highlighted note after a redraw.\n  // This is an ID string rather than an element.\n  RestoreCursorNote: '',\n};\n\nwindow.global_cursor = global_cursor;\n\nexport const global_playerOptions = {\n  PLAY: false,\n  PAUSE: false,\n};\n\nexport const global_interface = {\n  // State variables for interface:\n  InputVisible: false,\n  LastInputWidth: 0,\n  OriginalClef: false,\n  UndoHide: false,\n  ApplyZoom: false,\n  ShowingIndex: false,\n  FreezeRendering: false,\n};\n\n//////////////////////////////\n//\n// Key-code variables for cases in listeners.js:\n//\n// See also:\n//    https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent/key\n//    https://keycode.info\n//    https://wangchujiang.com/hotkeys\n//\n\n// event:             .code           .keyCode   .key (US keyboard)\nwindow.AKey = 'KeyA'; // 65      \"A\", \"a\"\nwindow.BKey = 'KeyB'; // 66      \"B\", \"b\"\nwindow.CKey = 'KeyC'; // 67      \"C\", \"c\"\nwindow.DKey = 'KeyD'; // 68      \"D\", \"d\"\nwindow.EKey = 'KeyE'; // 69      \"E\", \"e\"\nwindow.FKey = 'KeyF'; // 70      \"F\", \"f\"\nwindow.GKey = 'KeyG'; // 71      \"G\", \"g\"\nwindow.HKey = 'KeyH'; // 72      \"H\", \"h\"\nwindow.IKey = 'KeyI'; // 73      \"I\", \"i\"\nwindow.JKey = 'KeyJ'; // 74      \"J\", \"j\"\nwindow.KKey = 'KeyK'; // 75      \"K\", \"k\"\nwindow.LKey = 'KeyL'; // 76      \"L\", \"l\"\nwindow.MKey = 'KeyM'; // 77      \"M\", \"m\"\nwindow.NKey = 'KeyN'; // 78      \"N\", \"n\"\nwindow.OKey = 'KeyO'; // 79      \"O\", \"o\"\nwindow.PKey = 'KeyP'; // 80      \"P\", \"p\"\nwindow.QKey = 'KeyQ'; // 81      \"Q\", \"q\"\nwindow.RKey = 'KeyR'; // 82      \"R\", \"r\"\nwindow.SKey = 'KeyS'; // 83      \"S\", \"s\"\nwindow.TKey = 'KeyT'; // 84      \"T\", \"t\"\nwindow.UKey = 'KeyU'; // 85      \"U\", \"u\"\nwindow.VKey = 'KeyV'; // 86      \"V\", \"v\"\nwindow.WKey = 'KeyW'; // 87      \"W\", \"w\"\nwindow.XKey = 'KeyX'; // 88      \"X\", \"x\"\nwindow.YKey = 'KeyY'; // 89      \"Y\", \"y\"\nwindow.ZKey = 'KeyZ'; // 90      \"Z\", \"z\"\nwindow.ZeroKey = 'Digit0'; // 48      \"0\", \"(\"\nwindow.OneKey = 'Digit1'; // 49      \"1\", \"@\"\nwindow.TwoKey = 'Digit2'; // 50      \"2\", \"@\"\nwindow.ThreeKey = 'Digit3'; // 51      \"3\", \"#\"\nwindow.FourKey = 'Digit4'; // 52      \"4\", \"$\"\nwindow.FiveKey = 'Digit5'; // 53      \"5\", \"%\"\nwindow.SixKey = 'Digit6'; // 54      \"6\", \"^\"\nwindow.SevenKey = 'Digit7'; // 55      \"7\", \"&\"\nwindow.EightKey = 'Digit8'; // 56      \"8\", \"*\"\nwindow.NineKey = 'Digit9'; // 57      \"9\", \"(\"\n// Numpad keys: 0=96 .. 9=105\n\nwindow.BackKey = 'Backspace'; // 8       \"Backspace\"\nwindow.BackQuoteKey = 'Backquote'; // 192     \"`\", \"~\"\nwindow.BackSlashKey = 'Backslash'; // 220     \"\\\\\"\nwindow.CommaKey = 'Comma'; // 188     \",\", \"<\"\nwindow.DeleteKey = 'Delete'; // 46      \"Delete\"\nwindow.DotKey = 'Period'; // 190     \".\", \">\"\nwindow.EnterKey = 'Enter'; // 13      \"Enter\"\nwindow.EscKey = 'Escape'; // 27      \"Escape\"\nwindow.MinusKey = 'Minus'; // 189     \"-\", \"_\"\nwindow.SemiColonKey = 'Semicolon'; // 186     \";\", \":\"\nwindow.SingleQuoteKey = 'Quote'; // 222     \"'\", \"\\\"\"\nwindow.SlashKey = 'Slash'; // 191     \"/\"\nwindow.SpaceKey = 'Space'; // 32      \" \"\nwindow.TabKey = 'Tab'; // 9       \"Tab\"\nwindow.BracketLeftKey = 'BracketLeft'; // 219     \"[\", \"{\"\nwindow.BracketRightKey = 'BracketRight'; // 221     \"]\", \"}\"\nwindow.EqualKey = 'Equal'; // 187     \"=\", \"+\"\n\nwindow.ControlLeftKey = 'ControlLeft'; // 17      \"Control\"   event.ctrl\nwindow.ControlRightKey = 'ControlRight'; // 17      \"Control\"   event.ctrl\nwindow.ShiftLeftKey = 'ShiftLeft'; // 16      \"Shift\"     event.shift\nwindow.ShiftRightKey = 'ShiftRight'; // 16      \"Shift\"     event.shift\n\nwindow.LeftKey = 'ArrowLeft'; // 37      \"ArrowLeft\"\nwindow.UpKey = 'ArrowUp'; // 38      \"ArrowUp\"\nwindow.RightKey = 'ArrowRight'; // 39      \"ArrowRight\"\nwindow.DownKey = 'ArrowDown'; // 40      \"ArrowDown\"\n\nwindow.PgUpKey = 'PageUp'; // 33      \"PageUp\"\nwindow.PgDnKey = 'PageDown'; // 34      \"PageDown\"\nwindow.EndKey = 'End'; // 35      \"End\"\nwindow.HomeKey = 'Home'; // 36      \"Home\"\n\nwindow.F1Key = 'F1'; // 112     \"F1\"\nwindow.F2Key = 'F2'; // 113     \"F2\"\nwindow.F3Key = 'F3'; // 114     \"F3\"\nwindow.F4Key = 'F4'; // 115     \"F4\"\nwindow.F5Key = 'F5'; // 116     \"F5\"\nwindow.F6Key = 'F6'; // 117     \"F6\"\nwindow.F7Key = 'F7'; // 118     \"F7\"\nwindow.F8Key = 'F8'; // 119     \"F8\"\nwindow.F9Key = 'F9'; // 120     \"F9\"\nwindow.F10Key = 'F10'; // 121     \"F10\"\nwindow.F11Key = 'F11'; // 122     \"F11\"\nwindow.F12Key = 'F12'; // 123     \"F12\"\n// etc. to F32Key\n","///////////////////////////////////////////////////////////////////////////\n//\n// Split window interface:\n//\n\nfunction SPLITTER() {\n  this.mouseState = 0;\n  this.positionX = null;\n  this.leftContent = null;\n  this.splitContent = null;\n  this.splitWidth = 5;\n  this.minXPos = 100;\n  this.maxXPos = 2000;\n  this.rightPadding = 10;\n  this.defaultPos = 400;\n  this.snapTolerance = 30;\n  return this;\n}\n\nSPLITTER.prototype.setPositionX = function (xPosition) {\n  if (\n    xPosition < this.defaultPos + this.snapTolerance &&\n    xPosition > this.defaultPos - this.snapTolerance\n  ) {\n    xPosition = this.defaultPos;\n  }\n\n  if (xPosition < 0) {\n    xPosition = 0;\n  }\n  if (xPosition > this.maxXPos) {\n    xPosition = this.maxXPos;\n  }\n  this.positionX = xPosition;\n\n  if (!this.leftContent) {\n    this.leftContent = document.querySelector('#input');\n  }\n  if (!this.splitContent) {\n    this.splitContent = document.querySelector('#splitter');\n  }\n  if (!this.rightContent) {\n    this.rightContent = document.querySelector('#output');\n  }\n\n  if (this.leftContent) {\n    this.leftContent.style.left = 0;\n    this.leftContent.style.width = xPosition + 'px';\n  }\n  if (this.splitContent) {\n    this.splitContent.style.left = xPosition + 'px';\n  }\n  // if (this.rightContent) {\n  //   this.rightContent.style.left =\n  //     xPosition + this.splitWidth + this.rightPadding + 'px';\n  // }\n};\n\nexport default new SPLITTER();\n","/* global ace, require */\n\nimport { displayNotation } from './misc.js';\nimport { setEditorModeAndKeyboard } from './utility-ace.js';\n/** @type {AceAjax.Editor | undefined} */\nlet editor;\nlet configureAce = true;\n\nexport function getAceEditor() {\n  if (!editor) {\n    setupAceEditor('input');\n  }\n  return editor;\n}\n\nexport function setupAceEditor(idtag) {\n  editor = ace.edit(idtag);\n  window.EDITOR = editor;\n\n  editor.on('ready', () => {\n    if (!configureAce) {\n      setEditorModeAndKeyboard();\n    }\n  });\n\n  let configPath = `${import.meta.env.BASE_URL}scripts/ace`;\n\n  ace.config.set(\"basePath\", configPath);\n  ace.config.set('modePath', configPath);\n  ace.config.set('workerPath', configPath);\n  ace.config.set('themePath', configPath);\n\n  if (configureAce) {\n    configureAceEditor();\n    configureAce = false;\n  }\n}\n\nexport function configureAceEditor() {\n  editor.getSession().setUseWorker(true);\n  editor.$blockScrolling = Infinity;\n  editor.setAutoScrollEditorIntoView(true);\n  editor.setBehavioursEnabled(false); // no auto-close of parentheses, quotes, etc.\n\n  // These eat alt-l and alt-shift-l keyboard shortcuts on linux:\n  editor.commands.removeCommand('fold', true);\n  editor.commands.removeCommand('unfold', true);\n\n  editor.getSession().setTabSize(global_editorOptions.TABSIZE);\n  editor.getSession().setUseSoftTabs(false);\n\n  // Don't show line at 80 columns:\n  editor.setShowPrintMargin(false);\n\n  // Range = window.require(\"ace/range\").Range;\n  window.Range = ace.require('ace/range').Range;\n\n  // Force the cursor to blink when blurred (unfocused):\n  //editor.renderer.$cursorLayer.showCursor();\n  editor.renderer.$cursorLayer.smoothBlinking = true;\n  editor.renderer.$cursorLayer.setBlinking(true);\n\n  // editor.renderer.setOption('maxLines', 50);\n  editor.renderer.setOption('minLines', 50);\n  editor.renderer.setOption('hScrollBarAlwaysVisible', true);\n  editor.renderer.setOption('vScrollBarAlwaysVisible', true);\n\n  var cursor = document.querySelector('.ace_content .ace_cursor-layer');\n  if (cursor) {\n    CURSOR_OBSERVER = new MutationObserver(customCursor);\n    CURSOR_OBSERVER.observe(cursor, { attributes: true });\n  }\n\n  editor.setTheme('ace/theme/humdrum_light');\n}\n\nimport { setTextInEditor } from './misc.js';\nimport { global_editorOptions, global_interface } from './global-variables.js';\nimport splitter from './splitter.js';\n\nexport function insertSplashMusic() {\n  var splashElement = document.querySelector('#input-splash');\n  if (!splashElement) {\n    return;\n  }\n  let text = editor.getValue();\n  if (!text.match(/^\\s*$/)) {\n    return;\n  }\n  var splash = splashElement.textContent;\n  setTextInEditor(splash);\n}\n\nvar CURSOR_OBSERVER;\nvar CURSOR_DISPLAY;\n\nfunction customCursor() {\n  // Change scope\n  let activeElement = document.activeElement.nodeName;\n  let cursor = editor.renderer.$cursorLayer.cursor;\n  let cursorstate = null;\n\n  for (let i = 0; i < cursor.classList.length; i++) {\n    if (cursor.classList[i] == 'blurred') {\n      cursorstate = 'blurred';\n      break;\n    }\n    if (cursor.classList[i] == 'focused') {\n      cursorstate = 'focused';\n      break;\n    }\n  }\n  if (activeElement === 'TEXTAREA') {\n    if (cursorstate != 'focused') {\n      if (!CURSOR_DISPLAY) {\n        CURSOR_DISPLAY = true;\n      }\n      // console.log(\"FOCUSING CURSOR\");\n      cursor.classList.add('focused');\n      cursor.classList.remove('blurred');\n      editor.renderer.$cursorLayer.setBlinking(true);\n      editor.renderer.$cursorLayer.showCursor();\n    }\n  } else if (CURSOR_DISPLAY) {\n    if (cursorstate != 'blurred') {\n      // console.log(\"BLURRING CURSOR\");\n      cursor.classList.add('blurred');\n      cursor.classList.remove('focused');\n      editor.renderer.$cursorLayer.showCursor();\n      editor.renderer.$cursorLayer.setBlinking(true);\n    }\n  }\n}\n\nexport function setupSplitter() {\n  var splitterElem = document.querySelector('#splitter');\n  if (!splitterElem) {\n    return;\n  }\n\n  if (!splitter.leftContent) {\n    splitter.leftContent = document.querySelector('#input');\n  }\n  if (!splitter.splitContent) {\n    splitter.splitContent = document.querySelector('#splitter');\n  }\n  if (!splitter.rightContent) {\n    splitter.rightContent = document.querySelector('#output');\n  }\n\n  splitterElem.addEventListener('mousedown', function (event) {\n    splitter.mouseState = 1;\n    if (!splitter.leftContent) {\n      splitter.leftContent = document.querySelector('#input');\n    }\n    if (!splitter.splitContent) {\n      splitter.splitContent = document.querySelector('#splitter');\n    }\n    if (!splitter.rightContent) {\n      splitter.rightContent = document.querySelector('#output');\n    }\n    splitter.setPositionX(event.pageX);\n  });\n\n  window.addEventListener('mouseup', function (event) {\n    if (splitter.mouseState != 0) {\n      splitter.mouseState = 0;\n      editor.resize();\n      displayNotation();\n    }\n  });\n\n  window.addEventListener('mousemove', function (event) {\n    if (splitter.mouseState) {\n      var minXPos = splitter.minXPos;\n      if (event.pageX < minXPos) {\n        if (event.pageX < minXPos - 70) {\n          //Adjust closing snap tolerance here\n          splitter.setPositionX(0);\n          global_interface.InputVisible = false;\n        }\n        return;\n      }\n      splitter.setPositionX(event.pageX);\n      global_interface.InputVisible = true;\n    }\n  });\n}\n\n//////////////////////////////\n//\n// GetCgiParameters -- Returns an associative array containing the\n//     page's URL's CGI parameters\n//\n\nexport function GetCgiParameters() {\n\tvar url = window.location.search.substring(1);\n\tvar output = {};\n\tvar settings = url.split('&');\n\tfor (var i=0; i<settings.length; i++) {\n\t\tvar pair = settings[i].split('=');\n\t\tpair[0] = decodeURIComponent(pair[0]);\n\t\tpair[1] = decodeURIComponent(pair[1]);\n\t\tif (typeof output[pair[0]] === 'undefined') {\n\t\t\toutput[pair[0]] = pair[1];\n\t\t} else if (typeof output[pair[0]] === 'string') {\n\t\t\tvar arr = [ output[pair[0]], pair[1] ];\n\t\t\toutput[pair[0]] = arr;\n\t\t} else {\n\t\t\toutput[pair[0]].push(pair[1]);\n\t\t}\n\t}\n\tif (!output.mm || output.mm.match(/^\\s*$/)) {\n\t\tif (output.m) {\n\t\t\toutput.mm = output.m;\n\t\t}\n\t}\n\n\t// process aliases:\n\n\tif (!output.k && output.keys) {\n\t\toutput.k = output.keys;\n\t} else if (output.k && !output.keys) {\n\t\toutput.keys = output.k;\n\t}\n\n\tif (!output.t && output.text) {\n\t\toutput.t = output.text;\n\t} else if (output.t && !output.text) {\n\t\toutput.text = output.t;\n\t}\n\n\tif (!output.f && output.file) {\n\t\toutput.f = output.file;\n\t} else if (output.f && !output.file) {\n\t\toutput.file = output.f;\n\t}\n\n\tif (!output.F && output.filter) {\n\t\toutput.F = output.filter;\n\t} else if (output.F && !output.filter) {\n\t\toutput.filter = output.F;\n\t}\n\n\tif (!output.p && output.pitch) {\n\t\toutput.p = output.pitch;\n\t} else if (output.p && !output.pitch) {\n\t\toutput.pitch = output.p;\n\t}\n\n\tif (!output.r && output.rhythm) {\n\t\toutput.r = output.rhythm;\n\t} else if (output.r && !output.rhythm) {\n\t\toutput.rhythm = output.r;\n\t}\n\n\tif (!output.i && output.interval) {\n\t\toutput.i = output.interval;\n\t} else if (output.i && !output.interval) {\n\t\toutput.interval = output.i;\n\t}\n\n\t// store the URL anchor as a output parameter\n\tlet hash = location.hash.replace(/^#/, \"\");\n\tlet matches;\n\n\t// store #m parameter\n\tmatches = hash.match(/m(?![a-z])(\\d+.*)/);\n\tif (matches) {\n\t\toutput.hash_m = matches[1];\n\t}\n\n\t// store #mm parameter\n\tmatches = hash.match(/mm(?![a-z])(\\d+.*)/);\n\tif (matches) {\n\t\toutput.hash_mm = matches[1];\n\t}\n\n\t// store #mh parameter\n\tmatches = hash.match(/mh(?![a-z])(\\d+.*)/);\n\tif (matches) {\n\t\toutput.hash_mh = matches[1];\n\t}\n\n\t// store #mmh parameter\n\tmatches = hash.match(/mmh(?![a-z])(\\d+.*)/);\n\tif (matches) {\n\t\toutput.hash_mmh = matches[1];\n\t}\n\n\treturn output;\n}","//////////////////////////////\n//\n// getReferenceRecords --\n//\n\nimport { FILEINFO, global_interface } from './global-variables';\nimport { getAceEditor } from './setup';\n\nexport function getReferenceRecords(contents) {\n  var lines = contents.split(/\\r?\\n/);\n  var output = {};\n\n  var matches;\n  for (let i = lines.length - 1; i >= 0; i--) {\n    if ((matches = lines[i].match(/^\\!\\!\\!([^\\s]+):\\s*(.*)\\s*$/))) {\n      var key = matches[1];\n      var value = matches[2];\n      output[key] = value;\n      if ((matches = key.match(/(.*)@@(.*)/))) {\n        output[matches[1]] = value;\n      }\n      if ((matches = key.match(/(.*)@(.*)/))) {\n        output[matches[1]] = value;\n      }\n    }\n    if ((matches = lines[i].match(/^\\!?\\!\\!title:\\s*(.*)\\s*/))) {\n      output['title'] = matches[1];\n    }\n  }\n\n  if (!output['title'] || output['title'].match(/^\\s*$/)) {\n    output['title'] = FILEINFO['title-expansion'];\n  }\n\n  var counter = 0;\n  var prefix = '';\n  var postfix = '';\n  var substitute;\n  if (output['title'] && !output['title'].match(/^\\s*$/)) {\n    var pattern = output['title'];\n    while ((matches = pattern.match(/@\\{([^\\}]*)\\}/))) {\n      prefix = '';\n      postfix = '';\n      key = '';\n      if ((matches = pattern.match(/@\\{([^\\}]*)\\}\\{([^\\}]*)\\}\\{([^\\}]*)\\}/))) {\n        prefix = matches[1];\n        key = matches[2];\n        postfix = matches[3];\n        pattern = pattern.replace(\n          /@\\{([^\\}]*)\\}\\{([^\\}]*)\\}\\{([^\\}]*)\\}/,\n          'ZZZZZ'\n        );\n      } else if ((matches = pattern.match(/@\\{([^\\}]*)\\}\\{([^\\}]*)\\}/))) {\n        prefix = matches[1];\n        key = matches[2];\n        postfix = '';\n        pattern = pattern.replace(/@\\{([^\\}]*)\\}\\{([^\\}]*)\\}/, 'ZZZZZ');\n      } else if ((matches = pattern.match(/@\\{([^\\}]*)\\}/))) {\n        prefix = '';\n        key = matches[1];\n        postfix = '';\n        pattern = pattern.replace(/@\\{([^\\}]*)\\}/, 'ZZZZZ');\n      }\n\n      if (!key) {\n        break;\n      }\n      if (key.match(/^\\s*$/)) {\n        break;\n      }\n      if (output[key]) {\n        substitute = prefix + output[key] + postfix;\n      } else {\n        substitute = '';\n      }\n      pattern = pattern.replace(/ZZZZZ/, substitute);\n      counter++;\n      if (counter > 20) {\n        // avoid infinite loop in case something goes wrong\n        break;\n      }\n    }\n    output['title'] = pattern;\n  }\n\n  return output;\n}\n\n//////////////////////////////\n//\n// getStaffCount -- Return the number of **kern or **mens spines in the data.\n//\n\nexport function getStaffCount(data) {\n  var output = 0;\n  var lines = data.split(/\\r?\\n/);\n  for (var i = 0; i < lines.length; i++) {\n    if (!lines[i].match(/^\\*\\*/)) {\n      continue;\n    }\n    var tokens = lines[i].split(/\\t+/);\n    var kcount = 0;\n    var mcount = 0;\n    for (var j = 0; j < tokens.length; j++) {\n      if (tokens[j] === '**kern') {\n        kcount++;\n      } else if (tokens[j] === '**mens') {\n        mcount++;\n      }\n    }\n    // **kern and **mens are currently mutually exclusive\n    if (mcount > 0) {\n      kcount = 0;\n    }\n    output = mcount + kcount;\n    break;\n  }\n  return output;\n}\n\n//////////////////////////////\n//\n// diatonicToHumdrum --\n//\n\nfunction diatonicToHumdrum(pitch) {\n  pitch = parseInt(pitch);\n  var octave = parseInt(pitch / 7);\n  var pc = pitch % 7;\n  var pchar = 'x';\n  if (pc == 0) {\n    pchar = 'c';\n  } else if (pc == 1) {\n    pchar = 'd';\n  } else if (pc == 2) {\n    pchar = 'e';\n  } else if (pc == 3) {\n    pchar = 'f';\n  } else if (pc == 4) {\n    pchar = 'g';\n  } else if (pc == 5) {\n    pchar = 'a';\n  } else if (pc == 6) {\n    pchar = 'b';\n  }\n\n  var i;\n  var count;\n  var output = '';\n  if (octave < 4) {\n    pchar = pchar.toUpperCase();\n    count = 4 - octave;\n    for (i = 0; i < count; i++) {\n      output += pchar;\n    }\n  } else {\n    count = octave - 3;\n    for (i = 0; i < count; i++) {\n      output += pchar;\n    }\n  }\n\n  return output;\n}\n\n//////////////////////////////\n//\n// humdrumToDiatonic -- Does not like rests, null tokens.\n//\n\nfunction humdrumToDiatonic(pitch) {\n  var len = pitch.length;\n  var octave = 0;\n  var firstchar = pitch.charAt(0);\n  var firstlow = firstchar.toLowerCase();\n  if (firstchar === firstlow) {\n    octave = 3 + len;\n  } else {\n    octave = 4 - len;\n  }\n  var diatonic = 0;\n  if (firstlow === 'd') {\n    diatonic = 1;\n  } else if (firstlow === 'e') {\n    diatonic = 2;\n  } else if (firstlow === 'f') {\n    diatonic = 3;\n  } else if (firstlow === 'g') {\n    diatonic = 4;\n  } else if (firstlow === 'a') {\n    diatonic = 5;\n  } else if (firstlow === 'b') {\n    diatonic = 6;\n  }\n  return 7 * octave + diatonic;\n}\n\n//////////////////////////////\n//\n// transposeDiatonic --\n//\n\nexport function transposeDiatonic(pitch, amount) {\n  var len = pitch.length;\n  amount = parseInt(amount);\n  if (len == 0) {\n    return '';\n  }\n  var pitchnum = humdrumToDiatonic(pitch);\n  pitchnum += amount;\n\n  if (pitchnum < 1) {\n    // to low to process or mean anything\n    return pitch;\n  }\n  if (pitchnum >= 70) {\n    // to high to process or mean anything\n    return pitch;\n  }\n  return diatonicToHumdrum(pitchnum);\n}\n\n//////////////////////////////\n//\n// getFieldAndSubtoken -- Return the data token and subtoken position\n//    of the item at the given column on the line (column is index from 0),\n//    but token and subtoken are indexed from 1.\n//\n\nexport function getFieldAndSubtoken(text, column) {\n  // column++; // needed for some reason?\n  var output = { field: -1, subspine: -1 };\n  if (text.match(/^[*!=]/)) {\n    return output;\n  }\n  if (text == '') {\n    return output;\n  }\n\n  var field = 0;\n  var subspine = 0;\n  var i;\n  for (i = 0; i < column; i++) {\n    // deal with tab at start of line?\n    if (i > 0 && text[i] == '\\t' && text[i - 1] != '\\t') {\n      field++;\n      subspine = 0;\n    } else if (text[i] == ' ') {\n      subspine++;\n    }\n  }\n\n  var subtok = false;\n  // check if the field contains subtokens.  If so, set the\n  if (subspine > 0) {\n    subtok = true;\n  } else {\n    for (i = column; i < text.length; i++) {\n      if (text[i] == ' ') {\n        subtok = true;\n        break;\n      } else if (text[i] == '\\t') {\n        break;\n      }\n    }\n  }\n  if (subtok) {\n    subspine++;\n  }\n  field++;\n\n  output.field = field;\n  output.subspine = subspine;\n  return output;\n}\n\n//////////////////////////////\n//\n// insertMarkedNoteRdf -- If not present, insert marked note\n//     RDF marker in data; otherwise returns what chatacters should represent\n//     a marked note.\n//\nconst editor = getAceEditor();\nif (!editor) {\n  throw new Error('Ace Editor is undefined');\n}\n\nexport function insertMarkedNoteRdf() {\n  var limit = 20; // search only first and last 20 lines of data for RDF entries.\n  var editchar = '';\n  var matches;\n  var i;\n  var size = getAceEditor().session.getLength();\n  for (i = size - 1; i >= 0; i--) {\n    if (size - i > limit) {\n      break;\n    }\n    var line = editor.session.getLine(i);\n    if (\n      (matches = line.match(/^!!!RDF\\*\\*kern:\\s+([^\\s])\\s*=.*mark.*\\s+note/))\n    ) {\n      editchar = matches[1];\n    }\n    if (editchar !== '') {\n      break;\n    }\n  }\n\n  if (editchar === '') {\n    for (i = 0; i < size; i++) {\n      if (i > limit) {\n        break;\n      }\n      line = editor.session.getLine(i);\n      if (\n        (matches = line.match(\n          /^\\!\\!\\!RDF\\*\\*kern:\\s+([^\\s])\\s*=.*mark.*\\s+note/\n        ))\n      ) {\n        editchar = matches[1];\n      }\n      if (editchar !== '') {\n        break;\n      }\n    }\n  }\n\n  if (editchar !== '') {\n    return editchar;\n  }\n\n  var text = '';\n\n  if (editchar === '') {\n    text += '!!!RDF**kern: @ = marked note';\n    editchar = '@';\n  } else {\n    text += '!!!RDF**kern: ' + editchar + ' = marked note';\n  }\n\n  // append markers to end of file.\n  var freezeBackup = global_interface.FreezeRendering;\n  if (global_interface.FreezeRendering == false) {\n    global_interface.FreezeRendering = true;\n  }\n  editor.session.insert(\n    {\n      row: editor.session.getLength(),\n      column: 0,\n    },\n    '\\n' + text\n  );\n  global_interface.FreezeRendering = freezeBackup;\n\n  return editchar;\n}\n\n//////////////////////////////\n//\n// insertDirectionRdfs -- If not present, insert above/below RDF markers\n//     in data; otherwise returns what chatacters should represent \"above\"\n//     and \"below\".  Typically \">\" means \"above\" and \"<\" means \"below\".\n//     also can be used to check if \"<\" or \">\" are already used for\n//     something else.\n//\n\nexport function insertDirectionRdfs() {\n  var limit = 20; // search only first and last 20 lines of data for RDF entries.\n  var abovechar = '';\n  var belowchar = '';\n  var matches;\n  var i;\n  var size = editor.session.getLength();\n  for (i = size - 1; i >= 0; i--) {\n    if (size - i > limit) {\n      break;\n    }\n    var line = editor.session.getLine(i);\n    if ((matches = line.match(/^!!!RDF\\*\\*kern:\\s+([^\\s])\\s*=.*above/))) {\n      abovechar = matches[1];\n    } else if (\n      (matches = line.match(/^!!!RDF\\*\\*kern:\\s+([^\\s])\\s*=.*below/))\n    ) {\n      belowchar = matches[1];\n    }\n    if (abovechar !== '' && belowchar !== '') {\n      break;\n    }\n  }\n\n  if (abovechar === '' || belowchar === '') {\n    for (i = 0; i < size; i++) {\n      if (i > limit) {\n        break;\n      }\n      line = editor.session.getLine(i);\n      if ((matches = line.match(/^\\!\\!\\!RDF\\*\\*kern:\\s+([^\\s])\\s*=.*above/))) {\n        abovechar = matches[1];\n      } else if (\n        (matches = line.match(/^\\!\\!\\!RDF\\*\\*kern:\\s+([^\\s])\\s*=.*below/))\n      ) {\n        belowchar = matches[1];\n      }\n      if (abovechar !== '' && belowchar !== '') {\n        break;\n      }\n    }\n  }\n\n  if (abovechar !== '' && belowchar !== '') {\n    return [abovechar, belowchar];\n  }\n\n  var text = '';\n\n  if (abovechar === '') {\n    text += '!!!RDF**kern: > = above\\n';\n    abovechar = '>';\n  } else {\n    text += '!!!RDF**kern: ' + abovechar + ' = above\\n';\n  }\n\n  if (belowchar === '') {\n    text += '!!!RDF**kern: < = below';\n    belowchar = '<';\n  } else {\n    text += '!!!RDF**kern: ' + belowchar + ' = below';\n  }\n\n  // append markers to end of file.\n  var freezeBackup = global_interface.FreezeRendering;\n  if (global_interface.FreezeRendering == false) {\n    global_interface.FreezeRendering = true;\n  }\n  editor.session.insert(\n    {\n      row: editor.session.getLength(),\n      column: 0,\n    },\n    '\\n' + text\n  );\n  global_interface.FreezeRendering = freezeBackup;\n\n  return [abovechar, belowchar];\n}\n\n//////////////////////////////\n//\n// insertEditorialAccidentalRdf -- If not present, insert editorial accidental\n//     RDF marker in data; otherwise returns what chatacters should represent\n//     an editorial accidental.\n//\n\nexport function insertEditorialAccidentalRdf() {\n  var limit = 20; // search only first and last 20 lines of data for RDF entries.\n  var editchar = '';\n  var matches;\n  var i;\n  var size = editor.session.getLength();\n  for (i = size - 1; i >= 0; i--) {\n    if (size - i > limit) {\n      break;\n    }\n    var line = editor.session.getLine(i);\n    if (\n      (matches = line.match(/^!!!RDF\\*\\*kern:\\s+([^\\s])\\s*=.*edit.*\\s+acc/))\n    ) {\n      editchar = matches[1];\n    }\n    if (editchar !== '') {\n      break;\n    }\n  }\n\n  if (editchar === '') {\n    for (i = 0; i < size; i++) {\n      if (i > limit) {\n        break;\n      }\n      line = editor.session.getLine(i);\n      if (\n        (matches = line.match(\n          /^\\!\\!\\!RDF\\*\\*kern:\\s+([^\\s])\\s*=.*edit.*\\s+acc/\n        ))\n      ) {\n        editchar = matches[1];\n      }\n      if (editchar !== '') {\n        break;\n      }\n    }\n  }\n\n  if (editchar !== '') {\n    return editchar;\n  }\n\n  var text = '';\n\n  if (editchar === '') {\n    text += '!!!RDF**kern: i = editorial accidental\\n';\n    editchar = 'i';\n  } else {\n    text += '!!!RDF**kern: ' + editchar + ' = editorial accidental\\n';\n  }\n\n  // append markers to end of file.\n  var freezeBackup = global_interface.FreezeRendering;\n  if (global_interface.FreezeRendering == false) {\n    global_interface.FreezeRendering = true;\n  }\n  editor.session.insert(\n    {\n      row: editor.session.getLength(),\n      column: 0,\n    },\n    '\\n' + text\n  );\n  global_interface.FreezeRendering = freezeBackup;\n\n  return editchar;\n}\n","const scriptRel = 'modulepreload';const seen = {};const base = '/vhv/';export const __vitePreload = function preload(baseModule, deps) {\n    // @ts-ignore\n    if (!__VITE_IS_MODERN__ || !deps || deps.length === 0) {\n        return baseModule();\n    }\n    return Promise.all(deps.map((dep) => {\n        // @ts-ignore\n        dep = `${base}${dep}`;\n        // @ts-ignore\n        if (dep in seen)\n            return;\n        // @ts-ignore\n        seen[dep] = true;\n        const isCss = dep.endsWith('.css');\n        const cssSelector = isCss ? '[rel=\"stylesheet\"]' : '';\n        // @ts-ignore check if the file is already preloaded by SSR markup\n        if (document.querySelector(`link[href=\"${dep}\"]${cssSelector}`)) {\n            return;\n        }\n        // @ts-ignore\n        const link = document.createElement('link');\n        // @ts-ignore\n        link.rel = isCss ? 'stylesheet' : scriptRel;\n        if (!isCss) {\n            link.as = 'script';\n            link.crossOrigin = '';\n        }\n        link.href = dep;\n        // @ts-ignore\n        document.head.appendChild(link);\n        if (isCss) {\n            return new Promise((res, rej) => {\n                link.addEventListener('load', res);\n                link.addEventListener('error', rej);\n            });\n        }\n    })).then(() => baseModule());\n}","import * as Y from 'yjs';\nimport { createMutex } from 'lib0/mutex';\nimport { simpleDiffString } from 'lib0/diff';\n\nexport default class AceBinding {\n  /**\n   * @param {Y.Text} type\n   * @param {any} ace\n   * @param {Awareness} [awareness]\n   * @param {{ yUndoManager?: Y.UndoManager }} [options]\n   */\n  constructor(type, ace, awareness, { yUndoManager = null } = {}) {\n    const mux = createMutex();\n    const doc = /** @type {Y.Doc} */ (type.doc);\n    this.mux = mux;\n    this.type = type;\n    this.doc = doc;\n    this.ace = ace;\n    this.ace.session.getUndoManager().reset();\n    this.aceCursors = new AceCursors(this.ace);\n\n    this.yUndoManager = yUndoManager;\n    if (yUndoManager) {\n      yUndoManager.trackedOrigins.add(this); // track changes performed by this editor binding\n      const editorUndo = () => {\n        yUndoManager.undo();\n      };\n      const editorRedo = () => {\n        yUndoManager.redo();\n      };\n\n      this.ace.commands.addCommand({\n        name: 'undo',\n        bindKey: { win: 'Ctrl-Z', mac: 'Command-Z' },\n        exec: editorUndo,\n      });\n      this.ace.commands.addCommand({\n        name: 'redo',\n        bindKey: { win: 'Ctrl-Y', mac: 'Command-Y' },\n        exec: editorRedo,\n      });\n\n      yUndoManager.on('stack-item-added', this._onStackItemAdded)\n      yUndoManager.on('stack-item-popped', this._onStackItemPopped)\n    }\n\n    this.awareness = awareness;\n    this._awarenessChange = ({ added, removed, updated }) => {\n      this.aceCursors.marker.cursors = [];\n      const states = /** @type {Awareness} */ (this.awareness).getStates();\n      added.forEach((id) => {\n        // console.log('added: ' + id)\n        this.aceCursors.updateCursors(states.get(id), id);\n      });\n      updated.forEach((id) => {\n        // console.log('updated: ' + id)\n        this.aceCursors.updateCursors(states.get(id), id);\n      });\n      removed.forEach((id) => {\n        // console.log('removed: ' + id)\n        this.aceCursors.updateCursors(states.get(id), id);\n      });\n\n      this.aceCursors.marker.redraw();\n    };\n\n    this._typeObserver = (event) => {\n      const aceDocument = this.ace.getSession().getDocument();\n      // console.log('>>Yjs: type event', event)\n      let rev = this.ace.session.$undoManager.startNewGroup();\n      mux(() => {\n        const delta = event.delta;\n        let currentPos = 0;\n        for (const op of delta) {\n          if (op.retain) {\n            currentPos += op.retain;\n          } else if (op.insert) {\n            const start = aceDocument.indexToPosition(currentPos, 0);\n            aceDocument.insert(start, op.insert);\n            currentPos += op.insert.length;\n            // console.log('>>>Yjs: inserting at position:', start)\n            // console.log('>>>Yjs: inserting text:', op.insert)\n          } else if (op.delete) {\n            const start = aceDocument.indexToPosition(currentPos, 0);\n            const end = aceDocument.indexToPosition(currentPos + op.delete, 0);\n            const range = new Range(\n              start.row,\n              start.column,\n              end.row,\n              end.column\n            );\n            aceDocument.remove(range);\n            // console.log('>>>Yjs: removing at', start, end)\n          }\n        }\n        this.ace.session.$undoManager.markIgnored(rev);\n        this._cursorObserver();\n      });\n    };\n    type.observe(this._typeObserver);\n\n    this._aceObserver = (eventType, delta) => {\n      const aceDocument = this.ace.getSession().getDocument();\n      mux(() => {\n        this.type.doc.transact(() => {\n          if (eventType.lines.length > 1) {\n            // If there are several consecutive changes, we can't reliably compute the positions anymore.\n            // Instead, we will compute the diff and apply the changes\n            const d = simpleDiffString(\n              this.type.toString(),\n              aceDocument.getValue()\n            );\n            console.log('>>>Ace Observer: diff', { diff: d });\n            this.type.delete(d.index, d.remove);\n            this.type.insert(d.index, d.insert);\n          } else {\n            if (eventType.action === 'insert') {\n              const start = aceDocument.positionToIndex(eventType.start, 0);\n              // console.log('>>>Ace: inserting at index: ', start);\n              if (window.navigator.userAgent.indexOf('Win') != -1) {\n                eventType.lines.forEach((line) => line.replaceAll('\\r', ''));\n              }\n              // console.log('>>>Ace: Event lines:', eventType.lines)\n              type.insert(start, eventType.lines.join('\\n'));\n            } else if (eventType.action === 'remove') {\n              const start = aceDocument.positionToIndex(eventType.start, 0);\n              // console.log('>>>Ace: Deleting at index: ', start);\n              if (window.navigator.userAgent.indexOf('Win') != -1) {\n                eventType.lines.forEach((line) => line.replaceAll('\\r', ''));\n              }\n              const length = eventType.lines.join('\\n').length;\n              type.delete(start, length);\n            }\n          }\n          type.applyDelta(eventType);\n          this._cursorObserver();\n        }, this);\n      });\n    };\n    this.ace.on('change', this._aceObserver);\n\n    this._cursorObserver = () => {\n      let user = this.awareness.getLocalState().user;\n      let curSel = this.ace.getSession().selection;\n      let cursor = {\n        id: doc.clientID,\n        name: user.name,\n        sel: true,\n        color: user.color,\n      };\n\n      let indexAnchor = this.ace\n        .getSession()\n        .doc.positionToIndex(curSel.getSelectionAnchor());\n      let indexHead = this.ace\n        .getSession()\n        .doc.positionToIndex(curSel.getSelectionLead());\n      cursor.anchor = indexAnchor;\n      cursor.head = indexHead;\n\n      // flip if selected right to left\n      if (indexAnchor > indexHead) {\n        cursor.anchor = indexHead;\n        cursor.head = indexAnchor;\n      }\n\n      cursor.pos = cursor.head;\n\n      if (cursor.anchor === cursor.head) {\n        cursor.sel = false;\n      }\n\n      const aw = /** @type {any} */ (this.awareness.getLocalState());\n      if (curSel === null) {\n        if (this.awareness.getLocalState() !== null) {\n          this.awareness.setLocalStateField('cursor',/** @type {any} */(null));\n        }\n      } else {\n        if (!aw ||\n          !aw.cursor ||\n          cursor.anchor !== aw.cursor.anchor ||\n          cursor.head !== aw.cursor.head) {\n          this.awareness.setLocalStateField('cursor', cursor);\n        }\n      }\n    };\n\n    // update cursors\n    this.ace\n      .getSession()\n      .selection.on('changeCursor', () => this._cursorObserver());\n\n    if (this.awareness) {\n      this.awareness.on('change', this._awarenessChange);\n    }\n  }\n  _onStackItemPopped(event) {\n    // console.log('stackItem added to UndoManager', event);\n    // event.stackItem.meta.set('replacedValue',);\n  }\n  _onStackItemAdded(event) {\n    // console.log('stackItem removed from UndoManager', event);\n  }\n\n  destroy() {\n    console.log('destroyed');\n    this.type.unobserve(this._typeObserver);\n    this.ace.off('change', this._aceObserver);\n    if (this.awareness) {\n      this.awareness.off('change', this._awarenessChange);\n    }\n    if (this.yUndoManager) {\n      this.yUndoManager.off('stack-item-added', this._onStackItemAdded);\n      this.yUndoManager.off('stack-item-popped', this._onStackItemPopped);\n      this.yUndoManager.trackedOrigins.delete(this);\n    }\n  }\n}\n/*\nAceCursors // cc teddavis.org 2021\nSmall class for tracking cursors/selection in Ace Editor\n*/\nclass AceCursors {\n  constructor(ace) {\n    this.ace = ace;\n    this.marker = {};\n    this.marker.self = this;\n    this.markerID = {};\n    this.marker.cursors = [];\n    this.aceID = this.ace.container.id;\n\n    this.marker.update = function (html, markerLayer, session, config) {\n      let start = config.firstRow, end = config.lastRow;\n      let cursors = this.cursors;\n\n      for (let i = 0; i < cursors.length; i++) {\n        let pos = this.cursors[i];\n        if (pos.row < start) {\n          continue;\n        } else if (pos.row > end) {\n          break;\n        } else {\n          // compute cursor position on screen\n          // this code is based on ace/layer/marker.js\n          let screenPos = session.documentToScreenPosition(pos.row, pos.column);\n          let aceGutter = document.getElementsByClassName('ace_gutter')[0].offsetWidth;\n          let height = config.lineHeight;\n          let width = config.characterWidth;\n          let top = markerLayer.$getTop(screenPos.row, config);\n          let left = markerLayer.$padding + aceGutter + screenPos.column * width;\n\n          // draw cursor and flag\n          let el = document.getElementById(\n            this.self.aceID + '_cursor_' + pos.id\n          );\n          if (el == undefined) {\n            el = document.createElement('div');\n            el.id = this.self.aceID + '_cursor_' + pos.id;\n            el.className = 'cursor';\n            el.style.position = 'absolute';\n            el.innerHTML =\n              '<div class=\"cursor-label\" style=\"background: ' +\n              pos.color +\n              ';top: -1.8em;white-space: nowrap;\">' +\n              pos.name +\n              '</div>';\n            this.self.ace.container.appendChild(el);\n          } else {\n            el.style.height = height + 'px';\n            el.style.width = width + 'px';\n            el.style.top = top + 'px';\n            el.style.left = left + 'px';\n            el.style.borderLeft = '2px solid ' + pos.color;\n            el.style.zIndex = 100;\n            el.style.color = '#000';\n            el.style.cursor = 'help';\n          }\n        }\n      }\n    };\n\n    this.marker.redraw = function () {\n      this.session._signal('changeFrontMarker');\n    };\n\n    this.marker.session = this.ace.getSession();\n    this.marker.session.addDynamicMarker(this.marker, true);\n  }\n\n  updateCursors(cur, cid) {\n    if (cur !== undefined && cur.hasOwnProperty('cursor')) {\n      let c = cur.cursor;\n      let pos = this.ace.getSession().doc.indexToPosition(c.pos);\n\n      let curCursor = {\n        row: pos.row,\n        column: pos.column,\n        color: c.color,\n        id: c.id,\n        name: c.name,\n      };\n\n      // handle selection\n      if (c.sel) {\n        if (this.markerID[c.id] !== undefined &&\n          this.markerID[c.id].hasOwnProperty('sel') &&\n          this.markerID[c.id].sel !== undefined) {\n          this.ace.session.removeMarker(this.markerID[c.id].sel);\n          this.markerID[c.id].sel = undefined;\n        }\n\n        let anchor = this.ace.getSession().doc.indexToPosition(c.anchor);\n        let head = this.ace.getSession().doc.indexToPosition(c.head);\n\n        let customStyle = document.getElementById('style_' + c.id);\n        if (customStyle) {\n          customStyle.innerHTML =\n            '.selection-' +\n            c.id +\n            ' { position: absolute; z-index: 20; opacity: 0.5; background: ' +\n            c.color +\n            '; }';\n        } else {\n          let style = document.createElement('style');\n          style.type = 'text/css';\n          style.id = 'style_' + c.id;\n          document.getElementsByTagName('head')[0].appendChild(style);\n        }\n\n        this.markerID[c.id] = {\n          id: c.id,\n          sel: this.ace.session.addMarker(\n            new Range(anchor.row, anchor.column, head.row, head.column),\n            'selection-' + c.id,\n            'text'\n          ),\n        };\n      } else {\n        if (this.markerID[c.id] !== undefined &&\n          this.markerID[c.id].hasOwnProperty('sel') &&\n          this.markerID[c.id].sel !== undefined) {\n          this.ace.session.removeMarker(this.markerID[c.id].sel);\n          this.markerID[c.id].sel = undefined;\n        }\n      }\n      // console.log(curCursor)\n      this.marker.cursors.push(curCursor);\n    } else {\n      let el = document.getElementById(this.aceID + '_cursor_' + cid);\n      if (el) {\n        el.parentNode.removeChild(el);\n        if (this.markerID[cid] !== undefined &&\n          this.markerID[cid].hasOwnProperty('sel') &&\n          this.markerID[cid].sel !== undefined) {\n          this.ace.session.removeMarker(this.markerID[cid].sel);\n          this.markerID[cid].sel = undefined;\n        }\n      }\n    }\n  }\n}\n","import { assign, createMachine, interpret } from 'xstate';\nimport { updateHandler } from '../collaboration/collab-extension';\nimport { renderComments, uiCoords } from '../collaboration/templates';\nimport { displayNotation } from '../vhv-scripts/misc';\nimport { yProvider } from '../yjs-setup';\nimport { state as commentState } from './comments';\n\nlet inputElem = document.querySelector('#input');\nlet outputElem = document.querySelector('#output');\nlet outputWithCommentsElem = document.querySelector('.output-with-comments');\n\nconst replaceColValue = (elem, value) => {\n  if (!elem) return;\n\n  let oldValue = [...elem.classList].find((cl) => /^col/g.test(cl));\n  let shouldRerender = false;\n  if (oldValue) {\n    let numeric = oldValue.match(/\\d+/g);\n    if (numeric && numeric != value) {\n      shouldRerender = true;\n    }\n\n    elem.classList.remove(oldValue);\n  }\n  elem.classList.add(`col-${value}`);\n\n  return shouldRerender;\n};\n\nconst resize = (inputCol, outputCol, commentsCol) => {\n  let commentsSection = document.querySelector('#comments-section');\n\n  return () => {\n    replaceColValue(inputElem, inputCol);\n    let rerenderCol = replaceColValue(outputWithCommentsElem, outputCol + commentsCol - inputCol);\n    let rerenderSVG = replaceColValue(outputElem, outputCol);\n    replaceColValue(commentsSection, commentsCol);\n\n    if (rerenderCol || rerenderSVG) {\n      displayNotation();\n      let output = document.querySelector('#output > svg');\n      uiCoords.svgHeight = output?.height.baseVal.value ?? window.innerHeight;\n    }\n  };\n};\n\n// const resizeAndRerender = (inputCol, outputCol, commentsCol) => {\n//   return () => {\n//     resize(inputCol, outputCol, commentsCol)();\n//     displayNotation();\n//   };\n// };\n\nexport const layoutMachine = createMachine({\n  initial: 'notationVisible',\n  context: {\n    inputCol: 0,\n    outputCol: 0,\n    commentsCol: 0,\n  },\n  states: {\n    idle: {\n      id: 'idleState',\n      on: {\n        SHOW_NOTATION: {\n          target: 'notationVisible',\n          actions: [\n            assign({\n              inputCol: 0,\n              outputCol: 12,\n              commentsCol: 0,\n            }),\n            ({ inputCol, outputCol, commentsCol }) =>\n              resize(inputCol, outputCol, commentsCol)(),\n          ],\n        },\n      },\n    },\n    notationVisible: {\n      on: {\n        SHOW_TEXT: {\n          target: 'notationAndTextVisible',\n          actions: [\n            assign({\n              inputCol: 4,\n              outputCol: 12,\n              commentsCol: 0,\n            }),\n            ({ inputCol, outputCol, commentsCol }) =>\n              resize(inputCol, outputCol, commentsCol)(),\n          ],\n        },\n        SHOW_COMMENTS: {\n          target: 'notationAndCommentsVisible',\n          actions: [\n            assign({\n              inputCol: 0,\n              outputCol: 8,\n              commentsCol: 4,\n            }),\n            ({ inputCol, outputCol, commentsCol }) => {\n              resize(inputCol, outputCol, commentsCol)();\n              renderComments(commentState.comments)\n            }\n          ],\n        },\n        SHOW_COMMENTS_HIDE_TEXT: {\n          target: 'notationAndCommentsVisible',\n          actions: [\n            assign({\n              inputCol: 0,\n              outputCol: 8,\n              commentsCol: 4,\n            }),\n            ({ inputCol, outputCol, commentsCol }) => {\n              resize(inputCol, outputCol, commentsCol)();\n              renderComments(commentState.comments)\n            }\n          ],\n        }\n      },\n    },\n    notationAndTextVisible: {\n      on: {\n        SHOW_COMMENTS: {\n          target: 'allVisible',\n          actions: [\n            assign({\n              inputCol: 2,\n              outputCol: 10,\n              commentsCol: 2,\n            }),\n            ({ inputCol, outputCol, commentsCol }) => {\n              resize(inputCol, outputCol, commentsCol)();\n              renderComments(commentState.comments)\n            }\n          ],\n        },\n        HIDE_TEXT: {\n          target: 'notationVisible',\n          actions: [\n            assign({\n              inputCol: 0,\n              outputCol: 12,\n              commentsCol: 0,\n            }),\n            ({ inputCol, outputCol, commentsCol }) =>\n              resize(inputCol, outputCol, commentsCol)(),\n          ],\n        },\n        SHOW_COMMENTS_HIDE_TEXT: {\n          target: 'notationAndCommentsVisible',\n          actions: [\n            assign({\n              inputCol: 0,\n              outputCol: 8,\n              commentsCol: 4,\n            }),\n            ({ inputCol, outputCol, commentsCol }) => {\n              resize(inputCol, outputCol, commentsCol)();\n              renderComments(commentState.comments)\n            },\n          ],\n        }\n      },\n    },\n    notationAndCommentsVisible: {\n      on: {\n        SHOW_TEXT: {\n          target: 'allVisible',\n          actions: [\n            assign({\n              inputCol: 2,\n              outputCol: 10,\n              commentsCol: 2,\n            }),\n            ({ inputCol, outputCol, commentsCol }) => {\n              resize(inputCol, outputCol, commentsCol)();\n              renderComments(commentState.comments)\n            },\n          ],\n        },\n        HIDE_COMMENTS: {\n          target: 'notationVisible',\n          actions: [\n            assign({\n              inputCol: 0,\n              outputCol: 12,\n              commentsCol: 0,\n            }),\n            ({ inputCol, outputCol, commentsCol }) => {\n              resize(inputCol, outputCol, commentsCol)()\n              updateHandler({ updated: [...yProvider.awareness.getStates().keys()], added: [], removed: [] });\n            },\n          ],\n        },\n      },\n    },\n    allVisible: {\n      on: {\n        HIDE_TEXT: {\n          target: 'notationAndCommentsVisible',\n          actions: [\n            assign({\n              inputCol: 0,\n              outputCol: 8,\n              commentsCol: 4,\n            }),\n            ({ inputCol, outputCol, commentsCol }) =>\n              resize(inputCol, outputCol, commentsCol)(),\n          ],\n        },\n        HIDE_COMMENTS: {\n          target: 'notationAndTextVisible',\n          actions: [\n            assign({\n              inputCol: 4,\n              outputCol: 12,\n              commentsCol: 0,\n            }),\n            ({ inputCol, outputCol, commentsCol }) => {\n              resize(inputCol, outputCol, commentsCol)()\n              updateHandler({ updated: [...yProvider.awareness.getStates().keys()], added: [], removed: [] });\n            },\n          ],\n        },\n        HIDE_ALL: {\n          target: 'notationVisible',\n          actions: [\n            assign({\n              inputCol: 0,\n              outputCol: 12,\n              commentsCol: 0,\n            }),\n            ({ inputCol, outputCol, commentsCol }) =>\n              resize(inputCol, outputCol, commentsCol)(),\n          ],\n        },\n      },\n    },\n  },\n});\n\nexport let layoutService = interpret(layoutMachine);\n","import { state } from \"../state/comments\";\nimport { layoutService } from \"../state/layoutStateMachine\";\nimport { global_cursor } from \"../vhv-scripts/global-variables\";\n// import { handleCommentsMessage } from \"../yjs-setup\";\n\nexport const MULTI_SELECT_ALPHA = 0.3;\nexport const SELECT_OPACITY = 0.3;\n\nexport function getCoordinates(target) {\n  const targetBounds = target.getBoundingClientRect();\n  const closestStaffElem = target.parentNode?.parentNode;\n\n  let staffBounds;\n  if (closestStaffElem?.classList.contains('staff')) {\n    staffBounds = closestStaffElem.getBoundingClientRect();\n  }\n\n  return {\n    staffX: staffBounds?.x ?? targetBounds.x,\n    staffY: staffBounds?.y ?? targetBounds.y,\n    targetX: targetBounds.x,\n    targetY: targetBounds.y,\n    targetBounds,\n    staffBounds,\n  };\n}\n\nexport function getCoordinatesWithOffset(target, offsetElem) {\n  const targetBounds = target.getBoundingClientRect();\n  const closestStaffElem = target?.closest('.staff');\n\n  let staffBounds = closestStaffElem?.getBoundingClientRect();\n\n  let output = document.querySelector('#output');\n  let scrollTop = output.closest('[class*=output-container]').scrollTop\n\n  return {\n    staffX: staffBounds.x ?? targetBounds.x,\n    staffY: staffBounds.y ?? targetBounds.y,\n    targetX: targetBounds.x - offsetElem.offsetWidth,\n    targetY: targetBounds.y - offsetElem.offsetTop + scrollTop,\n    targetBounds,\n    staffBounds,\n  };\n}\n\n// https://stackoverflow.com/questions/21646738/convert-hex-to-rgba\nexport function hexToRgbA(hex, alpha) {\n  var c;\n  if (/^#([A-Fa-f0-9]{3}){1,2}$/.test(hex)) {\n    c = hex.substring(1).split('');\n    if (c.length == 3) {\n      c = [c[0], c[0], c[1], c[1], c[2], c[2]];\n    }\n    c = '0x' + c.join('');\n    return (\n      'rgba(' +\n      [(c >> 16) & 255, (c >> 8) & 255, c & 255, alpha ? alpha : '1'].join(\n        ','\n      ) +\n      ')'\n    );\n  }\n  throw new Error('Bad Hex');\n}\n\nexport function calculateMultiSelectCoords(selectedNotes) {\n  const coords = selectedNotes.reduce(\n    (oldBox, note) => {\n      const box = note.getBoundingClientRect();\n      return {\n        left: Math.min(oldBox.left, box.left),\n        top: Math.min(oldBox.top, box.top),\n        right: Math.max(oldBox.right, box.right),\n        bottom: Math.max(oldBox.bottom, box.bottom),\n      };\n    },\n    { left: Infinity, top: Infinity, right: 0, bottom: 0 }\n  );\n\n  return {\n    ...coords,\n    width: coords.right - coords.left,\n    height: coords.bottom - coords.top,\n  };\n}\n\nexport function calculateMultiSelectCoordsWithOffset(selectedNotes, offsetElem) {\n  if (!selectedNotes || !Array.isArray(selectedNotes) || selectedNotes.length == 0) {\n    console.log('Argument \"selectedNotes\" must be an array of elements', selectedNotes);\n    return;\n  }\n  \n  if (!offsetElem || !(offsetElem instanceof HTMLElement)) {\n    console.log('Argument \"offsetElem\" must be an HTMLElement');\n    return;\n  }\n  \n  const coords = selectedNotes.reduce(\n    (oldBox, note) => {\n      const box = note.getBoundingClientRect();\n      return {\n        left: Math.min(oldBox.left, box.left),\n        top: Math.min(oldBox.top, box.top),\n        right: Math.max(oldBox.right, box.right),\n        bottom: Math.max(oldBox.bottom, box.bottom),\n      };\n    },\n    {\n      left: Infinity,\n      top: Infinity,\n      right: Number.NEGATIVE_INFINITY,\n      bottom: Number.NEGATIVE_INFINITY,\n    }\n  );\n\n  return withScrollingAndOffset(coords, offsetElem);\n}\n\nfunction withScrollingAndOffset(coords, offsetElem) {\n  return {\n    left: coords.left - offsetElem.offsetWidth,\n    top: coords.top + window.scrollY - document.getElementById('topnav').getBoundingClientRect().height,\n    width: coords.right - coords.left,\n    height: coords.bottom - coords.top,\n  };\n}\n\nexport function timeSince(date) {\n  let seconds = Math.floor((new Date() - date) / 1000);\n  let interval = seconds / 31536000;\n\n  if (interval > 1) {\n    return Math.floor(interval) + \" years\";\n  }\n  interval = seconds / 2592000;\n  if (interval > 1) {\n    return Math.floor(interval) + \" months\";\n  }\n  interval = seconds / 86400;\n  if (interval > 1) {\n    return Math.floor(interval) + \" days\";\n  }\n  interval = seconds / 3600;\n  if (interval > 1) {\n    return Math.floor(interval) + \" hours\";\n  }\n  interval = seconds / 60;\n  if (interval > 1) {\n    return Math.floor(interval) + \" minutes\";\n  }\n  return Math.floor(seconds) + \" seconds\";\n}\n\nexport function unfocusCommentHighlights() {\n  document.querySelectorAll('.highlight-area').forEach(h => h.classList.remove('highlight-area-focus'));\n}\n\nexport function clearCursorHighlight() {\n  if (global_cursor.CursorNote) {\n    var classes = global_cursor.CursorNote.getAttribute('class');\n    var classlist = classes.split(' ');\n    var outclass = '';\n    for (var i = 0; i < classlist.length; i++) {\n      if (classlist[i] == 'highlight') {\n        continue;\n      }\n      outclass += ' ' + classlist[i];\n    }\n    outclass = outclass.replace(/^\\s+/, '');\n    global_cursor.CursorNote.setAttribute('class', outclass);\n    global_cursor.CursorNote = null;\n  }\n}\n\nexport function showCommentSection() {\n  // Check if comment highlights are computed\n  let highlightsComputed = state.comments.some(c => c.highlight == null);\n\n  // if (highlightsComputed) {\n  //   handleCommentsMessage(new MessageEvent('message', { data: JSON.stringify(state.comments) }));\n  //   console.log('Comments after highlight', state.comments);\n  // }\n\n  layoutService.send('SHOW_COMMENTS_HIDE_TEXT');\n}\nexport function hideCommentSection() {\n  layoutService.send('HIDE_COMMENTS');\n  layoutService.send('SHOW_TEXT');\n}","export function getURLParams(keys = []) {\n  let params = new URL(document.location).searchParams;\n\n  return keys\n    .map((key) => ({ [key]: params.get(key) }))\n    .reduce((prev, curr) => Object.assign({}, prev, curr), {});\n}\n\nexport let noop = () => {};\n\nlet productionURL = new URL('http://localhost:3001/'); // Replace when we have a server\nexport let baseUrl = import.meta.env.DEV\n  ? new URL('http://localhost:3001/')\n  : productionURL;\n","import { noop, baseUrl } from './util.js';\n\nconst create = async ({ data, onSuccess = noop, onError = noop }) => {\n  let url = baseUrl + 'api/comments';\n\n  try {\n    let response = await fetch(url, {\n      method: 'POST',\n      credentials: 'include',\n      body: JSON.stringify(data),\n      headers: { 'Content-Type': 'application/json' },\n    })\n  \n    let json = await response.json();\n    if (response.ok) {\n      onSuccess(json);\n    }\n  } catch(error) {\n    onError(error);\n  }\n}\n\nconst removeById = async (id, { data, onSuccess = noop, onError = noop }) => {\n  let url = `${baseUrl}api/comments/${id}`;\n\n  try {\n    let response = await fetch(url, {\n      method: 'DELETE',\n      credentials: 'include',\n      body: JSON.stringify(data),\n      headers: { 'Content-Type': 'application/json' },\n    })\n    \n    let json = await response.json();\n    if (response.ok) {\n      onSuccess(json);\n    }\n  } catch(error) {\n    onError(error);\n  }\n}\n\nconst removeByDocumentId = async(documentId, { data, onSuccess = noop, onError = noop }) => {\n  let url = `${baseUrl}api/comments`;\n  \n  try {\n    let response = await fetch(url, {\n      method: 'DELETE',\n      credentials: 'include',\n      body: JSON.stringify({ ...data, documentId }),\n      headers: { 'Content-Type': 'application/json' },\n    })\n\n    let json = await response.json();\n    if (response.ok) {\n      onSuccess(json);\n    }\n  } catch(error) {\n    onError(error);\n  }\n}\n\nexport {\n  create,\n  removeById,\n  removeByDocumentId\n}","export default \"__VITE_ASSET__321f14cd__\"","import { html } from 'lit-html';\nimport { setState, state } from '../state/comments.js';\nimport { yProvider } from '../yjs-setup.js';\nimport { updateHandler } from '../collaboration/collab-extension.js';\nimport * as commentService from '../api/comments.js';\nimport { getURLParams } from '../api/util.js';\nimport { timeSince } from '../collaboration/util-collab.js';\n\n// Include a user profile icon (probably img URL) when we have persistence for users\nexport let commentTemplate = (commentId, username, content, createdAt, imgUrl, parentId) => {\n  let user = yProvider.awareness.getLocalState().user;\n\n  const findById = (highlights, id) => highlights.find(elem => elem.dataset.commentId == id);\n\n  const handleClick = event => {\n    // Don't focus on the highlight when we click the delete button\n    if (event.target.nodeName == 'BUTTON')\n      return;\n\n    // Highlight the corresponding selection on the music score\n    let highlights = Array.from(document.querySelectorAll('.highlight-area'));\n    if (highlights.length != 0) {\n      let toFocus = parentId ? findById(highlights, parentId) : findById(highlights, commentId);\n      if (toFocus) {\n        highlights.forEach(h => h.classList.remove('highlight-area-focus'));\n        toFocus.classList.add('highlight-area-focus');\n      }\n    }\n  };\n  let { docId: documentId } = getURLParams(['docId']);\n\n  const handleDelete = async () => {\n    await commentService.removeById(commentId, {\n      data: { userId: user.id, documentId, clientId: yProvider.awareness.clientID },\n      onSuccess: () => {\n        console.log('Deleted comment with id: ', commentId);\n        setState({\n          comments: state.comments.filter(c => c.id != commentId)\n        });\n        updateHandler();\n      }\n    });\n  };\n\n  const deleteButton = () => username === user.email\n    ? html`<button type=\"button\" class=\"btn btn-danger\" @click=${handleDelete}>X</button>`\n    : null;\n\n  let time = timeSince(new Date(createdAt));\n\n  return html`<div id=${'comment-' + commentId} @click=${handleClick} class=\"p-2 mb-2 border-bottom\" data-parent-id=${parentId}>\n    <div>\n      <div class=\"d-inline-flex justify-content-between w-100 mb-3\">\n        <div class=\"d-flex\">\n          <div style=\"background-color: white; border-radius: 50%;\">\n            <img src=${imgUrl} alt=\"user profile icon\" width=\"24\" height=\"24\" />\n          </div>\n          <div class=\"d-inline-flex flex-column ml-2\">\n            <h5 class=\"m-0\">${username}</h5>\n            <small class=\"text-muted font-italic\">${time.charAt(0) === '0' ? 'Now' : time + ' ago'}</small>\n          </div>\n        </div>\n        <div>${deleteButton()}</div>\n      </div>\n      <p class=\"card-text\">${content}</p>\n    </div>\n  </div>`;\n};\n","import { html } from 'lit-html';\nimport { setState, state } from '../state/comments.js';\nimport { yProvider } from '../yjs-setup.js';\nimport * as commentService from '../api/comments.js';\nimport personImgUrl from '../../../images/person.svg';\nimport { getURLParams } from '../api/util.js';\nimport { commentTemplate } from './comment';\nimport { remToPixels } from '../collaboration/templates';\nimport { unfocusCommentHighlights } from '../collaboration/util-collab.js';\n\n// Used to hold parent comments, their replies and a form to add a new reply\nexport let commentReplyContainerTemplate = (parent, parentElemWidth) => {\n  let collapseId = `reply-collapse-${parent.id}`;\n  const handleClick = () => {\n    $(`.collapse.reply-form-container:not(#${collapseId})`).collapse('hide');\n    $(`#${collapseId}`).collapse('show');\n  };\n\n  const handleSubmit = async (event) => {\n    event.preventDefault();\n    let content = new FormData(event.target).get('content');\n    console.log({ content });\n    let { docId: documentId } = getURLParams(['docId']);\n\n    await commentService.create({\n      data: {\n        content,\n        parentCommentId: parent.id,\n        documentId,\n        clientId: yProvider.awareness.clientID,\n      },\n      onSuccess: (createdComment) => {\n        console.log('Added comment reply', createdComment);\n\n        setState({\n          comments: state.comments.concat(createdComment),\n        });\n\n        console.log('Comments after adding comment reply', state.comments);\n        $(`#${collapseId}`).collapse('hide');\n        event.target.reset();\n      }\n    });\n  };\n\n  const handleCancel = () => { \n    unfocusCommentHighlights();\n    return $(`#${collapseId}`).collapse('hide'); \n  }\n\n  console.log('Comment parent: ', parent);\n\n  return html`\n    <div id=${'comment-with-replies-' + parent.id} aria-expanded=\"false\" aria-controls=${collapseId} style=\"width: 18rem; top: ${parent.highlight.top}px; left:${parentElemWidth / 2 - remToPixels(18) / 2}px; position: absolute;\" class=\"card shadow comment-with-replies\" @click=${handleClick}>\n\n      <div class=\"card-body p-0\">\n        \n        ${html`${commentTemplate(parent.id, parent.usersDocuments[0].user.email, parent.content, parent.createdAt, personImgUrl)}`}\n        \n        ${parent.children.length > 0 ?\n      html`${parent.children\n        .map(child => commentTemplate(child.id, child.usersDocuments[0].user.email, child.content, child.createdAt, personImgUrl, child.parentCommentId))}`\n      : null}\n\n        <div class=\"collapse p-2 reply-form-container\" id=${collapseId}>\n          <form class=\"reply-form\" @submit=${handleSubmit}>\n              <div class=\"form-group\">\n                <input class=\"form-control\" placeholder=\"Reply\" name=\"content\" type=\"text\" />\n              </div>\n              <div class=\"form-group m-0\">\n                <button class=\"btn btn-primary\" type=\"submit\">Reply</button>\n                <button class=\"btn btn-light\" type=\"button\" @click=${handleCancel}>Cancel</button>\n              </div>\n          </form>\n        </div>\n      </div>\n    </div>\n  `;\n};\n","import { html, render } from 'lit-html';\nimport { layoutService } from '../state/layoutStateMachine.js';\nimport { calculateMultiSelectCoordsWithOffset } from './util-collab.js';\n\nimport { commentReplyContainerTemplate } from '../templates/commentReplyContainer';\nimport { updateHandler } from './collab-extension.js';\nimport { yProvider } from '../yjs-setup.js';\n\nexport let uiCoords = {\n  outputSVGHeight: 10,\n\n  /**\n   * @param {number|string} value\n   */\n  set svgHeight(value) {\n    this.outputSVGHeight = typeof value == 'string' ? parseInt(value, 10) : value;\n    render(commentSectionTemplate(this.outputSVGHeight), document.querySelector('.output-container'));\n  },\n\n  /**\n   * @returns {number}\n   */\n  get svgHeight() {\n    return this.outputSVGHeight;\n  }\n};\n\nexport let collabTemplate = (svgHeight, ...children) => {\n  return html`<div id=\"collab-container\" style=\"height: ${svgHeight}px\">${children}</div>`;\n}\n\nexport const multiSelectCoords = (selectedNotes) => {\n  const selector = selectedNotes.map((id) => '#' + id).join(',');\n  return calculateMultiSelectCoordsWithOffset(\n    Array.from(document.querySelectorAll(selector)),\n    document.querySelector('#input'),\n  );\n}\n\nlet commentSectionTemplate = (height) => {\n  return html`\n    <div\n      id=\"comments-section\"\n      class=\"col-0 h-100\"\n      style=\"min-height: 95vh; max-height: 95vh; position: relative;\"\n    >\n      <div\n        id=\"comments-container\"\n        style=\"height: 100vh; background-color: rgba(216, 215, 215, 0.8);\"\n      ></div>\n    </div>\n  `;\n}\n\nexport function remToPixels(rem) {\n  return rem * parseFloat(getComputedStyle(document.documentElement).fontSize);\n}\n\n\nexport let renderComments = (comments, overlaps = []) => {\n  let container =  /** @type HTMLElement */ (document.querySelector('#comments-container'));\n  \n  // Render comments only if user chooses to show them\n  let commentsVisible = layoutService.state.toStrings().some(name => name.toLowerCase().includes('comment'));\n\n  if (container && commentsVisible) {\n    let commentsWithReplies = [];\n    for (let c of comments) {\n      if (!c?.parentCommentId) {\n        commentsWithReplies.push({ ...c, children: [] });\n        continue;\n      }\n\n      let parent = commentsWithReplies.find(p => p.id == c.parentCommentId);\n      if (!parent) continue;\n      parent.children = [ ...parent.children, c ];\n    }\n\n    let width = container.offsetWidth;\n    console.log('commentsWithReplies', commentsWithReplies);\n    render(\n      html`${commentsWithReplies.map(p => commentReplyContainerTemplate(p, width))}`,\n      container\n      );\n\n    updateHandler({ added: [...yProvider.awareness.getStates().keys()], updated: [], removed: [] });\n  }\n}","import { renderComments } from \"../collaboration/templates\";\n\nexport let state = {\n  comments: [],\n  users: []\n}\n\nlet defaultOptions = () => ({ reRender: true })\n\nexport let setState = (newState = {}, options = defaultOptions()) => {\n  if (!typeof newState === 'object') {\n    throw new Error('State argument has to be an object');\n  }\n  \n  // if (Object.keys(state).length > 0 && state.constructor === Object && !compareKeys(state, newState)) {\n  //   throw new Error('The state object provided violates the state structure');\n  // }\n  \n  // console.log('Old state', state);\n  state = Object.assign({}, state, newState);\n  // console.log('New state', state);\n\n  if (options.reRender && Object.keys(newState).includes('comments')) {\n    renderComments(state.comments);\n  }\n\n  return state;\n}\n\nfunction compareKeys(a, b) {\n  let aKeys = Object.keys(a).sort();\n  let bKeys = Object.keys(b).sort();\n  return JSON.stringify(aKeys) === JSON.stringify(bKeys);\n}","import { noop, baseUrl } from './util.js';\n\nconst getByDocumentId = async (documentId, { onSuccess = noop, onError = noop }) => {\n  let url = `${baseUrl}api/users?docId=${documentId}`;\n\n  try {\n    let response = await fetch(url, { credentials: 'include' });\n  \n    let json = await response.json();\n    if (response.ok) {\n      onSuccess(json);\n      return json;\n    }\n  } catch(error) {\n    onError(error);\n  }\n}\n\nexport {\n  getByDocumentId\n}","import * as Y from 'yjs';\nimport { WebsocketProvider } from 'y-websocket';\n// import { WebrtcProvider } from 'y-webrtc';\nimport { addListenersToOutput, updateHandler } from './collaboration/collab-extension.js';\nimport { getAceEditor } from './vhv-scripts/setup.js';\nimport AceBinding from './AceBinding.js';\nimport { setState, state } from './state/comments.js';\nimport { multiSelectCoords } from './collaboration/templates.js';\nimport Cookies from 'js-cookie';\n\nimport * as userService from './api/users.js';\nimport { baseUrl, getURLParams } from './api/util.js';\n\nconst names = [\n  'Michael',\n  'John',\n  'Jim',\n  'Maria',\n  'Nick',\n  'Jake',\n  'Isabella',\n  'Kate',\n];\nconst colors = [\n  '#30bced',\n  '#6eeb83',\n  '#ffbc42',\n  '#ecd444',\n  '#ee6352',\n  '#9ac2c9',\n  '#8acb88',\n  '#1be7ff',\n];\n\nconst oneOf = (array) => array[Math.floor(Math.random() * array.length)];\n\nlet name = oneOf(names);\nlet userData = {\n  name,\n  color: oneOf(colors),\n  email: name + '@test.com',\n  id: 1,\n};\n\nexport let yProvider;\n\nexport function setupCollaboration() {\n  const ydoc = new Y.Doc();\n  \n  let { docId: DOC_ID, roomname } = getURLParams(['docId', 'roomname']);\n  let room = `docId=${DOC_ID}&roomname=${roomname}`;\n  \n  if (typeof yProvider == 'undefined') {\n    yProvider = new WebsocketProvider('ws://localhost:3001', room, ydoc); // local\n    yProvider.on('status', (event) => {\n      console.log(event.status); // websocket logs \"connected\" or \"disconnected\"\n    });\n    \n    // yProvider = new WebrtcProvider(room, ydoc);\n  }\n  \n  let appUser = Cookies.get('user');\n  if (appUser) {\n    let user = JSON.parse(appUser);\n    if (!user.name) {\n      user.name = user.email.split('@')[0];\n    }\n  \n    yProvider.awareness.setLocalStateField('user', {\n      ...user,\n      color: oneOf(colors),\n    });\n  } else {\n    yProvider.awareness.setLocalStateField('user', userData);\n  }\n  \n  const type = ydoc.getText('ace');\n  const yUndoManager = new Y.UndoManager(type);\n  \n  const editor = getAceEditor();\n  if (!editor) {\n    throw new Error('Ace Editor is undefined');\n  }\n  \n  const binding = new AceBinding(type, editor, yProvider.awareness, {\n    yUndoManager,\n  });\n  \n  // yProvider.awareness.on('update', updateHandler);\n  yProvider.awareness.on('change', updateHandler);\n\n  window.example = { yProvider, ydoc, type };\n  window.awareness = yProvider.awareness;\n\n  setupSSE(DOC_ID);\n}\n\nfunction setupSSE(DOC_ID) {\n  let eventSource = new EventSource(\n    `${baseUrl}events/comments?docId=${DOC_ID}&clientId=${yProvider.awareness.clientID}`,\n    { withCredentials: true }\n  );\n  \n  eventSource.addEventListener('open', async () => {\n    console.log('Event source connection for comments open');\n  \n    userService.getByDocumentId(DOC_ID, {\n      onSuccess: (usersJSON) => {\n        let connectedIds = [...yProvider.awareness.getStates().values()].map(\n          (s) => s.user.id\n        );\n        let users = [];\n        for (let user of usersJSON) {\n          user.online = connectedIds.includes(user.id);\n          users.push(user);\n        }\n  \n        setState({ users });\n      },\n    });\n  });\n  \n  function handleCommentsMessage (event) {\n      let payload = JSON.parse(event.data);\n      console.log('Message event', payload);\n    \n      if (Array.isArray(payload)) {\n        let shouldCompute = payload.some(p => p.highlight == null);\n        \n        if (document.querySelector('#output svg') && shouldCompute) {\n          computeCommentHighlights(payload);\n        } else {\n          // The SVG music score element hasn't been rendered yet here.\n          // We can't calculate comment highlight coordinates yet.\n          setState({ comments: payload }, { reRender: false });\n        }\n        return;\n      }\n    \n      // { type: 'resource:method', id: number }\n      // e.g { type: 'comment:delete', id: 1 }\n      if (payload.hasOwnProperty('type')) {\n        let [resource, method] = payload.type.split(':');\n    \n        if (Object.keys(state).includes(resource)) {\n          switch (method) {\n            case 'create':\n              if (resource === 'comments') {\n                computeCommentHighlights(state.comments.concat(payload.createdComment))\n                updateHandler();\n              }\n              break;\n            case 'delete':\n              if (resource === 'comments') {\n                if (Array.isArray(payload.ids)) {\n                  setState({\n                    comments: state.comments.filter((r) => !payload.ids.includes(r.id)),\n                  });\n                }\n              }\n              updateHandler(); // Re-render collab layer\n              break;\n            default:\n              console.log(`Unknown method: ${method}`);\n          }\n        }\n    \n        return;\n      }\n    \n      // let comments = state?.comments ? [...state.comments, payload] : [payload];\n  }\n  \n  function computeCommentHighlights(comments) {\n    // Add the highlight coordinates for each comment\n    setState({\n      comments: comments.map((c) => {\n        return c.highlight == null && typeof c?.multiSelectElements == 'string'\n          ? {\n              ...c,\n              highlight: Object.assign(\n                {},\n                multiSelectCoords(c.multiSelectElements.split(','))\n              ),\n            }\n          : c;\n      }),\n    });\n  }\n  \n  eventSource.addEventListener('message', handleCommentsMessage);\n  \n  eventSource.addEventListener('error', (error) => {\n    console.log('Error', error);\n    eventSource.close();\n  });\n  \n  window.addEventListener('beforeunload', () => {\n    eventSource.close();\n  });\n  \n}","import { html } from 'lit-html';\nimport { setState, state } from '../state/comments.js';\nimport { yProvider } from '../yjs-setup.js';\nimport * as commentService from '../api/comments.js';\nimport { getURLParams } from '../api/util.js';\nimport { multiSelectCoords } from '../collaboration/templates';\n\nexport const handleCommentPost = async (event) => {\n  event.preventDefault();\n\n  let content = event.target.querySelector('input[name=\"comment-text\"]');\n  console.log('You sent:', content.value);\n\n  let { docId: documentId } = getURLParams(['docId']);\n\n  let notes = yProvider.awareness.getLocalState()?.multiSelect;\n  if (Array.isArray(notes) && notes.length > 0) {\n    let coords = multiSelectCoords(notes);\n\n    await commentService.create({\n      data: {\n        \"content\": content.value,\n        \"parentCommentId\": null,\n        \"documentId\": documentId ? Number(documentId) : 1,\n        \"clientId\": yProvider.awareness.clientID,\n        \"multiSelectElements\": notes.join(',')\n      },\n      onSuccess: (createdComment) => {\n        console.log('Added comment', createdComment);\n        createdComment.highlight = Object.assign({}, coords);\n\n        setState({\n          comments: state.comments\n            .map((c) => {\n              return c.highlight == null && typeof c?.multiSelectElements == 'string'\n                ? {\n                  ...c,\n                  highlight: Object.assign(\n                    {},\n                    multiSelectCoords(c.multiSelectElements.split(','))\n                  ),\n                }\n                : c;\n            })\n            .concat(createdComment),\n        });\n\n        console.log('Comments after calculating coords', state.comments);\n      }\n    });\n  }\n\n  yProvider.awareness.setLocalStateField('multiSelect', null);\n  content.value = '';\n  $('#post-comment').modal('hide');\n};\n\nexport let commentFormTemplate = (onSubmit) => {\n\n  return html` <div class=\"modal-body\">\n    <form id=\"post-comment-form\" @submit=${onSubmit}>\n      <div class=\"form-group\">\n        <label for=\"comment-text\" class=\"col-form-label\">Comment:</label>\n        <input type=\"text\" class=\"form-control\" id=\"comment-text\" name=\"comment-text\" />\n      </div>\n      <div class=\"form-group float-right\">\n        <button type=\"button\" class=\"btn btn-secondary\" role=\"button\" data-dismiss=\"modal\">Close</button>\n        <button type=\"submit\" class=\"btn btn-primary\" role=\"button\">Post</button>\n      </div>\n    </form>\n  </div>`;\n};\n","import { html, render } from 'lit-html';\nimport { commentFormTemplate, handleCommentPost } from './commentForm';\nimport { remToPixels } from '../collaboration/templates';\n\n\nexport let commentsButtonTemplate = (coords, translateY) => {\n  let commentWidth = 2.5;\n  let commentHeight = 2.5;\n\n  const clickHandler = () => {\n    render(\n      commentFormTemplate(handleCommentPost),\n      document.querySelector('#post-comment .modal-content')\n    );\n  };\n\n  return html`<div\n    style=\"transform: translate(${coords.left +\n    coords.width -\n    remToPixels(commentWidth)}px, ${coords.top -\n    remToPixels(commentHeight)}px);\n  width: ${commentWidth}rem; height: ${commentHeight}rem; cursor: pointer; position: absolute; pointer-events: all;\"\n    class=\"p-2\"\n    data-toggle=\"modal\" data-target=\"#post-comment\" @click=${clickHandler}\n  >\n    <svg xmlns=\"http://www.w3.org/2000/svg\" id=\"comment-create-svg\" width=\"28\" height=\"28\" fill=\"currentColor\" class=\"bi bi-card-text\" viewBox=\"0 0 16 16\">\n      <path d=\"M14.5 3a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-13a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5h13zm-13-1A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h13a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 14.5 2h-13z\"/>\n      <path d=\"M3 5.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zM3 8a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9A.5.5 0 0 1 3 8zm0 2.5a.5.5 0 0 1 .5-.5h6a.5.5 0 0 1 0 1h-6a.5.5 0 0 1-.5-.5z\"/>\n    </svg>\n    </div>`;\n};","import { html } from 'lit-html';\nimport { hexToRgbA, MULTI_SELECT_ALPHA } from '../collaboration/util-collab.js';\nimport { commentsButtonTemplate } from './commentsButton';\nimport { multiSelectCoords } from '../collaboration/templates';\n\n\nexport let multiSelectTemplate = (clientId, isLocalUser = false, selectedNotes, color) => {\n  const coords = multiSelectCoords(selectedNotes);\n\n  return html`<div\n    class=\"multi-select-area\"\n    style=\"transform: translate(${coords.left}px, ${coords.top}px); width: ${coords.width}px; height:${coords.height}px; background-color: ${hexToRgbA(\n    color,\n    MULTI_SELECT_ALPHA\n  ) ?? 'rgba(0, 0, 255, 0.09)'};\"\n    data-client-id=${clientId}\n  ></div>\n  ${isLocalUser ? commentsButtonTemplate(coords, coords.top) : null}`;\n};\n\nexport let selectAreaTemplate = (translateX, translateY, width, height, hidden = true) => html`<div\n    id=\"select-area\"\n    ?hidden=${hidden}\n    style=\"transform: translate(${translateX}px, ${translateY}px);\n    width: ${width}px; height: ${height}px;\"\n  ></div>`;\n","import { render } from \"lit-html\";\nimport { selectAreaTemplate } from \"../templates/multiSelect.js\";\n\nexport class RubberBandSelection {\n  coords = {\n    left: 0,\n    top: 0,\n    right: 0,\n    bottom: 0,\n  };\n\n  offsetCoords = {\n    left: 0,\n    top: 0,\n    right: 0,\n    bottom: 0,\n  };\n\n  isSelecting = false;\n\n  selectAreaElem = document.querySelector('#select-area');\n\n  constructor(coords) {\n    this.coords = coords ?? this.coords;\n\n    // if (!this.selectAreaElem) {\n    //   this.selectAreaElem = document.createElement('div');\n    //   this.selectAreaElem.id = 'select-area';\n    //   document.body.appendChild(this.selectAreaElem);\n    // }\n  }\n\n  /**\n   * \n   * @param {MouseEvent} event \n   */\n  setUpperCoords(event) {\n    this.coords.left = event.clientX;\n    this.coords.top = event.clientY;\n\n    this.offsetCoords.left = event.offsetX;\n    this.offsetCoords.top = event.offsetY;\n  }\n \n  /**\n   * \n   * @param {MouseEvent} event \n   */\n  setLowerCoords(event) {\n    this.coords.right = event.clientX;\n    this.coords.bottom = event.clientY;\n\n    this.offsetCoords.right = event.offsetX;\n    this.offsetCoords.bottom = event.offsetY;\n  }\n\n  /**\n   * Update the position of the selection area DOM element\n   *\n   * @returns {{ left: number, top: number, right: number, bottom: number }} The new coordinates of the DOM element\n   */\n  updateElemPosition() {\n    let { left, top, right, bottom } = this.coords;\n    let minX = Math.min(left, right);\n    let maxX = Math.max(left, right);\n    let minY = Math.min(top, bottom);\n    let maxY = Math.max(top, bottom);\n    \n    this.renderSelectArea();\n    // this.selectAreaElem.style.transform = `translate(${minX}px, ${minY}px)`;\n    // this.selectAreaElem.style.width = maxX - minX + 'px';\n    // this.selectAreaElem.style.height = maxY - minY + 'px';\n\n    return {\n      left: minX,\n      top: minY,\n      right: maxX,\n      bottom: maxY,\n    };\n  }\n\n  renderSelectArea() {\n    let { left, top, right, bottom } = this.offsetCoords;\n    let offsetminX = Math.min(left, right);\n    let offsetmaxX = Math.max(left, right);\n    let offsetminY = Math.min(top, bottom);\n    let offsetmaxY = Math.max(top, bottom);\n\n    let collabContainer = document.querySelector('#collab-container');\n    if (collabContainer) {\n      render(\n        selectAreaTemplate(\n          offsetminX,\n          offsetminY,\n          offsetmaxX - offsetminX,\n          offsetmaxY - offsetminY,\n          false\n        ),\n        collabContainer\n      );\n    }\n  }\n\n  /**\n   * Update the internal coordinates state of the object with\n   * the position of the selection area DOM element\n   *\n   * @returns {{ left: number, top: number, right: number, bottom: number }} The new coordinates of the current object\n   */\n  reCalculateCoords() {\n    return (this.coords = this.updateElemPosition());\n  }\n\n  resetCoords() {\n    this.coords = {\n      left: 0,\n      top: 0,\n      right: 0,\n      bottom: 0,\n    };\n    this.updateElemPosition();\n  }\n\n  show() {\n    this.updateElemPosition();\n  }\n\n  hide() {\n    let collabContainer = document.querySelector('#collab-container');\n    if (collabContainer) {\n      render(selectAreaTemplate(0, 0, 0, 0, true), collabContainer);\n    }\n  }\n\n  /**\n   * Find every element of the array that is within the bounds of the selection\n   * area DOM element\n   *\n   * @param {Element[]} elements\n   * @returns {Element[]}\n   */\n  selectNoteElements(elements) {\n    return elements.filter((elem) => {\n      const box = elem.getBoundingClientRect();\n\n      return (\n        this.coords.left <= box.left &&\n        this.coords.top <= box.top &&\n        this.coords.right >= box.right &&\n        this.coords.bottom >= box.bottom\n      );\n    });\n  }\n}\n","import { html, render } from 'lit-html';\nimport { getURLParams } from '../api/util.js';\nimport { formatUserElem } from '../collaboration/collab-extension.js';\nimport { multiSelectCoords } from '../collaboration/templates.js';\nimport { getCoordinatesWithOffset } from '../collaboration/util-collab.js';\nimport { yProvider } from '../yjs-setup.js';\nimport { commentFormTemplate } from './commentForm.js';\nimport * as commentService from '../api/comments.js';\nimport { setState, state } from '../state/comments.js';\nimport { getAceEditor } from '../vhv-scripts/setup.js';\n\nlet contextMenu = (clientId, elemRefId, targetX, targetY, handleClick) =>\n  html`\n    <div class=\"dropup btn-group\" style=\"pointer-events: bounding-box\">\n      <div\n        id=${'dropdownMenuButton-' + elemRefId}\n        class=\"users-div btn dropdown-toggle p-0\"\n        data-toggle=\"dropdown\"\n        aria-expanded=\"false\"\n        style=\"transform: translate(${targetX}px, ${targetY - 30}px)\"\n        data-client-id=${clientId}\n        data-ref-id=${elemRefId}\n      >\n        You\n      </div>\n\n      <div\n        class=\"dropdown-menu p-0 border border-rounded shadow\"\n        aria-labelledby=${'dropdownMenuButton-' + elemRefId}\n        @click=${handleClick}\n      >\n        <div class=\"w-100 d-flex flex-column\">\n          <a\n            id=${'add-comment-' + elemRefId}\n            class=\"context-menu-dropdown-item text-decoration-none text-reset p-1 border-bottom border-secondary\"\n            href=\"#\"\n            data-toggle=\"modal\"\n            data-target=\"#post-comment\"\n            >Add Comment</a\n          >\n          <a\n            class=\"context-menu-dropdown-item text-decoration-none text-reset p-1 border-bottom border-secondary\"\n            id=${'details-' + elemRefId}\n            href=\"#\"\n            data-toggle=\"popover\"\n            >Element details</a\n          >\n          <!-- <a\n            class=\"context-menu-dropdown-item text-decoration-none text-reset p-1\"\n            id=${'history-' + elemRefId}\n            href=\"#\"\n            data-toggle=\"popover\"\n            >History</a\n          > -->\n        </div>\n      </div>\n    </div>\n  `;\nlet simpleIndicator = (clientId, elemRefId, targetX, targetY, name) =>\n  html`<div\n    class=\"users-div\"\n    style=\"transform: translate(${targetX}px, ${document.querySelector(\n      '.dropup.btn-group'\n    )\n      ? targetY - 50\n      : targetY - 25}px)\"\n    data-client-id=${clientId}\n    data-ref-id=${elemRefId}\n  >\n    ${name}\n  </div> `;\n\nexport let userAwarenessTemplate = (clientId, elemRefId, name) => {\n  let el = document.getElementById(elemRefId);\n  if (!el) return html`<div class=\"users-div\"></div>`;\n\n  let details;\n\n  const handleClick = (event) => {\n    console.log('click', { target: event.target });\n    let id = event.target.id;\n    if (/^details/.test(id)) {\n      if (!details) {\n        details = formatUserElem(el);\n        $(`#${id}`).popover({\n          container: 'body',\n          placement: 'auto',\n          content: () =>\n            Object.entries(JSON.parse(details).attrs)\n              .map(([key, val]) => `<div>${key}: ${val}</div>`)\n              .join('\\n'),\n          html: true,\n        });\n        $(`#${id}`).popover('show');\n        console.log({ details: JSON.parse(details) });\n      }\n    } else if (/^add-comment/.test(id)) {\n      const coords = multiSelectCoords([elemRefId]);\n      console.log(coords);\n      render(\n        commentFormTemplate(handleSingleComment([elemRefId], coords)),\n        document.querySelector('#post-comment .modal-content')\n      );\n    } else if (/^history/.test(id)) {\n      let editor = getAceEditor();\n      let undoManager = editor.getSession().getUndoManager();\n\n      console.log(undoManager.$undoStack);\n      console.log({ elemRefId })\n      let [ ,line, field, subfield ] = elemRefId.match(/-.*L(\\d+)F(\\d+)S?(\\d+)?/);\n\n      line = parseInt(line, 10) - 1;\n\n      for (let item of undoManager.$undoStack) {\n        if (item[0].start.row == line && item[0].end.row == line) {\n          console.log('change for element line', item);\n          // editor.getSession().redoChanges(item, true);\n        }\n      }\n      \n    } else {\n      console.log('Element does not have id');\n    }\n  };\n  const { targetX, targetY } = getCoordinatesWithOffset(\n    el,\n    document.querySelector('#input')\n  );\n\n  return html`${clientId == yProvider.awareness.clientID\n    ? contextMenu(clientId, elemRefId, targetX, targetY, handleClick)\n    : simpleIndicator(clientId, elemRefId, targetX, targetY, name)}`;\n};\n\nexport let singleSelectTemplate = (clientId, elemRefId, color) => {\n  let el = document.getElementById(elemRefId);\n  if (!el) return html`<div class=\"single-select\"></div>`;\n\n  const { staffY, targetX, targetY, targetBounds } = getCoordinatesWithOffset(\n    el,\n    document.querySelector('#input')\n  );\n\n  return html`<div\n    class=\"single-select\"\n    style=\"transform: translate(${targetX}px, ${targetY}px);\n    width: ${Math.abs(targetBounds.x - targetBounds.right)}px;\n    height: ${Math.abs(staffY - targetBounds.bottom)}px;\n    background-color: ${color}\"\n    data-client-id=${clientId}\n    data-ref-id=${elemRefId}\n  ></div>`;\n};\n\nexport const handleSingleComment = (notes, coords) => async (event) => {\n  event.preventDefault();\n\n  let content = event.target.querySelector('input[name=\"comment-text\"]');\n  console.log('You sent:', content.value);\n\n  let { docId: documentId } = getURLParams(['docId']);\n\n  if (Array.isArray(notes) && notes.length > 0) {\n    await commentService.create({\n      data: {\n        content: content.value,\n        parentCommentId: null,\n        documentId: documentId ? Number(documentId) : 1,\n        clientId: yProvider.awareness.clientID,\n        multiSelectElements: notes.join(','),\n      },\n      onSuccess: (createdComment) => {\n        createdComment.highlight = Object.assign({}, coords);\n        console.log('Added comment', createdComment);\n\n        setState({\n          comments: state.comments\n            .map((c) => {\n              return c.highlight == null &&\n                typeof c?.multiSelectElements == 'string'\n                ? {\n                    ...c,\n                    highlight: Object.assign(\n                      {},\n                      multiSelectCoords(c.multiSelectElements.split(','))\n                    ),\n                  }\n                : c;\n            })\n            .concat(createdComment),\n        });\n\n        console.log('Comments after calculating coords', state.comments);\n      },\n      onError: console.log\n    });\n  }\n\n  yProvider.awareness.setLocalStateField('multiSelect', null);\n  content.value = '';\n  $('#post-comment').modal('hide');\n};\n","import { html } from 'lit-html';\nimport { classMap } from 'lit-html/directives/class-map.js';\nimport userProfileImgUrl from '../../../images/user-profile.png';\nimport { yProvider } from '../yjs-setup';\n\n\nexport let userListTemplate = (users) => {\n  return html`\n    <ul class=\"users-online m-0 p-0 d-flex justify-content-between\">\n      ${users.map(user => onlineUserTemplate(user))}\n    </ul>`;\n};\n\nlet onlineUserTemplate = (user) => {\n  let classes = { 'online-status': user.online, 'offline-status': !user.online };\n\n  return html`<li data-toggle=\"tooltip\" title=${user.name}>\n    <span class=\"position-relative d-inline-flex\">\n      <div style=\"background-color: white; border-radius: 50%;\">\n        <img src=${user.imageProfileURL} alt=\"user profile icon\" width=\"40\" height=\"40\" style=\"border-radius: 50%;\" />\n      </div>\n      <span class=${classMap(classes)}></span>\n    </span>\n  </li>`;\n};\n\n// let onlineUserTemplate = (url, user) => {\n//   let classes = { 'online-status': user.online, 'offline-status': !user.online };\n//   return html`<li data-toggle=\"tooltip\" title=${user.name}>\n//     <span class=\"position-relative d-inline-flex\">\n//       <div style=\"background-color: white; border-radius: 50%;\">\n//         <img src=${url} alt=\"user profile icon\" width=\"40\" height=\"40\" />\n//       </div>\n//       <span class=${classMap(classes)}></span>\n//     </span>\n//   </li>`;\n// };\n","import { html } from 'lit-html';\n\n// Contains highlighted multi-selected areas referring to comments\n\nexport let highlightLayerTemplate = (height, ...children) => {\n  return html`<div id=\"highlight-container\" style=\"height: ${height}px\">${children}</div>`;\n};\n\n\nexport let highlightTemplate = (commentId, state) => html`<div\n  class=\"highlight-area highlight-color\"\n  style=\"left: ${state.left}px; top: ${state.top}px; width: ${state.width}px; height:${state.height}px;\"\n  data-comment-id=${commentId}\n  tabindex=\"0\"\n></div>`;\n","import { yProvider } from '../yjs-setup.js';\nimport { RubberBandSelection } from './RubberBandSelection';\nimport { html, render } from 'lit-html';\nimport { collabTemplate, uiCoords } from './templates.js';\nimport { multiSelectTemplate } from '../templates/multiSelect';\nimport {\n  singleSelectTemplate,\n  userAwarenessTemplate,\n} from '../templates/userAwareness';\nimport { userListTemplate } from '../templates/userList.js';\nimport {\n  highlightLayerTemplate,\n  highlightTemplate,\n} from '../templates/highlights.js';\nimport { setState, state } from '../state/comments.js';\nimport { layoutService } from '../state/layoutStateMachine.js';\nimport { featureIsEnabled } from '../boostrap.js';\nimport { global_cursor } from '../vhv-scripts/global-variables.js';\nimport { get } from 'lib0/indexeddb';\n\nlet DEBUG = false;\nfunction log(text) {\n  if (DEBUG) {\n    console.log(`[${new Date().toLocaleTimeString()}] ${text}`);\n  }\n}\n\nexport function formatUserElem(elem) {\n  const [, qOn, qOff, pitchName, accidental, octave] = elem.classList;\n  const formattedElem = {};\n  // prettier-ignore\n  formattedElem.attrs = formatAttributes({ qOn, qOff, pitchName, accidental, octave });\n  // formattedElem.clientIds = Array.from(elem.clientIds);\n\n  return JSON.stringify(formattedElem, null, 2);\n}\n\nfunction formatAttributes(attrs) {\n  let qOn = parseQuarterTime(attrs.qOn);\n  let qOff = parseQuarterTime(attrs.qOff);\n\n  let duration = qOff - qOn;\n\n  switch (duration) {\n    case 0.25:\n      duration = '1/4';\n      break;\n    case 0.5:\n      duration = '1/2';\n      break;\n    case 1:\n    case 2:\n    case 4:\n      duration = duration.toString();\n      break;\n    default:\n      log('Uknown time duration value', duration);\n      break;\n  }\n\n  let accidental = attrs.accidental.split('-')[1];\n  switch (accidental) {\n    case 'n':\n      accidental = 'natural';\n      break;\n    case 's':\n      accidental = 'sharp';\n      break;\n    case 'f':\n      accidental = 'flat';\n      break;\n    case 'ff':\n      accidental = 'double flat';\n      break;\n    case 'ss':\n      accidental = 'double sharp';\n      break;\n    default:\n      log('Uknown accidental value', accidental);\n      break;\n  }\n\n  return {\n    duration,\n    pitch: attrs.pitchName.split('-')[1],\n    accidental,\n    octave: attrs.octave.split('-')[1],\n  };\n}\n\nfunction parseQuarterTime(quarterTime) {\n  let [qTimeValue, divisor] = quarterTime.split(/\\D/).filter(Boolean);\n  qTimeValue = parseInt(qTimeValue, 10);\n  return quarterTime.includes('_') ? qTimeValue / divisor : qTimeValue;\n}\n\nfunction defaultClients() {\n  return {\n    added: [],\n    updated: [],\n    removed: [],\n  };\n}\n\nexport function updateHandler(clients = defaultClients()) {\n  const awStates = Array.from(yProvider.awareness.getStates().entries());\n  // console.log(yProvider.awareness.getStates());\n  const f = () => {\n    let collabContainer = document.querySelector('#output #collab');\n    if (!collabContainer) {\n      console.log(\n        'Element div#collab is not found. Cannot render collaboration elements.'\n      );\n      collabContainer = document.createElement('div');\n      collabContainer.id = 'collab';\n      document.querySelector('#output')?.prepend(collabContainer);\n    }\n\n    let multiSelects = html`${awStates\n      .filter(\n        ([_, state]) => state.multiSelect != null && state?.user?.color != null\n      )\n      .map(([clientId, state]) =>\n        multiSelectTemplate(\n          clientId,\n          clientId === yProvider.awareness.clientID,\n          state.multiSelect,\n          state.user.color\n        )\n      )}`;\n\n    let singleSelects = html`${awStates\n      .filter(\n        ([_, state]) =>\n          state?.singleSelect?.elemId != null && state?.user?.color != null\n      )\n      .map(([clientId, state]) =>\n        singleSelectTemplate(\n          clientId,\n          state.singleSelect.elemId,\n          state.user.color\n        )\n      )}`;\n\n    let userAwareness = html`${awStates\n      .filter(\n        ([_, state]) =>\n          state?.singleSelect?.elemId != null && state?.user?.name != null\n      )\n      .map(([clientId, state]) =>\n        userAwarenessTemplate(\n          clientId,\n          state.singleSelect.elemId,\n          state.user.name\n        )\n      )}`;\n\n    let commentsVisible = layoutService.state\n      .toStrings()\n      .some((name) => name.toLowerCase().includes('comment'));\n\n    let highlights = html`${commentsVisible ? \n      html`${state.comments\n            ?.filter((c) => c?.highlight != null)\n            .map((c) => highlightTemplate(c.id, c.highlight))}`\n      : null\n    }`\n\n    render(\n      html`\n        ${collabLayer(multiSelects, singleSelects, userAwareness)}\n        ${renderHighlightLayer(highlights)}\n      `,\n      collabContainer\n    );\n\n    // Display connection status (online/offline) for the users sharing the current document\n    let onlineElem = document.querySelector('#online-users');\n    if (onlineElem) {\n      let connectedIds = [...yProvider.awareness.getStates().values()].map(\n        (s) => s.user.id\n      );\n      let copy = [...state.users];\n      setState({\n        users: copy\n          .map((u) => ({ ...u, online: connectedIds.includes(u.id) }))\n          .sort((a, b) => b.online - a.online),\n      });\n      render(html`${userListTemplate(state.users)}`, onlineElem);\n      // Initialize bootstrap tooltips\n      $('[data-toggle=\"tooltip\"]').tooltip();\n    } else {\n      console.log(\n        'Element div#online-users is not found. Cannot display online user info.'\n      );\n    }\n  };\n\n  clients?.added?.forEach(f);\n  clients?.updated?.forEach(f);\n  clients?.removed?.forEach(f);\n}\n\n// window.addEventListener('DOMContentLoaded', () => {\n//   if (featureIsEnabled('collaboration')) {\n//     // Use a MutationObserver to find out when the score output SVG\n//     // is added to the DOM and attach mouse event listeners to it.\n//     // Then, disconnect the observer.\n//     const mutationObserver = new MutationObserver((mutationsList, observer) => {\n//       for (const mutation of mutationsList) {\n//         if (mutation.type === 'childList') {\n//           if (mutation.target.id === 'output') {\n//             if (\n//               !mutation.target.onmousedown &&\n//               !mutation.target.onmousemove &&\n//               !mutation.target.onmouseup\n//             ) {\n//               addListenersToOutput(mutation.target);\n//               observer.disconnect();\n//             }\n//           }\n//         }\n//       }\n//     });\n//     mutationObserver.observe(document.body, { childList: true, subtree: true });\n//   }\n// });\n\nfunction collabLayer(...children) {\n  let output = document.querySelector('#output');\n  let renderBefore = document.querySelector('#output > svg');\n  uiCoords.svgHeight = renderBefore?.height.baseVal.value ?? window.innerHeight;\n\n  return collabTemplate(uiCoords.svgHeight, ...children);\n}\n\nexport function renderHighlightLayer(...children) {\n  let output = document.querySelector('#output');\n  let svg = document.querySelector('#output > svg');\n\n  let collab = output.querySelector('#collab-container');\n  let svgHeight = svg?.height.baseVal.value ?? window.innerHeight;\n\n  return highlightLayerTemplate(svgHeight, ...children);\n}\n\nexport function addListenersToOutput(outputTarget) {\n  let startTime, endTime;\n  let shouldMultiSelect = false;\n  const rbSelection = new RubberBandSelection();\n\n  console.log('>>>Adding listeners to output')\n\n  document.addEventListener('mousedown', (event) => {\n    // Start selecting only when there isn't a note element on the cursor\n    if (event.target.nodeName != 'svg') return;\n\n    startTime = performance.now();\n\n    rbSelection.isSelecting = true;\n    rbSelection.setUpperCoords(event);\n    const selectedAreas = document.querySelectorAll('.multi-select-area');\n\n    const selectToRemove = [...selectedAreas].find(\n      (elem) => elem.dataset.clientId == yProvider.awareness.clientID\n    );\n    if (selectToRemove) {\n      yProvider.awareness.setLocalStateField('multiSelect', null);\n    }\n  });\n\n  // TODO: Use requestAnimationFrame\n  document.addEventListener('mousemove', (event) => {\n    if (rbSelection.isSelecting) {\n      endTime = performance.now();\n      let timePassed = endTime - startTime;\n\n      if (timePassed >= 300) {\n        rbSelection.setLowerCoords(event);\n\n        rbSelection.show();\n\n        shouldMultiSelect = true;\n      }\n    }\n  });\n\n  document.addEventListener('mouseup', handleMouseUp(yProvider.awareness));\n\n  function handleMouseUp(awareness) {\n    return () => {\n      rbSelection.reCalculateCoords();\n      rbSelection.isSelecting = false;\n\n      if (shouldMultiSelect) {\n        // TODO: extremely inefficient, selecting every single note element\n        const notes = Array.from(document.querySelectorAll('.note, .beam'));\n        const selectedElements = rbSelection.selectNoteElements(notes);\n\n        setNoteBounds(selectedElements);\n\n        const multiSelectedNotes = selectedElements\n          .map((note) => note.id)\n          .filter((id) => /^note/g.test(id));\n\n        if (multiSelectedNotes.length > 0) {\n          awareness?.setLocalStateField('multiSelect', multiSelectedNotes);\n        }\n\n        shouldMultiSelect = false;\n      }\n\n      rbSelection.resetCoords();\n      // rbSelection.selectAreaElem.hidden = true;\n      rbSelection.hide();\n      startTime = endTime = undefined;\n    };\n  }\n}\n\nfunction createNoteBounds() {\n  /** @type {HTMLElement | null} */ let leftMost = null;\n  /** @type {HTMLElement | null} */ let rightMost = null;\n\n  return {\n    /**\n     * \n     * @param {HTMLElement | null} left \n     * @param {HTMLElement | null} right \n     */\n    setBounds(left, right) {\n      if (left) {\n        leftMost = left;\n      }\n\n      if (right) {\n        rightMost = right;\n      }\n    },\n    /**\n     * \n     * @returns {{ leftMost: HTMLElement | null, rightMost: HTMLElement | null}}\n     */\n    getBounds() { return { leftMost, rightMost }}\n  }\n}\n\nexport let noteBounds = createNoteBounds();\n/**\n * \n * @param {HTMLElement[]} selectedElements \n */\nfunction setNoteBounds(selectedElements) {\n  if (selectedElements.length > 0) {\n    let selectedNotes = [...selectedElements].map(elem => {\n      return elem.classList.contains('beam') ? elem.querySelector('.note') : elem\n    });\n\n    let { leftMost, rightMost } = findLeftMostAndRightMost(selectedNotes);\n    if (leftMost && rightMost) {\n      noteBounds.setBounds(leftMost, rightMost);\n    }\n\n    console.log({ leftMost, rightMost });\n    if (leftMost) {\n      global_cursor.CursorNote = leftMost;\n    }\n  }\n}\n\nfunction findLeftMostAndRightMost(selectedNotes) {\n  let leftMost = selectedNotes[0];\n  let rightMost = selectedNotes[0];\n  for (let note of selectedNotes.slice(1)) {\n    let noteBox = note.getBoundingClientRect();\n    if (noteBox.left < leftMost?.getBoundingClientRect().left) {\n      leftMost = note;\n    }\n\n    if (noteBox.left > rightMost?.getBoundingClientRect().left) {\n      rightMost = note;\n    }\n  }\n  return { leftMost, rightMost };\n}\n","export function keysEqual(obj1, obj2) {\n  let keys1 = Object.keys(obj1).sort();\n  let keys2 = Object.keys(obj2).sort();\n\n  if (keys1.length !== keys2.length) return false;\n  for (let i = 0; i < keys1.length; i++) {\n    if (keys1[i] !== keys2[i]) return false;\n  }\n  return true;\n}","import CONFIG from '../features.json';\n\nimport { addListenersToOutput } from './collaboration/collab-extension.js';\nimport { keysEqual } from './util';\nimport { setupCollaboration } from './yjs-setup.js';\n\n/** @typedef {'score' | 'collaboration' | 'videoConference' | 'soundEditor'} FeatureKey */\n/** @param {{FeatureKey: boolean }} FeatureConfig*/\nconst FeatureConfig = {\n  score: false,\n  collaboration: false,\n  videoConference: false,\n  soundEditor: false,\n};\n\nif (import.meta.env.DEV) {\n  document.getElementById('feature-toggle').style.display = 'block';\n}\n\nlet featureForm = document.getElementById('feature-form');\nlet options = featureForm.querySelectorAll('input[type=\"checkbox\"]');\n\n// TODO: How should we handle dependencies for features?\n// E.g. enabling collaboration while score is disabled doesn't make sense\n// In other words, collaboration depends on score.\n\n/**\n * Based on https://www.martinfowler.com/articles/feature-toggles.html\n * \n * @param {FeatureConfig} initialConfig \n * @returns \n */\nfunction createFeatureToggler(initialConfig = FeatureConfig) {\n  let config = Object.assign({}, initialConfig);\n\n  return {\n    /**\n     * \n     * @param {FeatureKey} featureName \n     * @param {boolean} isEnabled\n     * @returns {Promise<Object>}>}\n     */\n    setFeature(featureName, isEnabled) {\n      let error;\n      if (!(featureName in config)) {\n        error = new Error(`Feature ${featureName} not found on feature config ${JSON.stringify(config, null, 2 )}`);\n      }\n      if (typeof isEnabled !== 'boolean') error = new Error('Value must be boolean');\n      \n      return new Promise((resolve, reject) => {\n        if (error) {\n          reject(error);\n        }\n\n        let oldValue = config[featureName];\n        config[featureName] = isEnabled;\n        resolve({\n          config,\n          changed: oldValue != isEnabled ? { [featureName]: isEnabled } : null,\n        });\n      })\n    },\n    /**\n     * \n     * @param {FeatureKey} featureName \n     * @returns {boolean}\n     */\n    featureIsEnabled(featureName) {\n      return config[featureName];\n    },\n  };\n}\n\nlet useConfigFile = keysEqual(CONFIG, FeatureConfig);\nconst featureToggler = createFeatureToggler(useConfigFile ? CONFIG : FeatureConfig);\nif (useConfigFile) {\n  bootstrap().then(() => console.log('Loaded features from file configuration'));\n}\n/**\n * \n * @param {FeatureKey} featureName\n * @returns {boolean}\n */\nexport function featureIsEnabled(featureName) {\n  return featureToggler.featureIsEnabled(featureName);\n}\n\nasync function bootstrap() {\n  if (featureToggler.featureIsEnabled('score')) {\n    handleScore();\n    disableOption('score', options);\n  }\n  \n  if (featureToggler.featureIsEnabled('collaboration')) {\n    handleCollabSetup();\n    disableOption('collaboration', options);\n  }\n\n  if (featureToggler.featureIsEnabled('videoConference')) {\n    let { default: jitsi } = await import('../js/jitsi/index.js');\n    handleVideoConfSetup(jitsi);\n  }\n\n  if (featureToggler.featureIsEnabled('soundEditor')) {\n\n  }\n}\n\nfunction disableOption(featureName, options) {\n  console.log(`Disabling ${featureName}`);\n  let optToDisable = [...options].find((o) => o.name === featureName);\n  if (!optToDisable) {\n    console.error('Option to disable was not found.');\n    return;\n  }\n  optToDisable.disabled = true;\n}\n\nfunction showCommentsInNav() {\n  document.getElementById('comments__menu-item')?.classList.remove('hidden');\n}\n\nfunction handleScore() {\n  let scoreElem = document.getElementById('score-editor');\n  if (!scoreElem) {\n    console.error('Score editor element was not found. Check index.html');\n    return;\n  }\n  scoreElem.style.display = 'block';\n}\n\nfunction handleCollabSetup() {\n  setupCollaboration();\n  addListenersToOutput();\n  showCommentsInNav();\n}\n\nfunction handleCollabTearDown() {\n  // TODO: disconnect from Yjs provider\n  // TODO: destroy Yjs document\n}\n\nfunction handleVideoConfSetup(jitsi) {\n  let jitsiContainer = document.getElementById('jitsi-meeting-container');\n  if (!jitsiContainer) {\n    console.error('Jitsi container element was not found. Check index.html');\n    return;\n  }\n  \n  jitsiContainer.style.display = 'block';\n  jitsi.setup();\n}\n\nfunction handleVideoConfTearDown(jitsi) {\n  let jitsiContainer = document.getElementById('jitsi-meeting-container');\n  if (!jitsiContainer) {\n    console.error('Jitsi container element was not found. Check index.html');\n    return;\n  }\n  jitsiContainer.style.display = 'none';\n  jitsi.destroy();\n}\n\nfunction initForm(config) {\n  return function() {\n    options.forEach((opt) => {\n      opt.checked = config[opt.name];\n    });\n  \n    featureForm?.addEventListener('submit', handleSubmit);\n  \n    function handleSubmit(e) {\n      e.preventDefault();\n  \n      const asFeatures = Array.from(options).map((o) => ({ name: o.name, checked: o.checked }));\n      console.log(asFeatures);\n  \n      asFeatures.forEach(async (feat) => {\n        let res = await featureToggler.setFeature(feat.name, feat.checked);\n  \n        // This option was unchanged, check the next option\n        if (res.changed === null) return;\n  \n        switch (feat.name) {\n          case 'score':\n            if (res.changed[feat.name]) {\n              handleScore();\n              disableOption('score', options);\n            }\n            break;\n          case 'collaboration':\n            if (res.changed[feat.name] && res.config['score']) {\n              handleCollabSetup();\n              disableOption('collaboration', options);\n            } else {\n              handleCollabTearDown();\n            }\n            break;\n          case 'videoConference':\n            // FIX: we're reloading Jitsi Meet every time\n            let { default: jitsi } = await import('../js/jitsi/index.js');\n            if (res.changed[feat.name]) {\n              handleVideoConfSetup(jitsi);\n            } else {\n              handleVideoConfTearDown(jitsi);\n            }\n            return;\n          default:\n            break;\n        }\n      });\n    }\n  }\n}\nwindow.addEventListener('load', initForm(useConfigFile ? CONFIG : FeatureConfig));\n\nwindow.bts = bootstrap;\nwindow.FeatureConfig = FeatureConfig;\nwindow.toggler = featureToggler;\n","/* global $ */\n\n//\n// reference: https://github.com/rism-ch/verovio/blob/gh-pages/mei-viewer.xhtml\n// vim: ts=3\n\nvar LASTLINE = -1;\n\n//////////////////////////////\n//\n// play_midi --\n//\n\nvar DELAY = 600;\n\nimport { getVrvWorker } from './humdrum-notation-plugin-worker.js';\n\nexport function play_midi(starttime) {\n  starttime = starttime ? starttime : 0;\n  if (starttime == 0) {\n    DELAY = 600;\n  } else {\n    DELAY = 600;\n  }\n\n  let vrvWorker = getVrvWorker();\n  if (!vrvWorker) {\n    throw new Error('Verovio worker is undefined');\n  }\n\n  // window.vrvWorker.renderToMidi()\n  vrvWorker\n    .renderToMidi()\n    .then(function (base64midi) {\n      var song = 'data:audio/midi;base64,' + base64midi;\n      console.log('Midi song', song);\n      $('#play-button').hide();\n      $('#midiPlayer_play').show();\n      $('#midiPlayer_stop').show();\n      $('#midiPlayer_pause').show();\n      $('#player').show();\n      $('#player').midiPlayer.play(song, starttime);\n      global_playerOptions.PLAY = true;\n      LASTLINE = -1;\n    })\n    .catch((err) => console.log('Error when trying to play midi', err));\n}\n\n// window.play_midi = play_midi;\n\nfunction downloadFile(base64Song, fileName = '') {\n  let element = document.createElement('a');\n  element.setAttribute('href', base64Song);\n  element.setAttribute('download', fileName + '.mid');\n\n  element.style.display = 'none';\n  document.body.appendChild(element);\n\n  element.click();\n\n  document.body.removeChild(element);\n}\n\n// window.play_midi = function play_midi(starttime) {\n//   starttime = starttime ? starttime : 0;\n//   if (starttime == 0) {\n//     DELAY = 600;\n//   } else {\n//     DELAY = 600;\n//   }\n\n//   vrvWorker\n//     .renderToMidi()\n//     .then(function (base64midi) {\n//       var song = 'data:audio/midi;base64,' + base64midi;\n//       console.log('Midi song', song);\n//       $('#play-button').hide();\n//       $('#midiPlayer_play').show();\n//       $('#midiPlayer_stop').show();\n//       $('#midiPlayer_pause').show();\n//       $('#player').show();\n//       $('#player').midiPlayer.play(song, starttime);\n//       PLAY = true;\n//       LASTLINE = -1;\n\n//       (function downloadFile(base64Song, fileName = '') {\n//         let element = document.createElement('a');\n//         element.setAttribute('href', base64Song);\n//         element.setAttribute('download', fileName + '.mid');\n      \n//         element.style.display = 'none';\n//         document.body.appendChild(element);\n      \n//         element.click();\n      \n//         document.body.removeChild(element);\n//       })(song, 'testFile');\n//     })\n//     .catch((err) => console.log('Error when trying to play midi', err));\n// }\n\n//////////////////////////////\n//\n// midiUpdate --\n//\nimport { showIdInEditor } from './vhv-scripts/utility-ace.js';\nimport { loadPage } from './vhv-scripts/misc.js';\nimport {\n  global_cursor,\n  global_playerOptions,\n} from './vhv-scripts/global-variables.js';\nimport { noteBounds } from './collaboration/collab-extension.js';\n\nvar ids = [];\nexport const midiUpdate = function (time) {\n  let vrvWorker = getVrvWorker();\n  if (!vrvWorker) {\n    throw new Error('Verovio worker is undefined');\n  }\n\n  var vrvTime = Math.max(0, time - DELAY);\n  // window.vrvWorker.getElementsAtTime(vrvTime)\n  vrvWorker.getElementsAtTime(vrvTime).then(function (elementsattime) {\n    var matches;\n    if (elementsattime.page > 0) {\n      if (elementsattime.page != vrvWorker.page) {\n        vrvWorker.page = elementsattime.page;\n        loadPage();\n      }\n      if (elementsattime.notes.length > 0 && ids != elementsattime.notes) {\n        ids.forEach(function (noteid) {\n          if ($.inArray(noteid, elementsattime.notes) == -1) {\n            // $(\"#\" + noteid ).attr(\"fill\", \"#000\");\n            // $(\"#\" + noteid ).attr(\"stroke\", \"#000\");\n            // $(\"#\" + noteid ).removeClassSVG(\"highlight\");\n\n            var element = document.querySelector('#' + noteid);\n            if (element) {\n              element.classList.remove('highlight');\n            }\n          }\n        });\n        ids = elementsattime.notes;\n\n        if (ids.includes(noteBounds.getBounds()?.rightMost?.id)) {\n          console.log('Stopping MIDI player');\n          window.midiPlayerStop();\n          midiStop();\n          return;\n        }\n        // for (var i=0; i<ids.length; i++) {\n        // \tif (matches = ids[i].match(/-L(\\d+)/)) {\n        // \t\tvar line = matches[1];\n        // \t\tif (line != LASTLINE) {\n        // \t\t\tshowIdInEditor(ids[i]);\n        // \t\t\tLASTLINE = line;\n        // \t\t}\n        // \t}\n        // }\n        var scrollParent = document.querySelector('#output');\n        var parentRect = scrollParent.getBoundingClientRect();\n        var scrolled = false;\n        var margin = 1 / 3;\n        ids.forEach(function (noteid) {\n          // console.log(\"NoteID\", noteid);\n\n          if ((matches = noteid.match(/-L(\\d+)/))) {\n            var line = parseInt(matches[1]);\n            // console.log(\"LASTLINE = \", LASTLINE, \"line =\", line);\n            if (line != LASTLINE && line > LASTLINE) {\n              showIdInEditor(noteid);\n              LASTLINE = line;\n            }\n          }\n\n          // $(\"#\" + noteid ).attr(\"fill\", \"#c00\");\n          // $(\"#\" + noteid ).attr(\"stroke\", \"#c00\");;\n          // $(\"#\" + noteid ).addClassSVG(\"highlight\");\n\n          var element = document.querySelector('#' + noteid);\n          if (element) {\n            element.classList.add('highlight');\n            /*\n\t\t\t\t\t\t\tvar classes = element.getAttribute(\"class\");\n\t\t\t\t\t\t\tvar classlist = classes.split(\" \");\n\t\t\t\t\t\t\tvar outclass = \"\";\n\t\t\t\t\t\t\tfor (var i=0; i<classlist.length; i++) {\n\t\t\t\t\t\t\t\tif (classlist[i] == \"highlight\") {\n\t\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\toutclass += \" \" + classlist[i];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\toutclass += \" highlight\";\n\t\t\t\t\t\t\telement.setAttribute(\"class\", outclass);*/\n            if (!scrolled) {\n              let system = element.closest('.system');\n              let rect;\n              let nextsystem = system.nextElementSibling;\n              if (system) {\n                rect = system.getBoundingClientRect();\n                /* Cannot use in Firefox:\n\t\t\t\t\t\t\t\t\tif (rect.top < parentRect.top) {\n\t\t\t\t\t\t\t\t\t\tscrollParent.scrollTop = scrollParent.scrollTop - (parentRect.top - rect.top) - rect.height * margin;\n\t\t\t\t\t\t\t\t\t\tscrolled = true;\n\t\t\t\t\t\t\t\t\t} else if (rect.bottom  > parentRect.bottom) {\n\t\t\t\t\t\t\t\t\t\tscrollParent.scrollTop = scrollParent.scrollTop + (rect.bottom - parentRect.bottom) + rect.height * margin;\n\t\t\t\t\t\t\t\t\t\tscrolled = true;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t*/\n                let nextrect;\n                let recttop;\n                let rectbottom;\n                let rectheight;\n\n                // Also need to deal with systems that are taller than view area...\n\n                if (nextsystem) {\n                  let nextnextsystem = nextsystem.nextElementSibling;\n                  nextrect = nextsystem.getBoundingClientRect();\n                  recttop = rect.top;\n                  rectbottom = nextrect.top;\n                  rectheight = rectbottom - recttop;\n                } else {\n                  recttop = rect.top;\n                  rectbottom = rect.bottom;\n                  rectheight = rectbottom - recttop;\n                }\n\n                if (recttop < parentRect.top) {\n                  // Scrolling backward in time:\n                  // scrollParent.scrollTop = scrollParent.scrollTop - (parentRect.top - recttop) - rectheight * margin;\n                  scrollParent.scrollTop =\n                    scrollParent.scrollTop -\n                    (parentRect.top - recttop) -\n                    rectheight * margin;\n                  scrolled = true;\n                } else if (rectbottom > parentRect.bottom) {\n                  // Scrolling forward in time:\n                  // scrollParent.scrollTop = scrollParent.scrollTop + (rectbottom - parentRect.bottom) + rectheight * margin;\n                  scrollParent.scrollTop =\n                    scrollParent.scrollTop +\n                    (recttop - parentRect.top) -\n                    parentRect.height / 20;\n                  scrolled = true;\n                }\n              }\n            }\n          }\n        });\n      }\n    }\n  });\n};\n\nwindow.midiUpdate = midiUpdate;\n\n//////////////////////////////\n//\n// midiStop -- Callback for WildWestMidi when stopping MIDI playback.\n//\n\nexport const midiStop = function () {\n  ids.forEach(function (noteid) {\n    // $(\"#\" + noteid ).attr(\"fill\", \"#000\");\n    // $(\"#\" + noteid ).attr(\"stroke\", \"#000\");\n    // .removeClassSVG is not working:\n    // $(\"#\" + noteid ).removeClassSVG(\"highlight\");\n\n    var element = document.querySelector('#' + noteid);\n    if (element) {\n      var classes = element.getAttribute('class');\n      var classlist = classes.split(' ');\n      var outclass = '';\n      for (var i = 0; i < classlist.length; i++) {\n        if (classlist[i] == 'highlight') {\n          continue;\n        }\n        outclass += ' ' + classlist[i];\n      }\n      element.setAttribute('class', outclass);\n    }\n  });\n\n  document.querySelectorAll('.highlight').forEach(note => note.classList.remove('highlight'));\n  $('#player').hide();\n  $('#play-button').show();\n  global_cursor.CursorNote = null;\n  global_playerOptions.PLAY = false;\n  LASTLINE = -1;\n};\n\n$.fn.addClassSVG = function (className) {\n  $(this).attr('class', function (index, existingClassNames) {\n    return existingClassNames + ' ' + className;\n  });\n  return this;\n};\n\n$.fn.removeClassSVG = function (className) {\n  $(this).attr('class', function (index, existingClassNames) {\n    //var re = new RegExp(className, 'g');\n    //return existingClassNames.replace(re, '');\n  });\n  return this;\n};\n","//\n// Programmer:    Craig Stuart Sapp <craig@ccrma.stanford.edu>\n// Creation Date: Sun Dec  2 08:11:05 EST 2018\n// Last Modified: Sun Dec 23 01:58:26 EST 2018\n// Filename:      humdrum-notation-plugin.js\n// Syntax:        JavaScript 1.8.5/ECMAScript 5.1\n// vim:           ts=3\n//\n//\tThis script sets up an editiable humdrum text region\n//\ton a webpage plus a dynamcially calculated SVG image\n//\tgenerated from the humdrum text using verovio.\n//\n//\tInput parameters for plugin styling:\n//\t\ttabsize:            default none (browser default)\n//\t\thumdrumMinHeight: the minimum height of the humdrum text box\n//\t\thumdrumMaxWidth:  the maximum width of the humdrum text box\n//\t\thumdrumMinWidth:  the maximum width of the humdrum text box\n//\t\thumdrumVisible:    \"false\" will hide the humdrum text.\n//\t\tcallback:           callback when notation changes\n//\n//\tParameters for verovio:\n//\thttp://www.verovio.org/command-line.xhtml\n//\n//\t\tadjustPageHeight default 1\n//\t\tborder           default 50\n//\t\tevenNoteSpacing  default 0\n//\t\tfont             default \"Leipzig\"\n//\t\tinputFrom        default \"auto\"\n//\t\t# page           default 1\n//\t\t# header         default 0\n//\t\t# footer         default 0\n//\t\tpageHeight       default 60000\n//\t\tpageWidth        default 1350\n//\t\tscale            default 40\n//\t\tspacingLinear    default 0.25\n//\t\tspacingNonLinear default 0.6\n//\t\tspacingStaff     default 12\n//\t\tspacingSystem    default 12\n//\n\n//\n// Programmer:    Craig Stuart Sapp <craig@ccrma.stanford.edu>\n// Creation Date: Sun Dec 23 01:47:54 EST 2018\n// Last Modified: Sun Dec 23 01:47:57 EST 2018\n// Filename:      _includes/code/global.js\n// Syntax:        JavaScript 1.8.5/ECMAScript 5.1\n// vim:           ts=3\n//\n// This file contains global functions for the Humdrum notation plugin.\n//\n\n'use strict';\n\nimport { featureIsEnabled } from './boostrap.js';\n//////////////////////////////\n//\n// DOMContentLoaded event listener --\n//\n\n// document.addEventListener(\"DOMContentLoaded\", function() {\n// \tdownloadVerovioToolkit(\"true\");\n// });\n\n/* global $ */\nimport { midiStop, midiUpdate } from './midifunctions.js';\nimport { global_interface } from './vhv-scripts/global-variables.js';\nimport {\n  monitorNotationUpdating,\n  displayNotation,\n  applyZoom,\n} from './vhv-scripts/misc.js';\nimport { getAceEditor } from './vhv-scripts/setup.js';\nimport { humdrumDataNoteIntoView } from './vhv-scripts/utility-ace.js';\nimport { markItem } from './vhv-scripts/utility-svg.js';\nimport { yProvider } from './yjs-setup.js';\n\nlet vrvWorker;\n\nexport function getVrvWorker() {\n  // Download verovio if the worker hasn't been initialized yet\n  if (typeof vrvWorker === 'undefined') {\n    downloadVerovioToolkit('true');\n  }\n  return vrvWorker;\n}\n\n//////////////////////////////\n//\n// downloadVerovioToolkit --\n//\n\nfunction downloadVerovioToolkit(use_worker) {\n  console.log('Downloading vrv toolkit from humdrum-notation-plugin-worker.js');\n  vrvWorker = new vrvInterface(use_worker, callbackAfterInitialized);\n  // window.vrvWorker = vrvWorker;\n}\n\nfunction callbackAfterInitialized() {\n  console.log('Initialized verovio worker');\n  initializeVerovioToolkit();\n}\n\nfunction initializeVerovioToolkit() {\n  // console.log(\"Verovio toolkit being initialized.\");\n\n  let editor = getAceEditor();\n  if (editor) {\n    editor.session.on('change', function (e) {\n      // console.log(\"EDITOR content changed\", e);\n      monitorNotationUpdating();\n    });\n\n    editor.getSession().selection.on('changeCursor', function () {\n      const { row, column } = editor.selection.getCursor();\n      const item = humdrumDataNoteIntoView(row, column);\n      // console.log('changeCursor event', { row, column, item })\n      if (item && item.classList.contains('note')) {\n        markItem(item);\n    \n        // createNewEditorSession({ item, row, column });\n        // createDraggableContainer(item);\n  \n        if (featureIsEnabled('collaboration')) {\n          if (yProvider) {\n            const localState = yProvider.awareness.getLocalState();\n        \n            yProvider.awareness.setLocalState({\n              ...localState,\n              singleSelect: { elemId: item.id },\n              multiSelect: null,\n            });\n          }\n        }\n      }\n    });\n  } else {\n    console.log('Warning: Editor not setup yet');\n  }\n\n  // $(window).resize(function() { applyZoom(); });\n  $(window).resize(function () {\n    displayNotation();\n  });\n\n  $('#input').mouseup(function () {\n    let $this = $(this);\n    if (\n      $this.outerWidth() != $this.data('x') ||\n      $this.outerHeight() != $this.data('y')\n    ) {\n      applyZoom();\n    }\n    $this.data('x', $this.outerWidth());\n    $this.data('y', $this.outerHeight());\n  });\n\n  if (!global_interface.ShowingIndex) {\n    console.log('Score will be displayed after verovio has finished loading');\n    displayNotation();\n  }\n\n  // downloadWildWebMidi('scripts/midiplayer/wildwebmidi.js');\n  initializeWildWebMidi();\n}\n\nfunction initializeWildWebMidi() {\n  $('#player').midiPlayer({\n    color: null,\n    // color: \"#c00\",\n    // onUnpdate: window.midiUpdate,\n    // onStop: window.midiStop,\n    onUnpdate: midiUpdate,\n    onStop: midiStop,\n    width: 250,\n    // locateFile: function () {\n    //   return 'wildwebmidi.data';\n    // }\n  });\n\n  $('#input').keydown(function () {\n    stop();\n  });\n\n  // window blur event listener -- Stop MIDI playback.  It is very computaionally\n  //    expensive, and is not useful if the window is not in focus.\n  window.addEventListener('blur', function () {\n    window.pause();\n  });\n}\n//////////////////////////////\n//\n// vrvInterface::vrvInterface --\n//\n\nfunction vrvInterface(use_worker, onReady) {\n  this.WIDTH = 0;\n  this.HEIGHT = 0;\n  this.page = 1;\n  this.pageCount = 0;\n  this.options = {};\n\n  this.initialized = false;\n  this.usingWorker = use_worker;\n\n  if (use_worker) {\n    this.createWorkerInterface(onReady);\n  } else {\n    this.createDefaultInterface(onReady);\n  }\n}\n\n//////////////////////////////\n//\n// vrvInterface::createWorkerInterface --\n//\nvrvInterface.prototype.createWorkerInterface = function (onReady) {\n  var vrv = this;\n\n  function handleEvent(oEvent) {\n    switch (oEvent.data.method) {\n      case 'ready':\n        vrv.initialized = true;\n        onReady();\n        break;\n      default:\n        while (vrv.resolvedIdx <= oEvent.data.idx) {\n          //resolve or reject\n          if (vrv.resolvedIdx === oEvent.data.idx) {\n            if (oEvent.data.success) {\n              vrv.promises[vrv.resolvedIdx].deferred.resolve(\n                oEvent.data.result\n              );\n            } else {\n              vrv.promises[vrv.resolvedIdx].deferred.reject(oEvent.data.result);\n            }\n          } else {\n            vrv.promises[vrv.resolvedIdx].deferred.reject();\n          }\n          if (vrv.promises[vrv.resolvedIdx].method === 'renderData') {\n            vrv.renderDataPending--;\n            if (vrv.renderDataPending === 0) vrv.handleWaitingRenderData();\n          }\n          delete vrv.promises[vrv.resolvedIdx];\n          vrv.resolvedIdx++;\n        }\n    }\n  }\n\n  console.log('creating verovio worker interface');\n  this.promises = {};\n  this.promiseIdx = 0;\n  this.resolvedIdx = 0;\n  this.renderDataPending = 0;\n  this.renderDataWaiting = null;\n\n  //\n  // \tconsole.log(\"LOADING https://verovio-script.humdrum.org/scripts/verovio-worker.js\");\n  // \tvar workerUrl = \"https://verovio-script.humdrum.org/scripts/verovio-worker.js\";\n  //\n\n  this.worker = null;\n  var that = this;\n  try {\n    // Worker script location need to be static, otherwise Vite won't transform them\n    if (import.meta.env.DEV) {\n      console.log('Loading development Verovio Worker');\n      that.worker = new Worker(new URL('./worker/verovio-worker-dev.js', import.meta.url));\n    } else {\n      console.log('Loading production Verovio Worker');\n      that.worker = new Worker(new URL('./worker/verovio-worker-prod.js', import.meta.url));\n    }\n    that.worker.addEventListener('message', handleEvent);\n\n    that.worker.onerror = function (event) {\n      event.preventDefault();\n      console.log(event);\n    };\n  } catch (e) {\n    console.log(e);\n  }\n};\n\n//////////////////////////////\n//\n// vrvInterface::checkInitialized --\n//\n\nvrvInterface.prototype.checkInitialized = function () {\n  if (!this.initialized) throw 'Verovio toolkit not (yet) initialized';\n};\n\n//////////////////////////////\n//\n// vrvInterface::filterData --\n//\n\nvrvInterface.prototype.filterData = function (opts, data, type) {\n  // Don't store options when filtering data.\n  return this.execute('filterData', arguments);\n};\n\n//////////////////////////////\n//\n// vrvInterface::renderData --\n//\n\nvrvInterface.prototype.renderData = function (opts, data, page) {\n  // console.log(\"%cvrvInterface.renderData\", \"color: #aa8800; font-weight: bold\");\n  this.options = opts;\n  return this.execute('renderData', arguments);\n};\n\n//////////////////////////////\n//\n// vrvInterface::getHumdrum --\n//\n\nvrvInterface.prototype.getHumdrum = function () {\n  // console.log(\"%cvrvInterface.getHumdrum\", \"color: #aa8800; font-weight: bold\");\n  var value = this.execute('getHumdrum', arguments);\n  return value;\n};\n\n//////////////////////////////\n//\n// vrvInterface::redoLayout --\n//\n\nvrvInterface.prototype.redoLayout = function (opts, redo, measure) {\n  // console.log(\"%cvrvInterface.redoLayout\", \"color: #8800aa; font-weight: bold\");\n  this.options = opts;\n  return this.execute('redoLayout', arguments);\n};\n\n//////////////////////////////\n//\n// vrvInterface::renderPage --\n//\n\nvrvInterface.prototype.renderPage = function (page) {\n  return this.execute('renderPage', arguments);\n};\n\n//////////////////////////////\n//\n// vrvInterface::renderAllPages --\n//\n\nvrvInterface.prototype.renderAllPages = function (data, opts) {\n  return this.execute('renderAllPages', arguments);\n};\n\n//////////////////////////////\n//\n// vrvInterface::gotoPage --\n//\n\nvrvInterface.prototype.gotoPage = function (page) {\n  var vrv = this;\n  return this.execute('gotoPage', arguments).then(function (obj) {\n    vrv.page = obj.page;\n    vrv.pageCount = obj.pageCount;\n    return page;\n  });\n};\n\n//////////////////////////////\n//\n// vrvInterface::getMEI --\n//\n\nvrvInterface.prototype.getMEI = function (page) {\n  return this.execute('getMEI', arguments);\n};\n\n//////////////////////////////\n//\n// vrvInterface::renderToMidi --\n//\n\nvrvInterface.prototype.renderToMidi = function () {\n  var value = this.execute('renderToMidi', arguments);\n  return value;\n};\n\n//////////////////////////////\n//\n// vrvInterface::getElementsAtTime --\n//\n\nvrvInterface.prototype.getElementsAtTime = function (vrvTime) {\n  return this.execute('getElementsAtTime', arguments);\n};\n\n//////////////////////////////\n//\n// vrvInterface::getTimeForElement --\n//\n\nvrvInterface.prototype.getTimeForElement = function (id) {\n  return this.execute('getTimeForElement', arguments);\n};\n\n//////////////////////////////\n//\n// vrvInterface::execute --\n//\n\nvrvInterface.prototype.execute = function (method, args) {\n  var vrv = this;\n  if (this.usingWorker) {\n    var arr = Array.prototype.slice.call(args);\n    switch (method) {\n      case 'renderData':\n        return vrv.postRenderData(method, arr);\n      default:\n        vrv.handleWaitingRenderData();\n        return vrv.post(method, arr);\n    }\n  } else {\n    return new RSVP.Promise(function (resolve, reject) {\n      try {\n        vrv.checkInitialized();\n        resolve(vrv.verovio[method].apply(vrv.verovio, args));\n      } catch (err) {\n        reject(err);\n      }\n    });\n  }\n};\n\n//////////////////////////////\n//\n// vrvInterface::handleWaitingRenderData --\n//\n\nvrvInterface.prototype.handleWaitingRenderData = function () {\n  if (this.renderDataWaiting) {\n    this.postDeferredMessage(\n      'renderData',\n      this.renderDataWaiting.args,\n      this.renderDataWaiting.deferred\n    );\n    this.renderDataWaiting = null;\n    this.renderDataPending++;\n  }\n};\n\n//////////////////////////////\n//\n// vrvInterface::postRenderData --\n//\n\nvrvInterface.prototype.postRenderData = function (method, args) {\n  // squash pending renderings:\n  if (this.renderDataPending > 0) {\n    if (!this.renderDataWaiting) {\n      this.renderDataWaiting = {\n        deferred: new RSVP.defer(),\n      };\n    }\n    this.renderDataWaiting.args = args;\n    return this.renderDataWaiting.deferred.promise;\n  } else {\n    this.renderDataPending++;\n    this.renderDataWaiting = null;\n    return this.post(method, args);\n  }\n};\n\n//////////////////////////////\n//\n// vrvInterface::post --\n//\n\nvrvInterface.prototype.post = function (method, args) {\n  return this.postDeferredMessage(method, args, new RSVP.defer());\n};\n\n//////////////////////////////\n//\n// vrvInterface::postDeferredMessage --\n//\n\nvrvInterface.prototype.postDeferredMessage = function (method, args, deferred) {\n  // console.log('Posting deferred message to Verovio worker', { method, args });\n  this.worker.postMessage({\n    idx: this.promiseIdx,\n    method: method,\n    args: args,\n  });\n  this.promises[this.promiseIdx] = {\n    method: method,\n    deferred: deferred,\n  };\n  this.promiseIdx++;\n  return deferred.promise;\n};\n","//\n// Programmer:     Craig Stuart Sapp <craig@ccrma.stanford.edu>\n// Creation Date:  Sat Jan  9 19:54:31 PST 2021\n// Last Modified:  Sun Jan 10 16:01:24 PST 2021\n// Filename:       highlight.js\n// Syntax:         ECMAScript 6\n// vim:            ts=3:nowrap:ft=javascript\n//\n// Description:    Interface to highlight SVG notation created from Humdrum\n//                 files.\n//\n\n///////////////////////////////////////////////////////////////////////////\n//\n// HnpMarkup class -- Interface to highlight and markup regions of a\n//                 verovio-generated SVG image.\n//\n\n//////////////////////////////\n//\n// HnpMarkup constructor -- Creat an HnpMarkup object.\n//    to create an object:\n//        let highligher = new HnpMarkup();\n//    to load an SVG image (an SVG element or a selector for an SVG element):\n//        highlighter.loadSvg(svg)\n//    functions starting with \"m_\" should be treated as private to the class.\n//\n\nexport function HnpMarkup() {\n  this.clear();\n  return this;\n}\n\n// function HnpMarkup() {\n// \tthis.clear();\n// \treturn this;\n// }\n\n// window.HnpMarkup = HnpMarkup;\n// console.log('Initialized HnpMarkup', window.HnpMarkup, HnpMarkup)\n\n//////////////////////////////\n//\n// HnpMarkup.prototype.clear -- Clear the contents of the highlighter.\n//\n\nHnpMarkup.prototype.clear = function () {\n  this.clearSvgInfo();\n};\n\n//////////////////////////////\n//\n// HnpMarkup.prototype.clearSvgInfo -- Clear information about\n//    the stored SVG image.  Does not clear highlighting database.\n//\n\nHnpMarkup.prototype.clearSvgInfo = function () {\n  this.m_svg = new HnpSvg();\n};\n\n//////////////////////////////\n//\n// HnpMarkup.prototype.loadSvg --\n//\n\nHnpMarkup.prototype.loadSvg = function (svg) {\n  let status = this.m_svg.loadSvg(svg);\n  if (!status) {\n    console.warn('Warning: could not load SVG image');\n  }\n  return status;\n};\n\n//////////////////////////////\n//\n// HnpMarkup.prototype.getMeasure --\n//\n\nHnpMarkup.prototype.getMeasure = function (barnum) {\n  if (!this.m_svg) {\n    return null;\n  }\n  return this.m_svg.getMeasure(barnum);\n};\n\n//////////////////////////////\n//\n// HnpMarkup.prototype.getMeasureElement --\n//\n\nHnpMarkup.prototype.getMeasureElement = function (barnum) {\n  if (!this.m_svg) {\n    return null;\n  }\n  let measure = this.m_svg.getMeasure(barnum);\n  if (!measure) {\n    return null;\n  }\n  if (typeof measure.element === 'undefined') {\n    return null;\n  }\n  return measure.element;\n};\n\n//////////////////////////////\n//\n// HnpMarkup.prototype.getLowerSystemMarkupElement --\n//\n\nHnpMarkup.prototype.getLowerSystemMarkupElement = function () {\n  return this.m_svg.getLowerSystemMarkupElement();\n};\n\n//////////////////////////////\n//\n// HnpMarkup.prototype.getLowerMeasureMarkupElement --\n//\n\nHnpMarkup.prototype.getLowerMeasureMarkupElement = function () {\n  return this.m_svg.getLowerMeasureMarkupElement();\n};\n\n//////////////////////////////\n//\n// HnpMarkup.prototype.highlightMeasure --\n//\n// Options:\n//     measure : the measure # to highlight\n//     opacity : 0.0 == transparent, 1.0 == opaque\n//     padding : units of 1/2 space between stafflines\n\nHnpMarkup.prototype.highlightMeasure = function (options) {\n  let measure;\n  let color;\n  let opacity;\n  let padding;\n\n  if (typeof options === 'number') {\n    measure = options;\n    color = 'goldenrod';\n    opacity = 0.25;\n    padding = 1;\n  } else if (typeof options === 'string') {\n    measure = parseInt(options);\n    color = 'goldenrod';\n    opacity = 0.25;\n    padding = 1;\n  } else {\n    measure = options.measure || 1;\n    color = options.color || 'goldenrod';\n    opacity = options.opacity || 0.25;\n    if (typeof options.padding !== 'undefined') {\n      padding = options.padding;\n    } else {\n      padding = 1;\n    }\n  }\n  if (measure < 0) {\n    return null;\n  }\n\n  let measureobj = this.getMeasure(measure);\n  if (!measureobj) {\n    return null;\n  }\n  let x = measureobj.getX();\n  let y = measureobj.getY();\n  let width = measureobj.getWidth();\n  let height = measureobj.getHeight();\n  let vu = measureobj.getVuScale();\n\n  if (padding > 0.0 && vu > 0.0) {\n    x = x - padding * vu;\n    y = y - padding * vu;\n    width = width + 2 * padding * vu;\n    height = height + 2 * padding * vu;\n  }\n\n  let mbox = document.createElementNS('http://www.w3.org/2000/svg', 'rect');\n  mbox.setAttribute('x', x);\n  mbox.setAttribute('y', y);\n  mbox.setAttribute('width', width);\n  mbox.setAttribute('height', height);\n  mbox.setAttribute('fill', color);\n  mbox.setAttribute('opacity', opacity);\n\n  let markupLayer = this.getLowerMeasureMarkupElement();\n  if (!markupLayer) {\n    return null;\n  }\n  markupLayer.appendChild(mbox);\n  return mbox;\n};\n\n///////////////////////////////////////////////////////////////////////////\n//\n// HnpSvg class -- Interface to verovio-generated SVG image of music notation.\n//\n\n//////////////////////////////\n//\n// HnpSvg constructor -- Creat an HnpSvg object.  This is used by the\n//    HnpMarkup class to interact with verovio-generated SVG image.\n//\n\nfunction HnpSvg() {\n  this.clear();\n  return this;\n}\n\n//////////////////////////////\n//\n// HnpSvg.prototype.clear -- Remove link to SVG image.\n//\n\nHnpSvg.prototype.clear = function () {\n  this.element = null;\n\n  // List of SVG system elements in image:\n  this.svgSystems = [];\n\n  // List of list of measure elements in each system:\n  this.svgSystemMeasures = [];\n\n  // List of all measures on the page (with other information added\n  // such as the measure number and bounding box of the measure).\n  this.svgMeasures = [];\n\n  ///////////////////////////\n  //\n  // Clear attributes relatd to the SVG image:\n  //\n\n  // pagemargin == element for the page region of the SVG image:\n  this.pagemargin = null;\n\n  // lowerMarkupLayer == element for storing highlights in SVG\n  // (behind the notation):\n  this.lowerMarkupElement = null;\n\n  // lowerSystemMarkups == element containing system highlights:\n  this.lowerSystemMarkupElement = null;\n\n  // lowerMeasureMarkupElement == element containing measure highlights:\n  this.lowerMeasureMarkupElement = null;\n};\n\n//////////////////////////////\n//\n// HnpSvg.prototype.loadSvg -- Load an svg image for later processing.\n//   Returns false if cannot load SVG.\n//\n\nHnpSvg.prototype.loadSvg = function (svg) {\n  this.clear();\n\n  // Verify the SVG image being loaded:\n  if (typeof svg === 'string') {\n    // Assume selector to SVG object:\n    let element = document.querySelector(svg);\n    if (!element) {\n      console.warn('Warning: Selector for SVG element is invalid', svg);\n      return false;\n    }\n    svg = element;\n  }\n  if (!svg) {\n    console.warn('Warning: SVG element not found');\n    return false;\n  }\n  let nodename = svg.nodeName;\n  if (nodename !== 'svg') {\n    console.warn('Warning: SVG element is not an SVG element:', svg);\n    return false;\n  }\n  this.element = svg;\n\n  // Create a list of systems in the SVG image:\n  let systems = svg.querySelectorAll('g[id^=\"system-\"].system');\n  if (!systems) {\n    console.warn('Warning: no systems in SVG image');\n    return false;\n  }\n  this.svgSystems = [];\n  for (let i = 0; i < systems.length; i++) {\n    let obj = {};\n    obj.element = systems[i];\n    this.svgSystems.push(obj);\n  }\n\n  // Create a 2D list of the measrues in the image.\n  // this.svgSystemMeasures indexes measures by system index, then measure\n  // index on that system.\n  this.svgSystemMeasures = [];\n  for (let i = 0; i < this.svgSystems.length; i++) {\n    let system = this.svgSystems[i].element;\n    let measures = system.querySelectorAll('g[id^=\"measure-\"].measure');\n    let m = [];\n    this.svgSystemMeasures.push(m);\n    if (!measures) {\n      continue;\n    }\n    for (let j = 0; j < measures.length; j++) {\n      let obj = new HnpSvgMeasure();\n      obj.element = measures[j];\n      obj.systemIndex = i;\n      obj.systemMeasureIndex = j;\n      obj.m_setMeasureNumber();\n      // Other measure information will be calculated\n      // when needed by .m_setMeasureInfo().\n      m.push(obj);\n    }\n  }\n\n  // Now create a 1D list of the measures in the SVG image\n  this.svgMeasures = [];\n  for (let i = 0; i < this.svgSystemMeasures.length; i++) {\n    let mlist = this.svgSystemMeasures[i];\n    for (let j = 0; j < mlist.length; j++) {\n      mlist[j].measureIndex = this.svgMeasures.length;\n      this.svgMeasures.push(mlist[j]);\n    }\n  }\n\n  // And create a lookup table by measure number.  Each measure\n  // index contains a list of measures with a given number\n  // (in case there are multiple measures with the same number).\n  this.measures = {};\n  for (let i = 0; i < this.svgMeasures.length; i++) {\n    let item = this.svgMeasures[i];\n    let number = item.number;\n    let obj = this.measures[number];\n    if (!obj) {\n      this.measures[number] = [];\n    }\n    obj = this.measures[number];\n    obj.push(item);\n  }\n\n  this.m_insertLowerMarkupLayer();\n\n  return true;\n};\n\n/////////////////////////////\n//\n// HnpSvg.prototype.m_insertLowerMarkupLayer = function () {\n//\n\nHnpSvg.prototype.m_insertLowerMarkupLayer = function () {\n  if (!this.element) {\n    console.warn('Error: no SVG image');\n    return;\n  }\n  let svg = this.element;\n  let pagemargin = svg.querySelector('.page-margin');\n  if (!pagemargin) {\n    console.warn('Error: invalid SVG image', svg);\n    return;\n  }\n  this.pagemargin = pagemargin;\n  let child = pagemargin.firstElementChild;\n  let classlist = child.classList;\n  let hasLayer = false;\n  for (let i = 0; i < classlist.length; i++) {\n    if (classlist[i] === 'lowerMarkupLayer') {\n      hasLayer = true;\n      break;\n    }\n  }\n  if (hasLayer) {\n    this.lowerMarkupElement = child;\n  } else {\n    let element = document.createElementNS('http://www.w3.org/2000/svg', 'g');\n    let parent = child.parentNode;\n    parent.prepend(element);\n    element.classList.add('lowerMarkupLayer');\n    this.lowerMarkupElement = element;\n  }\n\n  // fill in lowerMarkupLayer with sublayers:\n  this.lowerMarkupElement.innerHTML = '';\n\n  // Was declared global\n  let subelem;\n\n  subelem = document.createElementNS('http://www.w3.org/2000/svg', 'g');\n  subelem.classList.add('lowerSystemMarkups');\n  this.lowerMarkupElement.appendChild(subelem);\n  this.lowerSystemMarkupElement = subelem;\n\n  subelem = document.createElementNS('http://www.w3.org/2000/svg', 'g');\n  subelem.classList.add('lowerMeasureMarkups');\n  this.lowerMarkupElement.appendChild(subelem);\n  this.lowerMeasureMarkupElement = subelem;\n};\n\n//////////////////////////////\n//\n// HnpSvg.prototype.getLowerSystemMarkupElement --\n//\n\nHnpSvg.prototype.getLowerSystemMarkupElement = function () {\n  if (this.lowerSystemMarkupElement) {\n    return this.lowerSystemMarkupElement;\n  } else {\n    return null;\n  }\n};\n\n//////////////////////////////\n//\n// HnpSvg.prototype.getLowerMeasureMarkupElement --\n//\n\nHnpSvg.prototype.getLowerMeasureMarkupElement = function () {\n  if (this.lowerMeasureMarkupElement) {\n    return this.lowerMeasureMarkupElement;\n  } else {\n    return null;\n  }\n};\n\n//////////////////////////////\n//\n// HnpSvg.prototype.getMeasure --\n//\n\nHnpSvg.prototype.getMeasure = function (barnum) {\n  if (typeof barnum === 'undefined') {\n    console.log('Warning: no bar number given as input.');\n    return;\n  }\n  if (!this.measures) {\n    return null;\n  }\n  if (typeof barnum === 'string') {\n    barnum = parseInt(barnum);\n  }\n  let output = this.measures[barnum][0];\n  return output;\n};\n\n///////////////////////////////////////////////////////////////////////////\n//\n// HnpSvgMeasure class -- Interface to measure element int\n//     verovio-generated SVG image of music notation.\n//\n\n//////////////////////////////\n//\n// HnpSvgMeasure constructor -- Creat an HnpSvgMeasure object.\n//    to create an object:\n//        let measure = new HnpSvgMeasure();\n//\n\nfunction HnpSvgMeasure() {\n  this.clear();\n  return this;\n}\n\n//////////////////////////////\n//\n// HnpSvgMeasure.prototype.clear --\n//\n\nHnpSvgMeasure.prototype.clear = function () {\n  delete this.element; // measure element in SVG image.\n  delete this.number; // measure number extracted from element.\n};\n\n//////////////////////////////\n//\n// HnpSvgMeasure.prototype.getMeasureNumber --\n//\n\nHnpSvgMeasure.prototype.getMeasureNumber = function () {\n  if (typeof this.number !== 'undefined') {\n    return this.number;\n  }\n  this.m_setMeasureNumber();\n  return this.number;\n};\n\n//////////////////////////////\n//\n// HnpSvgMeasure.prototype.getMeasureElement --\n//\n\nHnpSvgMeasure.prototype.getMeasureElement = function () {\n  if (typeof this.element !== 'undefined') {\n    return this.element;\n  }\n  return null;\n};\n\n//////////////////////////////\n//\n// HnpSvgMeasure.prototype.m_setMeasureNumber --  Extract measure number\n//   from measure element.  It is stored as a class element in the form\n//   m-#.\n//\n\nHnpSvgMeasure.prototype.m_setMeasureNumber = function () {\n  if (typeof this.number !== 'undefined') {\n    return this.number;\n  }\n  let output = -1;\n  let measure = this.element;\n  if (!measure) {\n    return output;\n  }\n  let classlist = measure.classList;\n  for (let i = 0; i < classlist.length; i++) {\n    let matches = classlist[i].match(/m-(\\d+)/);\n    if (matches) {\n      output = parseInt(matches[1]);\n      break;\n    }\n  }\n  this.number = output;\n  return output;\n};\n\n//////////////////////////////\n//\n// HnpSvgMeasure.prototype.getX -- Return the top left corner horizontal\n//   position of the bounding box for a measure (positiver direction is\n//   to the right).  The X value may be influenced by a measure number,\n//   so this function will set the X position to the left barline instead.\n//\n\nHnpSvgMeasure.prototype.getX = function () {\n  if (typeof this.x !== 'undefined') {\n    return this.x;\n  }\n  this.m_setMeasureInfo();\n  return this.x;\n};\n\n//////////////////////////////\n//\n// HnpSvgMeasure.prototype.getY -- Return the top left corner vertical\n//    position of the bounding box for a measure (positive direction\n//    is down).\n//\n\nHnpSvgMeasure.prototype.getY = function () {\n  if (typeof this.y !== 'undefined') {\n    return this.y;\n  }\n  this.m_setMeasureInfo();\n  return this.y;\n};\n\n//////////////////////////////\n//\n// HnpSvgMeasure.prototype.getHeight --\n//\n\nHnpSvgMeasure.prototype.getHeight = function () {\n  if (typeof this.height !== 'undefined') {\n    return this.height;\n  }\n  this.m_setMeasureInfo();\n  return this.height;\n};\n\n//////////////////////////////\n//\n// HnpSvgMeasure.prototype.getWidth --\n//\n\nHnpSvgMeasure.prototype.getWidth = function () {\n  if (typeof this.width !== 'undefined') {\n    return this.width;\n  }\n  this.m_setMeasureInfo();\n  return this.width;\n};\n\n//////////////////////////////\n//\n// HnpSvgMeasure.prototype.getVuScale -- Return 1/2 the distance\n//   between staff lines.\n//\n\nHnpSvgMeasure.prototype.getVuScale = function () {\n  if (typeof this.vu !== 'undefined') {\n    return this.vu;\n  }\n  this.m_setMeasureInfo();\n  return this.vu;\n};\n\n//////////////////////////////\n//\n// HnpSvgMeasure.prototype.m_setMeasureInfo --\n//\n\nHnpSvgMeasure.prototype.m_setMeasureInfo = function () {\n  if (typeof this.x !== 'undefined') {\n    // Already have measure dimensions, do not recalculate.\n    return false;\n  }\n  if (!this.element) {\n    // No SVG element to process\n    console.log('NO SVG ELEMENT');\n    return false;\n  }\n\n  let bbox = this.element.getBBox();\n  let lines = this.element.querySelectorAll('.staff path');\n  if (lines.length <= 0) {\n    this.width = bbox.width;\n    console.warn('Warning: NO STAFF LINES IN MEASURE');\n    return false;\n  }\n  this.stafflines = lines;\n  this.m_setX();\n  this.y = bbox.y;\n  this.height = bbox.height;\n\n  let sbbox = this.stafflines[0].getBBox();\n  this.width = sbbox.width;\n\n  let status = this.m_setVuScale();\n  return status;\n};\n\n//////////////////////////////\n//\n// HnpSvgMeasure.prototype.m_setX -- The measure X position may be pushed\n//    to the left because of a measure number.  This function will instead\n//    look at the X position of the staff lines in the measure.\n//\n\nHnpSvgMeasure.prototype.m_setX = function () {\n  let stafflines = this.stafflines;\n  if (stafflines.length <= 0) {\n    console.log('STAFFLINES NOT FOUND');\n    this.x = 0.0;\n    return false;\n  }\n  let path1 = stafflines[0].getAttribute('d');\n  let y1;\n  let y2;\n  var matches = path1.match(/M([\\d.+-]+)/);\n  if (!matches) {\n    this.x = 0.0;\n    console.log('STAFFLINES NOT FOUND B');\n    return false;\n  } else {\n    this.x = parseFloat(matches[1]);\n    return true;\n  }\n};\n\n//////////////////////////////\n//\n// HnpSvgMeasure.prototype.m_setVuScale -- 1/2 of the distance between stafflines.\n//     Checking only the to staff of a system, and assuming all staves\n//     are the same size.\n//\n\nHnpSvgMeasure.prototype.m_setVuScale = function () {\n  let stafflines = this.stafflines;\n  if (stafflines.length <= 0) {\n    this.vu = 0.0;\n    return false;\n  }\n  let path1 = stafflines[0].getAttribute('d');\n  let y1;\n  let y2;\n  var matches = path1.match(/M[\\d.+-]+\\s+([\\d.+-]+)/);\n  if (!matches) {\n    this.vu = 0.0;\n    return false;\n  } else {\n    y1 = parseInt(matches[1]);\n  }\n  let path2 = stafflines[1].getAttribute('d');\n  matches = path2.match(/M[\\d.+-]+\\s+([\\d.+-]+)/);\n  if (!matches) {\n    this.vu = 0.0;\n    return false;\n  } else {\n    y2 = parseInt(matches[1]);\n  }\n  let difference = Math.abs(y2 - y1);\n  this.vu = difference;\n  return true;\n};\n\n//////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////\n//\n// scrollToMeasure -- Bring a particular measure into view at the\n//   top of the selected element.\n//\n// let scrollHash = true;\n// function scrollToMeasure(number, selector) {\n// \tif (!scrollHash) {\n// \t\treturn;\n// \t}\n// \tscrollHash = false;\n// \tlet scroller = document.querySelector(\"#output\");\n// \tlet element = window.MARKUP.getMeasureElement(number);\n// \tif (scroller && element) {\n// \t\tlet viewport = element.getBoundingClientRect();\n// \t\tlet topmargin = 100;\n// \t\tlet scrolly = viewport.y - topmargin;\n// \t\tif (scrolly < 0) {\n// \t\t\tscrolly = 0;\n// \t\t}\n// \t\tscroller.scrollTo(0, scrolly);\n// \t}\n// }\n","//\n// Programmer:     Craig Stuart Sapp <craig@ccrma.stanford.edu>\n// Creation Date:  Mon Oct 31 14:42:33 PDT 2016\n// Last Modified:  Tue Jan 31 04:12:38 PST 2017\n// Filename:       editor.js\n// Web Address:    https://verovio.humdrum.org/scripts/editor.js\n// Syntax:         JavaScript 1.8/ECMAScript 5\n// vim:            ts=3: ft=javascript\n//\n// Description:   Processing key commands to edit music.\n//\n\n// InterfaceSingleNumber: digit typed on the keyboard before\n// certain commands, suh as slurs, which indicates the number\n// of notes to include under the slur.  Or \"2\" for double-flats/\n// sharps, or for the transposing interval when changing pitch.\n// window.InterfaceSingleNumber = 0;\nexport let InterfaceSingleNumber = 0;\nexport function setInterfaceSingleNumber(value) {\n  let number = parseInt(value, 10) % 10;\n  InterfaceSingleNumber = number;\n}\n\nimport {\n  insertDirectionRdfs,\n  transposeDiatonic,\n  insertEditorialAccidentalRdf,\n  insertMarkedNoteRdf,\n} from './utility-humdrum.js';\nimport { getMenu } from '../menu.js';\n\n//////////////////////////////\n//\n// processNotationKey -- Also consider whether MEI or Humdrum is\n//    currently being displayed, but that would double the code...\n//\n\nexport function processNotationKey(key, element) {\n  var id = element.id;\n  var matches;\n\n  if ((matches = id.match(/L(\\d+)/))) {\n    var line = parseInt(matches[1]);\n  } else {\n    return; // required\n  }\n\n  if ((matches = id.match(/F(\\d+)/))) {\n    var field = parseInt(matches[1]);\n  } else {\n    return; // required\n  }\n\n  if ((matches = id.match(/S(\\d+)/))) {\n    var subfield = parseInt(matches[1]);\n  } else {\n    subfield = null;\n  }\n\n  if ((matches = id.match(/N(\\d+)/))) {\n    var number = parseInt(matches[1]);\n  } else {\n    number = 1;\n  }\n\n  if ((matches = id.match(/^([a-z]+)-/))) {\n    var name = matches[1];\n  } else {\n    return; // required\n  }\n\n  if (line < 1 || field < 1) {\n    return;\n  }\n\n  var line2 = 0;\n  var field2 = 0;\n  var subfield2 = 0;\n  var number2 = 1;\n\n  if ((matches = id.match(/^[^-]+-[^-]+-.*L(\\d+)/))) {\n    line2 = parseInt(matches[1]);\n  }\n  if ((matches = id.match(/^[^-]+-[^-]+-.*F(\\d+)/))) {\n    field2 = parseInt(matches[1]);\n  }\n  if ((matches = id.match(/^[^-]+-[^-]+-.*S(\\d+)/))) {\n    subfield2 = parseInt(matches[1]);\n  }\n  if ((matches = id.match(/^[^-]+-[^-]+-.*N(\\d+)/))) {\n    number2 = parseInt(matches[1]);\n  }\n\n  if (key === 'esc') {\n    // window.MENU.hideContextualMenus();\n    getMenu().hideContextualMenus();\n    global_cursor.HIGHLIGHTQUERY = '';\n    if (!element) {\n      return;\n    }\n    var classes = element.getAttribute('class');\n    var classlist = classes.split(' ');\n    var outclass = '';\n    for (var i = 0; i < classlist.length; i++) {\n      if (classlist[i] == 'highlight') {\n        continue;\n      }\n      outclass += ' ' + classlist[i];\n    }\n    element.setAttribute('class', outclass);\n    global_cursor.CursorNote = '';\n    return;\n  }\n\n  if (name === 'note') {\n    if (key === 'y') {\n      toggleVisibility(id, line, field);\n    } else if (key === 'a') {\n      setStemAboveMarker(id, line, field);\n    } else if (key === 'b') {\n      setStemBelowMarker(id, line, field);\n    } else if (key === 'c') {\n      deleteStemMarker(id, line, field);\n    } else if (key === '#') {\n      toggleSharp(id, line, field, subfield);\n    } else if (key === '-') {\n      toggleFlat(id, line, field, subfield);\n    } else if (key === 'i') {\n      toggleEditorialAccidental(id, line, field, subfield);\n    } else if (key === 'n') {\n      toggleNatural(id, line, field, subfield);\n    } else if (key === 'm') {\n      toggleMordent('m', id, line, field, subfield);\n    } else if (key === 'M') {\n      toggleMordent('M', id, line, field, subfield);\n    } else if (key === 'w') {\n      toggleMordent('w', id, line, field, subfield);\n    } else if (key === 'W') {\n      toggleMordent('W', id, line, field, subfield);\n    } else if (key === 'X') {\n      toggleExplicitAccidental(id, line, field, subfield);\n    } else if (key === 'L') {\n      startNewBeam(element, line, field);\n    } else if (key === 'J') {\n      endNewBeam(element, line, field);\n    } else if (key === 'transpose-up-step') {\n      transposeNote(id, line, field, subfield, +1);\n    } else if (key === 'transpose-down-step') {\n      transposeNote(id, line, field, subfield, -1);\n    } else if (key === 'transpose-up-octave') {\n      transposeNote(id, line, field, subfield, +7);\n    } else if (key === 'transpose-down-octave') {\n      transposeNote(id, line, field, subfield, -7);\n    } else if (key === \"'\") {\n      toggleStaccato(id, line, field);\n    } else if (key === '^') {\n      toggleAccent(id, line, field);\n    } else if (key === '^^') {\n      toggleMarcato(id, line, field);\n    } else if (key === '~') {\n      toggleTenuto(id, line, field);\n    } else if (key === 's') {\n      addSlur(id, line, field);\n    } else if (key === 'q') {\n      toggleGraceNoteType(id, line, field);\n    } else if (key === 'p') {\n      console.log('p pressed');\n      togglePedalStart(id, line, field);\n    } else if (key === 'P') {\n      togglePedalEnd(id, line, field);\n    } else if (key === 't') {\n      toggleMinorTrill(id, line, field);\n    } else if (key === 'T') {\n      toggleMajorTrill(id, line, field);\n    } else if (key === '`') {\n      toggleStaccatissimo(id, line, field);\n    } else if (key === ';') {\n      toggleFermata(id, line, field);\n    } else if (key === ':') {\n      toggleArpeggio(id, line, field);\n    } else if (key === '1') {\n      InterfaceSingleNumber = 1;\n    } else if (key === '2') {\n      InterfaceSingleNumber = 2;\n    } else if (key === '3') {\n      InterfaceSingleNumber = 3;\n    } else if (key === '4') {\n      InterfaceSingleNumber = 4;\n    } else if (key === '5') {\n      InterfaceSingleNumber = 5;\n    } else if (key === '6') {\n      InterfaceSingleNumber = 6;\n    } else if (key === '7') {\n      InterfaceSingleNumber = 7;\n    } else if (key === '8') {\n      InterfaceSingleNumber = 8;\n    } else if (key === '9') {\n      InterfaceSingleNumber = 9;\n    } else if (key === '@') {\n      toggleMarkedNote(id, line, field, subfield);\n    }\n  } else if (name === 'rest') {\n    if (key === 'y') {\n      toggleVisibility(id, line, field);\n    } else if (key === ';') {\n      toggleFermata(id, line, field);\n    } else if (key === 'L') {\n      startNewBeam(element, line, field);\n    } else if (key === 'J') {\n      endNewBeam(element, line, field);\n    }\n  } else if (name === 'dynam') {\n    if (key === 'a') {\n      setDynamAboveMarker(id, line, field, number);\n    } else if (key === 'b') {\n      setDynamBelowMarker(id, line, field, number);\n    } else if (key === 'c') {\n      deleteDynamDirectionMarker(id, line, field, number);\n    }\n  } else if (name === 'hairpin') {\n    if (key === 'a') {\n      setHairpinAboveMarker(id, line, field, number);\n    } else if (key === 'b') {\n      setHairpinBelowMarker(id, line, field, number);\n    } else if (key === 'c') {\n      deleteHairpinDirectionMarker(id, line, field, number);\n    }\n  } else if (name === 'slur') {\n    if (key === 'a') {\n      setSlurAboveMarker(id, line, field, number);\n    } else if (key === 'b') {\n      setSlurBelowMarker(id, line, field, number);\n    } else if (key === 'c') {\n      deleteSlurDirectionMarker(id, line, field, number);\n    } else if (key === 'D') {\n      deleteSlur(id, line, field, number, line2, field2, number2);\n    } else if (key === 'delete') {\n      deleteSlur(id, line, field, number, line2, field2, number2);\n    }\n    // else if (key === \"f\")  { flipSlurDirection(id, line, field, number); }\n    else if (key === 'leftEndMoveBack') {\n      leftEndMoveBack(id, line, field, number, line2, field2, number2);\n    } else if (key === 'leftEndMoveForward') {\n      leftEndMoveForward(id, line, field, number, line2, field2, number2);\n    } else if (key === 'rightEndMoveForward') {\n      rightEndMoveForward(id, line, field, number, line2, field2, number2);\n    } else if (key === 'rightEndMoveBack') {\n      rightEndMoveBack(id, line, field, number, line2, field2, number2);\n    } else if (key === '1') {\n      InterfaceSingleNumber = 1;\n    } else if (key === '2') {\n      InterfaceSingleNumber = 2;\n    } else if (key === '3') {\n      InterfaceSingleNumber = 3;\n    } else if (key === '4') {\n      InterfaceSingleNumber = 4;\n    } else if (key === '5') {\n      InterfaceSingleNumber = 5;\n    } else if (key === '6') {\n      InterfaceSingleNumber = 6;\n    } else if (key === '7') {\n      InterfaceSingleNumber = 7;\n    } else if (key === '8') {\n      InterfaceSingleNumber = 8;\n    } else if (key === '9') {\n      InterfaceSingleNumber = 9;\n    }\n  } else if (name === 'tie') {\n    // need to fix tie functions to deal with chord notes (subfield values):\n    if (key === 'a') {\n      setTieAboveMarker(id, line, field, subfield);\n    } else if (key === 'b') {\n      setTieBelowMarker(id, line, field, subfield);\n    } else if (key === 'c') {\n      deleteTieDirectionMarker(id, line, field, subfield);\n    }\n    // else if (key === \"f\")  { flipTieDirection(id, line, field, subfield); }\n  } else if (name === 'beam') {\n    if (key === 'a') {\n      setBeamAboveMarker(id, line, field);\n    } else if (key === 'b') {\n      setBeamBelowMarker(id, line, field);\n    } else if (key === 'c') {\n      deleteBeamDirectionMarker(id, line, field);\n    }\n    // else if (key === \"f\")  { flipBeamDirection(id, line, field); }\n  }\n}\n\n///////////////////////////////////////////////////////////////////////////\n//\n// Beam editing --\n//\n\n//////////////////////////////\n//\n// setBeamAboveMarker --\n//\n\nfunction setBeamAboveMarker(id, line, field) {\n  // console.log(\"SET BEAM ABOVE\", token, line, field, id);\n  var token = getEditorContents(line, field);\n  if (token === '.' || token[0] == '!' || token[0] == '*') {\n    return;\n  }\n  var directions = insertDirectionRdfs();\n  var above = directions[0];\n  var below = directions[1];\n  var re = new RegExp(\n    '([^LJKk]*)([LJKk]+)([' + above + below + ']*)([^LJKk]*)'\n  );\n  var matches = re.exec(token);\n  if (!matches) {\n    return;\n  } else {\n    var newtoken = matches[1];\n    newtoken += matches[2];\n    newtoken += above;\n    newtoken += matches[4];\n  }\n\n  // console.log(\"OLDTOKEN\", token, \"NEWTOKEN\", newtoken);\n  if (newtoken !== token) {\n    global_cursor.RestoreCursorNote = id;\n    global_cursor.HIGHLIGHTQUERY = id;\n    setEditorContents(line, field, newtoken, id);\n  }\n}\n\n//////////////////////////////\n//\n// setBeamBelowMarker --\n//\n\nfunction setBeamBelowMarker(id, line, field) {\n  // console.log(\"SET BEAM BELOW\", token, line, field, id);\n  var token = getEditorContents(line, field);\n  if (token === '.' || token[0] == '!' || token[0] == '*') {\n    return;\n  }\n  var directions = insertDirectionRdfs();\n  var above = directions[0];\n  var below = directions[1];\n  var re = new RegExp(\n    '([^LJKk]*)([LJKk]+)([' + above + below + ']*)([^LJKk]*)'\n  );\n  var matches = re.exec(token);\n  if (!matches) {\n    return;\n  } else {\n    var newtoken = matches[1];\n    newtoken += matches[2];\n    newtoken += below;\n    newtoken += matches[4];\n  }\n\n  // console.log(\"OLDTOKEN\", token, \"NEWTOKEN\", newtoken);\n  if (newtoken !== token) {\n    global_cursor.RestoreCursorNote = id;\n    global_cursor.HIGHLIGHTQUERY = id;\n    setEditorContents(line, field, newtoken, id);\n  }\n}\n\n//////////////////////////////\n//\n// deleteBeamDirectionMarker --\n//\n\nfunction deleteBeamDirectionMarker(id, line, field) {\n  // console.log(\"REMOVE BEAM DIRECTION\", token, line, field, id);\n  var token = getEditorContents(line, field);\n  if (token === '.' || token[0] == '!' || token[0] == '*') {\n    return;\n  }\n  var directions = insertDirectionRdfs();\n  var above = directions[0];\n  var below = directions[1];\n  var re = new RegExp(\n    '([^LJKk]*)([LJKk]+)([' + above + below + ']*)([^LJKk]*)'\n  );\n  var matches = re.exec(token);\n  if (!matches) {\n    return;\n  } else {\n    var newtoken = matches[1];\n    newtoken += matches[2];\n    newtoken += matches[4];\n  }\n\n  // console.log(\"OLDTOKEN\", token, \"NEWTOKEN\", newtoken);\n  if (newtoken !== token) {\n    global_cursor.RestoreCursorNote = id;\n    global_cursor.HIGHLIGHTQUERY = id;\n    setEditorContents(line, field, newtoken, id);\n  }\n}\n\n///////////////////////////////////////////////////////////////////////////\n//\n// Dynamics editing --\n//\n\n//////////////////////////////\n//\n// setDynamAboveMarker -- Move dynamic above staff.\n//\n\nfunction setDynamAboveMarker(id, line, field, number) {\n  setAboveMarker(id, line, field, number, 'DY');\n}\n\n//////////////////////////////\n//\n// setDynamBelowMarker -- Move dynamic below staff.\n//\n\nfunction setDynamBelowMarker(id, line, field, number) {\n  setBelowMarker(id, line, field, number, 'DY');\n}\n\n//////////////////////////////\n//\n// deleteDynamDirectionMarker -- Remove layout code for dynamic positioning.\n//\n\nfunction deleteDynamDirectionMarker(id, line, field, number) {\n  deleteDirectionMarker(id, line, field, number, 'DY');\n}\n\n///////////////////////////////////////////////////////////////////////////\n//\n// Hairpin layout paramters --\n//\n\n//////////////////////////////\n//\n// setHairpinAboveMarker -- Set to HP layout code later\n//\n\nfunction setHairpinAboveMarker(id, line, field, number) {\n  setAboveMarker(id, line, field, number, 'HP');\n}\n\n//////////////////////////////\n//\n// setHairpinBelowMarker --\n//\n\nfunction setHairpinBelowMarker(id, line, field, number) {\n  setBelowMarker(id, line, field, number, 'HP');\n}\n\n//////////////////////////////\n//\n// deleteHairpinDirectionMarker -- remove layout code for hairpins.\n//\n\nfunction deleteHairpinDirectionMarker(id, line, field, number) {\n  deleteDirectionMarker(id, line, field, number, 'HP');\n}\n\n///////////////////////////////////////////////////////////////////////////\n//\n// Generic Layout functions --\n//\n\n//////////////////////////////\n//\n// setAboveMarker -- Add layut code for above parameter.\n//\n\nfunction setAboveMarker(id, line, field, number, category) {\n  var token = getEditorContents(line, field);\n  if (token === '.' || token[0] == '!' || token[0] == '*') {\n    return;\n  }\n\n  var editQ = false;\n  var lastline = line - 1;\n  var ptoken = getEditorContents(lastline, field);\n  var idlineadj = 0;\n  if (!ptoken.match(/^!LO/)) {\n    createEmptyLine(line);\n    idlineadj = 1;\n    line += 1;\n    lastline = line - 1;\n    ptoken = '!';\n    editQ = true;\n  }\n\n  if (ptoken.match(/^!LO/)) {\n    if (ptoken.match(/:b(?=:|=|$)/)) {\n      // Change to :a (not very elegant if there is a parameter starting with \"b\":\n      ptoken = ptoken.replace(/:b(?=:|=|$)/, ':a');\n      editQ = true;\n    } else if (ptoken.match(/:a(:|=|$)/)) {\n      // Do nothing\n    } else {\n      // Assuming no other parameters, but may be clobbering something.\n      // (so fix later):\n      ptoken = '!LO:' + category + ':a';\n      editQ = true;\n    }\n  } else if (ptoken == '!') {\n    ptoken = '!LO:' + category + ':a';\n    editQ = true;\n  } else {\n    console.log('ERROR TOGGLING ABOVE DIRECTION');\n  }\n\n  if (idlineadj != 0) {\n    id = id.replace('L' + (line - 1), 'L' + (line + idlineadj - 1));\n  }\n\n  if (editQ) {\n    global_cursor.RestoreCursorNote = id;\n    global_cursor.HIGHLIGHTQUERY = id;\n    setEditorContents(lastline, field, ptoken, id);\n  }\n}\n\n//////////////////////////////\n//\n// setBelowMarker -- Add layout code for below parameter.\n//\n\nfunction setBelowMarker(id, line, field, number, category) {\n  var token = getEditorContents(line, field);\n  if (token === '.' || token[0] == '!' || token[0] == '*') {\n    return;\n  }\n\n  var editQ = false;\n  var lastline = line - 1;\n  var ptoken = getEditorContents(lastline, field);\n  var idlineadj = 0;\n  if (!ptoken.match(/^!LO/)) {\n    createEmptyLine(line);\n    idlineadj = 1;\n    line += 1;\n    lastline = line - 1;\n    ptoken = '!';\n    editQ = true;\n  }\n\n  if (ptoken.match(/^!LO/)) {\n    if (ptoken.match(/:a(?=:|=|$)/)) {\n      // Change to :b (not very elegant if there is a parameter starting with \"b\":\n      ptoken = ptoken.replace(/:a(?=:|=|$)/, ':b');\n      editQ = true;\n    } else if (ptoken.match(/:b(:|=|$)/)) {\n      // Do nothing\n    } else {\n      // Assuming no other parameters, but may be clobbering something.\n      // (so fix later):\n      ptoken = '!LO:' + category + ':b';\n      editQ = true;\n    }\n  } else if (ptoken == '!') {\n    ptoken = '!LO:' + category + ':b';\n    editQ = true;\n  } else {\n    console.log('ERROR TOGGLING ABOVE DIRECTION');\n  }\n\n  if (idlineadj != 0) {\n    id = id.replace('L' + (line - 1), 'L' * +(line + idlineadj - 1));\n  }\n\n  if (editQ) {\n    global_cursor.RestoreCursorNote = id;\n    global_cursor.HIGHLIGHTQUERY = id;\n    setEditorContents(lastline, field, ptoken, id);\n  }\n}\n\n//////////////////////////////\n//\n// deleteDirectionMarker -- remove layout code for hairpins.\n//\nimport { displayNotation } from './misc.js';\nimport { highlightIdInEditor, turnOffAllHighlights } from './utility-svg.js';\nimport { getAceEditor } from './setup.js';\nimport {\n  global_cursor,\n  global_editorOptions,\n  global_interface,\n} from './global-variables.js';\n\nconst editor = getAceEditor();\nif (!editor) {\n  throw new Error('Ace Editor is undefined');\n}\n\nfunction deleteDirectionMarker(id, line, field, number, category) {\n  line = parseInt(line);\n  var token = getEditorContents(line - 1, field);\n  if (token[0] !== '!') {\n    // don't know what to do.\n    return;\n  }\n  var editQ = false;\n  var re = new RegExp('^!LO:' + category + ':');\n  if (token.match(re)) {\n    token = '!';\n    editQ = true;\n  } else {\n    // don't know what to do\n    return;\n  }\n  if (!editQ) {\n    return;\n  }\n\n  setEditorContents(line - 1, field, token, id, true);\n\n  var text = editor.session.getLine(line - 2);\n  if (text.match(/^[!\\t]+$/)) {\n    // remove line\n    var range = new Range(line - 2, 0, line - 1, 0);\n\n    editor.session.remove(range);\n\n    global_cursor.RestoreCursorNote = id.replace('L' + line, 'L' + (line - 1));\n    displayNotation();\n    highlightIdInEditor(global_cursor.RestoreCursorNote);\n  }\n}\n\n//////////////////////////////\n//\n// createEmptyLine -- Create a null local comment line.  See addNullLine()\n//    which can probably replace this function.\n//\n\nfunction createEmptyLine(line) {\n  var freezeBackup = global_interface.FreezeRendering;\n  if (global_interface.FreezeRendering == false) {\n    global_interface.FreezeRendering = true;\n  }\n\n  var text = editor.session.getLine(line - 1);\n  var output = '';\n  if (text[0] == '\\t') {\n    output += '\\t';\n  } else {\n    output += '!';\n  }\n  var i;\n  for (i = 1; i < text.length; i++) {\n    if (text[i] == '\\t') {\n      output += '\\t';\n    } else if (text[i] != '\\t' && text[i - 1] == '\\t') {\n      output += '!';\n    }\n  }\n  output += '\\n' + text;\n\n  var range = new Range(line - 1, 0, line - 1, text.length);\n  editor.session.replace(range, output);\n\n  // don't redraw the data\n  global_interface.FreezeRendering = freezeBackup;\n}\n\n///////////////////////////////////////////////////////////////////////////\n//\n// Slur editing --\n//\n\n//////////////////////////////\n//\n// setSlurAboveMarker --\n//\n\nfunction setSlurAboveMarker(id, line, field, number) {\n  var token = getEditorContents(line, field);\n  if (token === '.' || token[0] == '!' || token[0] == '*') {\n    return;\n  }\n  // console.log(\"TOGGLE SLUR ABOVE\", token, line, field, number, id);\n\n  var directions = insertDirectionRdfs();\n  var above = directions[0];\n  var below = directions[1];\n  var counter = 0;\n  var newtoken = '';\n  for (var i = 0; i < token.length; i++) {\n    if (token[i] == '(') {\n      counter++;\n    }\n    newtoken += token[i];\n    if (counter != number) {\n      continue;\n    }\n    if (token[i + 1] == above) {\n      counter++;\n      continue;\n    } else if (token[i + 1] == below) {\n      newtoken += above;\n      i++;\n      counter++;\n      continue;\n    } else {\n      newtoken += above;\n      counter++;\n      continue;\n    }\n  }\n\n  // console.log(\"OLDTOKEN\", token, \"NEWTOKEN\", newtoken);\n  if (newtoken !== token) {\n    global_cursor.RestoreCursorNote = id;\n    global_cursor.HIGHLIGHTQUERY = id;\n    setEditorContents(line, field, newtoken, id);\n  }\n}\n\n//////////////////////////////\n//\n// setSlurBelowMarker --\n//\n\nfunction setSlurBelowMarker(id, line, field, number) {\n  var token = getEditorContents(line, field);\n  if (token === '.' || token[0] == '!' || token[0] == '*') {\n    // nothing to do, just a null data token\n    return;\n  }\n  var token = getEditorContents(line, field);\n  // console.log(\"TOGGLE SLUR BELOW\", token, line, field, number, id);\n\n  var directions = insertDirectionRdfs();\n  var above = directions[0];\n  var below = directions[1];\n  var counter = 0;\n  var newtoken = '';\n  for (var i = 0; i < token.length; i++) {\n    if (token[i] == '(') {\n      counter++;\n    }\n    newtoken += token[i];\n    if (counter != number) {\n      continue;\n    }\n    if (token[i + 1] == below) {\n      counter++;\n      continue;\n    } else if (token[i + 1] == above) {\n      newtoken += below;\n      i++;\n      counter++;\n      continue;\n    } else {\n      newtoken += below;\n      counter++;\n      continue;\n    }\n  }\n\n  // console.log(\"OLDTOKEN\", token, \"NEWTOKEN\", newtoken);\n  if (newtoken !== token) {\n    global_cursor.RestoreCursorNote = id;\n    global_cursor.HIGHLIGHTQUERY = id;\n    setEditorContents(line, field, newtoken, id);\n  }\n}\n\n//////////////////////////////\n//\n// deleteSlurDirectionMarker --\n//\n\nfunction deleteSlurDirectionMarker(id, line, field, number) {\n  var token = getEditorContents(line, field);\n  if (token === '.' || token[0] == '!' || token[0] == '*') {\n    return;\n  }\n  //console.log(\"DELETE SLUR DIRECTION\", token, line, field, number, id);\n\n  var directions = insertDirectionRdfs();\n  var above = directions[0];\n  var below = directions[1];\n  var counter = 0;\n  var newtoken = '';\n  for (var i = 0; i < token.length; i++) {\n    if (token[i] == '(') {\n      counter++;\n    }\n    newtoken += token[i];\n    if (counter != number) {\n      continue;\n    }\n    if (token[i + 1] == below) {\n      i++;\n      counter++;\n      continue;\n    } else if (token[i + 1] == above) {\n      i++;\n      counter++;\n      continue;\n    } else {\n      counter++;\n      continue;\n    }\n  }\n\n  // console.log(\"OLDTOKEN\", token, \"NEWTOKEN\", newtoken);\n  if (newtoken !== token) {\n    global_cursor.RestoreCursorNote = id;\n    global_cursor.HIGHLIGHTQUERY = id;\n    setEditorContents(line, field, newtoken, id);\n  }\n}\n\n//////////////////////////////\n//\n// leftEndMoveBack -- Only woks in regions where spines don't split or merge.\n//\n\nfunction leftEndMoveBack(id, line, field, number, line2, field2, number2) {\n  console.log('LEFT END MOVE BACK');\n  var token1 = getEditorContents(line, field);\n  if (parseInt(line) >= parseInt(line2)) {\n    return;\n  }\n  var i = line - 2; // -1 for 0-index and -1 for line after\n  var counter = 0;\n  var target = InterfaceSingleNumber;\n  if (!target) {\n    target = 1;\n  }\n\n  while (i > 0) {\n    var text = editor.session.getLine(i);\n    if (\n      text.match(/^\\*/) ||\n      text.match(/^=/) ||\n      text.match(/^!/) ||\n      text === ''\n    ) {\n      i--;\n      continue;\n    }\n    var token2 = getEditorContents(i + 1, field);\n    if (token2.match(/[A-G]/i)) {\n      counter++;\n    }\n    if (counter != target) {\n      i--;\n      continue;\n    }\n    break;\n  }\n\n  console.log(\n    'LEFTENDMOVEBACK NEW',\n    token1,\n    line,\n    field,\n    number,\n    token2,\n    i + 1,\n    id\n  );\n\n  if (i <= 0) {\n    // no note to attach to\n    return;\n  }\n  if (text[0] == '*' || text[0] == '!' || text === '') {\n    // no note to attach to\n    return;\n  }\n\n  var freezeBackup = global_interface.FreezeRendering;\n  global_interface.FreezeRendering = true;\n  var slurstart = deleteSlurStart(id, line, field, number);\n  if (slurstart !== '') {\n    addSlurStart(id, i + 1, field, slurstart);\n  }\n  global_interface.FreezeRendering = freezeBackup;\n  displayNotation();\n\n  InterfaceSingleNumber = 0;\n}\n\n//////////////////////////////\n//\n// addSlur -- add a slur to a note, which goes to the next note in the field.\n//\n\nfunction addSlur(id, line, field) {\n  var token = getEditorContents(line, field);\n  var freezeBackup = global_interface.FreezeRendering;\n  global_interface.FreezeRendering = true;\n  addSlurStart(id, line, field, '(');\n\n  var i = parseInt(line); // -1 for 0-index and +1 for line after\n  var counter = 0;\n  var size = editor.session.getLength();\n\n  var target = InterfaceSingleNumber;\n  if (!target) {\n    target = 1;\n  }\n\n  while (i < size) {\n    var text = editor.session.getLine(i);\n    if (\n      text.match(/^\\*/) ||\n      text.match(/^=/) ||\n      text.match(/^!/) ||\n      text === ''\n    ) {\n      i++;\n      continue;\n    }\n    var token2 = getEditorContents(i + 1, field);\n    if (token2.match(/[A-G]/i)) {\n      counter++;\n    }\n    if (counter != target) {\n      i++;\n      continue;\n    }\n    break;\n  }\n\n  if (i >= size) {\n    // no note to attach to\n    return;\n  }\n  if (text[0] == '*' || text[0] == '!' || text === '') {\n    // no note to attach to\n    return;\n  }\n  if (i + 1 <= line) {\n    // do not pass slur begin\n    return;\n  }\n\n  addSlurEnd(id, i + 1, field, ')');\n  var newid = id.replace(/^note-/, 'slur-');\n  // FIX N number here later:\n  var ending = '-L' + (i + 1) + 'F' + field + 'N' + 1;\n  newid += ending;\n  global_interface.FreezeRendering = freezeBackup;\n  if (!global_interface.FreezeRendering) {\n    displayNotation(null, null, newid);\n  }\n  InterfaceSingleNumber = 0;\n\n  // for some reason the highlighting is lost on the note,\n  // so add it back:\n  // wait for worker to finish redrawing?\n  setTimeout(function () {\n    var element = document.querySelector('svg g#' + id);\n    if (element) {\n      var classname = element.getAttribute('class');\n      if (!classname.match(/\\bhighlight\\b/)) {\n        classname += ' highlight';\n        element.setAttribute('class', classname);\n      }\n      global_cursor.CursorNote = element;\n    }\n  }, 300);\n}\n\n//////////////////////////////\n//\n// addSlurStart --\n//\n\nfunction addSlurStart(id, line, field, slurstart) {\n  var token = getEditorContents(line, field);\n  var newtoken = '';\n  for (var i = token.length - 1; i >= 0; i--) {\n    if (token[i] == '(') {\n      // need to insert new slur after last one\n      newtoken = token.substring(0, i + 1);\n      newtoken += slurstart;\n      newtoken += token.substring(i + 1);\n      break;\n    }\n  }\n\n  if (newtoken === '') {\n    newtoken = slurstart + token;\n  }\n\n  var pcount = 0;\n  for (i = 0; i < newtoken.length; i++) {\n    if (newtoken[i] == '(') {\n      pcount++;\n    }\n  }\n\n  var newid = id.replace(/L\\d+/, 'L' + line);\n  newid = newid.replace(/F\\d+/, 'F' + field);\n  newid = newid.replace(/N\\d+/, 'N' + pcount);\n  // console.log(\"OLDTOKEN2\", token, \"NEWTOKEN2\", newtoken);\n  // console.log(\"OLDID\", id, \"NEWID\", newid);\n  if (newtoken !== token) {\n    global_cursor.RestoreCursorNote = newid;\n    global_cursor.HIGHLIGHTQUERY = newid;\n    setEditorContents(line, field, newtoken, newid);\n  }\n}\n\n//////////////////////////////\n//\n// addSlurEnd --\n//\n\nfunction addSlurEnd(id, line, field, slurend) {\n  var token = getEditorContents(line, field);\n  var newtoken = '';\n  for (var i = 0; i < token.length; i++) {\n    if (token[i] == '(') {\n      // need to insert new slur before first one\n      newtoken = token.substring(0, i + 1);\n      newtoken += slurend;\n      newtoken += token.substring(i + 1);\n    }\n  }\n\n  if (newtoken === '') {\n    newtoken = token + slurend;\n  }\n\n  var pcount = 0;\n  for (i = 0; i < newtoken.length; i++) {\n    if (newtoken[i] == '(') {\n      pcount++;\n    }\n  }\n\n  if (newtoken !== token) {\n    global_cursor.RestoreCursorNote = id;\n    global_cursor.HIGHLIGHTQUERY = id;\n    setEditorContents(line, field, newtoken, id);\n  }\n}\n\n//////////////////////////////\n//\n// deleteSlurStart --\n//\n\nfunction deleteSlurStart(id, line, field, number) {\n  var token = getEditorContents(line, field);\n  var newtoken = '';\n  var counter = 0;\n  var output = '';\n  for (var i = 0; i < token.length; i++) {\n    if (token[i] == '(') {\n      counter++;\n    }\n    if (counter != number) {\n      newtoken += token[i];\n      continue;\n    }\n    output += token[i];\n    if (token[i + 1] == '>') {\n      output += '>';\n      i++;\n    } else if (token[i + 1] == '<') {\n      output += '<';\n      i++;\n    }\n    counter++;\n  }\n\n  // console.log(\"OLDTOKEN1\", token, \"NEWTOKEN1\", newtoken);\n  if (newtoken !== token) {\n    global_cursor.RestoreCursorNote = id;\n    global_cursor.HIGHLIGHTQUERY = id;\n    setEditorContents(line, field, newtoken, id);\n  }\n\n  return output;\n}\n\n//////////////////////////////\n//\n// deleteSlurEnd --\n//\n\nfunction deleteSlurEnd(id, line, field, number) {\n  var token = getEditorContents(line, field);\n  var newtoken = '';\n  var counter = 0;\n  var output = '';\n  for (var i = 0; i < token.length; i++) {\n    if (token[i] == ')') {\n      counter++;\n      output = ')';\n    }\n    if (counter == number) {\n      counter++;\n      continue;\n    }\n    newtoken += token[i];\n  }\n\n  // console.log(\"OLDTOKEN1\", token, \"NEWTOKEN1\", newtoken);\n  if (newtoken !== token) {\n    global_cursor.RestoreCursorNote = id;\n    global_cursor.HIGHLIGHTQUERY = id;\n    setEditorContents(line, field, newtoken, id);\n  }\n\n  return output;\n}\n\n//////////////////////////////\n//\n// deleteSlur --\n//\n\nfunction deleteSlur(id, line, field, number, line2, field2, number2) {\n  // console.log(\"DELETING SLUR\");\n  var freezeBackup = global_interface.FreezeRendering;\n  deleteSlurStart(id, line, field, number);\n  deleteSlurEnd(id, line2, field2, number2);\n  global_interface.FreezeRendering = freezeBackup;\n  global_cursor.RestoreCursorNote = null;\n  global_cursor.HIGHLIGHTQUERY = null;\n  if (!global_interface.FreezeRendering) {\n    displayNotation();\n  }\n}\n\n//////////////////////////////\n//\n// leftEndMoveForward --\n//\n\nfunction leftEndMoveForward(id, line, field, number, line2, field2, number2) {\n  console.log('LEFT END MOVE FORWARD');\n  var token1 = getEditorContents(line, field);\n  if (parseInt(line) >= parseInt(line2)) {\n    return;\n  }\n\n  var i = parseInt(line); // -1 for 0-index and +1 for line after\n  var counter = 0;\n  var size = editor.session.getLength();\n  var target = InterfaceSingleNumber;\n  if (!target) {\n    target = 1;\n  }\n\n  while (i < size) {\n    var text = editor.session.getLine(i);\n    if (\n      text.match(/^\\*/) ||\n      text.match(/^=/) ||\n      text.match(/^!/) ||\n      text === ''\n    ) {\n      i++;\n      continue;\n    }\n    var token2 = getEditorContents(i + 1, field);\n    if (token2.match(/[A-G]/i)) {\n      counter++;\n    }\n    if (counter != target) {\n      i++;\n      continue;\n    }\n    break;\n  }\n\n  if (i >= size) {\n    // no note to attach to\n    return;\n  }\n  if (text[0] == '*' || text[0] == '!' || text === '') {\n    // no note to attach to\n    return;\n  }\n  if (i + 1 >= line2) {\n    // do not pass slur end\n    return;\n  }\n\n  var freezeBackup = global_interface.FreezeRendering;\n  global_interface.FreezeRendering = true;\n  var slurstart = deleteSlurStart(id, line, field, number);\n  if (slurstart !== '') {\n    addSlurStart(id, i + 1, field, slurstart);\n  }\n  global_interface.FreezeRendering = freezeBackup;\n  displayNotation();\n\n  InterfaceSingleNumber = 0;\n}\n\n//////////////////////////////\n//\n// rightEndMoveForward --\n//\n\nfunction rightEndMoveForward(id, line, field, number, line2, field2, number2) {\n  // console.log(\"RIGHT END MOVE FORWARD\");\n  var token1 = getEditorContents(line2, field);\n  if (parseInt(line) >= parseInt(line2)) {\n    return;\n  }\n  var i = parseInt(line2); // -1 for 0-index and +1 for line after\n  var counter = 0;\n  var size = editor.session.getLength();\n\n  var target = InterfaceSingleNumber;\n  if (!target) {\n    target = 1;\n  }\n\n  while (i < size) {\n    var text = editor.session.getLine(i);\n    if (\n      text.match(/^\\*/) ||\n      text.match(/^=/) ||\n      text.match(/^!/) ||\n      text === ''\n    ) {\n      i++;\n      continue;\n    }\n    var token2 = getEditorContents(i + 1, field);\n    if (token2.match(/[A-G]/i)) {\n      counter++;\n    }\n    if (counter != target) {\n      i++;\n      continue;\n    }\n    break;\n  }\n\n  if (i >= size) {\n    // no note to attach to\n    return;\n  }\n  if (text[0] == '*' || text[0] == '!' || text === '') {\n    // no note to attach to\n    return;\n  }\n  if (i + 1 <= line) {\n    // do not pass slur start\n    return;\n  }\n\n  var freezeBackup = global_interface.FreezeRendering;\n  global_interface.FreezeRendering = true;\n  var slurend = deleteSlurEnd(id, line2, field2, number2);\n  if (slurend !== '') {\n    addSlurEnd(id, i + 1, field, slurend);\n  }\n  // need to remove \"N\" if \"N1\" (in verovio)\n  var newend = 'L' + (i + 1) + 'F' + field2 + 'N' + number2;\n  var newid = id.replace(/-[^-]+$/, '-' + newend);\n  global_cursor.RestoreCursorNote = newid;\n  global_cursor.HIGHLIGHTQUERY = newid;\n  global_interface.FreezeRendering = freezeBackup;\n  displayNotation();\n\n  InterfaceSingleNumber = 0;\n}\n\n//////////////////////////////\n//\n// rightEndMoveBack --\n//\n\nfunction rightEndMoveBack(id, line, field, number, line2, field2, number2) {\n  // console.log(\"RIGHT END MOVE BACKWARD\");\n  var token1 = getEditorContents(line2, field);\n  if (parseInt(line) >= parseInt(line2)) {\n    return;\n  }\n  var i = parseInt(line2) - 2; // -1 for 0-index and -1 for line after\n  var counter = 0;\n  var target = InterfaceSingleNumber;\n  if (!target) {\n    target = 1;\n  }\n\n  while (i >= 0) {\n    var text = editor.session.getLine(i);\n    if (\n      text.match(/^\\*/) ||\n      text.match(/^=/) ||\n      text.match(/^!/) ||\n      text === ''\n    ) {\n      i--;\n      continue;\n    }\n    var token2 = getEditorContents(i + 1, field);\n    if (token2.match(/[A-G]/i)) {\n      counter++;\n    }\n    if (counter != target) {\n      i--;\n      continue;\n    }\n    break;\n  }\n\n  if (i <= 0) {\n    // no note to attach to\n    return;\n  }\n  if (text[0] == '*' || text[0] == '!' || text === '') {\n    // no note to attach to\n    return;\n  }\n  if (i + 1 <= line) {\n    // do not pass slur start\n    return;\n  }\n\n  var freezeBackup = global_interface.FreezeRendering;\n  global_interface.FreezeRendering = true;\n  var slurend = deleteSlurEnd(id, line2, field2, number2);\n  if (slurend !== '') {\n    addSlurEnd(id, i + 1, field, slurend);\n  }\n  // need to remove \"N\" if \"N1\" (in verovio)\n  var newend = 'L' + (i + 1) + 'F' + field2 + 'N' + number2;\n  var newid = id.replace(/-[^-]+$/, '-' + newend);\n  global_cursor.RestoreCursorNote = newid;\n  global_cursor.HIGHLIGHTQUERY = newid;\n  global_interface.FreezeRendering = freezeBackup;\n  displayNotation();\n\n  InterfaceSingleNumber = 0;\n}\n\n///////////////////////////////////////////////////////////////////////////\n//\n// Tie editing --\n//\n\n//////////////////////////////\n//\n// setTieAboveMarker --\n//\n\nfunction setTieAboveMarker(id, line, field, subfield) {\n  console.log('TIE ABOVE', token, line, field, subfield, id);\n\n  var token = getEditorContents(line, field);\n  if (token === '.' || token[0] == '!' || token[0] == '*') {\n    return;\n  }\n\n  if (subfield) {\n    var subtokens = token.split(' ');\n    token = subtokens[subfield - 1];\n  }\n  if (token.match('r')) {\n    // reset, so no tie allowed\n    return;\n  }\n\n  var newtoken = '';\n  var matches;\n\n  if (!(token.match(/[[]/) || token.match('_'))) {\n    // no tie start\n    return;\n  }\n\n  var directions = insertDirectionRdfs();\n  var above = directions[0];\n  var below = directions[1];\n  var re = new RegExp('([^_[]*)([_[]+)([' + above + below + ']*)([^_[]*)');\n  if ((matches = re.exec(token))) {\n    newtoken = matches[1] + matches[2] + above + matches[4];\n  } else {\n    newtoken = token;\n  }\n\n  if (subfield) {\n    subtokens[subfield - 1] = newtoken;\n    newtoken = subtokens.join(' ');\n  }\n\n  // console.log(\"OLDTOKEN\", token, \"NEWTOKEN\", newtoken);\n  if (newtoken !== token) {\n    global_cursor.RestoreCursorNote = id;\n    global_cursor.HIGHLIGHTQUERY = id;\n    setEditorContents(line, field, newtoken, id);\n  }\n}\n\n//////////////////////////////\n//\n// setTieBelowMarker --\n//\n\nfunction setTieBelowMarker(id, line, field, subfield) {\n  console.log('TIE BELOW', token, line, field, subfield, id);\n\n  var token = getEditorContents(line, field);\n  if (token === '.' || token[0] == '!' || token[0] == '*') {\n    return;\n  }\n\n  if (subfield) {\n    var subtokens = token.split(' ');\n    token = subtokens[subfield - 1];\n  }\n  if (token.match('r')) {\n    // reset, so no tie allowed\n    return;\n  }\n\n  var newtoken = '';\n  var matches;\n\n  if (!(token.match(/[[]/) || token.match('_'))) {\n    // no tie start\n    return;\n  }\n\n  var directions = insertDirectionRdfs();\n  var above = directions[0];\n  var below = directions[1];\n  var re = new RegExp('([^_[]*)([_[]+)([' + above + below + ']*)([^_[]*)');\n  if ((matches = re.exec(token))) {\n    newtoken = matches[1] + matches[2] + below + matches[4];\n  } else {\n    newtoken = token;\n  }\n\n  if (subfield) {\n    subtokens[subfield - 1] = newtoken;\n    newtoken = subtokens.join(' ');\n  }\n\n  // console.log(\"OLDTOKEN\", token, \"NEWTOKEN\", newtoken);\n  if (newtoken !== token) {\n    global_cursor.RestoreCursorNote = id;\n    global_cursor.HIGHLIGHTQUERY = id;\n    setEditorContents(line, field, newtoken, id);\n  }\n}\n\n//////////////////////////////\n//\n// deleteTieDirectionMarker --\n//\n\nfunction deleteTieDirectionMarker(id, line, field, subfield) {\n  console.log('TIE DIRECTION REMOVE', token, line, field, subfield, id);\n\n  var token = getEditorContents(line, field);\n  if (token === '.' || token[0] == '!' || token[0] == '*') {\n    return;\n  }\n\n  if (subfield) {\n    var subtokens = token.split(' ');\n    token = subtokens[subfield - 1];\n  }\n  if (token.match('r')) {\n    // reset, so no tie allowed\n    return;\n  }\n\n  var newtoken = '';\n  var matches;\n\n  if (!(token.match(/[[]/) || token.match('_'))) {\n    // no tie start\n    return;\n  }\n\n  var directions = insertDirectionRdfs();\n  var above = directions[0];\n  var below = directions[1];\n  var re = new RegExp('([^_[]*)([_[]+)([' + above + below + ']*)([^_[]*)');\n  if ((matches = re.exec(token))) {\n    newtoken = matches[1] + matches[2] + matches[4];\n  } else {\n    newtoken = token;\n  }\n\n  if (subfield) {\n    subtokens[subfield - 1] = newtoken;\n    newtoken = subtokens.join(' ');\n  }\n\n  // console.log(\"OLDTOKEN\", token, \"NEWTOKEN\", newtoken);\n  if (newtoken !== token) {\n    global_cursor.RestoreCursorNote = id;\n    global_cursor.HIGHLIGHTQUERY = id;\n    setEditorContents(line, field, newtoken, id);\n  }\n}\n\n///////////////////////////////////////////////////////////////////////////\n//\n// Stem editing --\n//\n\n//////////////////////////////\n//\n// setStemAboveMarker --\n//\n\nfunction setStemAboveMarker(id, line, field) {\n  console.log('STEM ABOVE', line, field, id);\n  var token = getEditorContents(line, field);\n\n  if (token === '.' || token[0] == '!' || token[0] == '*') {\n    return;\n  }\n  if (token.match('r')) {\n    // rest, which does not need/have a natural\n    return;\n  }\n\n  var matches;\n  var subtokens = token.split(' ');\n  for (var i = 0; i < subtokens.length; i++) {\n    if (\n      (matches = subtokens[i].match(\n        /([^\\\\\\\\\\\\\\/]*)([\\\\\\\\\\\\\\/]+)([^\\\\\\\\\\\\\\/]*)/\n      ))\n    ) {\n      subtokens[i] = matches[1] + '/' + matches[3];\n    } else if (\n      (matches = subtokens[i].match(\n        /([^A-Ga-g#XxYyTt:'~oOS$MmWw\\^<>n-]*)([A-Ga-g#Xx<>yYnTt:'~oOS$MmWw\\^-]+)(.*)/\n      ))\n    ) {\n      subtokens[i] = matches[1] + matches[2] + '/' + matches[3];\n    }\n  }\n\n  var newtoken = subtokens.join(' ');\n\n  // console.log(\"OLDTOKEN\", token, \"NEWTOKEN\", newtoken);\n  if (newtoken !== token) {\n    global_cursor.RestoreCursorNote = id;\n    global_cursor.HIGHLIGHTQUERY = id;\n    setEditorContents(line, field, newtoken, id);\n  }\n}\n\n//////////////////////////////\n//\n// setStemBelowMarker --\n//\n\nfunction setStemBelowMarker(id, line, field) {\n  console.log('STEM BELOW', line, field, id);\n  var token = getEditorContents(line, field);\n  console.log('TOKEN EXTRACTED IS', token);\n\n  if (token === '.' || token[0] == '!' || token[0] == '*') {\n    return;\n  }\n  if (token.match('r')) {\n    // rest, which does not need/have a natural\n    return;\n  }\n\n  var matches;\n  var subtokens = token.split(' ');\n  for (var i = 0; i < subtokens.length; i++) {\n    if (\n      (matches = subtokens[i].match(/([^\\\\\\/]*)([\\\\\\\\\\\\\\/]+)([^\\\\\\\\\\\\\\/]*)/))\n    ) {\n      subtokens[i] = matches[1] + '\\\\' + matches[3];\n    } else if (\n      (matches = subtokens[i].match(\n        /([^A-Ga-g#XxYyTt:'~oOS$MmWw\\^<>n-]*)([A-Ga-g#Xx<>yYnTt:'~oOS$MmWw\\^-]+)(.*)/\n      ))\n    ) {\n      subtokens[i] = matches[1] + matches[2] + '\\\\' + matches[3];\n    }\n  }\n\n  var newtoken = subtokens.join(' ');\n\n  // console.log(\"OLDTOKEN\", token, \"NEWTOKEN\", newtoken);\n  if (newtoken !== token) {\n    global_cursor.RestoreCursorNote = id;\n    global_cursor.HIGHLIGHTQUERY = id;\n    setEditorContents(line, field, newtoken, id);\n  }\n}\n\n//////////////////////////////\n//\n// deleteStemMarker --\n//\n\nfunction deleteStemMarker(id, line, field) {\n  console.log('REMOVE STEMS', line, field, id);\n  var token = getEditorContents(line, field);\n\n  if (token === '.' || token[0] == '!' || token[0] == '*') {\n    return;\n  }\n  if (token.match('r')) {\n    // rest, which does not need/have a natural\n    return;\n  }\n\n  var newtoken = token.replace(/[\\\\\\/]/g, '');\n\n  // console.log(\"OLDTOKEN\", token, \"NEWTOKEN\", newtoken);\n  if (newtoken !== token) {\n    global_cursor.RestoreCursorNote = id;\n    global_cursor.HIGHLIGHTQUERY = id;\n    setEditorContents(line, field, newtoken, id);\n  }\n}\n\n///////////////////////////////////////////////////////////////////////////\n//\n// Transposing --\n//\n\n//////////////////////////////\n//\n// tranposeUp --\n//\n\nexport function transposeNote(id, line, field, subfield, amount) {\n  // console.log('TRANSPOSE Note', { line, column: field, subfield, noteId: id });\n  var token = getEditorContents(line, field);\n\n  amount = parseInt(amount);\n  var target = InterfaceSingleNumber;\n  if (!target) {\n    target = 1;\n  }\n\n  if (target > 1) {\n    if (amount > 0) {\n      amount = target - 1;\n    } else {\n      amount = -target + 1;\n    }\n    InterfaceSingleNumber = 0;\n  }\n\n  if (subfield) {\n    var subtokens = token.split(' ');\n    token = subtokens[subfield - 1];\n  }\n\n  if (token === '.' || token[0] == '!' || token[0] == '*') {\n    return;\n  }\n  if (token.match('r')) {\n    // rest, which does not need/have a natural\n    return;\n  }\n\n  var newtoken;\n  var matches;\n  if ((matches = token.match(/([^a-gA-G]*)([a-gA-G]+)([^a-gA-G]*)/))) {\n    newtoken = matches[1];\n    newtoken += transposeDiatonic(matches[2], amount);\n    newtoken += matches[3];\n  }\n\n  if (subfield) {\n    subtokens[subfield - 1] = newtoken;\n    newtoken = subtokens.join(' ');\n  }\n\n  // console.log('OLDTOKEN', token, 'NEWTOKEN', newtoken);\n  if (newtoken !== token) {\n    global_cursor.RestoreCursorNote = id;\n    global_cursor.HIGHLIGHTQUERY = id;\n    setEditorContents(line, field, newtoken, id);\n\n    // let shouldUpdate = window.confirm('Include value?');\n    // if (shouldUpdate) {\n    // \t// Add true as last parameter to prevent from rendering change to SVG\n    // \tsetEditorContents(line, field, newtoken, id);\n    // }\n  }\n}\n\n// id, line, field, subfield, amount\nexport function transposeNotes(noteDescriptions) {\n  const transposedNotes = [];\n  for (let { id, line, field, subfield, amount }  of noteDescriptions) {\n    let token = getEditorContents(line, field);\n    amount = parseInt(amount);\n  \n    let subtokens;\n    if (subfield) {\n      subtokens = token.split(' ');\n      token = subtokens[subfield - 1];\n    }\n  \n    if (token === '.' || token[0] == '!' || token[0] == '*') {\n      continue;\n    }\n    if (token.match('r')) {\n      // rest, which does not need/have a natural\n      continue;\n    }\n  \n    let newtoken;\n    let matches;\n    if ((matches = token.match(/([^a-gA-G]*)([a-gA-G]+)([^a-gA-G]*)/))) {\n      newtoken = matches[1];\n      newtoken += transposeDiatonic(matches[2], amount);\n      newtoken += matches[3];\n    }\n  \n    if (subfield) {\n      subtokens[subfield - 1] = newtoken;\n      newtoken = subtokens.join(' ');\n    }\n  \n    // console.log('OLDTOKEN', token, 'NEWTOKEN', newtoken);\n    if (newtoken !== token) {\n      transposedNotes.push({ line, field, token: newtoken, id });\n    }\n  }\n  return transposedNotes;\n}\n\n///////////////////////////////////////////////////////////////////////////\n//\n// Accidental editing --\n//\n\n//////////////////////////////\n//\n// toggleEditorialAccidental --\n//\n\nfunction toggleEditorialAccidental(id, line, field, subfield) {\n  console.log('TOGGLE EDITORIAL ACCIDENTAL', line, field, subfield, id);\n  var token = getEditorContents(line, field);\n\n  if (subfield) {\n    var subtokens = token.split(' ');\n    token = subtokens[subfield - 1];\n  }\n\n  if (token === '.' || token[0] == '!' || token[0] == '*') {\n    return;\n  }\n  if (token.match('r')) {\n    // rest, which does not need/have an accidental\n    return;\n  }\n\n  var editchar = insertEditorialAccidentalRdf();\n  var newtoken;\n  var matches;\n\n  var re = new RegExp(editchar);\n  if (re.exec(token)) {\n    newtoken = token.replace(new RegExp(editchar, 'g'), '');\n  } else if (token.match(/[-#n]/)) {\n    // add editorial accidental\n    matches = token.match(/(.*[a-gA-Gn#xXyY-]+)(.*)/);\n    newtoken = matches[1] + editchar + matches[2];\n  } else {\n    // add a natural and an editorial accidental\n    matches = token.match(/(.*[a-gA-GxXyY]+)(.*)/);\n    newtoken = matches[1] + 'n' + editchar + matches[2];\n  }\n\n  if (subfield) {\n    subtokens[subfield - 1] = newtoken;\n    newtoken = subtokens.join(' ');\n  }\n\n  // console.log(\"OLDTOKEN\", token, \"NEWTOKEN\", newtoken);\n  if (newtoken !== token) {\n    global_cursor.RestoreCursorNote = id;\n    global_cursor.HIGHLIGHTQUERY = id;\n    setEditorContents(line, field, newtoken, id);\n  }\n}\n\n//////////////////////////////\n//\n// toggleSharp -- show or hide a sharp or double sharp on a note.\n//\n\nfunction toggleSharp(id, line, field, subfield) {\n  // console.log(\"TOGGLE NATURAL ACCIDENTAL\", line, field, subfield, id);\n  var token = getEditorContents(line, field);\n\n  if (subfield) {\n    var subtokens = token.split(' ');\n    token = subtokens[subfield - 1];\n  }\n\n  if (token === '.' || token[0] == '!' || token[0] == '*') {\n    return;\n  }\n  if (token.match('r')) {\n    // rest, which does not need/have a natural\n    return;\n  }\n\n  var newtoken;\n\n  if (InterfaceSingleNumber == 2) {\n    if (!token.match('##')) {\n      // add double sharp\n      newtoken = token.replace(/[#n-]+/, '');\n      newtoken = newtoken.replace(/([a-gA-G]+)/, function (str, p1) {\n        return p1 ? p1 + '##' : str;\n      });\n    } else {\n      // remove double-sharp\n      newtoken = token.replace(/#+i?/, '');\n    }\n    InterfaceSingleNumber = 0;\n  } else {\n    if (token.match('##') || !token.match('#')) {\n      // add sharp\n      newtoken = token.replace(/[#n-]+/, '');\n      newtoken = newtoken.replace(/([a-gA-G]+)/, function (str, p1) {\n        return p1 ? p1 + '#' : str;\n      });\n    } else {\n      // remove sharp\n      newtoken = token.replace(/#+i?/, '');\n    }\n  }\n\n  if (subfield) {\n    subtokens[subfield - 1] = newtoken;\n    newtoken = subtokens.join(' ');\n  }\n\n  // console.log(\"OLDTOKEN\", token, \"NEWTOKEN\", newtoken);\n  if (newtoken !== token) {\n    global_cursor.RestoreCursorNote = id;\n    global_cursor.HIGHLIGHTQUERY = id;\n    setEditorContents(line, field, newtoken, id);\n  }\n}\n\n//////////////////////////////\n//\n// toggleFlat -- Show or hide a flat or double flat on a note.\n//\n\nfunction toggleFlat(id, line, field, subfield) {\n  // console.log(\"TOGGLE FLAT ACCIDENTAL\", line, field, subfield, id);\n  var token = getEditorContents(line, field);\n\n  if (subfield) {\n    var subtokens = token.split(' ');\n    token = subtokens[subfield - 1];\n  }\n\n  if (token === '.' || token[0] == '!' || token[0] == '*') {\n    return;\n  }\n  if (token.match('r')) {\n    // rest, which does not need/have a natural\n    return;\n  }\n\n  var newtoken;\n  if (InterfaceSingleNumber == 2) {\n    if (!token.match('--')) {\n      // add flat\n      newtoken = token.replace(/[#n-]+/, '');\n      newtoken = newtoken.replace(/([a-gA-G]+)/, function (str, p1) {\n        return p1 ? p1 + '--' : str;\n      });\n    } else {\n      // remove flat\n      newtoken = token.replace(/-+i?/, '');\n    }\n    InterfaceSingleNumber = 0;\n  } else {\n    if (token.match('--') || !token.match('-')) {\n      // add flat\n      newtoken = token.replace(/[#n-]+/, '');\n      newtoken = newtoken.replace(/([a-gA-G]+)/, function (str, p1) {\n        return p1 ? p1 + '-' : str;\n      });\n    } else {\n      // remove flat\n      newtoken = token.replace(/-+i?/, '');\n    }\n  }\n\n  if (subfield) {\n    subtokens[subfield - 1] = newtoken;\n    newtoken = subtokens.join(' ');\n  }\n\n  // console.log(\"OLDTOKEN\", token, \"NEWTOKEN\", newtoken);\n  if (newtoken !== token) {\n    global_cursor.RestoreCursorNote = id;\n    global_cursor.HIGHLIGHTQUERY = id;\n    setEditorContents(line, field, newtoken, id);\n  }\n}\n\n//////////////////////////////\n//\n// toggleNatural --\n//\n\nfunction toggleNatural(id, line, field, subfield) {\n  console.log('TOGGLE NATURAL ACCIDENTAL', line, field, subfield, id);\n  var token = getEditorContents(line, field);\n\n  if (subfield) {\n    var subtokens = token.split(' ');\n    token = subtokens[subfield - 1];\n  }\n\n  if (token === '.' || token[0] == '!' || token[0] == '*') {\n    return;\n  }\n  if (token.match('r')) {\n    // rest, which does not need/have a natural\n    return;\n  }\n\n  var newtoken;\n  if (!token.match('n')) {\n    // add natural\n    newtoken = token.replace(/[#n-]+/, '');\n    newtoken = newtoken.replace(/([a-gA-G]+)/, function (str, p1) {\n      return p1 ? p1 + 'n' : str;\n    });\n  } else {\n    // remove natural\n    newtoken = token.replace(/n+i?/, '');\n  }\n\n  if (subfield) {\n    subtokens[subfield - 1] = newtoken;\n    newtoken = subtokens.join(' ');\n  }\n\n  // console.log(\"OLDTOKEN\", token, \"NEWTOKEN\", newtoken);\n  if (newtoken !== token) {\n    global_cursor.RestoreCursorNote = id;\n    global_cursor.HIGHLIGHTQUERY = id;\n    setEditorContents(line, field, newtoken, id);\n  }\n}\n\n//////////////////////////////\n//\n// toggleExplicitAccidental --\n//\n\nfunction toggleExplicitAccidental(id, line, field, subfield) {\n  console.log('TOGGLE EXPLICIT ACCIDENTAL', line, field, subfield, id);\n  var token = getEditorContents(line, field);\n\n  if (subfield) {\n    var subtokens = token.split(' ');\n    token = subtokens[subfield - 1];\n  }\n\n  if (token === '.' || token[0] == '!' || token[0] == '*') {\n    return;\n  }\n  if (token.match('r')) {\n    // rest, so no accidental\n    return;\n  }\n\n  var newtoken;\n  var matches;\n\n  if (token.match(/n/)) {\n    // remove cautionary natural\n    newtoken = token.replace(/n/g, '');\n  } else if ((matches = token.match(/([^#-]*)([#-]+)(X?)([^#-]*)/))) {\n    // add or remove \"X\" from sharp/flats\n    if (matches[3] === 'X') {\n      // remove cautionary accidental\n      newtoken = matches[1] + matches[2] + matches[4];\n    } else {\n      // add cautionary accidental\n      newtoken = matches[1] + matches[2] + 'X' + matches[4];\n    }\n  } else {\n    // add a natural sign\n    if ((matches = token.match(/([^A-G]*)([A-G]+)([^A-G]*)/i))) {\n      newtoken = matches[1] + matches[2] + 'n' + matches[3];\n    }\n  }\n\n  if (subfield) {\n    subtokens[subfield - 1] = newtoken;\n    newtoken = subtokens.join(' ');\n  }\n\n  // console.log(\"OLDTOKEN\", token, \"NEWTOKEN\", newtoken);\n  if (newtoken !== token) {\n    global_cursor.RestoreCursorNote = id;\n    global_cursor.HIGHLIGHTQUERY = id;\n    setEditorContents(line, field, newtoken, id);\n  }\n}\n\n//////////////////////////////\n//\n// toggleStaccato --\n//\n\nfunction toggleStaccato(id, line, field) {\n  var counter = 0;\n  var maxline = editor.session.getLength();\n  var i = line;\n  var freezeBackup = global_interface.FreezeRendering;\n  global_interface.FreezeRendering = true;\n  var target = InterfaceSingleNumber;\n  if (!target) {\n    target = 1;\n  }\n  while (line < maxline && counter < target) {\n    var token = getEditorContents(line, field);\n    if (\n      token.match(/^\\*/) ||\n      token.match(/^=/) ||\n      token.match(/^!/) ||\n      token === ''\n    ) {\n      line++;\n      continue;\n    }\n    if (token === '.') {\n      // nothing to do, just a null data token\n      line++;\n      continue;\n    }\n    if (token.match('r')) {\n      // not a note\n      line++;\n      continue;\n    }\n    if (!token.match(\"'\")) {\n      // add staccato\n      token = token.replace(/'+/, '');\n      token = token.replace(/([a-gA-G]+[-#nXxYy<>]*)/g, function (str, p1) {\n        return p1 ? p1 + \"'\" : str;\n      });\n      global_cursor.RestoreCursorNote = id;\n      setEditorContents(line, field, token, id);\n      counter++;\n      line++;\n    } else {\n      // remove staccato\n      token = token.replace(/'[<>]*/g, '');\n      global_cursor.RestoreCursorNote = id;\n      setEditorContents(line, field, token, id);\n      counter++;\n      line++;\n    }\n  }\n  InterfaceSingleNumber = 0;\n  global_interface.FreezeRendering = freezeBackup;\n  displayNotation();\n}\n\n//////////////////////////////\n//\n// toggleAccent --\n//\n\nfunction toggleAccent(id, line, field) {\n  var counter = 0;\n  var maxline = editor.session.getLength();\n  var i = line;\n  var freezeBackup = global_interface.FreezeRendering;\n  global_interface.FreezeRendering = true;\n  var target = InterfaceSingleNumber;\n  if (!target) {\n    target = 1;\n  }\n  while (line < maxline && counter < target) {\n    var token = getEditorContents(line, field);\n    if (\n      token.match(/^\\*/) ||\n      token.match(/^=/) ||\n      token.match(/^!/) ||\n      token === ''\n    ) {\n      line++;\n      continue;\n    }\n    if (token === '.') {\n      // nothing to do, just a null data token\n      line++;\n      continue;\n    }\n    if (token.match('r')) {\n      // not a note\n      line++;\n      continue;\n    }\n\n    if (!token.match(/\\^+/)) {\n      // add accent\n      token = token.replace(/\\^+/, '');\n      token = token.replace(/([a-gA-G]+[-#nXxYy<>]*)/, function (str, p1) {\n        return p1 ? p1 + '^' : str;\n      });\n      global_cursor.RestoreCursorNote = id;\n      setEditorContents(line, field, token, id);\n      counter++;\n      line++;\n    } else {\n      // remove accent\n      token = token.replace(/\\^+[<>]*/g, '');\n      global_cursor.RestoreCursorNote = id;\n      setEditorContents(line, field, token, id);\n      counter++;\n      line++;\n    }\n  }\n  InterfaceSingleNumber = 0;\n  global_interface.FreezeRendering = freezeBackup;\n  displayNotation();\n}\n\n//////////////////////////////\n//\n// toggleMarcato --\n//\n\nfunction toggleMarcato(id, line, field) {\n  var counter = 0;\n  var maxline = editor.session.getLength();\n  var i = line;\n  var freezeBackup = global_interface.FreezeRendering;\n  global_interface.FreezeRendering = true;\n  var target = InterfaceSingleNumber;\n  if (!target) {\n    target = 1;\n  }\n  while (line < maxline && counter < target) {\n    var token = getEditorContents(line, field);\n    if (\n      token.match(/^\\*/) ||\n      token.match(/^=/) ||\n      token.match(/^!/) ||\n      token === ''\n    ) {\n      line++;\n      continue;\n    }\n    if (token === '.') {\n      // nothing to do, just a null data token\n      line++;\n      continue;\n    }\n    if (token.match('r')) {\n      // not a note\n      line++;\n      continue;\n    }\n\n    if (!token.match(/\\^+/)) {\n      // add marcato\n      token = token.replace(/\\^+/, '');\n      token = token.replace(/([a-gA-G]+[-#nXxYy<>]*)/, function (str, p1) {\n        return p1 ? p1 + '^^' : str;\n      });\n      global_cursor.RestoreCursorNote = id;\n      setEditorContents(line, field, token, id);\n      counter++;\n      line++;\n    } else {\n      // remove marcato\n      token = token.replace(/\\^+[<>]*/g, '');\n      global_cursor.RestoreCursorNote = id;\n      setEditorContents(line, field, token, id);\n      counter++;\n      line++;\n    }\n  }\n  InterfaceSingleNumber = 0;\n  global_interface.FreezeRendering = freezeBackup;\n  displayNotation();\n}\n\n//////////////////////////////\n//\n// toggleTenuto --\n//\n\nfunction toggleTenuto(id, line, field) {\n  var counter = 0;\n  var maxline = editor.session.getLength();\n  var i = line;\n  var freezeBackup = global_interface.FreezeRendering;\n  global_interface.FreezeRendering = true;\n  var target = InterfaceSingleNumber;\n  if (!target) {\n    target = 1;\n  }\n  while (line < maxline && counter < target) {\n    var token = getEditorContents(line, field);\n    if (\n      token.match(/^\\*/) ||\n      token.match(/^=/) ||\n      token.match(/^!/) ||\n      token === ''\n    ) {\n      line++;\n      continue;\n    }\n    if (token === '.') {\n      // nothing to do, just a null data token\n      line++;\n      continue;\n    }\n    if (token.match('r')) {\n      // not a note\n      line++;\n      continue;\n    }\n\n    if (!token.match(/~/)) {\n      // add marcato\n      token = token.replace(/~+/g, '');\n      token = token.replace(/([a-gA-G]+[-#nXxYy<>]*)/, function (str, p1) {\n        return p1 ? p1 + '~' : str;\n      });\n      global_cursor.RestoreCursorNote = id;\n      setEditorContents(line, field, token, id);\n      counter++;\n      line++;\n    } else {\n      // remove marcato\n      token = token.replace(/~[<>]*/g, '');\n      global_cursor.RestoreCursorNote = id;\n      setEditorContents(line, field, token, id);\n      setEditorContents(line, field, token, id);\n      counter++;\n    }\n  }\n  InterfaceSingleNumber = 0;\n  global_interface.FreezeRendering = freezeBackup;\n  displayNotation();\n}\n\n//////////////////////////////\n//\n// toggleStaccatissimo --\n//\n\nfunction toggleStaccatissimo(id, line, field) {\n  var counter = 0;\n  var maxline = editor.session.getLength();\n  var i = line;\n  var freezeBackup = global_interface.FreezeRendering;\n  global_interface.FreezeRendering = true;\n  var target = InterfaceSingleNumber;\n  if (!target) {\n    target = 1;\n  }\n  while (line < maxline && counter < target) {\n    var token = getEditorContents(line, field);\n    if (\n      token.match(/^\\*/) ||\n      token.match(/^=/) ||\n      token.match(/^!/) ||\n      token === ''\n    ) {\n      line++;\n      continue;\n    }\n    if (token === '.') {\n      // nothing to do, just a null data token\n      line++;\n      continue;\n    }\n    if (token.match('r')) {\n      // not a note\n      line++;\n      continue;\n    }\n\n    if (!token.match(/`/)) {\n      // add marcato\n      token = token.replace(/`/g, '');\n      token = token.replace(/([a-gA-G]+[-#nXxYy<>]*)/, function (str, p1) {\n        return p1 ? p1 + '`' : str;\n      });\n      global_cursor.RestoreCursorNote = id;\n      setEditorContents(line, field, token, id);\n      counter++;\n      line++;\n    } else {\n      // remove marcato\n      token = token.replace(/`[<>]*/g, '');\n      global_cursor.RestoreCursorNote = id;\n      setEditorContents(line, field, token, id);\n      counter++;\n      line++;\n    }\n  }\n  InterfaceSingleNumber = 0;\n  global_interface.FreezeRendering = freezeBackup;\n  displayNotation();\n}\n\n//////////////////////////////\n//\n// toggleGraceNoteType --\n//\n\nfunction toggleGraceNoteType(id, line, field) {\n  var token = getEditorContents(line, field);\n  var subtokens = token.split(' ');\n  for (var i = 0; i < subtokens.length; i++) {\n    if (subtokens[i].match('qq')) {\n      subtokens[i] = subtokens[i].replace(/qq/g, 'q');\n    } else if (subtokens[i].match('q')) {\n      subtokens[i] = subtokens[i].replace(/q/g, 'qq');\n    }\n  }\n  var newtoken = subtokens.join(' ');\n\n  // console.log(\"OLDTOKEN\", token, \"NEWTOKEN\", newtoken);\n  if (newtoken !== token) {\n    global_cursor.RestoreCursorNote = id;\n    global_cursor.HIGHLIGHTQUERY = id;\n    setEditorContents(line, field, newtoken, id);\n  }\n}\n\n//////////////////////////////\n//\n// toggleMinorTrill --\n//\n\nfunction toggleMinorTrill(id, line, field) {\n  var token = getEditorContents(line, field);\n  if (token === '.') {\n    // nothing to do, just a null data token\n    return;\n  }\n  if (token.match('r')) {\n    // not a note\n    return;\n  }\n  if (!token.match(/T/i)) {\n    // add trill\n    token = token.replace(/T/gi, '');\n    token = token.replace(/([a-gA-G]+[-#nXxYy<>]*)/, function (str, p1) {\n      return p1 ? p1 + 't' : str;\n    });\n    global_cursor.RestoreCursorNote = id;\n    setEditorContents(line, field, token, id);\n  } else if (token.match(/T/)) {\n    // change to major-second trill\n    token = token.replace(/T/g, 't');\n    global_cursor.RestoreCursorNote = id;\n    setEditorContents(line, field, token, id);\n  } else {\n    // remove trill\n    token = token.replace(/T[<>]*/gi, '');\n    global_cursor.RestoreCursorNote = id;\n    setEditorContents(line, field, token, id);\n  }\n}\n\n//////////////////////////////\n//\n// toggleMordent --\n//\n\nfunction toggleMordent(mtype, id, line, field, subfield) {\n  console.log('TOGGLE MORDENT', token, line, field, subfield, id);\n\n  var token = getEditorContents(line, field);\n  if (token === '.' || token[0] == '!' || token[0] == '*') {\n    return;\n  }\n\n  if (subfield) {\n    var subtokens = token.split(' ');\n    token = subtokens[subfield - 1];\n  }\n  if (token.match('r')) {\n    // reset, so no mordent allowed\n    return;\n  }\n\n  var newtoken = '';\n  var matches;\n  var matches = token.match(/[MmWw]/);\n  var hasmordent = false;\n  if (matches) {\n    hasmordent = true;\n  }\n  var hascurrentmordent = false;\n  if (hasmordent) {\n    var re2 = new RegExp(mtype);\n    if (re2.exec(token)) {\n      hascurrentmordent = true;\n    }\n  }\n\n  if (hascurrentmordent) {\n    // remove existing mordent\n    newtoken = token.replace(/[MmWw][<>]*/g, '');\n  } else if (hasmordent) {\n    // change the current mordent to the new one\n    newtoken = token.replace(/[MmWw]/g, mtype);\n  } else {\n    // add the given mordent\n    newtoken = token + mtype;\n  }\n\n  if (subfield) {\n    subtokens[subfield - 1] = newtoken;\n    newtoken = subtokens.join(' ');\n  }\n\n  // console.log(\"OLDTOKEN\", token, \"NEWTOKEN\", newtoken);\n  if (newtoken !== token) {\n    global_cursor.RestoreCursorNote = id;\n    global_cursor.HIGHLIGHTQUERY = id;\n    setEditorContents(line, field, newtoken, id);\n  }\n}\n\n//////////////////////////////\n//\n// toggleLigatureStart --\n//\n\nfunction toggleLigatureStart(id, line, field) {\n  var addline = true;\n  var ptext = editor.session.getLine(line);\n  if (ptext.match(/^\\*/) && ptext.match(/\\*lig/)) {\n    // if there is an lig line don't add one\n    addline = false;\n  }\n  if (!addline) {\n    // Already a line with one or more *lig exists.  Toggle *lig on/off\n    // for given field and delete line if only contains * tokens.\n    let oldline = editor.session.getLine(line);\n    oldline = oldline.replace(/\\t+$/, '').replace(/^\\t+/, '');\n    let fields = oldline.split(/\\t+/);\n    if (fields[field - 1] === '*') {\n      fields[field - 1] = '*lig';\n    } else {\n      fields[field - 1] = '*';\n    }\n    let newline = fields.join('\\t');\n    if (newline.match(/^[*\\t]+$/)) {\n      // blank line so delete it\n      console.log('DELETING BLANK LINE');\n      editor.session.replace(new Range(line - 2, 0, line - 1, 0), '');\n      newid = id.replace(/L\\d+/, 'L' + (line - 1));\n      global_cursor.RestoreCursorNote = newid;\n      global_cursor.HIGHLIGHTQUERY = newid;\n    } else {\n      // update line\n      console.log('UPDATING LINE:', newline);\n      newline += '\\n';\n      editor.session.replace(new Range(line, 0, line + 1, 0), newline);\n      var newid = id;\n      global_cursor.RestoreCursorNote = newid;\n      global_cursor.HIGHLIGHTQUERY = newid;\n    }\n  } else {\n    // Add an *lig on a line after the selected line at the given field.\n    let oldline = editor.session.getLine(line - 1);\n    oldline = oldline.replace(/\\t+$/, '').replace(/^\\t+/, '');\n    let fields = oldline.split(/\\t+/);\n    let fieldcount = fields.length;\n    let newline = '';\n    for (let i = 0; i < fieldcount; i++) {\n      newline += '*';\n      if (i == field - 1) {\n        newline += 'lig';\n      }\n      if (i < fieldcount - 1) {\n        newline += '\\t';\n      }\n    }\n    newline += '\\n';\n    editor.session.insert({ row: line - 1, column: 0 }, newline);\n    newid = id.replace(/L\\d+/, 'L' + (line + 1));\n    global_cursor.RestoreCursorNote = newid;\n    global_cursor.HIGHLIGHTQUERY = newid;\n  }\n}\n\n//////////////////////////////\n//\n// toggleColorationStart --\n//\n\nfunction toggleColorationStart(id, line, field) {\n  var addline = true;\n  var ptext = editor.session.getLine(line);\n  if (ptext.match(/^\\*/) && ptext.match(/\\*col/)) {\n    // if there is an col line don't add one\n    addline = false;\n  }\n  if (!addline) {\n    // Already a line with one or more *col exists.  Toggle *col on/off\n    // for given field and delete line if only contains * tokens.\n    let oldline = editor.session.getLine(line);\n    oldline = oldline.replace(/\\t+$/, '').replace(/^\\t+/, '');\n    let fields = oldline.split(/\\t+/);\n    if (fields[field - 1] === '*') {\n      fields[field - 1] = '*col';\n    } else {\n      fields[field - 1] = '*';\n    }\n    let newline = fields.join('\\t');\n    if (newline.match(/^[*\\t]+$/)) {\n      // blank line so delete it\n      console.log('DELETING BLANK LINE');\n      editor.session.replace(new Range(line - 2, 0, line - 1, 0), '');\n      newid = id.replace(/L\\d+/, 'L' + (line - 1));\n      global_cursor.RestoreCursorNote = newid;\n      global_cursor.HIGHLIGHTQUERY = newid;\n    } else {\n      // update line\n      console.log('UPDATING LINE:', newline);\n      newline += '\\n';\n      editor.session.replace(new Range(line, 0, line + 1, 0), newline);\n      var newid = id;\n      global_cursor.RestoreCursorNote = newid;\n      global_cursor.HIGHLIGHTQUERY = newid;\n    }\n  } else {\n    // Add an *col on a line after the selected line at the given field.\n    let oldline = editor.session.getLine(line - 1);\n    oldline = oldline.replace(/\\t+$/, '').replace(/^\\t+/, '');\n    let fields = oldline.split(/\\t+/);\n    let fieldcount = fields.length;\n    let newline = '';\n    for (let i = 0; i < fieldcount; i++) {\n      newline += '*';\n      if (i == field - 1) {\n        newline += 'col';\n      }\n      if (i < fieldcount - 1) {\n        newline += '\\t';\n      }\n    }\n    newline += '\\n';\n    editor.session.insert({ row: line - 1, column: 0 }, newline);\n    newid = id.replace(/L\\d+/, 'L' + (line + 1));\n    global_cursor.RestoreCursorNote = newid;\n    global_cursor.HIGHLIGHTQUERY = newid;\n  }\n}\n\n//////////////////////////////\n//\n// togglePedalStart -- Inserting before LO:TX is a problem\n//\n// InterfaceSingleNumber == 4 => *Xlig toggle instead of *Xped\n// InterfaceSingleNumber == 5 => *Xcol toggle instead of *Xped\n//\n\nfunction togglePedalStart(id, line, field) {\n  if (InterfaceSingleNumber == 4) {\n    toggleLigatureStart(id, line, field);\n    InterfaceSingleNumber = 0;\n    return;\n  } else if (InterfaceSingleNumber == 5) {\n    toggleColorationStart(id, line, field);\n    InterfaceSingleNumber = 0;\n    return;\n  }\n\n  var text = editor.session.getLine(line - 1);\n  if (text.match(/^!/)) {\n    return;\n  }\n  if (text.match(/^\\*/)) {\n    return;\n  }\n  var addline = true;\n  var ptext = editor.session.getLine(line - 2);\n  if (ptext.match(/^\\*/) && ptext.match(/\\*ped/)) {\n    addline = false;\n  }\n  var newid;\n  if (!addline) {\n    // delete existing pedal line\n    console.log('DELETING PEDAL START');\n    editor.session.replace(new Range(line - 2, 0, line - 1, 0), '');\n    newid = id.replace(/L\\d+/, 'L' + (line - 1));\n    global_cursor.RestoreCursorNote = newid;\n    global_cursor.HIGHLIGHTQUERY = newid;\n    return;\n  }\n\n  // inserting in the first column, but should more\n  // correctly be the first **kern dataspine...\n  var newline = createNullLine('*', text);\n  newline = newline.replace(/^(\\t*)\\*(\\t*)/, '$1*ped$2');\n  editor.session.insert({ row: line - 1, column: 0 }, newline);\n  newid = id.replace(/L\\d+/, 'L' + (line + 1));\n  global_cursor.RestoreCursorNote = newid;\n  global_cursor.HIGHLIGHTQUERY = newid;\n}\n\n//////////////////////////////\n//\n// toggleColorationEnd --\n//\n\nfunction toggleColorationEnd(id, line, field) {\n  var addline = true;\n  var ptext = editor.session.getLine(line);\n  if (ptext.match(/^\\*/) && ptext.match(/\\*Xcol/)) {\n    // if there is an Xcol line don't add one\n    addline = false;\n  }\n  if (!addline) {\n    // Already a line with one or more *Xcol exists.  Toggle *Xcol on/off\n    // for given field and delete line if only contains * tokens.\n    let oldline = editor.session.getLine(line);\n    oldline = oldline.replace(/\\t+$/, '').replace(/^\\t+/, '');\n    let fields = oldline.split(/\\t+/);\n    if (fields[field - 1] === '*') {\n      fields[field - 1] = '*Xcol';\n    } else {\n      fields[field - 1] = '*';\n    }\n    let newline = fields.join('\\t');\n    if (newline.match(/^[*\\t]+$/)) {\n      // blank line so delete it\n      console.log('DELETING BLANK LINE');\n      editor.session.replace(new Range(line, 0, line + 1, 0), '');\n      var newid = id;\n      global_cursor.RestoreCursorNote = newid;\n      global_cursor.HIGHLIGHTQUERY = newid;\n    } else {\n      // update line\n      console.log('UPDATING LINE:', newline);\n      newline += '\\n';\n      editor.session.replace(new Range(line, 0, line + 1, 0), newline);\n      var newid = id;\n      global_cursor.RestoreCursorNote = newid;\n      global_cursor.HIGHLIGHTQUERY = newid;\n    }\n  } else {\n    // Add an *Xcol on a line after the selected line at the given field.\n    let oldline = editor.session.getLine(line - 1);\n    oldline = oldline.replace(/\\t+$/, '').replace(/^\\t+/, '');\n    let fields = oldline.split(/\\t+/);\n    let fieldcount = fields.length;\n    let newline = '';\n    for (let i = 0; i < fieldcount; i++) {\n      newline += '*';\n      if (i == field - 1) {\n        newline += 'Xcol';\n      }\n      if (i < fieldcount - 1) {\n        newline += '\\t';\n      }\n    }\n    newline += '\\n';\n    editor.session.replace(new Range(line, 0, line, 0), newline);\n    var newid = id;\n    global_cursor.RestoreCursorNote = newid;\n    global_cursor.HIGHLIGHTQUERY = newid;\n  }\n}\n\n//////////////////////////////\n//\n// toggleLigatureEnd --\n//\n\nfunction toggleLigatureEnd(id, line, field) {\n  var addline = true;\n  var ptext = editor.session.getLine(line);\n  if (ptext.match(/^\\*/) && ptext.match(/\\*Xlig/)) {\n    // if there is an Xlig line don't add one\n    addline = false;\n  }\n  if (!addline) {\n    // Already a line with one or more *Xlig exists.  Toggle *Xlig on/off\n    // for given field and delete line if only contains * tokens.\n    let oldline = editor.session.getLine(line);\n    oldline = oldline.replace(/\\t+$/, '').replace(/^\\t+/, '');\n    let fields = oldline.split(/\\t+/);\n    if (fields[field - 1] === '*') {\n      fields[field - 1] = '*Xlig';\n    } else {\n      fields[field - 1] = '*';\n    }\n    let newline = fields.join('\\t');\n    if (newline.match(/^[*\\t]+$/)) {\n      // blank line so delete it\n      console.log('DELETING BLANK LINE');\n      editor.session.replace(new Range(line, 0, line + 1, 0), '');\n      var newid = id;\n      global_cursor.RestoreCursorNote = newid;\n      global_cursor.HIGHLIGHTQUERY = newid;\n    } else {\n      // update line\n      console.log('UPDATING LINE:', newline);\n      newline += '\\n';\n      editor.session.replace(new Range(line, 0, line + 1, 0), newline);\n      var newid = id;\n      global_cursor.RestoreCursorNote = newid;\n      global_cursor.HIGHLIGHTQUERY = newid;\n    }\n  } else {\n    // Add an *Xlig on a line after the selected line at the given field.\n    let oldline = editor.session.getLine(line - 1);\n    oldline = oldline.replace(/\\t+$/, '').replace(/^\\t+/, '');\n    let fields = oldline.split(/\\t+/);\n    let fieldcount = fields.length;\n    let newline = '';\n    for (let i = 0; i < fieldcount; i++) {\n      newline += '*';\n      if (i == field - 1) {\n        newline += 'Xlig';\n      }\n      if (i < fieldcount - 1) {\n        newline += '\\t';\n      }\n    }\n    newline += '\\n';\n    editor.session.replace(new Range(line, 0, line, 0), newline);\n    var newid = id;\n    global_cursor.RestoreCursorNote = newid;\n    global_cursor.HIGHLIGHTQUERY = newid;\n  }\n}\n\n//////////////////////////////\n//\n// togglePedalEnd --\n//\n// InterfaceSingleNumber == 4 => *Xlig toggle instead of *Xped\n// InterfaceSingleNumber == 5 => *Xcol toggle instead of *Xped\n//\n\nfunction togglePedalEnd(id, line, field) {\n  if (InterfaceSingleNumber == 4) {\n    toggleLigatureEnd(id, line, field);\n    InterfaceSingleNumber = 0;\n    return;\n  } else if (InterfaceSingleNumber == 5) {\n    toggleColorationEnd(id, line, field);\n    InterfaceSingleNumber = 0;\n    return;\n  }\n\n  var text = editor.session.getLine(line - 1);\n  if (text.match(/^!/)) {\n    return;\n  }\n  if (text.match(/^\\*/)) {\n    return;\n  }\n  var addline = true;\n  var ptext = editor.session.getLine(line);\n  if (ptext.match(/^\\*/) && ptext.match(/\\*Xped/)) {\n    addline = false;\n  }\n  var newid;\n  if (!addline) {\n    // delete existing pedal line\n    // console.log(\"DELETING PEDAL END\");\n    editor.session.replace(new Range(line, 0, line + 1, 0), '');\n    newid = id;\n    global_cursor.RestoreCursorNote = newid;\n    global_cursor.HIGHLIGHTQUERY = newid;\n    return;\n  }\n\n  var freezeBackup = global_interface.FreezeRendering;\n  global_interface.FreezeRendering = true;\n  var newline = createNullLine('*', text);\n  newline = newline.replace(/^(\\t*)\\*(\\t*)/, '$1*Xped$2');\n  editor.session.replace(new Range(line, 0, line, 0), newline);\n  newid = id;\n  console.log('OLDID', id, 'NEWID', newid);\n  global_cursor.RestoreCursorNote = newid;\n  global_cursor.HIGHLIGHTQUERY = newid;\n\n  global_interface.FreezeRendering = freezeBackup;\n  displayNotation();\n}\n\n//////////////////////////////\n//\n// toggleMajorTrill --\n//\n\nfunction toggleMajorTrill(id, line, field) {\n  var token = getEditorContents(line, field);\n  if (token === '.') {\n    // nothing to do, just a null data token\n    return;\n  }\n  if (token.match('r')) {\n    // not a note\n    return;\n  }\n  if (!token.match(/T/i)) {\n    // add trill\n    token = token.replace(/T/gi, '');\n    token = token.replace(/([a-gA-G]+[-#nXxYy<>]*)/, function (str, p1) {\n      return p1 ? p1 + 'T' : str;\n    });\n    global_cursor.RestoreCursorNote = id;\n    setEditorContents(line, field, token, id);\n  } else if (token.match(/t/)) {\n    // switch to major second trill\n    token = token.replace(/t/g, 'T');\n    global_cursor.RestoreCursorNote = id;\n    setEditorContents(line, field, token, id);\n  } else {\n    // remove trill\n    token = token.replace(/T[<>]*/gi, '');\n    global_cursor.RestoreCursorNote = id;\n    setEditorContents(line, field, token, id);\n  }\n}\n\n//////////////////////////////\n//\n// toggleArpeggio --\n//\n\nfunction toggleArpeggio(id, line, field) {\n  var token = getEditorContents(line, field);\n  if (token === '.') {\n    // nothing to do, just a null data token\n    return;\n  }\n  if (token.match('r')) {\n    // not a note\n    return;\n  }\n  if (!token.match(/:/i)) {\n    // add arpeggio\n    token = token.replace(/:/gi, '');\n    token = token.replace(/([a-gA-G]+[-#nXxYy<>]*)/g, function (str, p1) {\n      return p1 ? p1 + ':' : str;\n    });\n    global_cursor.RestoreCursorNote = id;\n    setEditorContents(line, field, token, id);\n  } else {\n    // remove arpeggio\n    token = token.replace(/:/gi, '');\n    global_cursor.RestoreCursorNote = id;\n    setEditorContents(line, field, token, id);\n  }\n}\n\n//////////////////////////////\n//\n// toggleFermata --\n//\n\nfunction toggleFermata(id, line, field) {\n  console.log('TOGGLING FERMATA');\n  var token = getEditorContents(line, field);\n  if (token === '.') {\n    // nothing to do, just a null data token\n    return;\n  }\n  if (!token.match(/;/i)) {\n    // add marcato\n    token = token.replace(/;/gi, '');\n    token = token.replace(/([ra-gA-G]+[-#nXxYy<>]*)/, function (str, p1) {\n      return p1 ? p1 + ';' : str;\n    });\n    global_cursor.RestoreCursorNote = id;\n    setEditorContents(line, field, token, id);\n  } else {\n    // remove marcato\n    token = token.replace(/;[<>]*/gi, '');\n    global_cursor.RestoreCursorNote = id;\n    setEditorContents(line, field, token, id);\n  }\n}\n\n//////////////////////////////\n//\n// toggleVisibility -- Still have to think about chords.\n//\n\nfunction toggleVisibility(id, line, field) {\n  var token = getEditorContents(line, field);\n\n  if (token === '.') {\n    // nothing to do, just a null data token\n    return;\n  }\n\n  if (token.match(/yy/)) {\n    // token is invisible, so make it visible again.\n    token = token.replace(/yy/, '');\n    global_cursor.RestoreCursorNote = id;\n    setEditorContents(line, field, token, id);\n  } else {\n    // make token invisible (deal with chords later)\n    token = token + 'yy';\n    global_cursor.RestoreCursorNote = id;\n    setEditorContents(line, field, token, id);\n  }\n}\n\n/////////////////////////////\n//\n// setEditorContents --\n//\n\nexport function setEditorContents(line, field, token, id, dontredraw) {\n  var freezeBackup = global_interface.FreezeRendering;\n  if (global_interface.FreezeRendering == false) {\n    global_interface.FreezeRendering = true;\n  }\n\n  var i;\n  var linecontent = editor.session.getLine(line - 1);\n  var range = new Range(line - 1, 0, line - 1, linecontent.length);\n\n  var components = linecontent.split(/\\t+/);\n  components[field - 1] = token;\n\n  // count tabs between fields\n  var tabs = [];\n  for (i = 0; i < components.length + 1; i++) {\n    tabs[i] = '';\n  }\n  var pos = 0;\n  if (linecontent[0] != '\\t') {\n    pos++;\n  }\n  for (i = 1; i < linecontent.length; i++) {\n    if (linecontent[i] == '\\t') {\n      tabs[pos] += '\\t';\n    } else if (linecontent[i] != '\\t' && linecontent[i - 1] == '\\t') {\n      pos++;\n    }\n  }\n\n  var newlinecontent = '';\n  for (i = 0; i < tabs.length; i++) {\n    newlinecontent += tabs[i];\n    if (components[i]) {\n      newlinecontent += components[i];\n    }\n  }\n\n  // newlinecontent = components.join(\"\\t\");\n\n  var column = 0;\n  for (i = 0; i < field - 1; i++) {\n    column += components[i].length;\n    column += tabs[i].length;\n  }\n  // global_editorOptions.EDITINGID = id;\n\n  editor.session.replace(range, newlinecontent);\n  // editor.gotoLine(line, column + 1);\n\n  // global_cursor.RestoreCursorNote = id;\n  global_interface.FreezeRendering = freezeBackup;\n  if (!dontredraw) {\n    displayNotation();\n  }\n}\n\nfunction setEditorContents2(line, field, token, id) {\n  var i;\n  var linecontent = editor.session.getLine(line - 1);\n  var range = new Range(line - 1, 0, line - 1, linecontent.length);\n\n  var components = linecontent.split(/\\t+/);\n  components[field - 1] = token;\n\n  // count tabs between fields\n  var tabs = [];\n  for (i = 0; i < components.length + 1; i++) {\n    tabs[i] = '';\n  }\n  var pos = 0;\n  if (linecontent[0] != '\\t') {\n    pos++;\n  }\n  for (i = 1; i < linecontent.length; i++) {\n    if (linecontent[i] == '\\t') {\n      tabs[pos] += '\\t';\n    } else if (linecontent[i] != '\\t' && linecontent[i - 1] == '\\t') {\n      pos++;\n    }\n  }\n\n  var newlinecontent = '';\n  for (i = 0; i < tabs.length; i++) {\n    newlinecontent += tabs[i];\n    if (components[i]) {\n      newlinecontent += components[i];\n    }\n  }\n\n  editor.session.replace(range, newlinecontent);\n}\n\nexport function setEditorContentsMany(notes) {\n  global_interface.FreezeRendering = true;\n  notes.forEach(note => setEditorContents2(note.line, note.field, note.token, note.id));\n  global_interface.FreezeRendering = false;\n  displayNotation();\n}\n\n//////////////////////////////\n//\n// getEditorContents -- Allow subtokens perhaps.\n//\n\nexport function getEditorContents(line, field) {\n  var token = '';\n\n  var linecontent = editor.session.getLine(line - 1);\n\n  var col = 0;\n  if (field > 1) {\n    var tabcount = 0;\n    for (let i = 0; i < linecontent.length; i++) {\n      col++;\n      if (linecontent[i] == '\\t') {\n        if (i > 0 && linecontent[i - 1] != '\\t') {\n          tabcount++;\n        }\n      }\n      if (tabcount == field - 1) {\n        break;\n      }\n    }\n  }\n  for (var c = col; c < linecontent.length; c++) {\n    if (linecontent[c] == '\\t') {\n      break;\n    }\n    if (linecontent[c] == undefined) {\n      console.log('undefined index', c);\n      break;\n    }\n    token += linecontent[c];\n  }\n\n  return token;\n}\n\n//////////////////////////////\n//\n// toggleMarkedNote --\n//\n\nfunction toggleMarkedNote(id, line, field, subfield) {\n  console.log('TOGGLE MARKED NOTE ', line, field, subfield, id);\n  var token = getEditorContents(line, field);\n\n  if (subfield) {\n    var subtokens = token.split(' ');\n    token = subtokens[subfield - 1];\n  }\n\n  if (token === '.' || token[0] == '!' || token[0] == '*') {\n    return;\n  }\n  if (token.match('r')) {\n    // rest, which does not need/have an accidental\n    return;\n  }\n\n  var editchar = insertMarkedNoteRdf();\n  var newtoken;\n  var matches;\n\n  var re = new RegExp(editchar);\n  if (re.exec(token)) {\n    // remove mark\n    newtoken = token.replace(new RegExp(editchar, 'g'), '');\n  } else {\n    // add a natural and an editorial accidental\n    newtoken = token + editchar;\n  }\n\n  if (subfield) {\n    subtokens[subfield - 1] = newtoken;\n    newtoken = subtokens.join(' ');\n  }\n\n  if (newtoken !== token) {\n    global_cursor.RestoreCursorNote = id;\n    global_cursor.HIGHLIGHTQUERY = id;\n    setEditorContents(line, field, newtoken, id);\n  }\n}\n\n//////////////////////////////\n//\n// addLocalCommentLineAboveCurrentPosition -- Add a local comment\n//   line above the current line. Cursor keeps its position on the\n//   original line.\n//\n\nexport function addLocalCommentLineAboveCurrentPosition() {\n  addNullLine('!', '**blank');\n}\n\n//////////////////////////////\n//\n// addInterpretationLineAboveCurrentPosition -- Add an interpretation\n//   line above the current line. Cursor keeps its position on the\n//   original line.\n//\n\nexport function addInterpretationLineAboveCurrentPosition() {\n  addNullLine('*', '**blank');\n}\n\n//////////////////////////////\n//\n// addDataLineAboveCurrentPosition -- Add an empty data line\n//   above the current line. Cursor keeps its position on the\n//   original line.\n//\n\nexport function addDataLineAboveCurrentPosition() {\n  addNullLine('.', '**dynam');\n}\n\n//////////////////////////////\n//\n// addBarlineAboveCurrentPosition -- Add barline above the current\n//   line. Cursor keeps its position on the original line.\n//\n\nexport function addBarlineAboveCurrentPosition() {\n  addNullLine('=', '**blank');\n}\n\n//////////////////////////////\n//\n// createNullLine --\n//\n\nfunction createNullLine(token, textline) {\n  var newline = '';\n  if (textline[0] == '\\t') {\n    newline += '\\t';\n  } else {\n    newline += token;\n  }\n  var i;\n  for (i = 1; i < textline.length; i++) {\n    if (textline[i] == '\\t') {\n      newline += '\\t';\n    } else if (textline[i] != '\\t' && textline[i - 1] == '\\t') {\n      newline += token;\n    }\n  }\n  newline += '\\n';\n  return newline;\n}\n\n//////////////////////////////\n//\n// addNullLine -- Add a line of tokens based on how many tokens\n//    the given line has.  However, if the current line is an\n//    exclusive interpretation, then instead add a **dynam column\n//    on the right side of the cursor's column.\n//\n\nfunction addNullLine(token, exinterp, row) {\n  if (!token) {\n    token = '.';\n  }\n  if (!exinterp) {\n    exinterp = '**blank';\n  }\n  if (!row) {\n    var location = editor.getCursorPosition();\n    row = location.row;\n  }\n  var currentline = editor.session.getLine(row);\n  if (currentline.match(/^!!/)) {\n    // don't know how many spines to add\n    return;\n  }\n  if (currentline.match(/^$/)) {\n    // empty line: don't know how many spines to add\n    return;\n  }\n  if (currentline.match(/^\\*\\*/)) {\n    // can't add spines before exclusive interpretation\n    // so instead add a **dynam spine on the right of the\n    // cursor's current column.\n    addSpineToRight(exinterp, currentline, location);\n    return;\n  }\n\n  var newline = createNullLine(token, currentline);\n  editor.session.insert({ row: row, column: 0 }, newline);\n}\n\n//////////////////////////////\n//\n// addSpineToRight --  Add an extra spine to the immediate\n//    right of a given spine (must be done at an exinterp line).\n//\n\nfunction addSpineToRight(exinterp, currentline, location) {\n  console.log(\n    'EXINTERP',\n    exinterp,\n    'CURRENTLINE',\n    currentline,\n    'LOCATION',\n    location\n  );\n  var column = location.column;\n\n  // calculate spine number at current location\n  var scount = 0;\n  var i;\n  var state = 0;\n  for (i = 0; i < location.column + 1; i++) {\n    if (currentline[i] == '\\t') {\n      if (state == 1) {\n        state = 0;\n      }\n    } else {\n      if (state == 0) {\n        state = 1;\n        scount++;\n      }\n    }\n  }\n\n  // count the total number of spines:\n  var tcount = 0;\n  state = 0;\n  for (i = 0; i < currentline.length; i++) {\n    if (currentline[i] == '\\t') {\n      if (state == 1) {\n        state = 0;\n      }\n    } else {\n      if (state == 0) {\n        state = 1;\n        tcount++;\n      }\n    }\n  }\n\n  console.log('   SPINE NUMBER IS ', scount, 'TOTAL', tcount);\n  var filter = 'extract -s ';\n  if (scount == 1) {\n    if (tcount == 1) {\n      filter += '1,0';\n    } else if (tcount == 2) {\n      filter += '1,0,2';\n    } else {\n      filter += '1,0,2-$';\n    }\n  } else {\n    filter += '1-' + scount + ',0';\n    if (scount == tcount) {\n      // do nothing\n    } else if (scount + 1 == tcount) {\n      filter += ',' + tcount;\n    } else {\n      filter += ',' + (scount + 1) + '-$';\n    }\n  }\n  if (exinterp !== '**blank') {\n    filter += ' -n ' + exinterp;\n  }\n  // window.MENU.applyFilter(filter);\n  getMenu().applyFilter(filter);\n}\n\n//////////////////////////////\n//\n// getBeamParent -- Return the first element containing an id starting\n//   with \"beam-\" in the ancestors of the given element.\n//\n\nfunction getBeamParent(element) {\n  var current = element.parentNode;\n  while (current) {\n    if (current.id.match(/^beam-/)) {\n      return current;\n    }\n    current = current.parentNode;\n  }\n  return undefined;\n}\n\n//////////////////////////////\n//\n// getBeamChild -- Return the direct child of a beam which contains this element.\n//\n\nfunction getBeamChild(element) {\n  var current = element;\n  while (current) {\n    if (current.parentNode && current.parentNode.id.match(/^beam-/)) {\n      return current;\n    }\n    current = current.parentNode;\n  }\n  return undefined;\n}\n\n//////////////////////////////\n//\n// startNewBeam -- L: Splitting a beam into two pieces, with the current note\n//    starting a new beam, and the previous note ending the old beam.\n//\n\nfunction startNewBeam(element, line, field) {\n  var parent = getBeamParent(element);\n  var newelement = getBeamChild(element);\n  if (!parent) {\n    return;\n  }\n  var pid = parent.id;\n  if (!pid.match(/^beam/)) {\n    return;\n  }\n  var selector = '#' + pid + \" > g[id^='note']\";\n  selector += ', #' + pid + \" > g[id^='rest']\";\n  selector += ', #' + pid + \" > g[id^='chord']\";\n  var children = parent.querySelectorAll(selector);\n  var targeti = -1;\n  for (var i = 0; i < children.length; i++) {\n    if (children[i] === newelement) {\n      targeti = i;\n      break;\n    }\n  }\n  if (targeti <= 0) {\n    // no need to start a new beam\n    return;\n  }\n\n  var freezeBackup = global_interface.FreezeRendering;\n  if (global_interface.FreezeRendering == false) {\n    global_interface.FreezeRendering = true;\n  }\n\n  if (targeti == 1) {\n    // remove the beam on the first note of the original beam group\n    // and add a beam start on this note unless it is at the end\n    // of the original beam group.\n    removeBeamInfo(children[0]);\n    if (children.length == 2) {\n      removeBeamInfo(children[1]);\n    } else {\n      addBeamStart(children[targeti]);\n    }\n  } else if (targeti < children.length - 1) {\n    addBeamStart(children[targeti]);\n    addBeamEnd(children[targeti - 1]);\n  } else {\n    // remove the last note from the beam group\n    addBeamEnd(children[targeti - 1]);\n    removeBeamInfo(children[targeti]);\n  }\n\n  global_editorOptions.EDITINGID = element.id;\n  global_cursor.RestoreCursorNote = element.id;\n\n  global_interface.FreezeRendering = freezeBackup;\n  if (!global_interface.FreezeRendering) {\n    displayNotation();\n  }\n  turnOffAllHighlights();\n  highlightIdInEditor(global_editorOptions.EDITINGID);\n}\n\n//////////////////////////////\n//\n// endNewBeam -- J: Splitting a beam into two pieces, with the current note\n//    ending the old beam, and the current note starting a new beam.\n//\n\nfunction endNewBeam(element, line, field) {\n  var parent = getBeamParent(element);\n  var newelement = getBeamChild(element);\n  if (!parent) {\n    return;\n  }\n  var pid = parent.id;\n  if (!pid.match(/^beam/)) {\n    return;\n  }\n  var selector = '#' + pid + \" > g[id^='note']\";\n  selector += ', #' + pid + \" > g[id^='rest']\";\n  selector += ', #' + pid + \" > g[id^='chord']\";\n  var children = parent.querySelectorAll(selector);\n  var targeti = -1;\n  for (var i = 0; i < children.length; i++) {\n    if (children[i] === newelement) {\n      targeti = i;\n      break;\n    }\n  }\n  if (targeti < 0) {\n    return;\n  }\n  if (children.length == 1) {\n    // strange: nothing to do\n    return;\n  }\n  if (targeti == children.length - 1) {\n    // already at the end of a beam, so nothing to do\n    return;\n  }\n\n  var freezeBackup = global_interface.FreezeRendering;\n  if (global_interface.FreezeRendering == false) {\n    global_interface.FreezeRendering = true;\n  }\n\n  if (targeti == 0) {\n    // remove the beam info from the 0th element and add to 1st\n    removeBeamInfo(children[0]);\n    addBeamStart(children[targeti + 1]);\n  } else if (targeti == children.length - 2) {\n    // end current beam, and make next note out of a beam\n    removeBeamInfo(children[targeti + 1]);\n    addBeamEnd(children[targeti]);\n  } else {\n    addBeamEnd(children[targeti]);\n    addBeamStart(children[targeti + 1]);\n  }\n  global_editorOptions.EDITINGID = element.id;\n  global_cursor.RestoreCursorNote = element.id;\n\n  global_interface.FreezeRendering = freezeBackup;\n  if (!global_interface.FreezeRendering) {\n    displayNotation();\n  }\n  turnOffAllHighlights();\n  highlightIdInEditor(global_editorOptions.EDITINGID);\n}\n\n//////////////////////////////\n//\n// removeBeamInfo -- remove [JLKk] characters from given line and field taken\n//     from ID of input element.\n//\n\nfunction removeBeamInfo(element) {\n  if (!element) {\n    return;\n  }\n  var id = element.id;\n  var matches = id.match(/[^-]+-.*L(\\d+).*F(\\d+)/);\n  if (!matches) {\n    return;\n  }\n  var line = parseInt(matches[1]);\n  var field = parseInt(matches[2]);\n  var token = getEditorContents(line, field).replace(/[LJKk]+[<>]?/g, '');\n  setEditorContents(line, field, token, id, true);\n}\n\n//////////////////////////////\n//\n// addBeamStart -- remove [JLKk] characters from given line and field taken\n//     from ID of input element and place a \"L\" at the end of the token.\n//\n\nfunction addBeamStart(element) {\n  if (!element) {\n    return;\n  }\n  var id = element.id;\n  var matches = id.match(/[^-]+-.*L(\\d+).*F(\\d+)/);\n  if (!matches) {\n    return;\n  }\n  var line = parseInt(matches[1]);\n  var field = parseInt(matches[2]);\n  var token = getEditorContents(line, field).replace(/[LJKk]+[<>]?/g, '');\n  token += 'L';\n  setEditorContents(line, field, token, id, true);\n}\n\n//////////////////////////////\n//\n// addBeamEnd -- remove [JLKk] characters from given line and field taken\n//     from ID of input element and place a \"J\" at the end of the token.\n//\n\nfunction addBeamEnd(element) {\n  if (!element) {\n    return;\n  }\n  var id = element.id;\n  var matches = id.match(/[^-]+-.*L(\\d+).*F(\\d+)/);\n  if (!matches) {\n    return;\n  }\n  var line = parseInt(matches[1]);\n  var field = parseInt(matches[2]);\n  var token = getEditorContents(line, field).replace(/[LJKk]+[<>]?/g, '');\n  token += 'J';\n  setEditorContents(line, field, token, id, true);\n}\n","//////////////////////////////\n//\n// getFilenameBase --\n//\nimport { FILEINFO } from './global-variables.js';\nimport { getTextFromEditor, getTextFromEditorRaw } from './misc.js';\n\nexport function getFilenameBase(text) {\n  if (!text) {\n    text = getTextFromEditor();\n  }\n  if (!text) {\n    return '';\n  }\n  var matches = text.match(/^!!!!SEGMENT:\\s*([^\\s'\"!*]+)/);\n  var output;\n  if (matches) {\n    output = matches[1];\n    output = output.replace(/.*\\//, '').replace(/\\..*?$/, '');\n    if (output.length > 0) {\n      return output;\n    }\n  }\n  // In the data was loaded from a repertory file, then use that\n  // file as the filename base.\n  if (FILEINFO) {\n    if (FILEINFO.file) {\n      output = FILEINFO.file;\n      output = output.replace(/.*\\//, '').replace(/\\..*?$/, '');\n      if (output.length > 0) {\n        return output;\n      }\n    }\n  }\n  return 'data';\n}\n\n//////////////////////////////\n//\n// getFilenameExtension --\n//\n\nexport function getFilenameExtension(text) {\n  if (!text) {\n    text = getTextFromEditorRaw();\n  }\n  if (!text) {\n    return 'txt';\n  }\n  var beginning = text.substring(0, 1000).replace(/^\\s+/, '');\n  if (beginning.match(/<meiHead/)) {\n    return 'mei';\n  }\n  if (beginning.match(/<score-(part|time)wise/)) {\n    return 'musicxml';\n  }\n  if (beginning.match(/<opus/)) {\n    return 'musicxml';\n  }\n  if (beginning.match(/^[A-Za-z0-9+\\/\\s]+$/)) {\n    return 'mime';\n  }\n\n  var matches;\n  var ext;\n  var fullname;\n  if (beginning.match(/^[!*]/)) {\n    // Humdrum file.\n    matches = beginning.match(/^!!!!SEGMENT:\\s*([^\\s'\"!*]+)/);\n    if (matches) {\n      fullname = matches[1];\n      if (fullname.match(/\\./)) {\n        ext = fullname.replace(/.*\\./, '');\n        if (ext && ext.length > 0) {\n          return ext;\n        }\n      }\n    }\n    if (FILEINFO) {\n      if (FILEINFO.file) {\n        fullname = FILEINFO.file.replace(/.*\\//, '');\n        ext = fullname.replace(/.*\\./, '');\n        if (ext && ext.length > 0) {\n          return ext;\n        }\n      }\n    }\n    return 'krn';\n  }\n\n  if (beginning.match(/group memberships:/i)) {\n    // MuseData\n    return '.msd';\n  }\n\n  return 'txt';\n}\n\n//////////////////////////////\n//\n// dataIsHumdrum -- Returns true if the input text (or text from\n//    the editor if no text given as input) is Humdrum data or not.\n//\n\nexport function dataIsHumdrum(data) {\n  if (!data) {\n    data = getTextFromEditor();\n  }\n  if (data.match(/^\\s*[!*]/)) {\n    return true;\n  } else {\n    return false;\n  }\n}\n\n//////////////////////////////\n//\n// dataIsXml -- Returns true if the input text (or text from\n//     the editor if no text given as input) is XML data or not.\n//\n\nfunction dataIsXml(data) {\n  if (!data) {\n    data = getTextFromEditor();\n  }\n  if (data.match(/^\\s*<\\?xml\\b/)) {\n    return true;\n  } else {\n    return false;\n  }\n}\n\n//////////////////////////////\n//\n// trimTabs -- also removes blank lines and tabs from inside of reference records.\n//\n\nfunction trimTabs(data) {\n  var lines = data.split(/\\r?\\n/);\n  var output = '';\n  for (var i = 0; i < lines.length; i++) {\n    let line = lines[i].replace(/\\t+$/, '');\n    if (line.match(/^\\s*$/)) {\n      // ignoring blank lines\n      continue;\n    }\n    if (line.match(/^!!![^\\s]+:\\t/)) {\n      line = line.replace(/\\t/, ' ');\n    }\n    output += line + '\\n';\n  }\n  return output;\n}\n\n//////////////////////////////\n//\n// trimTabsInEditor -- remove trailing tabs on text lines in\n//    editor.  Also removes empty lines.\n//\nimport { setTextInEditor } from './misc.js';\n\nexport function trimTabsInEditor(text) {\n  if (!text) {\n    text = getTextFromEditor();\n  }\n  if (!text) {\n    console.log('No content to convert to Humdrum');\n    return;\n  }\n\n  var newtext = trimTabs(text);\n  setTextInEditor(newtext);\n}\n\n////////////////////////////////////////////////////////////////////////////\n//\n//  Base64 encode/decode: Fixs problems with atob and btoa with UTF-8 encoded text.\n//\n//  https://www.webtoolkit.info\n//\n\nexport const Base64 = {\n  // private property\n  _keyStr: 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=',\n\n  // public method for encoding\n  encode: function (input) {\n    var output = '';\n    var chr1, chr2, chr3, enc1, enc2, enc3, enc4;\n    var i = 0;\n\n    input = Base64._utf8_encode(input);\n\n    while (i < input.length) {\n      chr1 = input.charCodeAt(i++);\n      chr2 = input.charCodeAt(i++);\n      chr3 = input.charCodeAt(i++);\n\n      enc1 = chr1 >> 2;\n      enc2 = ((chr1 & 3) << 4) | (chr2 >> 4);\n      enc3 = ((chr2 & 15) << 2) | (chr3 >> 6);\n      enc4 = chr3 & 63;\n\n      if (isNaN(chr2)) {\n        enc3 = enc4 = 64;\n      } else if (isNaN(chr3)) {\n        enc4 = 64;\n      }\n\n      output =\n        output +\n        this._keyStr.charAt(enc1) +\n        this._keyStr.charAt(enc2) +\n        this._keyStr.charAt(enc3) +\n        this._keyStr.charAt(enc4);\n    }\n\n    return output;\n  },\n\n  // public method for decoding\n  decode: function (input) {\n    var output = '';\n    var chr1, chr2, chr3;\n    var enc1, enc2, enc3, enc4;\n    var i = 0;\n\n    input = input.replace(/[^A-Za-z0-9\\+\\/\\=]/g, '');\n\n    while (i < input.length) {\n      enc1 = this._keyStr.indexOf(input.charAt(i++));\n      enc2 = this._keyStr.indexOf(input.charAt(i++));\n      enc3 = this._keyStr.indexOf(input.charAt(i++));\n      enc4 = this._keyStr.indexOf(input.charAt(i++));\n\n      chr1 = (enc1 << 2) | (enc2 >> 4);\n      chr2 = ((enc2 & 15) << 4) | (enc3 >> 2);\n      chr3 = ((enc3 & 3) << 6) | enc4;\n\n      output = output + String.fromCharCode(chr1);\n\n      if (enc3 != 64) {\n        output = output + String.fromCharCode(chr2);\n      }\n      if (enc4 != 64) {\n        output = output + String.fromCharCode(chr3);\n      }\n    }\n\n    output = Base64._utf8_decode(output);\n\n    return output;\n  },\n\n  // private method for UTF-8 encoding\n  _utf8_encode: function (string) {\n    string = string.replace(/\\r\\n/g, '\\n');\n    var utftext = '';\n\n    for (var n = 0; n < string.length; n++) {\n      var c = string.charCodeAt(n);\n\n      if (c < 128) {\n        utftext += String.fromCharCode(c);\n      } else if (c > 127 && c < 2048) {\n        utftext += String.fromCharCode((c >> 6) | 192);\n        utftext += String.fromCharCode((c & 63) | 128);\n      } else {\n        utftext += String.fromCharCode((c >> 12) | 224);\n        utftext += String.fromCharCode(((c >> 6) & 63) | 128);\n        utftext += String.fromCharCode((c & 63) | 128);\n      }\n    }\n\n    return utftext;\n  },\n\n  // private method for UTF-8 decoding\n  _utf8_decode: function (utftext) {\n    var string = '';\n    var i = 0;\n    // var c = c1 = c2 = 0;\n    var c = 0,\n      c1 = 0,\n      c2 = 0;\n\n    while (i < utftext.length) {\n      c = utftext.charCodeAt(i);\n\n      if (c < 128) {\n        string += String.fromCharCode(c);\n        i++;\n      } else if (c > 191 && c < 224) {\n        c2 = utftext.charCodeAt(i + 1);\n        string += String.fromCharCode(((c & 31) << 6) | (c2 & 63));\n        i += 2;\n      } else {\n        c2 = utftext.charCodeAt(i + 1);\n        // Was declared global\n        var c3 = utftext.charCodeAt(i + 2);\n        string += String.fromCharCode(\n          ((c & 15) << 12) | ((c2 & 63) << 6) | (c3 & 63)\n        );\n        i += 3;\n      }\n    }\n    return string;\n  },\n};\n\n//////////////////////////////\n//\n// convertDataToTsv --\n//\n\nexport function convertDataToTsv(lines) {\n  var output = '';\n  for (var i = 0; i < lines.length; i++) {\n    output += convertLineToTsv(lines[i]) + '\\n';\n  }\n  return output;\n}\n\n//////////////////////////////\n//\n// convertDataToCsv --\n//\n\nexport function convertDataToCsv(lines) {\n  var output = '';\n  for (var i = 0; i < lines.length; i++) {\n    output += convertLineToCsv(lines[i]) + '\\n';\n  }\n  return output;\n}\n\n//////////////////////////////\n//\n// convertLineToTsv --\n//\n\nfunction convertLineToTsv(line) {\n  var chars = line.split('');\n  var output = '';\n  if (chars.length < 1) {\n    return output;\n  }\n  var inquote = 0;\n\n  if (chars.length >= 2 && chars[0] == '!' && chars[1] == '!') {\n    // Global commands and reference records which do not start with a\n    // quote are considered to be literal.\n    return line;\n  }\n\n  var separator = ',';\n\n  for (var i = 0; i < chars.length; i++) {\n    if (chars[i] == '\"' && !inquote) {\n      inquote = 1;\n      continue;\n    }\n    if (\n      inquote &&\n      chars[i] == '\"' &&\n      chars[i + 1] == '\"' &&\n      i < chars.length - 1\n    ) {\n      output += '\"';\n      i++;\n      continue;\n    }\n    if (chars[i] == '\"') {\n      inquote = 0;\n      continue;\n    }\n    if (!inquote && line.substr(i, separator.length) == separator) {\n      output += '\\t';\n      i += separator.length - 1;\n      continue;\n    }\n    output += chars[i];\n  }\n  return output;\n}\n\n//////////////////////////////\n//\n// convertLineToCsv --\n//\n\nfunction convertLineToCsv(line) {\n  if (line.match(/^!!/)) {\n    return line;\n  }\n  // Using \\t rather than \\t to preserve tabs\n  var tokens = line.split(/\\t/);\n  var output = '';\n  for (var i = 0; i < tokens.length; i++) {\n    output += convertTokenToCsv(tokens[i]);\n    if (i < tokens.length - 1) {\n      output += ',';\n    }\n  }\n  return output;\n}\n\n//////////////////////////////\n//\n// convertTokenToCsv --\n//\n\nfunction convertTokenToCsv(token) {\n  var output = '';\n  if (token.match(/,/) || token.match(/\"/)) {\n    output += '\"';\n    output += token.replace(/\"/g, '\"\"');\n    output += '\"';\n    return output;\n  } else {\n    return token;\n  }\n}\n","/* global saveAs */\nimport { setTextInEditor, getTextFromEditorRaw } from './misc.js';\nimport { getMenu } from '../menu.js';\nimport { InterfaceSingleNumber, setInterfaceSingleNumber } from './editor.js';\n\n//////////////////////////////\n//\n// loadBuffer -- load the text contents from a local buffer, but if the\n//    shift key is pressed, delete the current contents of the buffer instead.\n//\n\nfunction loadBuffer(number, event) {\n  if (number < 1 || number > 9) {\n    return;\n  }\n  if (event && event.shiftKey) {\n    // clear contents of given buffer.\n    var key = 'SAVE' + number;\n    delete localStorage[key];\n    var title = key + '-TITLE';\n    delete localStorage[title];\n    var selement = document.querySelector('#save-' + number);\n    if (selement) {\n      selement.classList.remove('filled');\n    }\n    var lelement = document.querySelector('#load-' + number);\n    if (lelement) {\n      lelement.classList.remove('filled');\n    }\n  } else {\n    // store contents of text editor in given buffer.\n    // window.MENU.loadFromBuffer(number);\n    getMenu().loadFromBuffer(number);\n  }\n}\n\n//////////////////////////////\n//\n// saveBuffer -- save the text contents to a local buffer, but if the\n//    shift key is pressed, delete the current contents of the buffer instead.\n//\n\nfunction saveBuffer(number, event) {\n  if (number < 1 || number > 9) {\n    return;\n  }\n  if (event && event.shiftKey) {\n    // clear contents of given buffer.\n    var key = 'SAVE' + number;\n    delete localStorage[key];\n    var title = key + '-TITLE';\n    delete localStorage[title];\n    var selement = document.querySelector('#save-' + number);\n    if (selement) {\n      selement.classList.remove('filled');\n    }\n    var lelement = document.querySelector('#load-' + number);\n    if (lelement) {\n      lelement.classList.remove('filled');\n    }\n  } else {\n    // store contents of text editor in given buffer.\n    // window.MENU.saveToBuffer(number);\n    getMenu().saveToBuffer(number);\n  }\n}\n\n//////////////////////////////\n//\n// restoreEditorContentsLocally -- Restore the editor contents from localStorage.\n//\nexport function restoreEditorContentsLocally() {\n  // save current contents to 0th buffer\n  var encodedcontents = encodeURIComponent(getTextFromEditorRaw());\n  localStorage.setItem('SAVE0', encodedcontents);\n  // reset interval timer of buffer 0 autosave here...\n\n  var target = InterfaceSingleNumber;\n  if (!target) {\n    target = 1;\n  }\n  // Was declared global\n  var key = 'SAVE' + target;\n  var contents = localStorage.getItem(key);\n  if (!contents) {\n    return;\n  }\n  var decodedcontents = decodeURIComponent(localStorage.getItem(key));\n  setTextInEditor(decodedcontents);\n  setInterfaceSingleNumber(0);\n}\n\n//////////////////////////////\n//\n// prepareBufferStates --\n//\n\nexport function prepareBufferStates() {\n  var saves = document.querySelectorAll('[id^=save-]');\n  var loads = document.querySelectorAll('[id^=load-]');\n  var i;\n  var id;\n  var num = 0;\n  var value;\n  var matches;\n  var skey;\n  var lkey;\n  var tkey;\n\n  // Was declared global\n  var title;\n\n  for (i = 0; i < saves.length; i++) {\n    id = saves[i].id;\n    matches = id.match(/save-(\\d+)/);\n    if (matches) {\n      num = parseInt(matches[1]);\n    } else {\n      continue;\n    }\n    if (num < 1) {\n      continue;\n    }\n    skey = 'SAVE' + num;\n    if (localStorage.hasOwnProperty(skey)) {\n      value = localStorage[skey];\n      if (value) {\n        saves[i].classList.add('filled');\n        tkey = 'SAVE' + num + '-TITLE';\n        if (localStorage.hasOwnProperty(tkey)) {\n          title = localStorage[tkey];\n          if (title) {\n            saves[i].title = title;\n          }\n        }\n      }\n    }\n  }\n\n  for (i = 0; i < loads.length; i++) {\n    id = loads[i].id;\n    matches = id.match(/load-(\\d+)/);\n    if (matches) {\n      num = parseInt(matches[1]);\n    } else {\n      continue;\n    }\n    if (num < 1) {\n      continue;\n    }\n    skey = 'SAVE' + num;\n    if (localStorage.hasOwnProperty(skey)) {\n      value = localStorage[skey];\n      if (value) {\n        loads[i].classList.add('filled');\n        tkey = 'SAVE' + num + '-TITLE';\n        if (localStorage.hasOwnProperty(tkey)) {\n          title = localStorage[tkey];\n          if (title) {\n            loads[i].title = title;\n          }\n        }\n      }\n    }\n  }\n}\n\n//////////////////////////////\n//\n// saveEditorContentsLocally -- Save the editor contents to localStorage.\n//\n\nexport function saveEditorContentsLocally() {\n  var target = InterfaceSingleNumber;\n  if (!target) {\n    target = 1;\n  }\n  // Was declared global\n  var key = 'SAVE' + target;\n  var value = getTextFromEditorRaw();\n  var filled = false;\n  var encodedcontents = '';\n  if (value.match(/^\\s*$/)) {\n    encodedcontents = '';\n    filled = false;\n  } else {\n    encodedcontents = encodeURIComponent(value);\n    filled = true;\n  }\n  localStorage.setItem(key, encodedcontents);\n  var telement = document.querySelector('#title-info');\n  var title = '';\n  if (telement) {\n    title = telement.textContent.replace(/^\\s+/, '').replace(/\\s+$/, '');\n  }\n  localStorage.setItem(key + '-TITLE', title);\n\n  var selement = document.querySelector('#save-' + target);\n  if (selement) {\n    selement.title = title;\n    if (filled) {\n      selement.classList.add('filled');\n    } else {\n      selement.classList.remove('filled');\n    }\n  }\n\n  var lelement = document.querySelector('#load-' + target);\n  if (lelement) {\n    lelement.title = title;\n    if (filled) {\n      lelement.classList.add('filled');\n    } else {\n      lelement.classList.remove('filled');\n    }\n  }\n\n  setInterfaceSingleNumber(0);\n}\n\n//////////////////////////////\n//\n// saveSvgData --\n//\nimport { getTextFromEditor } from './misc.js';\nimport { dataIsHumdrum } from './utility.js';\nimport { getVrvWorker } from '../humdrum-notation-plugin-worker.js';\nimport { getAceEditor } from './setup.js';\nimport {\n  global_editorOptions,\n  global_interface,\n  OPTIONS,\n} from './global-variables.js';\n\nlet vrvWorker = getVrvWorker();\nif (!vrvWorker) {\n  throw new Error('Verovio worker is undefined');\n}\n\nlet editor = getAceEditor();\nif (!editor) {\n  throw new Error('Ace Editor is undefined');\n}\n\nexport function saveSvgData() {\n  if (global_interface.ShowingIndex) {\n    return;\n  }\n\n  var options = JSON.parse(JSON.stringify(OPTIONS));\n  console.log('SVG PRINTING OPTIONS', options);\n  var data = getTextFromEditor();\n  if (data.match(/^\\s*$/)) {\n    return;\n  }\n\n  var humdrum = dataIsHumdrum(data);\n\n  var page = vrvWorker.page;\n  var force = true;\n\n  // window.vrvWorker.renderPage(window.vrvWorker.page)\n  vrvWorker.renderData(options, data, page, force).then(function (data) {\n    console.log('buffer vrvWorker.renderData', data);\n    var filename = global_editorOptions.SAVEFILENAME;\n    var size = editor.session.getLength();\n    var matches;\n    var line;\n    for (var i = 0; i < size; i++) {\n      line = editor.session.getLine(i);\n      if ((matches = line.match(/^!!!!SEGMENT:\\s*([^\\s].*)\\s*$/))) {\n        filename = matches[1];\n      }\n    }\n    filename = filename.replace(/\\.[^.]+/, '.svg');\n    if (!filename.match(/svg$/)) {\n      filename += '.svg';\n    }\n\n    var blob = new Blob([data], { type: 'text/plain' });\n    // Global from FileSave.js\n    saveAs(blob, filename);\n\n    // Redraw without adjustPageWidth on.\n    options.adjustPageWidth = 0;\n    vrvWorker.renderData(options, data, page, force);\n  });\n}\n","/* global saveAs */\n\n//////////////////////////////\n//\n// saveEditorContents -- Save the editor contents to a file on the local disk.\n//   Saves in UTF-8 format.\n//\nimport { getFilenameBase, getFilenameExtension } from './utility.js';\nimport { getTextFromEditor } from './misc.js';\n\nexport function saveEditorContents() {\n  var filebase = getFilenameBase();\n  if (!filebase) {\n    filebase = 'data';\n  }\n  var filename = filebase;\n  var extension = getFilenameExtension();\n  if (extension) {\n    filename += '.' + extension;\n  }\n\n  var text = getTextFromEditor();\n  // var blob = new Blob([text], {type: 'text/plain;charset=utf-8'});\n  var blob = new Blob([text], { type: 'text/plain' });\n\n  // Global from FileSave.js module\n  saveAs(blob, filename);\n}\n","/* global RSVP, $, PDFDocument, blobStream, saveAs, SVGtoPDF */\n//\n//\tFunctions for saving SVG images to a PDF file.\n//\tSee demo at:\n//\t\thttp://pdfkit.org/demo/browser.html\n//\n//\tvim: ts=3:ft=javascript\n//\n//\n//These external scripts are also needed to create PDF files (found\n//in the _include/head/main.html file:\n//\n//<xscript src=\"/scripts/pdfkit/blobstream.js\" type=\"text/javascript\"></xscript>\n//<xscript src=\"/scripts/pdfkit/pdfkit.js\" type=\"text/javascript\"></xscript>\n//<xscript src=\"/scripts/pdfkit/source.js\" type=\"text/javascript\"></xscript>\n//\n//Verovio text font not needed anymore (loaded as a base-64 string):\n//<xscript src=\"scripts/pdfkit/vrv-ttf.js\" type=\"text/javascript\"></xscript>\n//\n//\n//\tThe saving process also needs FileSaver.js:\n//\t\thttps://github.com/eligrey/FileSaver.js\n//\tbut this is already included for saving editor contents.\n//\nimport { getFilenameBase } from './utility.js';\nimport { getStaffCount } from './utility-humdrum.js';\n\nimport { getVrvWorker } from '../humdrum-notation-plugin-worker.js';\nimport { getAceEditor } from './setup.js';\nimport { global_verovioOptions } from './global-variables.js';\n\nlet vrvWorker = getVrvWorker();\nif (!vrvWorker) {\n  throw new Error('Verovio worker is undefined');\n}\n\n//////////////////////////////\n//\n// loadPdfFonts -- load all default fonts used by Verovio\n//\n\nfunction loadPdfFonts(pdf) {\n  return RSVP.all([\n    loadFontResource(pdf, 'Times', '/scripts/pdfkit/EBGaramond-Regular.ttf'),\n    loadFontResource(\n      pdf,\n      'TimesItalic',\n      '/scripts/pdfkit/EBGaramond-Italic.ttf'\n    ),\n    loadFontResource(pdf, 'TimesBold', '/scripts/pdfkit/EBGaramond-Bold.ttf'),\n    loadFontResource(\n      pdf,\n      'TimesBoldItalic',\n      '/scripts/pdfkit/EBGaramond-BoldItalic.ttf'\n    ),\n    loadFontResource(pdf, 'VerovioText', '/scripts/pdfkit/VerovioText-1.0.ttf'),\n  ]);\n}\n\n//////////////////////////////\n//\n// loadFontResource -- use font from file in pdf, returns promise\n//\n\nfunction loadFontResource(pdf, name, path) {\n  var promise = new RSVP.Promise(function (resolve, reject) {\n    var client = new XMLHttpRequest();\n    client.open('GET', path);\n    client.responseType = 'arraybuffer';\n\n    client.onreadystatechange = function () {\n      if (this.readyState === this.DONE) {\n        if (this.status === 200) {\n          resolve(this.response);\n        } else {\n          reject(this);\n        }\n      }\n    };\n\n    client.send(null);\n  });\n\n  return promise.then(function (data) {\n    pdf.registerFont(name, data);\n    return true;\n  });\n}\n\n//////////////////////////////\n//\n// svgFontCallback -- substitute svg fonts with pdf fonts\n//\n\nfunction svgFontCallback(family, bold, italic, options) {\n  if (family == 'VerovioText') {\n    return family;\n  }\n  if (family.match(/(?:^|,)\\s*sans-serif\\s*$/) || true) {\n    if (bold) {\n      return italic ? 'TimesBoldItalic' : 'TimesBold';\n    } else {\n      return italic ? 'TimesItalic' : 'Times';\n    }\n  }\n}\n\n//////////////////////////////\n//\n// generatePdfShapshot -- Write a PDF file containing the currently displayed SVG.\n//\n\nexport function generatePdfSnapshot(format, orientation) {\n  $('html').css('cursor', 'wait');\n\n  var svg = document.querySelector('#output svg');\n  var svgwidth = svg.getAttribute('width');\n  var svgheight = svg.getAttribute('height');\n  svgwidth = parseInt(svgwidth);\n  svgheight = parseInt(svgheight);\n  var aspect = svgheight / svgwidth;\n\n  var format = format ? format : 'letter';\n\n  var pagewidth = 2159;\n  var pageheight = 2794;\n  if (format === 'A4') {\n    pagewidth = 2100;\n    pageheight = 2970;\n  } else if (format === 'B3') {\n    pagewidth = 2500;\n    pageheight = 3530;\n  }\n\n  if (!orientation) {\n    if (svgwidth > svgheight) {\n      orientation = 'landscape';\n    }\n  }\n  var orientation = orientation ? orientation : 'portrait';\n  if (orientation === 'landscape') {\n    pagewidth = [pageheight, (pageheight = pagewidth)][0];\n  }\n\n  var pageaspect = pageheight / pagewidth;\n  var scaling = 0.99;\n  var mmwidth;\n  var mmheight;\n\n  if (aspect < pageaspect) {\n    mmwidth = (pagewidth / 10) * scaling;\n    mmheight = (pagewidth / 10) * aspect * scaling;\n  } else {\n    mmheight = (pageheight / 10) * scaling;\n    mmwidth = (pageheight / 10 / aspect) * scaling;\n  }\n\n  var pagewidthmm = pagewidth / 10.0;\n  var pageheightmm = pageheight / 10.0;\n\n  // pdf page offset (units are in mm?)\n  var x = 0;\n  var y = 0;\n\n  if (mmwidth < pagewidthmm) {\n    x = pagewidthmm - mmwidth;\n  }\n  x += 1;\n\n  var newspan = document.createElement('span');\n  newspan.innerHTML = svg.outerHTML;\n  var newsvg = newspan.querySelector('svg');\n\n  newsvg.setAttribute('width', mmwidth + 'mm');\n  newsvg.setAttribute('height', mmheight + 'mm');\n\n  var pdfOptions = {};\n  pdfOptions.fontCallback = svgFontCallback;\n  var pdf = new PDFDocument({\n    useCSS: true,\n    compress: true,\n    autoFirstPage: false,\n    layout: orientation,\n  });\n\n  var stream = pdf.pipe(blobStream());\n  stream.on('finish', function () {\n    var blob = stream.toBlob('application/pdf');\n    var pdfFilebase = getFilenameBase();\n    var pdfFilename = pdfFilebase;\n    //if (SAVEFILENAME) {\n    //\tpdfFilename = SAVEFILENAME.replace(/\\.[^.]*$/, \"\") + \"-snapshot.pdf\";\n    //} else {\n    //\tpdfFilename = \"snapshot.pdf\";\n    //}\n    if (pdfFilename) {\n      pdfFilename += '-snapshot.pdf';\n    } else {\n      pdfFilename = 'snapshot.pdf';\n    }\n    saveAs(blob, pdfFilename);\n    $('html').css('cursor', 'auto');\n  });\n\n  loadPdfFonts(pdf).then(function () {\n    pdf.addPage({ size: format, layout: orientation });\n    SVGtoPDF(pdf, newsvg, x, y, pdfOptions);\n    pdf.end();\n  });\n}\n\n//////////////////////////////\n//\n// generatePdfFull -- Write a multi-page PDF of the full score in the text editor.\n//\n\nexport function generatePdfFull(format, orientation) {\n  var oldOptions = vrvWorker.options;\n  // need to explicitly disable mmOutput = 1 set by the printing process.\n  oldOptions.mmOutput = 0;\n\n  $('html').css('cursor', 'wait');\n  var format = format ? format : 'letter';\n  var orientation = orientation ? orientation : 'portrait';\n\n  var width = 2159;\n  // var height = 2794;\n  var height = 2920;\n\n  if (format === 'A4') {\n    width = 2100;\n    height = 2970;\n  } else if (format === 'B3') {\n    width = 2500;\n    height = 3530;\n  }\n  if (orientation === 'landscape') {\n    width = [height, (height = width)][0];\n  }\n\n  var pdfOptions = {};\n  pdfOptions.fontCallback = svgFontCallback;\n\n  var pdf = new PDFDocument({\n    useCSS: true,\n    compress: true,\n    autoFirstPage: false,\n    layout: orientation,\n  });\n  var stream = pdf.pipe(blobStream());\n  stream.on('finish', function () {\n    var blob = stream.toBlob('application/pdf');\n    var pdfFilebase = getFilenameBase();\n    var pdfFilename = pdfFilebase;\n    if (pdfFilename) {\n      pdfFilename += '.pdf';\n    } else {\n      pdfFilename = 'data.pdf';\n    }\n    saveAs(blob, pdfFilename);\n\n    $('html').css('cursor', 'auto');\n  });\n\n  var scale = 95;\n  height /= scale / 100;\n  width /= scale / 100;\n\n  // var spacingBraceGroup   = 12;\n  // var spacingBracketGroup = 12;\n  var spacingStaff = 10;\n  var spacingSystem = 14;\n  var pageMarginTop = 100;\n  var pageMarginBottom = 100;\n  var pageMarginLeft = 50;\n  var pageMarginRight = 50;\n\n  var vrvOptions = {\n    pageHeight: height - pageMarginTop,\n    pageWidth: width,\n    pageMarginLeft: pageMarginLeft,\n    pageMarginRight: pageMarginRight,\n    pageMarginTop: pageMarginTop,\n    pageMarginBottom: pageMarginBottom,\n    spacingSystem: spacingSystem,\n    spacingStaff: spacingStaff,\n    scale: scale,\n    adjustPageHeight: 0,\n    justifyVertically: 1,\n    breaks: global_verovioOptions.BREAKS ? 'encoded' : 'auto',\n    mmOutput: 1,\n    // justifyIncludeLastPage : 1, // no longer a verovio option?\n    // justifySystemOnly   : 1, // no longer a verovio option?\n    // justifySystemsOnly  : 1, // no longer a verovio option?\n    header: 'auto',\n    footer: 'encoded',\n    usePgFooterForAll: 1,\n    barLineWidth: 0.12,\n    staffLineWidth: 0.12,\n    font: global_verovioOptions.FONT,\n  };\n\n  var scoredata = getAceEditor().getValue().replace(/^\\s+/, '');\n\n  var staffcount = getStaffCount(scoredata);\n  if (staffcount == 2) {\n    //vrvOptions.justifySystemsOnly = 1;\n    //vrvOptions.justifyIncludeLastPage = 1;\n  }\n\n  vrvOptions = cleanOptions2(scoredata, vrvOptions);\n  console.log('PRINTING OPTIONS', vrvOptions);\n\n  RSVP.hash({\n    fonts: loadPdfFonts(pdf),\n    svglist: vrvWorker.renderAllPages(scoredata, vrvOptions),\n  })\n    .then(function (data) {\n      for (var i = 0; i < data.svglist.length; i++) {\n        pdf.addPage({ size: format, layout: orientation });\n        var x = 0;\n        var y = 0;\n        SVGtoPDF(pdf, data.svglist[i], x, y, pdfOptions);\n      }\n      pdf.end();\n      return true;\n    })\n    .finally(function () {\n      // restore the old layout for the VHV  webpage:\n      var force = false;\n      var page = vrvWorker.page;\n      var cleanoldoptions = cleanOptions2(scoredata, oldOptions);\n      vrvWorker.redoLayout(oldOptions, true);\n      vrvWorker.options = oldOptions;\n    });\n}\n\n//////////////////////////////\n//\n// cleanOptions2 -- Remove options that will be processed interally from the data.\n//\n\nfunction cleanOptions2(content, options) {\n  var lines = content.match(/[^\\r\\n]+/g);\n  var output = options;\n  var setlist = [''];\n  var optionsets = {};\n  optionsets[''] = {};\n  var i;\n\n  for (i = 0; i < lines.length; i++) {\n    var matches = lines[i].match(/^!!!verovio([^\\s]*):\\s*(.*)\\s*$/);\n    if (!matches) {\n      continue;\n    }\n    if (matches[1] == '-parameter-group') {\n      setlist.push(matches[2]);\n      continue;\n    }\n    var mm = matches[2].match(/^\\s*([^\\s]+)\\s+(.*)\\s*$/);\n    if (!mm) {\n      continue;\n    }\n    var m = matches[1].match(/^-([^\\s]+)\\s*$/);\n    var set = '';\n    if (m) {\n      set = m[1];\n    }\n    if (typeof optionsets[set] === 'undefined') {\n      optionsets[set] = {};\n    }\n    optionsets[set][mm[1]] = mm[2];\n  }\n\n  for (i = 0; i < setlist.length; i++) {\n    if (!optionsets[setlist[i]]) {\n      continue;\n    }\n    var keys = Object.keys(optionsets[setlist[i]]);\n    var j;\n    var key;\n    for (j = 0; j < keys.length; j++) {\n      if (typeof output[keys[j]] !== 'undefined') {\n        delete output[keys[j]];\n      }\n    }\n  }\n\n  return output;\n}\n","/* global $ */\n// let VEROVIOOPTIONS = {% include verovio-options.json %};\n// import * as VEROVIOOPTIONS from './verovio-options.json';\n\nimport {\n  global_editorOptions,\n  global_verovioOptions,\n} from './global-variables';\n\nlet VEROVIOOPTIONS = {\n  OPTION: [\n    {\n      NAME: 'help',\n      ABBR: '?',\n      INFO: 'Display help message.',\n      ARG: 'boolean',\n      CLI_ONLY: 'true',\n    },\n    {\n      NAME: 'allPages',\n      ABBR: 'a',\n      INFO: 'Output all pages.',\n      ARG: 'boolean',\n      CLI_ONLY: 'true?',\n    },\n    {\n      NAME: 'inputFrom',\n      ABBR: 'f',\n      INFO: 'Select input data type.',\n      ARG: 'string',\n      DEF: 'mei',\n      ALT: ['auto', 'darms', 'pae', 'xml', 'humdrum', 'humdrum-xml'],\n      CLI_ONLY: 'true?',\n    },\n    {\n      NAME: 'outfile',\n      ABBR: 'o',\n      INFO: 'Output file name (use \"-\" for standard output).',\n      ARG: 'string',\n      CLI_ONLY: 'true',\n    },\n    {\n      NAME: 'page',\n      ABBR: 'p',\n      INFO: 'Select the page to engrave.',\n      ARG: 'integer',\n      DEF: '1',\n      MIN: '1',\n      CLI_ONLY: 'true',\n    },\n    {\n      NAME: 'resources',\n      ABBR: 'r',\n      INFO: 'Path to SVG resources.',\n      ARG: 'string',\n      DEF: '/usr/local/share/verovio',\n      CLI_ONLY: 'true',\n    },\n    {\n      NAME: 'scale',\n      ABBR: 's',\n      INFO: 'Scale percentage',\n      ARG: 'integer',\n      DEF: '100',\n      MIN: '1',\n    },\n    {\n      NAME: 'minLastJustification',\n      INFO: 'Minimum length of last system which can be stretched to 100% width of page.',\n      ARG: 'float',\n      DEF: '0.8',\n      MIN: '0.0',\n      MAX: '1.0',\n    },\n    {\n      NAME: 'outputTo',\n      ABBR: 't',\n      INFO: 'Select output data format',\n      ARG: 'string',\n      DEF: 'svg',\n      ALT: ['mei', 'midi'],\n    },\n    {\n      NAME: 'version',\n      ABBR: 'v',\n      INFO: 'Display verovio version number.',\n      ARG: 'boolean',\n      CLI_ONLY: 'true',\n    },\n    {\n      NAME: 'xmlIdSeed',\n      ABBR: 'x',\n      INFO: 'Seed the random number generator for XML IDs.',\n      ARG: 'integer',\n    },\n    {\n      NAME: 'adjustPageHeight',\n      CAT: 'Input and page layout options',\n      INFO: 'Crop the page height to the actual height of the content.',\n      ARG: 'boolean',\n    },\n    {\n      NAME: 'adjustPageWidth',\n      CAT: 'Input and page layout options.',\n      INFO: 'Crop the page width to the actual width of the content.',\n      ARG: 'boolean',\n    },\n    {\n      NAME: 'breaks',\n      CAT: 'Input and page layout options',\n      INFO: 'Define page and system breaks layout.',\n      ARG: 'string',\n      DEF: 'auto',\n      ALT: ['none', 'line', 'smart', 'encoded'],\n    },\n    {\n      NAME: 'breaksSmartSb',\n      CAT: 'Input and page layout options',\n      INFO: 'In smart breaks mode, the portion of the system width usage\\n\\tat which an encoded system break will be used.',\n      ARG: 'float',\n      DEF: '0.66',\n      MIN: '0.00',\n      MAX: '1.00',\n    },\n    {\n      NAME: 'condense',\n      CAT: 'Input and page layout options',\n      INFO: 'Control condensed score layout.',\n      ARG: 'string',\n      DEF: 'auto',\n      ALT: ['none', 'encoded'],\n    },\n    {\n      NAME: 'condenseFirstPage',\n      CAT: 'Input and page layout options',\n      INFO: 'When condensing a score, also condense the first page.',\n      ARG: 'boolean',\n    },\n    {\n      NAME: 'condenseTempoPages',\n      CAT: 'Input and page layout options',\n      INFO: 'When condensing a score, also condense pages with a tempo.',\n      ARG: 'boolean',\n    },\n    {\n      NAME: 'evenNoteSpacing',\n      CAT: 'Input and page layout options',\n      INFO: 'Specify the linear spacing factor.  This is useful for mensural notation display.',\n      ARG: 'boolean',\n    },\n    {\n      NAME: 'expand',\n      CAT: 'Input and page layout options',\n      INFO: 'Expand all referenced elements in the expanion.  Input is an xml:id of the expansion list.',\n      ARG: 'string',\n    },\n    {\n      NAME: 'humType',\n      CAT: 'Input and page layout options',\n      INFO: 'Include type attributes when importing rom Humdrum',\n      ARG: 'boolean',\n    },\n    {\n      NAME: 'justifyVertically',\n      CAT: 'Input and page layout options',\n      INFO: 'Justify spacing veritcally to fill a page.',\n      ARG: 'boolean',\n    },\n    {\n      NAME: 'landscape',\n      CAT: 'Input and page layout options',\n      INFO: 'The landscape paper orientation flag.',\n      ARG: 'boolean',\n    },\n    {\n      NAME: 'mensuralToMeasure',\n      CAT: 'Input and page layout options',\n      INFO: 'Convert mensural sections to measure-based MEI.',\n      ARG: 'boolean',\n    },\n    {\n      NAME: 'mmOutput',\n      CAT: 'Input and page layout options',\n      INFO: 'Specify that the output in the SVG is given in mm (default is px).',\n      ARG: 'boolean',\n    },\n    {\n      NAME: 'footer',\n      CAT: 'Input and page layout options',\n      INFO: 'Do not add any footer, add a footer, use automatic footer.',\n      ARG: 'string',\n      DEF: 'auto',\n      ALT: ['none', 'encoded', 'always'],\n    },\n    {\n      NAME: 'header',\n      CAT: 'Input and page layout options',\n      INFO: 'Do not add any header, add a header, use automatic header.',\n      ARG: 'string',\n      DEF: 'auto',\n      ALT: ['none', 'encoded'],\n    },\n    {\n      NAME: 'noJustification',\n      CAT: 'Input and page layout options',\n      INFO: 'Do not justify the system.',\n      ARG: 'boolean',\n    },\n    {\n      NAME: 'openControlEvents',\n      CAT: 'Input and page layout options',\n      INFO: 'Render open control events.',\n      ARG: 'boolean',\n    },\n    {\n      NAME: 'outputIndent',\n      CAT: 'Input and page layout options',\n      INFO: 'Output indent value for MEI and SVG.',\n      ARG: 'integer',\n      DEF: '3',\n      MIN: '1',\n      MAX: '10',\n    },\n    {\n      NAME: 'outputFormatRaw',\n      CAT: 'Input and page layout options',\n      INFO: 'Output MEI with no line indents or non-content newlines. See svgFormatRaw.',\n      ARG: 'boolean',\n    },\n    {\n      NAME: 'outputIndentTab',\n      CAT: 'Input and page layout options',\n      INFO: 'Use tabs rather than spaces for indenting XML output.',\n      ARG: 'boolean',\n    },\n    {\n      NAME: 'outputSmuflXmlEntities',\n      CAT: 'Input and page layout options',\n      INFO: 'Output SMuFL characters as XML entities instead of hex byte codes.',\n      ARG: 'boolean',\n    },\n    {\n      NAME: 'pageHeight',\n      CAT: 'Input and page layout options',\n      INFO: 'The page height.',\n      ARG: 'integer',\n      DEF: '2970',\n      MIN: '100',\n      MAX: '60000',\n    },\n    {\n      NAME: 'pageMarginBottom',\n      CAT: 'Input and page layout options',\n      INFO: 'Bottom margin of pages.',\n      ARG: 'integer',\n      DEF: '50',\n      MIN: '0',\n      MAX: '500',\n    },\n    {\n      NAME: 'pageMarginLeft',\n      CAT: 'Input and page layout options',\n      INFO: 'Left margin of pages.',\n      ARG: 'integer',\n      DEF: '50',\n      MIN: '0',\n      MAX: '500',\n    },\n    {\n      NAME: 'pageMarginRight',\n      CAT: 'Input and page layout options',\n      INFO: 'Right margin of pages.',\n      ARG: 'integer',\n      DEF: '50',\n      MIN: '0',\n      MAX: '500',\n    },\n    {\n      NAME: 'pageMarginTop',\n      CAT: 'Input and page layout options',\n      INFO: 'Top margin of pages.',\n      ARG: 'integer',\n      DEF: '50',\n      MIN: '0',\n      MAX: '500',\n    },\n    {\n      NAME: 'pageWidth',\n      CAT: 'Input and page layout options',\n      INFO: 'Page width.',\n      ARG: 'integer',\n      DEF: '2100',\n      MIN: '100',\n      MAX: '60000',\n    },\n    {\n      NAME: 'preserveAnalyticalMarkup',\n      CAT: 'Input and page layout options',\n      INFO: 'Preserves the analytical markup in MEI.',\n      ARG: 'boolean',\n    },\n    {\n      NAME: 'removeIDs',\n      CAT: 'Input and page layout options',\n      INFO: 'Remove XML IDs in the MEI output when not referenced.',\n      ARG: 'boolean',\n    },\n    {\n      NAME: 'shrinkToFit',\n      CAT: 'Input and page layout options',\n      INFO: 'Scale down page content to fit the page height if needed.',\n      ARG: 'boolean',\n    },\n    {\n      NAME: 'svgBoundingBoxes',\n      CAT: 'Input and page layout options',\n      INFO: 'Include bounding boxes in SVG output.',\n      ARG: 'boolean',\n    },\n    {\n      NAME: 'svgViewBox',\n      CAT: 'Input and page layout options',\n      INFO: 'Use viewbox on SVG root element for easy scaling of document.',\n      ARG: 'boolean',\n    },\n    {\n      NAME: 'svgHtml5',\n      CAT: 'Input and page layout options',\n      INFO: 'Write data-id and data-class attributes for JS usage and ID clash avoidance.',\n      ARG: 'boolean',\n    },\n    {\n      NAME: 'svgFormatRaw',\n      CAT: 'Input and page layout options',\n      INFO: 'Writes SVG with no line indenting or non-content newlines. See outputFormatRaw.',\n      ARG: 'boolean',\n    },\n    {\n      NAME: 'svgRemoveXlink',\n      CAT: 'Input and page layout options',\n      INFO: 'Removes the \"xlink:\" prefix from href attributes for compatibility with some newer browsers.',\n      ARG: 'boolean',\n    },\n    {\n      NAME: 'unit',\n      CAT: 'Input and page layout options',\n      INFO: 'The MEI unit (1/2 of the distance between the staff lines).',\n      ARG: 'integer',\n      DEF: '9',\n      MIN: '6',\n      MAX: '20',\n    },\n    {\n      NAME: 'useBraceGlyph',\n      CAT: 'Input and page layout options',\n      INFO: 'Use brace glyph from current font.',\n      ARG: 'boolean',\n    },\n    {\n      NAME: 'useFacsimile',\n      CAT: 'Input and page layout options',\n      INFO: 'Use information in the facsimile element to control the layout.',\n      ARG: 'boolean',\n    },\n    {\n      NAME: 'usePgFooterForAll',\n      CAT: 'Input and page layout options',\n      INFO: 'Use the pgFooter element for all pages.',\n      ARG: 'boolean',\n    },\n    {\n      NAME: 'usePgHeaderForAll',\n      CAT: 'Input and page layout options',\n      INFO: 'Use the pgHeader element for all pages.',\n      ARG: 'boolean',\n    },\n    {\n      NAME: 'clefChangeFactor',\n      CAT: 'Input and page layout options',\n      INFO: 'Set the size ratio of normal clefs to changing clefs.',\n      ARG: 'float',\n      DEF: '0.66',\n      MIN: '0.25;',\n      MAX: '1.00;',\n    },\n    {\n      NAME: 'midiTempoAdjustment',\n      CAT: 'General layout',\n      INFO: 'MIDI tempo adjustment factor.',\n      ARG: 'float',\n      DEF: '1.00',\n      MIN: '0.20',\n      MAX: '4.00',\n    },\n    {\n      NAME: 'barLineSeparation',\n      CAT: 'General layout',\n      INFO: 'Default distance between multiple barlines when locked together.',\n      ARG: 'float',\n      DEF: '0.80',\n      MIN: '0.50',\n      MAX: '2.00',\n    },\n    {\n      NAME: 'barLineWidth',\n      CAT: 'General layout',\n      ARG: 'float',\n      INFO: 'The width of a barline.',\n      DEF: '0.30',\n      MIN: '0.10',\n      MAX: '0.80',\n    },\n    {\n      NAME: 'beamMaxSlope',\n      INFO: 'The maximum beam slope.',\n      CAT: 'General layout',\n      ARG: 'integer',\n      DEF: '10',\n      MIN: '1',\n      MAX: '20',\n    },\n    {\n      NAME: 'beamMinSlope',\n      INFO: 'The minimum beam slope.',\n      CAT: 'General layout',\n      ARG: 'integer',\n      DEF: '0',\n      MIN: '0',\n      MAX: '0',\n    },\n    {\n      NAME: 'bracketThickness',\n      INFO: 'Thickness of the system bracket.',\n      CAT: 'General layout',\n      ARG: 'float',\n      DEF: '1.0',\n      MIN: '0.5',\n      MAX: '2.0',\n    },\n    {\n      NAME: 'dynamDist',\n      INFO: 'Default distance from staff to dynamic marks.',\n      CAT: 'General layout',\n      ARG: 'float',\n      DEF: '1.00',\n      MIN: '0.50',\n      MAX: '16.00',\n    },\n    {\n      NAME: 'engravingDefaults',\n      INFO: 'JSON describing defaults for engraving SMuFL elements.',\n      CAT: 'General layout',\n      ARG: 'string',\n    },\n    {\n      NAME: 'engravingDefaultsFile',\n      INFO: 'Path to JSON file describing defaults for engraving SMuFL elements.',\n      CAT: 'General layout',\n      ARG: 'string',\n    },\n    {\n      NAME: 'font',\n      INFO: 'Set the music font.',\n      CAT: 'General layout',\n      ARG: 'string',\n      DEF: 'Leipzig',\n      ALT: ['Bravura', 'Gootville', 'Leland'],\n    },\n    {\n      NAME: 'graceFactor',\n      INFO: 'The grace size ratio numerator.',\n      CAT: 'General layout',\n      ARG: 'float',\n      DEF: '0.75',\n      MIN: '0.50',\n      MAX: '1.00',\n    },\n    {\n      NAME: 'graceRhythmAlign',\n      INFO: 'Align grace notes rhythmically with all staves.',\n      CAT: 'General layout',\n      ARG: 'boolean',\n    },\n    {\n      NAME: 'graceRightAlign',\n      INFO: 'Align the right position of a grace group with all staves.',\n      CAT: 'General layout',\n      ARG: 'boolean',\n    },\n    {\n      NAME: 'hairpinSize',\n      CAT: 'General layout',\n      ARG: 'float',\n      INFO: 'Size of hairpins (crescendo lines).',\n      DEF: '3.00',\n      MIN: '1.00',\n      MAX: '8.00',\n    },\n    {\n      NAME: 'hairpinThickness',\n      CAT: 'General layout',\n      INFO: 'Hairpin thickness (crescendo lines).',\n      ARG: 'float',\n      DEF: '0.20',\n      MIN: '0.10',\n      MAX: '0.80',\n    },\n    {\n      NAME: 'harmDist',\n      CAT: 'General layout',\n      INFO: 'Default distance from haromonic labels to the staff.',\n      ARG: 'float',\n      DEF: '1.00',\n      MIN: '0.50',\n      MAX: '16.00',\n    },\n    {\n      NAME: 'justificationStaff',\n      CAT: 'General layout',\n      INFO: 'Staff justification.',\n      ARG: 'float',\n      DEF: '1.00',\n      MIN: '0.00',\n      MAX: '10.00',\n    },\n    {\n      NAME: 'justificationSystem',\n      CAT: 'General layout',\n      INFO: 'Vertical system spacing justification.',\n      ARG: 'float',\n      DEF: '1.00',\n      MIN: '0.00',\n      MAX: '10.00',\n    },\n    {\n      NAME: 'justificationBracketGroup',\n      CAT: 'General layout',\n      INFO: 'Space between staves inside a bracket group justification.',\n      ARG: 'float',\n      DEF: '1.00',\n      MIN: '0.00',\n      MAX: '10.00',\n    },\n    {\n      NAME: 'justificationBraceGroup',\n      CAT: 'General layout',\n      INFO: 'Space between staves inside a brace group justification.',\n      ARG: 'float',\n      DEF: '1.00',\n      MIN: '0.00',\n      MAX: '10.00',\n    },\n    {\n      NAME: 'ledgerLineThickness',\n      CAT: 'General layout',\n      INFO: 'Thickness of ledger lines.',\n      ARG: 'float',\n      DEF: '0.25',\n      MIN: '0.10',\n      MAX: '0.50',\n    },\n    {\n      NAME: 'ledgerLineExtension',\n      CAT: 'General layout',\n      INFO: 'Amount by which ledger lines should extend on either side of a notehead.',\n      ARG: 'float',\n      DEF: '0.54',\n      MIN: '0.20',\n      MAX: '1.00',\n    },\n    {\n      NAME: 'lyricSize',\n      CAT: 'General layout',\n      ARG: 'float',\n      INFO: 'Size of lyric text.',\n      DEF: '4.50',\n      MIN: '2.00',\n      MAX: '8.00',\n    },\n    {\n      NAME: 'lyricHyphenLength',\n      CAT: 'General layout',\n      ARG: 'float',\n      INFO: 'Lyric hyphen and dash lengths.',\n      DEF: '1.20',\n      MIN: '0.50',\n      MAX: '3.00',\n    },\n    {\n      NAME: 'lyricLineThickness',\n      CAT: 'General layout',\n      INFO: 'Lyric extender line thicknesses.',\n      ARG: 'float',\n      DEF: '0.25',\n      MIN: '0.10',\n      MAX: '0.50',\n    },\n    {\n      NAME: 'lyricNoStartHyphen',\n      CAT: 'General layout',\n      INFO: 'Do not show hyphens at system beginnings.',\n      ARG: 'boolean',\n    },\n    {\n      NAME: 'lyricTopMinMargin',\n      CAT: 'General layout',\n      INFO: 'The minmal margin above the lyrics',\n      ARG: 'float',\n      DEF: '3.00',\n      MIN: '3.00',\n      MAX: '8.00',\n    },\n    {\n      NAME: 'lyricWordSpace',\n      CAT: 'General layout',\n      INFO: 'Minimum width of spaces separating lyric text.',\n      ARG: 'float',\n      DEF: '1.20',\n      MIN: '0.50',\n      MAX: '3.00',\n    },\n    {\n      NAME: 'minMeasureWidth',\n      INFO: 'The minimal measure width.',\n      CAT: 'General layout',\n      ARG: 'integer',\n      DEF: '15',\n      MIN: '1',\n      MAX: '30',\n    },\n    {\n      NAME: 'mnumInterval',\n      INFO: 'Repeat measure numbers at the given cycle size.',\n      CAT: 'General layout',\n      ARG: 'integer',\n    },\n    {\n      NAME: 'multiRestStyle',\n      INFO: 'Rendering style of multiple measure rests.',\n      CAT: 'General layout',\n      ARG: 'string',\n      DEF: 'auto',\n      ALT: ['default', 'block', 'symbols'],\n    },\n    {\n      NAME: 'repeatBarLineDotSeparation',\n      INFO: 'Default horizontal distance between dots and inner repeat barline.',\n      CAT: 'General layout',\n      ARG: 'float',\n      DEF: '0.30',\n      MIN: '0.10',\n      MAX: '1.00',\n    },\n    {\n      NAME: 'repeatEndingLineThickness',\n      INFO: 'Repeat and endling line thickness.',\n      CAT: 'General layout',\n      ARG: 'float',\n      DEF: '0.15',\n      MIN: '0.10',\n      MAX: '2.00',\n    },\n    {\n      NAME: 'slurControlPoints',\n      INFO: 'Slur control points.  Higher values mean more curvature at endpoints.',\n      CAT: 'General layout',\n      ARG: 'integer',\n      DEF: '5',\n      MIN: '1',\n      MAX: '10',\n    },\n    {\n      NAME: 'slurHeightFactor',\n      INFO: 'Slur height factor.  Higher values mean flatter slurs.',\n      CAT: 'General layout',\n      ARG: 'integer',\n      DEF: '5',\n      MIN: '1',\n      MAX: '100',\n    },\n    {\n      NAME: 'slurMinHeight',\n      INFO: 'Minimum slur height.',\n      CAT: 'General layout',\n      ARG: 'float',\n      DEF: '1.20',\n      MIN: '0.30',\n      MAX: '2.00',\n    },\n    {\n      NAME: 'slurMaxHeight',\n      INFO: 'Maximum slur height.',\n      CAT: 'General layout',\n      ARG: 'float',\n      DEF: '3.00',\n      MIN: '2.00',\n      MAX: '6.00',\n    },\n    {\n      NAME: 'slurMaxSlope',\n      INFO: 'Maximum slur slope in degrees.',\n      CAT: 'General layout',\n      ARG: 'float',\n      DEF: '20',\n      MIN: '0',\n      MAX: '60',\n    },\n    {\n      NAME: 'slurEndpointThickness',\n      INFO: 'Slur endpoint thickness.',\n      CAT: 'General layout',\n      ARG: 'float',\n      DEF: '0.10',\n      MIN: '0.05',\n      MAX: '0.25',\n    },\n    {\n      NAME: 'slurMidpointThickness',\n      INFO: 'Slur midpoint thickness.',\n      CAT: 'General layout',\n      ARG: 'float',\n      DEF: '0.60',\n      MIN: '0.20',\n      MAX: '1.20',\n    },\n    {\n      NAME: 'spacingBraceGroup',\n      INFO: 'Minimum space between staves inside of a braced group.',\n      CAT: 'General layout',\n      ARG: 'float',\n      DEF: '12',\n      MIN: '0',\n      MAX: '48',\n    },\n    {\n      NAME: 'spacingBracketGroup',\n      INFO: 'Minimum space between staves inside a bracketed group.',\n      CAT: 'General layout',\n      ARG: 'float',\n      DEF: '12',\n      MIN: '0',\n      MAX: '48',\n    },\n    {\n      NAME: 'spacingDurDetection',\n      INFO: 'Detect long duration for adjusting spacing.',\n      CAT: 'General layout',\n      ARG: 'boolean',\n    },\n    {\n      NAME: 'slurCurveFactor',\n      INFO: 'Slur curve factor.  Higher values mean rounder slurs.',\n      CAT: 'General layout',\n      ARG: 'integer',\n      DEF: '10',\n      MIN: '1',\n      MAX: '100',\n    },\n    {\n      NAME: 'octaveAlternativeSymbols',\n      INFO: 'Use alternative symbols for displaying octaves.',\n      CAT: 'General layout',\n      ARG: 'boolean',\n    },\n    {\n      NAME: 'octaveLineThickness',\n      INFO: 'Octave line thickness.',\n      CAT: 'General layout',\n      ARG: 'float',\n      DEF: '0.20',\n      MIN: '0.10',\n      MAX: '1.00',\n    },\n    {\n      NAME: 'spacingLinear',\n      CAT: 'General layout',\n      ARG: 'float',\n      INFO: 'Specify the linear spacing factor',\n      DEF: '0.25',\n      MIN: '0.00',\n      MAX: '1.00',\n    },\n    {\n      NAME: 'spacingNonLinear',\n      CAT: 'General layout',\n      ARG: 'float',\n      INFO: 'Specify the non-linear spacing factor.',\n      DEF: '0.60',\n      MIN: '0.00',\n      MAX: '1.00',\n    },\n    {\n      NAME: 'spacingStaff',\n      ARG: 'integer',\n      INFO: 'The staff minimal spacing',\n      CAT: 'General layout',\n      DEF: '12',\n      MIN: '0',\n      MAX: '48',\n    },\n    {\n      NAME: 'spacingSystem',\n      ARG: 'integer',\n      INFO: 'The system minimal spacing',\n      CAT: 'General layout',\n      DEF: '12',\n      MIN: '0',\n      MAX: '48',\n    },\n    {\n      NAME: 'staffLineWidth',\n      CAT: 'General layout',\n      ARG: 'float',\n      INFO: 'The staff line width in unit',\n      DEF: '0.15',\n      MIN: '0.10',\n      MAX: '0.30',\n    },\n    {\n      NAME: 'stemWidth',\n      CAT: 'General layout',\n      ARG: 'float',\n      INFO: 'The stem width',\n      DEF: '0.20',\n      MIN: '0.10',\n      MAX: '0.50',\n    },\n    {\n      NAME: 'subBracketThickness',\n      CAT: 'General layout',\n      ARG: 'float',\n      INFO: 'Thickness of system sub-brackets.',\n      DEF: '0.20',\n      MIN: '0.10',\n      MAX: '2.00',\n    },\n    {\n      NAME: 'systemDivider',\n      CAT: 'General layout',\n      INFO: 'Display style of system dividers',\n      ARG: 'string',\n      DEF: 'auto',\n      ALT: ['none', 'left', 'left-right'],\n    },\n    {\n      NAME: 'systemMaxPerPage',\n      CAT: 'General layout',\n      INFO: 'Maximum number of systems per page',\n      ARG: 'integer',\n    },\n    {\n      NAME: 'textEnclosureThickness',\n      CAT: 'General layout',\n      INFO: 'Thickness of text-enclosing boxes.',\n      ARG: 'float',\n      DEF: '0.20',\n      MIN: '0.10',\n      MAX: '0.80',\n    },\n    {\n      NAME: 'thickBarlineThickness',\n      CAT: 'General layout',\n      INFO: 'Thickness of thick barlines.',\n      ARG: 'float',\n      DEF: '1.00',\n      MIN: '0.50',\n      MAX: '2.00',\n    },\n    {\n      NAME: 'tieEndpointThickness',\n      CAT: 'General layout',\n      INFO: 'Endpoint tie thickenesses',\n      ARG: 'float',\n      DEF: '0.10',\n      MIN: '0.05',\n      MAX: '0.25',\n    },\n    {\n      NAME: 'tieMidpointThickness',\n      CAT: 'General layout',\n      INFO: 'Tie midpoint thickenesses',\n      ARG: 'float',\n      DEF: '0.50',\n      MIN: '0.20',\n      MAX: '1.00',\n    },\n    {\n      NAME: 'tupletBracketThickness',\n      CAT: 'General layout',\n      INFO: 'Tuplet bracket thicknesses.',\n      ARG: 'float',\n      DEF: '0.20',\n      MIN: '0.10',\n      MAX: '0.80',\n    },\n    {\n      NAME: 'tupletNumHead',\n      CAT: 'General layout',\n      INFO: 'Placement of tuplet number on the notehead-side.',\n      ARG: 'boolean',\n    },\n    {\n      NAME: 'defaultBottomMargin',\n      CAT: 'element margins',\n      INFO: 'Default bottom margin',\n      ARG: 'float',\n      DEF: '0.50',\n      MIN: '0.00',\n      MAX: '5.00',\n    },\n    {\n      NAME: 'defaultLeftMargin',\n      CAT: 'element margins',\n      INFO: 'Default left margin.',\n      ARG: 'float',\n      DEF: '0.00',\n      MIN: '0.00',\n      MAX: '2.00',\n    },\n    {\n      NAME: 'defaultRightMargin',\n      CAT: 'element margins',\n      INFO: 'The default right margin',\n      ARG: 'float',\n      DEF: '0.00',\n      MIN: '0.00',\n      MAX: '2.00',\n    },\n    {\n      NAME: 'defaultTopMargin',\n      CAT: 'element margins',\n      INFO: 'The default top margin',\n      ARG: 'float',\n      DEF: '0.50',\n      MIN: '0.00',\n      MAX: '6.00',\n    },\n    {\n      NAME: 'leftMarginAccid',\n      CAT: 'element margins',\n      INFO: 'The margin for accid',\n      ARG: 'float',\n      DEF: '1.00',\n      MIN: '0.00',\n      MAX: '2.00',\n    },\n    {\n      NAME: 'bottomMarginArtic',\n      CAT: 'element margins',\n      INFO: 'Bottom margin for articulations.',\n      ARG: 'float',\n      DEF: '0.75',\n      MIN: '0.00',\n      MAX: '10.00',\n    },\n    {\n      NAME: 'bottomMarginHarm',\n      CAT: 'element margins',\n      INFO: 'Bottom margin for harmony labels.',\n      ARG: 'float',\n      DEF: '1.00',\n      MIN: '0.00',\n      MAX: '10.00',\n    },\n    {\n      NAME: 'bottomMarginHeader',\n      CAT: 'element margins',\n      INFO: 'Bottom margin for page headers.',\n      ARG: 'float',\n      DEF: '8.00',\n      MIN: '0.00',\n      MAX: '24.00',\n    },\n    {\n      NAME: 'leftMarginBarLine',\n      CAT: 'element margins',\n      INFO: 'Left margin for barLines.',\n      ARG: 'float',\n      DEF: '0.00',\n      MIN: '0.00',\n      MAX: '2.00',\n    },\n    {\n      NAME: 'leftMarginBeatRpt',\n      CAT: 'element margins',\n      INFO: 'Left margin for beatRpt.',\n      ARG: 'float',\n      DEF: '2.00',\n      MIN: '0.00',\n      MAX: '2.00',\n    },\n    {\n      NAME: 'leftMarginChord',\n      CAT: 'element margins',\n      INFO: 'Left margin for chords.',\n      ARG: 'float',\n      DEF: '1.00',\n      MIN: '0.00',\n      MAX: '2.00',\n    },\n    {\n      NAME: 'leftMarginClef',\n      CAT: 'element margins',\n      INFO: 'Left margin for clefs.',\n      ARG: 'float',\n      DEF: '1.00',\n      MIN: '0.00',\n      MAX: '2.00',\n    },\n    {\n      NAME: 'leftMarginKeySig',\n      CAT: 'element margins',\n      INFO: 'Left margin for key signatures.',\n      ARG: 'float',\n      DEF: '1.00',\n      MIN: '0.00',\n      MAX: '2.00',\n    },\n    {\n      NAME: 'leftMarginLeftBarLine',\n      CAT: 'element margins',\n      INFO: 'Left margin for left barLines.',\n      ARG: 'float',\n      DEF: '1.00',\n      MIN: '0.00',\n      MAX: '2.00',\n    },\n    {\n      NAME: 'leftMarginMensur',\n      CAT: 'element margins',\n      INFO: 'Left margin for mensur.',\n      ARG: 'float',\n      DEF: '1.00',\n      MIN: '0.00',\n      MAX: '2.00',\n    },\n    {\n      NAME: 'leftMarginMeterSig',\n      CAT: 'element margins',\n      INFO: 'Left margin for meterSig.',\n      ARG: 'float',\n      DEF: '1.00',\n      MIN: '0.00',\n      MAX: '2.00',\n    },\n    {\n      NAME: 'leftMarginMRest',\n      CAT: 'element margins',\n      INFO: 'Left margin for mRest.',\n      ARG: 'float',\n      DEF: '0.00',\n      MIN: '0.00',\n      MAX: '2.00',\n    },\n    {\n      NAME: 'leftMarginMRpt2',\n      CAT: 'element margins',\n      INFO: 'Left margin for mRpt2.',\n      ARG: 'float',\n      DEF: '0.00',\n      MIN: '0.00',\n      MAX: '2.00',\n    },\n    {\n      NAME: 'leftMarginMultiRest',\n      CAT: 'element margins',\n      INFO: 'Left margin for multiRest.',\n      ARG: 'float',\n      DEF: '0.00',\n      MIN: '0.00',\n      MAX: '2.00',\n    },\n    {\n      NAME: 'leftMarginMultiRpt',\n      CAT: 'element margins',\n      INFO: 'Left  margin for multiRpt.',\n      ARG: 'float',\n      DEF: '0.00',\n      MIN: '0.00',\n      MAX: '2.00',\n    },\n    {\n      NAME: 'leftMarginNote',\n      CAT: 'element margins',\n      INFO: 'Right margin for note.',\n      ARG: 'float',\n      DEF: '1.00',\n      MIN: '0.00',\n      MAX: '2.00',\n    },\n    {\n      NAME: 'leftMarginRest',\n      CAT: 'element margins',\n      INFO: 'Left margin for rest.',\n      ARG: 'float',\n      DEF: '1.00',\n      MIN: '0.00',\n      MAX: '2.00',\n    },\n    {\n      NAME: 'leftMarginRightBarLine',\n      CAT: 'element margins',\n      INFO: 'Margin for right barLine.',\n      ARG: 'float',\n      DEF: '1.00',\n      MIN: '0.00',\n      MAX: '2.00',\n    },\n    {\n      NAME: 'leftMarginTabDurSym',\n      CAT: 'element margins',\n      INFO: 'Margin for tabDurSym.',\n      ARG: 'float',\n      DEF: '1.00',\n      MIN: '0.00',\n      MAX: '2.00',\n    },\n    {\n      NAME: 'rightMarginAccid',\n      CAT: 'element margins',\n      INFO: 'Right margin for accid.',\n      ARG: 'float',\n      DEF: '0.00',\n      MIN: '0.00',\n      MAX: '2.00',\n    },\n    {\n      NAME: 'rightMarginBarLine',\n      CAT: 'element margins',\n      INFO: 'Right margin for barLine.',\n      ARG: 'float',\n      DEF: '0.00',\n      MIN: '0.00',\n      MAX: '2.00',\n    },\n    {\n      NAME: 'rightMarginBeatRpt',\n      CAT: 'element margins',\n      INFO: 'Right margin for beatRpt.',\n      ARG: 'float',\n      DEF: '0.00',\n      MIN: '0.00',\n      MAX: '2.00',\n    },\n    {\n      NAME: 'rightMarginChord',\n      CAT: 'element margins',\n      INFO: 'Right margin for chord.',\n      ARG: 'float',\n      DEF: '0.00',\n      MIN: '0.00',\n      MAX: '2.00',\n    },\n    {\n      NAME: 'rightMarginClef',\n      CAT: 'element margins',\n      INFO: 'Right margin for clef.',\n      ARG: 'float',\n      DEF: '1.00',\n      MIN: '0.00',\n      MAX: '2.00',\n    },\n    {\n      NAME: 'rightMarginKeySig',\n      CAT: 'element margins',\n      INFO: 'Right margin for keySig.',\n      ARG: 'float',\n      DEF: '1.00',\n      MIN: '0.00',\n      MAX: '2.00',\n    },\n    {\n      NAME: 'rightMarginLeftBarLine',\n      CAT: 'element margins',\n      INFO: 'Right margin for left barLine.',\n      ARG: 'float',\n      DEF: '1.00',\n      MIN: '0.00',\n      MAX: '2.00',\n    },\n    {\n      NAME: 'rightMarginMensur',\n      CAT: 'element margins',\n      INFO: 'Right margin for mensur.',\n      ARG: 'float',\n      DEF: '1.00',\n      MIN: '0.00',\n      MAX: '2.00',\n    },\n    {\n      NAME: 'rightMarginMeterSig',\n      CAT: 'element margins',\n      INFO: 'Right margin for meterSig.',\n      ARG: 'float',\n      DEF: '1.00',\n      MIN: '0.00',\n      MAX: '2.00',\n    },\n    {\n      NAME: 'rightMarginMRest',\n      CAT: 'element margins',\n      INFO: 'Right margin for mRest.',\n      ARG: 'float',\n      DEF: '0.00',\n      MIN: '0.00',\n      MAX: '2.00',\n    },\n    {\n      NAME: 'rightMarginMRpt2',\n      CAT: 'element margins',\n      INFO: 'Right margin for mRpt2.',\n      ARG: 'float',\n      DEF: '0.00',\n      MIN: '0.00',\n      MAX: '2.00',\n    },\n    {\n      NAME: 'rightMarginMultiRest',\n      CAT: 'element margins',\n      INFO: 'Right margin for multiRest.',\n      ARG: 'float',\n      DEF: '0.00',\n      MIN: '0.00',\n      MAX: '2.00',\n    },\n    {\n      NAME: 'rightMarginMultiRpt',\n      CAT: 'element margins',\n      INFO: 'Right margin for multiRpt.',\n      ARG: 'float',\n      DEF: '0.00',\n      MIN: '0.00',\n      MAX: '2.00',\n    },\n    {\n      NAME: 'rightMarginNote',\n      CAT: 'element margins',\n      INFO: 'The right margin for note.',\n      ARG: 'float',\n      DEF: '0.00',\n      MIN: '0.00',\n      MAX: '2.00',\n    },\n    {\n      NAME: 'rightMarginRest',\n      CAT: 'element margins',\n      INFO: 'The right margin for rest.',\n      ARG: 'float',\n      DEF: '0.00',\n      MIN: '0.00',\n      MAX: '2.00',\n    },\n    {\n      NAME: 'rightMarginRightBarLine',\n      CAT: 'element margins',\n      ARG: 'float',\n      INFO: 'The right margin for right barLine.',\n      DEF: '0.00',\n      MIN: '0.00',\n      MAX: '2.00',\n    },\n    {\n      NAME: 'rightMarginTabDurSym',\n      CAT: 'element margins',\n      INFO: 'Right margin for tabDurSym.',\n      ARG: 'float',\n      DEF: '0.00',\n      MIN: '0.00',\n      MAX: '2.00',\n    },\n    {\n      NAME: 'topMarginArtic',\n      CAT: 'element margins',\n      INFO: 'Top margin for articulations.',\n      ARG: 'float',\n      DEF: '0.75',\n      MIN: '0.00',\n      MAX: '10.00',\n    },\n    {\n      NAME: 'topMarginHarm',\n      CAT: 'element margins',\n      INFO: 'Top margin for harmony labels.',\n      ARG: 'float',\n      DEF: '1.00',\n      MIN: '0.00',\n      MAX: '10.00',\n    },\n  ],\n};\n\n// let VEROVIOOPTIONS = null;\n// fetch('http://127.0.0.1:4000/scripts/vhv-scripts/verovio-options.json', {\tmethod: 'GET' })\n// \t.then(res => res.json())\n// \t.then(json => {\n// \t\tconsole.log('options: ', json);\n// \t\tVEROVIOOPTIONS = json;\n// \t\treturn Promise.resolve(VEROVIOOPTIONS);\n// \t})\n// \t.catch(err => console.log('Error when loading verovio-options', err));\n\n//////////////////////////////\n//\n// getVerovioDefaultOptions --\n//\n\nfunction getVerovioDefaultOptions() {\n  let output = {};\n  if (!VEROVIOOPTIONS) {\n    return output;\n  }\n  var options = VEROVIOOPTIONS.OPTION;\n  for (let i = 0; i < options.length; i++) {\n    if (typeof options[i].DEF !== 'undefined') {\n      if (typeof (options[i].NAME !== 'undefined')) {\n        if (typeof options[i].CLI_ONLY !== 'undefined') {\n          if (options[i].CLI_ONLY !== 'true') {\n            output[options[i].NAME] = options[i].DEF;\n          }\n        }\n      }\n    }\n  }\n  return output;\n}\n\n//////////////////////////////\n//\n// humdrumToSvgOptions --\n//\n// Verovio options:\n// # = number\n// B = boolean (1, or 0)\n// S = string\n//\n// border #           == border around SVG image (default 50)\n// inputFrom S        == input data from (darms, mei, pae, xml)\n// pageHeight #       == height of page (default 2970)\n// pageWidth #        == width of page (default 2100)\n// scale #            == scaling percent for image\n// adjustPageHeight B == crop the page height to content\n// adjustPageWidth  B == crop the page width to content\n// evenNoteSpacing B  == space notes evenly and close regardless of durations\n// font S             == Bravura, Gootville, Leland (default Leipzig)\n// ignoreLayout       == ignore any encoded layout and recalulate\n// noLayout B         == ignore any encoded layout and display single system\n// page #             == select page to engrave\n// appXPathQuery S    == xpath query for selecting app\n// spacingLinear #    == linear spacing factor (default 0.25)\n// spacingNonLinear # == non-linear spacing factor (default 0.6)\n// spacingStaff #     == spacing above each staff (MEI vu)\n// spacigSystem #     == spacing above each system (MEI vu)\n// humType            == embedd extra type/class attributes\n// tupletNumHead      == display tuplets on note-head side of notes by default.\n//\n\nexport function humdrumToSvgOptions() {\n  var output = getVerovioDefaultOptions();\n  // console.log('humdrumToSvgOptions default opts loaded', output);\n\n  output.adjustPageHeight = 1;\n  // output.adjustPageWidth   = 1;\n  output.barLineWidth = 0.12;\n  output.breaks = global_verovioOptions.BREAKS ? 'encoded' : 'auto';\n  output.font = global_verovioOptions.FONT;\n  output.inputFrom = 'auto';\n  output.humType = 1;\n  output.tupletNumHead = 0;\n  output.justifyVertically = 0;\n  output.leftMarginClef = 1.5;\n  output.lyricSize = global_verovioOptions.LYRIC_SIZE;\n  output.minLastJustification = 0.5;\n  output.footer = 'none';\n  output.header = 'none';\n  output.pageHeight = 60000;\n  output.pageMarginBottom = 40;\n  output.pageMarginLeft = 30;\n  output.pageMarginRight = 20;\n  output.pageMarginTop = 100;\n  output.pageWidth = 2500;\n  output.scale = global_verovioOptions.SCALE;\n  output.spacingLinear = 0.25;\n  output.spacingNonLinear = 0.6;\n  output.spacingStaff = global_verovioOptions.SPACING_STAFF;\n  output.spacingSystem = global_verovioOptions.SPACING_SYSTEM;\n  output.staffLineWidth = 0.12;\n  output.outputIndent = 1;\n\n  // output.svgViewBox = 1;\n  // output.svgRemoveXlink       = true; // enable to remove xlink: from href use element property\n\n  // if (window.PAGED) {\n  // \tvar tw = $(\"#input\").outerWidth();\n  // \tif ($(\"#input\").css(\"display\") == \"none\") {\n  // \t\ttw = 0;\n  // \t}\n  // \t// output.pageHeight = ($(window).innerHeight() - $(\"#navbar\").outerHeight()) / global_verovioOptions.ZOOM - 100;\n  // \t// output.pageWidth = ($(window).innerWidth() - tw) / global_verovioOptions.ZOOM - 100;\n  // \t// jQuery $window.innerHeight() not working properly (in Chrome).\n  // \toutput.pageHeight = (window.innerHeight - $(\"#topnav\").outerHeight()) / (global_verovioOptions.ZOOM * global_verovioOptions.SCALE / 40) - 50;\n  // \toutput.pageWidth = (window.innerWidth - tw) / (global_verovioOptions.ZOOM * global_verovioOptions.SCALE / 40 ) - 100;\n  // } else {\n  // \tvar tw = $(\"#input\").outerWidth();\n  // \tif ($(\"#input\").css(\"display\") == \"none\") {\n  // \t\ttw = 0;\n  // \t}\n  // \toutput.pageWidth = (window.innerWidth - tw) / (global_verovioOptions.ZOOM * global_verovioOptions.SCALE / 40 ) - 100;\n  // }\n  let commentsCol = document.querySelector('#comments-section');\n  let commentsWidth = 0;\n  if (commentsCol) {\n    commentsWidth = commentsCol.getBoundingClientRect().width;\n    let col = [...commentsCol.classList].find(cl => /^col/g.test(cl));\n    if (col?.includes('col-0')) {\n      commentsWidth = 0;\n    }\n  }\n\n  var tw = $('#input').outerWidth();\n  if ($('#input').css('display') == 'none') {\n    tw = 0;\n  }\n  output.pageWidth =\n    (window.innerWidth - tw - commentsWidth) /\n      ((global_verovioOptions.ZOOM * global_verovioOptions.SCALE) / 40) -\n    100;\n  // output.pageWidth =\n  //   (window.innerWidth - tw) /\n  //     ((global_verovioOptions.ZOOM * global_verovioOptions.SCALE) / 40) -\n  //   100;\n\n  var newLinearSpacing =\n    global_editorOptions.SPACINGADJUSTMENT + output.spacingLinear;\n  if (newLinearSpacing < 0.05) {\n    newLinearSpacing = 0.05;\n  }\n  output.spacingLinear = newLinearSpacing;\n  // console.log('humdrumToSvgOptions new opts values', output);\n\n  return output;\n}\n\nfunction humdrumToMeiOptions() {\n  return {\n    inputFrom: 'humdrum',\n    adjustPageHeight: 1,\n    // adjustPageWidth   : 1,\n    pageHeight: 8000,\n    pageMarginLeft: 20,\n    pageMarginRight: 20,\n    pageMarginTop: 0,\n    pageMarginBottom: 20,\n    pageWidth: 2500,\n    scale: 40,\n    footer: 'none',\n    header: 'none',\n    breaks: 'auto',\n    spacingNonLinear: 0.6,\n    spacingLinear: 0.25,\n    barLineWidth: 0.12,\n    staffLineWidth: 0.12,\n    font: global_verovioOptions.FONT,\n    outputIndent: 1,\n  };\n}\n\nfunction humdrumToHumdrumOptions() {\n  return {\n    inputFrom: 'humdrum',\n  };\n}\n\nexport function musicxmlToHumdrumOptions() {\n  return {\n    inputFrom: 'musicxml-hum',\n  };\n}\n\nexport function musedataToHumdrumOptions() {\n  return {\n    inputFrom: 'musedata-hum',\n  };\n}\n\nfunction musicxmlToMeiOptions() {\n  return {\n    inputFrom: 'musicxml',\n    breaks: 'auto',\n  };\n}\n\nfunction meiToMeiOptions() {\n  return {\n    inputFrom: 'mei',\n    breaks: 'encoded',\n  };\n}\n\nexport function meiToHumdrumOptions() {\n  return {\n    inputFrom: 'mei-hum',\n    breaks: 'auto',\n  };\n}\n\nexport function esacToHumdrumOptions() {\n  return {\n    inputFrom: 'esac',\n  };\n}\n\n//////////////////////////////\n//\n// loadEditorFontSizes -- Recover the last session's font size for the text editor.  If there is no previous\n//     session, the use a size of 1.0;  Also the music size (global_verovioOptions.SCALE = 40 default).\n//\n\nexport function loadEditorFontSizes() {\n  var value = localStorage.INPUT_FONT_SIZE;\n  if (!value) {\n    value = 1.0;\n  } else {\n    value *= 1.0;\n  }\n  if (value < 0.25) {\n    value = 0.25;\n  }\n  if (value > 3.0) {\n    value = 3.0;\n  }\n  global_editorOptions.INPUT_FONT_SIZE = value;\n\n  var value2 = localStorage.SCALE;\n  if (!value2) {\n    value2 = 40;\n  } else {\n    value2 *= 1;\n  }\n  if (value2 < 1) {\n    value2 = 40;\n  } else if (value2 > 1000) {\n    value2 = 40;\n  }\n  global_verovioOptions.SCALE = value2;\n}\n","import { assign, createMachine, interpret } from \"xstate\";\n\nconst setElemId = (parentClass) => (context, event) => {\n  let target = document.querySelector(`#${event.elemId}`);\n  target = target?.closest(`.${parentClass}`);\n  return target?.id ? target.id : '';\n}\n\nexport const selectMachine = createMachine({\n  initial: 'idle',\n  context: {\n    elemId: '',\n    // refElemId: '',\n    // clientId: '',\n  },\n  states: {\n    idle: {\n      id: 'idleState',\n      on: {\n        SELECT: {\n          target: 'noteSelected',\n          actions: assign({\n            elemId: setElemId('note')\n          }),\n        },\n      },\n    },\n    noteSelected: {\n      on: {\n        SELECT: [\n          {\n            target: 'chordSelected',\n            actions: assign({\n              elemId: setElemId('chord'),\n            }),\n            cond: (context, event) => {\n              return !!document.querySelector(`#${event.elemId}`)?.closest('.chord');\n            }\n          },\n          {\n            target: 'layerSelected',\n            actions: assign({\n              elemId: setElemId('layer'),\n            }),\n          },\n        ],\n        RESET: { \n          target: 'idle',\n          actions: assign({\n            elemId: (_, __) => ''\n          })\n        }\n      },\n    },\n    chordSelected: {\n      on: {\n        SELECT: {\n          target: 'layerSelected',\n          actions: assign({\n            elemId: setElemId('layer'),\n          }),\n        },\n        RESET: { \n          target: 'idle',\n          actions: assign({\n            elemId: (_, __) => ''\n          })\n        }\n      },\n    },\n    layerSelected: {\n      id: 'layer',\n      on: {\n        SELECT: {\n          target: 'idle',\n          actions: assign({\n            elemId: (context, event) => '',\n          }),\n        },\n        RESET: { \n          target: 'idle',\n          actions: assign({\n            elemId: (_, __) => ''\n          })\n        }\n      },\n    },\n  },\n});\n\nexport let selectService = interpret(selectMachine);","import { getAceEditor } from \"./setup\";\n\nlet chordEditor = document.getElementById('chord-editor');\nlet editBtn = document.getElementById('show-chord-editor-btn');\nlet sendBtn = document.getElementById('send-chord-btn');\n\nexport let chord = {\n  current: null,\n  new: {\n    root: null,\n    accidental: null,\n    variation: null\n  }\n};\nexport let chordLocation = {};\nexport let chordSelected = {\n  root:null,\n  accidental:null,\n  variation:null\n}\n\n//coloring selection and decoloring previous selections\nfor (let td of document.querySelectorAll('.Chords td')) {\n  if (td.closest('#chord-editor')) {\n    td.addEventListener('click', function (event) {\n      event.target.style.color = 'tomato';\n\n      let otherCells = document.getElementsByClassName(event.target.className);\n      for (let other of otherCells) {\n        if (other !== event.target) other.style.color = 'white';\n      }\n\n      switch (event.target.className) {\n        case 'root':\n          chord.new.root = event.target.innerText;\n          chordSelected.root = event.target;\n          console.log({ chord, chordSelected })\n          break;\n        case 'accidental':\n          chord.new.accidental = event.target.innerText;\n          chordSelected.accidental = event.target;\n          break;\n        case 'variation':\n          chord.new.variation = event.target.innerText;\n          chordSelected.variation = event.target;\n          break;\n      }\n\n      if (chord.new.root && chord.new.variation) {\n        sendBtn.style.display = 'block';\n      }\n    });\n  }\n}\n\n//back click\ndocument.getElementById('close-chord-btn').addEventListener('click', function (event) {\n  if (chordSelected.root) chordSelected.root.style.color = 'white';\n  if (chordSelected.accidental)\n    chordSelected.accidental.style.color = 'white';\n  if (chordSelected.variation) chordSelected.variation.style.color = 'white';\n\n  Object.keys(chordSelected).forEach((i) => (chordSelected[i] = null));\n  Object.keys(chord.new).forEach((i) => (chord.new[i] = null));\n\n  chordEditor.style.display = 'none';\n  // document.getElementById('cover').style.visibility = 'hidden';\n});\n\n//edit click\neditBtn.addEventListener('click', (event) => {\n  chordEditor.style.display = 'block';\n  editBtn.style.visibility = 'hidden';\n});\n\n//edit hidden when scrolling\ndocument.querySelector('#output').parentElement.addEventListener('scroll', function () {\n  editBtn.style.visibility = 'hidden';\n});\n\n//send click\nsendBtn.addEventListener('click', function (event) {\n  chordEditor.style.display = 'none';\n  // document.getElementById('cover').style.visibility = 'hidden';\n\n  chordSelected.root.style.color = 'white';\n  if (chordSelected.accidental) chordSelected.accidental.style.color = 'white';\n  chordSelected.variation.style.color = 'white';\n  Object.keys(chordSelected).forEach((i) => (chordSelected[i] = null));\n\n  let edtr = getAceEditor();\n  if (!edtr) {\n    throw new Error('Ace Editor is undefined');\n  }\n  let kernfile = edtr.session.getValue();\n\n  let jsonRequest = {\n    kernfile,\n    chordLocation,\n    chord,\n  };\n\n  console.log(jsonRequest);\n\n  let xhttp = new XMLHttpRequest();\n  xhttp.onload = function () {\n    let jsonResponse = JSON.parse(xhttp.response); //to response einai json?mporei kai sketo string\n    let newKern = jsonResponse[0];\n    edtr.setValue(newKern);\n  };\n  //xhttp.open(\"POST\", url)\n  //xhttp.setRequestHeader('Content-Type', 'application/json');\n  //xhttp.send(jsonRequest);\n  Object.keys(chord.new).forEach((i) => (chord.new[i] = null));\n  sendBtn.style.display = 'none';\n});","import { getAceEditor } from './setup.js';\nimport { getVrvWorker } from '../humdrum-notation-plugin-worker.js';\n\nconst ACCEPTED_FORMATS = '.xml,.musicxml,.mei,.krn';\n\nexport function openFileFromDisk() {\n  let input = document.getElementById('file-input');\n  if (!input) {\n    input = document.createElement('input');\n    input.setAttribute('id', 'file-input');\n    input.setAttribute('type', 'file');\n    input.setAttribute('accept', '.xml,.musicxml,.mei,.krn');\n    input.style.display = 'none';\n\n    input.addEventListener('change', event => {\n      if (event.target.files.length == 0)\n        return;\n      let file = event.target.files[0];\n\n      let extension = file.name.slice(file.name.lastIndexOf('.'));\n      if (!ACCEPTED_FORMATS.split(',').includes(extension)) {\n        console.error('The format of this file is not supported');\n        return;\n      }\n\n      let reader = new FileReader();\n      reader.addEventListener('load', e => {\n        let fileContent = e.target.result.toString();\n        getAceEditor().session.setValue(fileContent);\n      });\n      reader.readAsText(file);\n    });\n    document.body.appendChild(input);\n  }\n\n  input.click();\n}\n\nexport async function saveContentAsMIDI() {\n  let base64Midi = await getVrvWorker().renderToMidi();\n  let song = 'data:audio/midi;base64,' + base64Midi;\n\n  let element = document.createElement('a');\n  element.setAttribute('download', 'data.mid');\n  element.style.display = 'none';\n  element.setAttribute('href', song);\n\n  document.body.appendChild(element);\n  element.click();\n  document.body.removeChild(element);\n}","//\n// Programmer:     Craig Stuart Sapp <craig@ccrma.stanford.edu>\n// Creation Date:  Thu Jun 21 16:07:56 PDT 2018\n// Last Modified:  Thu Jun 21 16:08:01 PDT 2018\n// Filename:       hmdindex.js\n// Web Address:    https://verovio.humdrum.org/scripts/hmdindex.js\n// Syntax:         JavaScript 1.8/ECMAScript 5\n// vim:            ts=3: ft=javascript\n//\n// Description:    Parse an index.hmd file giving the contents of a repertory.\n//\n\n//////////////////////////////\n//\n// HMDIndex constructor -- Creat an HMDIndex object.\n//\n\nexport function HMDIndex(contents) {\n  this.clear();\n  this.parse(contents);\n  return this;\n}\n\n//////////////////////////////\n//\n// HMDIndex.prototype.clear -- Clear the old contents of the index\n//\n\nHMDIndex.prototype.clear = function () {\n  // parameters == list of key/value pairs extracted from\n  // Humdrum reference records in the input Humdurm data.\n  this.parameters = {};\n\n  // items == list of files, groups, or dummy/dummy-vhv lines stored\n  // on data lines in the input Humdrum data.  These are\n  // sorted by the sortkey field after loading the data.\n  this.items = [];\n\n  // groupedItems == database of sortkey values for entries\n  // that are in groups (movements of a larger work).\n  this.groupedItems = {};\n\n  // sortIndex == database of entries indexed by sortkey value.\n  this.sortIndex = {};\n};\n\n//////////////////////////////\n//\n// HMDIndex.prototype.setParameter -- Set a parameter.\n//\n\nHMDIndex.prototype.setParameter = function (key, value) {\n  this.parameters[key] = value;\n};\n\n//////////////////////////////\n//\n// HMDIndex.prototype.getParameter -- Get a parameter.\n//\n\nHMDIndex.prototype.getParameter = function (key) {\n  return this.parameters[key];\n};\n\n//////////////////////////////\n//\n// HMDIndex.prototype.parse -- Parse the contents of a Humdrum\n//     file containing and index of works and store them in the\n//     object.\n//\n\nHMDIndex.prototype.parse = function (contents) {\n  this.clear();\n  var exfound = 0;\n  var index = {};\n  var lines = contents.match(/[^\\r\\n]+/g);\n  if (lines.length == 1) {\n    if (lines[0].match(/^https?:\\/\\//)) {\n      return this.parseURL(lines[0]);\n    }\n  }\n  var entry;\n  for (var i = 0; i < lines.length; i++) {\n    var line = lines[i];\n    if (line.match(/^\\s*$/)) {\n      continue;\n    }\n    var matches = line.match(/^!!!([^!:\\s]+)\\s*:\\s*(.*)\\s*$/);\n    if (matches) {\n      this.setParameter(matches[1], matches[2]);\n      continue;\n    }\n    if (line.match(/^!/)) {\n      // local or global comment\n      continue;\n    }\n    if (line.match(/^\\*\\*/)) {\n      exfound = 1;\n      var fields = line.split(/\\t+/);\n      for (var j = 0; j < fields.length; j++) {\n        var ematch = fields[j].match(/^\\*\\*(.*)/);\n        if (ematch) {\n          index[ematch[1]] = j;\n        }\n      }\n    }\n    if (!exfound) {\n      continue;\n    }\n    if (line.match(/^\\*/)) {\n      continue;\n    }\n    var data = line.split(/\\t+/);\n    if (data.length < 1) {\n      // not enough data fields so ignore the entry\n      // there must be at least the filename specified.\n      continue;\n    }\n    var filename = '';\n    var sortkey = '';\n    var available = '';\n    var pdfname = '';\n    var description = '';\n    if (data[index['file']]) {\n      filename = data[index['file']];\n    }\n    if (data[index['sort']]) {\n      sortkey = data[index['sort']];\n    }\n    if (data[index['available']]) {\n      available = data[index['available']];\n    }\n    if (data[index['pdf']]) {\n      pdfname = data[index['pdf']];\n    }\n    if (data[index['description']]) {\n      description = cleanTitle(data[index['description']]);\n    }\n\n    this.addEntry({\n      filename: filename,\n      sortkey: sortkey,\n      available: available,\n      pdfname: pdfname,\n      description: description,\n    });\n  }\n\n  this.sortEntries();\n\n  return this;\n};\n\n//////////////////////////////\n//\n// HMDIndex.prototype.sortEntries --\n//\n\nHMDIndex.prototype.sortEntries = function () {\n  this.items.sort(function (a, b) {\n    if (a.sortkey < b.sortkey) {\n      return -1;\n    } else if (a.sortkey > b.sortkey) {\n      return 1;\n    } else {\n      return 0;\n    }\n  });\n};\n\n//////////////////////////////\n//\n// HMDIndex.prototype.parseURL --\n//\n\nHMDIndex.prototype.parseURL = function (url) {\n  var that = this;\n  var request = new XMLHttpRequest();\n  request.open('GET', url);\n  request.onload = function () {\n    if (request.status == 200) {\n      that.parse(request.responseText);\n    } else {\n      reject('ERROR:', request.status);\n    }\n  };\n  request.send();\n};\n\n//////////////////////////////\n//\n// HMDIndex.prototpye.addEntry --\n//\n\nHMDIndex.prototype.addEntry = function (object) {\n  var filename = object.filename;\n  var sortkey = object.sortkey;\n  var available = object.available;\n  var pdfname = object.pdfname;\n  var description = cleanTitle(object.description);\n\n  var matches;\n\n  if (!filename || filename === '.') {\n    // require filename at a minimum\n    return;\n  }\n  if (!available || available === '.') {\n    available = 'Y';\n  }\n  if (available !== 'Y' && available !== 'N') {\n    if (available.match(/y/i)) {\n      available = 'Y';\n    } else {\n      available = 'N';\n    }\n  }\n  if (!available) {\n    available = 'Y';\n  }\n  if (!sortkey || sortkey === '.') {\n    sortkey = filename;\n  }\n  if (!pdfname || pdfname === '.') {\n    pdfname = '';\n  }\n  if (!description || description === '.') {\n    description = filename;\n  }\n\n  // split the filename into directory, basename, and extension:\n  var directory = '';\n  var basename = '';\n  var extension = '';\n\n  var obj = {\n    sortkey: sortkey,\n    description: description,\n    pdfname: pdfname,\n  };\n\n  // THERE IS ALSO filename === \"DUMMY\" to implement.\n  if (filename.match(/^@/)) {\n    // this is a group, not a filename.  The group is a list\n    // of sortkeys of the items that form the group.\n    obj.group = filename.replace(/^@/, '').split(':');\n    for (var i = 0; i < obj.group.length; i++) {\n      this.groupedItems[obj.group[i]] = true;\n    }\n  } else {\n    matches = filename.match(/(.*)\\//);\n    if (matches) {\n      directory = matches[1];\n    }\n    matches = filename.match(/([^\\/]+?)(\\.[^\\/.]*)?$/);\n    if (matches) {\n      extension = matches[2];\n      basename = matches[1];\n    } else {\n      matches = filename.match(/([^\\/]+)$/);\n      if (matches) {\n        basename = matches[1];\n      }\n    }\n    obj.available = available;\n    obj.file = {\n      fullname: filename,\n      extension: extension,\n      directory: directory,\n      basename: basename,\n    };\n  }\n\n  this.items.push(obj);\n  this.sortIndex[sortkey] = obj;\n};\n\n//////////////////////////////\n//\n// HMDIndex.prototype.generateHTML --\n//\n\nHMDIndex.prototype.generatHtml = HMDIndex.prototype.generateHTML;\n\nHMDIndex.prototype.generateHTML = function () {\n  console.log('OBJECT HMD', this);\n\n  var urlbase = '';\n  if (this.parameters) {\n    urlbase = this.parameters.github;\n  }\n\n  var output = '';\n  output += \"<table class='index-list'>\\n\";\n\n  for (var i = 0; i < this.items.length; i++) {\n    var skey = this.items[i].sortkey;\n    if (this.groupedItems[skey] === true) {\n      continue;\n    }\n    if (this.items[i].file) {\n      output += this.generateFileHTML(this.items[i]);\n    } else if (this.items[i].group) {\n      output += this.generateGroupHTML(this.items[i]);\n    }\n    // print DUMMY item\n  }\n\n  output += '</table>\\n';\n\n  return output;\n};\n\n//////////////////////////////\n//\n// HMDIndex.prototype.cleanTitle --\n//\n\nHMDIndex.prototype.cleanTitle = function (text) {\n  return cleanRepertoryEntryText(text);\n};\n\n//////////////////////////////\n//\n// HMDIndex.prototype.generateFileHTML --\n//\n\nHMDIndex.prototype.generateFileHTML = function (entry, indent) {\n  var output = '';\n  output += '<tr>';\n  output += '<td>';\n\n  var description = cleanTitle(entry.description);\n  var matches = description.match(/(.*)<link>(.*?)<\\/link>(.*)/);\n  var prefix = '';\n  var postfix = '';\n  if (matches) {\n    prefix = matches[1];\n    postfix = matches[3];\n    description = matches[2];\n  }\n  if (description.match(/^\\s*$/)) {\n    description = entry.file.basename;\n  }\n\n  if (indent) {\n    output += \"<span class='indenter'></span>\";\n  }\n  output += prefix;\n  output += \"<span class='ilink'\";\n  output += ' onclick=\\'displayWork(\"';\n  output += this.parameters.githubbase;\n  output += '/';\n  output += entry.file.fullname;\n  output += '\");';\n  output += \"'>\";\n  output += description;\n  output += '</span>';\n  output += postfix;\n\n  output += '</td>';\n  output += '</tr>\\n';\n\n  return output;\n};\n\n//////////////////////////////\n//\n// HMDIndex.prototype.generateGroupHTML --\n//\n\nHMDIndex.prototype.generateGroupHTML = function (entry) {\n  var output = '';\n  // output += \"<div class='group'>\\n\";\n  output += \"<tr><td class='igroup'>\\n\";\n  output += cleanTitle(entry.description);\n  output += '</td></tr>\\n';\n  var indent = 1;\n  for (var i = 0; i < entry.group.length; i++) {\n    var fileentry = this.sortIndex[entry.group[i]];\n    output += this.generateFileHTML(fileentry, indent);\n  }\n  // output += \"</div>\\n\";\n  return output;\n};\n","/* global $, basketSession */\n\nimport {\n  redrawInputArea,\n  displayScoreTextInEditor,\n  replaceEditorContentWithHumdrumFile,\n} from './misc.js';\nimport { HMDIndex } from './hmdindex.js';\nimport { getVrvWorker } from '../humdrum-notation-plugin-worker.js';\n\nlet vrvWorker = getVrvWorker();\nif (!vrvWorker) {\n  throw new Error('Verovio worker is undefined');\n}\n\n//////////////////////////////\n//\n// loadKernScoresFile --\n//\nlet recursionCnt = 0;\nlet hmdIndex;\n\nexport function loadKernScoresFile(obj, force) {\n  var file = obj.file;\n  var measures = obj.measures;\n  var page = obj.page;\n  var getnext = obj.next;\n  var getprevious = obj.previous;\n\n  file = applyUrlAliases(file);\n\n  if (measures) {\n    var getnext = false;\n    var getprevious = false;\n  }\n\n  recursionCnt++;\n  if (recursionCnt > 10000) {\n    console.log('RECURSION TOO LARGE', file);\n    return;\n  }\n\n  var url = '';\n  var key = '';\n  var ret;\n\n  if (file) {\n    if (file.match(/^https?:/)) {\n      url = file;\n      key = file;\n    } else if (file.match(/^bb:/)) {\n      ret = getBitbucketUrl(file, measures);\n      if (ret) {\n        url = ret.url;\n        key = ret.key;\n      }\n    } else if (file.match(/^bitbucket:/)) {\n      ret = getBitbucketUrl(file, measures);\n      if (ret) {\n        url = ret.url;\n        key = ret.key;\n      }\n    } else if (file.match(/^github:/)) {\n      ret = getGithubUrl(file, measures);\n      if (ret) {\n        url = ret.url;\n        key = ret.key;\n      }\n    } else {\n      ret = kernScoresUrl(file, measures);\n      if (ret) {\n        url = ret.url;\n        key = ret.url;\n      }\n    }\n  } else if (obj.tasso) {\n    ret = getTassoUrl(obj.tasso, measures);\n    if (ret) {\n      url = ret.url;\n      key = ret.key;\n    }\n  } else if (obj.bb) {\n    ret = getBitbucketUrl(obj.bb, measures);\n    if (ret) {\n      url = ret.url;\n      key = ret.key;\n    }\n  } else if (obj.github) {\n    ret = getGithubUrl(obj.bb, measures);\n    if (ret) {\n      url = ret.url;\n      key = ret.key;\n    }\n  } else if (obj.bitbucket) {\n    ret = getBitbucketUrl(obj.bitbucket, measures);\n    if (ret) {\n      url = ret.url;\n      key = ret.key;\n    }\n  }\n\n  if (!key) {\n    key = 'DATA';\n    // return;\n  }\n\n  var requires = getRequires(url, key);\n\n  var keys = commaDuplicate(key);\n\n  if (force) {\n    for (var i = 0; i < keys.length; i++) {\n      basketSession.remove(key[i]);\n      console.log('removed ', key[i]);\n    }\n  }\n\n  redrawInputArea();\n\n  var expire = 142;\n\n  var jinfo;\n\n  var info = basketSession.get(keys[0]);\n  // var info = null;\n  // console.log(\"INFO\", info)\n\n  if (obj && obj.file && obj.file.match(/musedata/)) {\n    // console.log(\"Going to download\", key);\n    basketSession.require(...requires).then(\n      function () {\n        var infos = [];\n        for (var j = 0; j < keys.length; j++) {\n          infos[j] = basketSession.get(keys[j]);\n        }\n        var data = '';\n        var filenames = commaDuplicate(key);\n        for (j = 0; j < infos.length; j++) {\n          // print file header\n          data += '&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&\\n';\n          //mm = key.match(/([^\\/]+)\\/([^\\/]+)\\s*$/);\n          //if (mm) {\n          //\t// filename = mm[1] + \"/\" + base;\n          //\tfilename = filenames[j];\n          //} else {\n          //\tfilename = \"unknown\";\n          //}\n\n          // Was declared global\n          var filename = infos[j].url;\n          data += '@filename==' + filename + '\\n';\n          data += '&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&\\n';\n          var oinfo = infos[j];\n          data += oinfo.data;\n          data += '/eof\\n';\n        }\n        data += '//\\n'; // end-of-transmission marker for MuseData stage2 multipart file.\n        displayScoreTextInEditor(data, vrvWorker.page);\n\n        if (infos.length > 1) {\n          // console.log(\"GOING TO ADD MULTIPLE FILES TO EDITOR\", infos);\n        } else if (infos.length == 1) {\n          info = basketSession.get(key);\n          console.log('INFO = ', info);\n          if (info) {\n            try {\n              jinfo = JSON.parse(info.data);\n              if (force) {\n                try {\n                  var textdata = atob(jinfo.content);\n                } catch (err) {\n                  // text is not MIME encoding.\n                }\n                if (textdata.match(/^\\s*$/)) {\n                  textdata = '!!!ONB: No data content\\n';\n                }\n                try {\n                  displayScoreTextInEditor(atob(jinfo.content), vrvWorker.page);\n                } catch (err) {\n                  displayScoreTextInEditor(jinfo.content, vrvWorker.page);\n                }\n              }\n              if (getnext) {\n                processInfo(jinfo, obj, false, false);\n              }\n            } catch (err) {\n              console.log('Error downloading', key, 'Error:', err);\n              displayScoreTextInEditor(info.data, vrvWorker.page);\n            }\n          } else {\n            console.log('Error retrieving', key);\n          }\n          redrawInputArea();\n        }\n      },\n      function () {\n        console.log('Error retrieving', key);\n      }\n    );\n  } else if (!info) {\n    console.log('Going to download', key);\n    basketSession\n      .require({ url: url, key: key, expire: expire, execute: false })\n      .then(\n        function () {\n          info = basketSession.get(key);\n          if (info) {\n            if (info.url.match(/\\/index.hmd$/)) {\n              hmdIndex = new HMDIndex(info.data);\n              hmdIndex.parameters.githubbase = file;\n              displayHmdIndexFinally(hmdIndex, url);\n              // window.HMDINDEX = new HMDIndex(info.data);\n              // window.HMDINDEX.parameters.githubbase = file;\n              // displayHmdIndexFinally(window.HMDINDEX, url);\n            } else {\n              try {\n                jinfo = JSON.parse(info.data);\n                if (force) {\n                  var textdata = atob(jinfo.content);\n                  if (textdata.match(/^\\s*$/)) {\n                    textdata = '!!!ONB: No data content\\n';\n                  }\n                  displayScoreTextInEditor(atob(jinfo.content), vrvWorker.page);\n                }\n                if (getnext) {\n                  processInfo(jinfo, obj, false, false);\n                }\n              } catch (err) {\n                console.log('Error downloading', key, 'Error:', err);\n                displayScoreTextInEditor(info.data, vrvWorker.page);\n              }\n            }\n          } else {\n            console.log('Error1 retrieving', key);\n          }\n          redrawInputArea();\n        },\n        function () {\n          console.log('Error2 retrieving', key);\n        }\n      );\n  } else {\n    try {\n      jinfo = JSON.parse(info.data);\n      if (getnext) {\n        processInfo(jinfo, obj, false, false);\n      }\n    } catch (err) {\n      displayScoreTextInEditor(info.data, vrvWorker.page);\n      redrawInputArea();\n    }\n  }\n}\n\n//////////////////////////////\n//\n// getTassoUrl --\n//\n\nfunction getTassoUrl(file, measures) {\n  var filename = file.replace(/\\.krn$/, '');\n\n  var url = 'https://josquin.stanford.edu/cgi-bin/tasso?&file=' + filename;\n  url += '&a=humdrum';\n\n  var key = filename;\n  if (measures) {\n    url += '&mm=' + measures;\n    key += '&mm=' + measures;\n  }\n\n  return { url: url, key: key };\n}\n\n//////////////////////////////\n//\n// getGithubUrl --\n//\n// http://verovio.humdrum.org/?file=github:polyrhythm-project/rds-scores\n// https://bitbucket.org/musedata/beethoven/raw/master/bhl/qrtet/op18no5/stage2/01/03\n//\n\nfunction getGithubUrl(file, measures) {\n  file = file.replace(/^github:\\/*/, '');\n\n  var username = '';\n  var repository = '';\n  var pathandfile = '';\n  var url = '';\n\n  url = 'https://raw.githubusercontent.com/';\n  // Was declared global\n  var matches = file.match('^/*([^/]+)/([^/]+)/?(.*)');\n  if (matches) {\n    username = matches[1];\n    repository = matches[2];\n    pathandfile = matches[3];\n  }\n  url += username;\n  url += '/';\n  url += repository;\n  url += '/master/';\n  if (!pathandfile) {\n    url += 'index.hmd';\n  } else {\n    url += pathandfile;\n  }\n\n  var key = pathandfile;\n\n  var obj = { url: url, key: key };\n  return obj;\n}\n\n//////////////////////////////\n//\n// getBitbucketUrl --\n//\n// http://verovio.humdrum.org/?file=bitbucket:musedata/beethoven/bhl/qrtet/op18no5/stage2/01/03\n// https://bitbucket.org/musedata/beethoven/raw/master/bhl/qrtet/op18no5/stage2/01/03\n//\n\nfunction getBitbucketUrl(file, measures) {\n  file = file.replace(/^(bb|bitbucket):/, '');\n\n  var username = '';\n  var repository = '';\n  var pathandfile = '';\n  var url = '';\n\n  url = 'https://bitbucket.org/';\n  // Was declared global\n  var matches = file.match('^/?([^/]+)/([^/]+)/(.*)');\n  if (matches) {\n    username = matches[1];\n    repository = matches[2];\n    pathandfile = matches[3];\n  }\n  url += username;\n  url += '/';\n  url += repository;\n  url += '/raw/master/';\n  url += pathandfile;\n\n  var key = pathandfile;\n\n  return { url: url, key: key };\n}\n\n//////////////////////////////\n//\n// kernScoresUrl -- convert kernscores location into URL.\n//\n\nfunction kernScoresUrl(file, measures) {\n  var location;\n  var filename;\n  var user = '';\n  var repository = '';\n  var matches;\n  var jrp = false;\n  var github = false;\n  var nifc = false;\n\n  if ((matches = file.match(/^(j|jrp):\\/?\\/?(.*)/))) {\n    jrp = true;\n    file = matches[2];\n  } else if (\n    (matches = file.match(/^(g|gh|github):\\/?\\/?([^\\/]+)\\/([^\\/]+)\\/(.+)/))\n  ) {\n    github = true;\n    user = matches[2];\n    repository = matches[3];\n    file = matches[4];\n  } else if ((matches = file.match(/^nifc:\\/?\\/?(?:krn)?(.*)/i))) {\n    nifc = true;\n    file = matches[1];\n  }\n\n  if (jrp) {\n    filename = file;\n    location = '';\n  } else if (github) {\n    filename = file;\n  } else if (nifc) {\n    filename = file;\n  } else {\n    if ((matches = file.match(/(.*)\\/([^\\/]+)/))) {\n      location = matches[1];\n      filename = matches[2];\n    }\n  }\n\n  if (!filename || !filename.match(/\\.[a-z][a-z][a-z]$/)) {\n    if (!jrp) {\n      loadIndexFile(file);\n      return;\n    }\n  }\n\n  if (filename.match(/^\\s*$/)) {\n    if (!jrp) {\n      loadIndexFile(file);\n      return;\n    }\n  }\n\n  var url;\n  if (jrp) {\n    url = 'https://josquin.stanford.edu/cgi-bin/jrp?id=' + filename;\n    url += '&a=humdrum';\n  } else if (nifc) {\n    url = 'https://humdrum.nifc.pl/krn/' + filename;\n  } else if (github) {\n    url =\n      'https://raw.githubusercontent.com/' +\n      user +\n      '/' +\n      repository +\n      '/master/' +\n      filename;\n  } else {\n    url = 'https://kern.humdrum.org/data?l=' + location + '&file=' + filename;\n    url += '&format=info-json';\n  }\n\n  var key = '';\n  if (!github) {\n    key = location + '/' + filename;\n    if (measures) {\n      url += '&mm=' + measures;\n      key += '&mm=' + measures;\n    }\n  }\n\n  return { url: url, key: key };\n}\n\n//////////////////////////////\n//\n// downloadKernScoresFile --\n//\n\nfunction downloadKernScoresFile(file, measures, page) {\n  var location;\n  var filename;\n  var matches;\n  var jrp = false;\n  var bitbucket = false;\n  var github = false;\n  var nifc = false;\n\n  matches = file.match(/^jrp:(.*)/i);\n  if (matches) {\n    jrp = true;\n    file = matches[1];\n  } else {\n    matches = file.match(/^(?:bitbucket|bb):(.*)/i);\n    if (matches) {\n      bitbucket = true;\n      file = matches[1];\n    } else {\n      matches = file.match(/^(?:github|gh):(.*)/i);\n      if (matches) {\n        bitbucket = true;\n        file = matches[1];\n      } else {\n        matches = file.match(/^nifc:(.*)/i);\n        if (matches) {\n          nifc = true;\n          file = matches[1];\n        }\n      }\n    }\n  }\n\n  var url;\n  if (jrp) {\n    if ((matches = file.match(/(.*)\\/([^\\/]+)/))) {\n      location = matches[1];\n      filename = matches[2];\n    }\n    url = 'https://josquin.stanford.edu/data?id=' + location;\n    url += '&a=humdrum';\n  } else if (nifc) {\n    file = file.replace(/^\\/+/, '');\n    url = 'https://humdrum.nifc.pl/krn/' + file;\n  } else {\n    if ((matches = file.match(/(.*)\\/([^\\/]+)/))) {\n      location = matches[1];\n      filename = matches[2];\n    }\n    url = 'https://kern.humdrum.org/data?l=' + location + '&file=' + filename;\n    if (measures) {\n      url += '&mm=' + measures;\n    }\n  }\n\n  if (filename) {\n    global_editorOptions.SAVEFILENAME = filename;\n    console.log(\n      'global_editorOptions.SAVEFILENAME - ',\n      global_editorOptions.SAVEFILENAME\n    );\n  }\n\n  if (bitbucket && url.match(/,/)) {\n    downloadMultipleFiles(url);\n    return;\n  }\n\n  console.log('DATA URL', url);\n  var request = new XMLHttpRequest();\n  request.open('GET', url);\n  request.addEventListener('load', function () {\n    if (request.status == 200) {\n      // console.log(\"DATA\", request.responseText);\n      //var inputarea = document.querySelector(\"#input\");\n      //console.log(\"Current file:\", file);\n      //inputarea.value = request.response;\n\n      // https://ace.c9.io/#nav=api&api=editor\n      replaceEditorContentWithHumdrumFile(request.response, page);\n    }\n  });\n  request.send();\n}\n\n/////////////////////////////\n//\n// downloadMultipleFiles -- Currently assumes to be MuseData.\n//\n\nfunction downloadMultipleFiles(url) {\n  console.log('DOWNLOADING MULTIPLE FILES', url);\n}\n\n///////////////////////////////\n//\n// loadHmdIndexFile --\n//\n\nfunction loadHmdIndexFile(location) {\n  var request = new XMLHttpRequest();\n  request.open('GET', url);\n  request.addEventListener('load', function () {\n    if (request.status == 200) {\n      var INDEX = request.responseText;\n      // window.HMDINDEX = new HMDIndex(info.data);\n      hmdIndex = new HMDIndex(info.data);\n      // console.log(\"INDEX= \", INDEX);\n      $('html').css('cursor', 'auto');\n      // displayHmdIndexFinally(window.HMDINDEX, location);\n      displayHmdIndexFinally(hmdIndex, location);\n    }\n  });\n  request.send();\n}\n\n///////////////////////////////\n//\n// loadIndexFile --\n//\n\nexport function loadIndexFile(location) {\n  if (location.match(/index.hmd$/)) {\n    loadHmdIndexFile(location);\n    return;\n  }\n  var url = 'https://kern.humdrum.org/data?l=' + location;\n  url += '&format=index';\n\n  console.log('Loading index', url);\n\n  var request = new XMLHttpRequest();\n  request.open('GET', url);\n  request.addEventListener('load', function () {\n    if (request.status == 200) {\n      var INDEX = request.responseText;\n      // console.log(\"INDEX= \", INDEX);\n      $('html').css('cursor', 'auto');\n      displayIndexFinally(INDEX, location);\n    }\n  });\n  request.send();\n}\n\n//////////////////////////////\n//\n// displayIndexFinally --\n//\n\nfunction displayIndexFinally(index, location) {\n  global_interface.ShowingIndex = true;\n\n  // window.IndexSupressOfInput = true;\n  if (global_interface.InputVisible == true) {\n    global_interface.UndoHide = true;\n    global_interface.ApplyZoom = true;\n    // hideInputArea(true);\n  }\n\n  var matches;\n  var lines = index.split(/\\r?\\n/);\n  var i;\n  var newlines = [];\n  var data;\n  for (i = 0; i < lines.length; i++) {\n    if (lines[i].match(/^\\s*$/)) {\n      continue;\n    }\n    data = lines[i].split(/\\t+/);\n    if (data.length >= 3) {\n      if ((matches = data[1].match(/(.*)HIDE$/))) {\n        // data[1] = matches[1];\n        data[2] = data[2].replace(/<hlstart>/g, '');\n        data[2] = data[2].replace(/<hlend>/g, '');\n      }\n      let newline = data[1] + '\\t' + data[0] + '\\t' + data[2];\n      newlines.push(newline);\n    }\n  }\n  newlines.sort();\n  var items = [];\n  for (i = 0; i < newlines.length; i++) {\n    data = newlines[i].split(/\\t+/);\n    var entry = {};\n    entry.sorter = data[0];\n    entry.filename = data[1];\n    entry.text = cleanRepertoryEntryText(data[2]);\n    items.push(entry);\n  }\n\n  var indents = {};\n\n  var final = \"<table class='index-list'>\";\n  for (i = 0; i < items.length; i++) {\n    if (items[i].text.match(/^All /)) {\n      continue;\n    }\n    items[i].text = items[i].text.replace(\n      /\\[?<a[^>]*wikipedia[^<]*.*?<\\/a>\\]?/gi,\n      ''\n    );\n\n    final += '<tr><td>';\n\n    if (indents[items[i].sorter]) {\n      final += \"<span class='indenter'></span>\";\n    } else if (indents[items[i].sorter.replace(/HIDE$/, '')]) {\n      final += \"<span class='indenter'></span>\";\n    }\n\n    if (items[i].filename.match(/^@/)) {\n      items[i].text.replace(/<not>.*?<\\/not>/g, '');\n      final += items[i].text;\n      var xtext = items[i].filename;\n      xtext = xtext.replace(/^@/, '');\n      var tindent = xtext.split(/:/);\n      indents = {};\n      for (var j = 0; j < tindent.length; j++) {\n        indents[tindent[j]] = 'true';\n      }\n    } else if (items[i].sorter.match(/HIDE$/)) {\n      var spantext = '';\n      spantext += location;\n      spantext += '/' + items[i].filename;\n      spantext += '\\');\">';\n      items[i].text = items[i].text.replace(/<hlstart>/, spantext);\n      final += items[i].text;\n    } else if (!items[i].text.match(/hlstart/)) {\n      final += \"<span class='ilink' onclick=\\\"displayWork('\";\n      final += location;\n      final += '/' + items[i].filename;\n      final += '\\');\">';\n      final += items[i].text;\n      final += '</span>';\n    } else {\n      var spantext = '';\n      spantext += \"<span class='ilink' onclick=\\\"displayWork('\";\n      spantext += location;\n      spantext += '/' + items[i].filename;\n      spantext += '\\');\">';\n      items[i].text = items[i].text.replace(/<hlstart>/, spantext);\n      if (items[i].text.match(/<hlend>/)) {\n        items[i].text = items[i].text.replace(/<hlend>/, '</span>');\n      } else {\n        items[i].text += '</span>';\n      }\n      final += items[i].text;\n    }\n    final += '</td></tr>';\n  }\n  final += '</table>';\n  var indexelem = document.querySelector('#index');\n  indexelem.innerHTML = final;\n  indexelem.style.visibility = 'visible';\n  indexelem.style.display = 'block';\n}\n\n//////////////////////////////\n//\n// cleanRepertoryEntryText --\n//\n\nfunction cleanRepertoryEntryText(text) {\n  text = text.replace(/-sharp/g, '&sharp;').replace(/-flat/g, '&flat;');\n  text = text.replace(/<not>.*?<\\/not>/g, '');\n  let matches = text.match(/@\\{link:([^}]+)\\}/);\n  if (matches) {\n    let link = matches[1];\n    let replacement = '';\n    if (link.match(/https?:\\/\\/.*wikipedia/)) {\n      replacement += '<a target=\"_blank\" href=\"' + link + '\">';\n      replacement +=\n        '<span style=\"float:right; font-size:60%\" class=\"fa-stack fa-1x\">\\n';\n      replacement += '<i class=\"fas fa-square fa-stack-2x\"></i>\\n';\n      replacement +=\n        '<i class=\"fab fa-wikipedia-w fa-stack-1x fa-inverse\"></i>\\n';\n      replacement += '</span>\\n';\n      replacement += '</a>\\n';\n      text = text.replace(/@\\{link:[^}]+\\}/, replacement);\n    }\n  }\n  return text;\n}\n\n//////////////////////////////\n//\n// displayHmdIndexFinally --\n//\n\nfunction displayHmdIndexFinally(hmdindex, source) {\n  if (!hmdindex.parameters.hmdindexurl) {\n    hmdindex.parameters.hmdindexurl = source;\n  }\n  if (hmdindex.parameters.hmdindexurl && !hmdindex.parameters.baseurl) {\n    var baseurl = hmdindex.parameters.hmdindexurl.replace(/\\/index.hmd$/, '');\n    hmdindex.parameters.baseurl = baseurl;\n  }\n  global_interface.ShowingIndex = true;\n\n  // window.IndexSupressOfInput = true;\n  if (global_interface.InputVisible == true) {\n    global_interface.UndoHide = true;\n    global_interface.ApplyZoom = true;\n    // hideInputArea(true);\n  }\n\n  var indexelem = document.querySelector('#index');\n  indexelem.innerHTML = hmdindex.generateHTML();\n  indexelem.style.visibility = 'visible';\n  indexelem.style.display = 'block';\n}\n\n//////////////////////////////\n//\n// applyUrlAliases --\n//\n//\n\nfunction applyUrlAliases(file) {\n  if (!file) {\n    return file;\n  }\n  var matches;\n\n  // Github web interface URL:\n  //    https://github.com/josquin-research-project/Ock/blob/master/Ock2002-Ave_Maria.krn\n  // Maps to the raw data associated with that page:\n  //    https://raw.githubusercontent.com/josquin-research-project/Ock/master/Ock2002-Ave_Maria.krn\n  matches = file.match(\n    /https:\\/\\/github.com\\/([^\\/]+)\\/([^\\/]+)\\/blob\\/([^\\/]+)\\/(.*)/\n  );\n  if (matches) {\n    var user = matches[1];\n    var repertory = matches[2];\n    var commit = matches[3];\n    var path = matches[4];\n    file = 'https://raw.githubusercontent.com/' + user + '/' + repertory + '/';\n    file += commit + '/' + path;\n  }\n\n  return file;\n}\n\n//////////////////////////////\n//\n// getRequires -- Convert a comma-construct for URL into a list of files to download.\n//\n\nfunction getRequires(url, key) {\n  var expire = 172;\n  var listing;\n  if (!key.match(/,/)) {\n    listing = [\n      {\n        url: url,\n        key: key,\n        expire: expire,\n        execute: false,\n      },\n    ];\n    return listing;\n  }\n\n  // Input represents multiple files, such as\n  // https://verovio.humdrum.org?bb=musedata/beethoven/bhl/qrtet/op18no5/stage2/01/03,04\n  // should expand to two files:\n  // https://verovio.humdrum.org?bb=musedata/beethoven/bhl/qrtet/op18no5/stage2/01/03\n  // https://verovio.humdrum.org?bb=musedata/beethoven/bhl/qrtet/op18no5/stage2/01/04\n\n  var urls = commaDuplicate(url);\n  var keys = commaDuplicate(key);\n\n  listing = [];\n  for (var i = 0; i < urls.length; i++) {\n    listing.push({\n      url: urls[i],\n      key: keys[i],\n      expire: expire,\n      execute: false,\n    });\n  }\n  return listing;\n}\n\n//////////////////////////////\n//\n// commaDuplicate --\n//\n\nfunction commaDuplicate(value) {\n  var pieces = value.split(/\\s*,\\s*/);\n  var first = pieces[0];\n  var matches = first.match(/^(.*\\/)([^\\/]+)/);\n  if (!matches) {\n    return value;\n  }\n  var base = matches[1];\n  pieces[0] = matches[2];\n  var output = [];\n  for (var i = 0; i < pieces.length; i++) {\n    output.push(base + pieces[i]);\n  }\n  return output;\n}\n\n//////////////////////////////\n//\n// processInfo --\n//\nimport { Base64 } from './utility.js';\nimport {\n  global_editorOptions,\n  global_interface,\n  setFileInfo,\n} from './global-variables.js';\n\nfunction processInfo(info, obj, nextwork, prevwork) {\n  var score;\n  if (info) {\n    // window.FILEINFO = info;\n    setFileInfo(info);\n    // score = atob(info.content);\n    score = Base64.decode(info.content);\n    // console.log(\"Score unpacked\");\n  } else {\n    console.log('Impossible error for', info);\n    return;\n  }\n\n  var matches;\n  if (obj && obj.file && (matches = obj.file.match(/([^\\/]+)$/))) {\n    global_editorOptions.SAVEFILENAME = matches[1];\n  }\n\n  // var inputarea = document.querySelector(\"#input\");\n  // inputarea.value = score;\n  displayScoreTextInEditor(score, vrvWorker.page);\n\n  obj.next = false;\n  obj.previous = false;\n\n  if (!obj) {\n    return;\n  }\n\n  if (info['next-work']) {\n    obj.file = info['next-work'];\n    loadKernScoresFile(obj);\n  }\n  if (info['previous-work']) {\n    obj.file = info['previous-work'];\n    loadKernScoresFile(obj);\n  }\n}\n","/* global $ */\n\n//\n// Programmer:     Craig Stuart Sapp <craig@ccrma.stanford.edu>\n// Creation Date:  Sun Apr 17 17:21:46 PDT 2016\n// Last Modified:  Thu Aug 18 21:03:35 CEST 2016\n// Filename:       listeners.js\n// Web Address:    https://verovio.humdrum.org/listeners.js\n// Syntax:         JavaScript 1.8/ECMAScript 5\n// vim:            ts=3: ft=javascript\n//\n// Description:   Event listeners and related code for index.html.\n//\n\nimport {\n  FILEINFO,\n  global_cursor,\n  global_editorOptions,\n  global_interface,\n  global_playerOptions,\n  global_verovioOptions,\n} from './global-variables.js';\nimport { getAceEditor, GetCgiParameters, setupSplitter } from './setup.js';\nimport {\n  displayNotation,\n  cleanFont,\n  updateEditorMode,\n  setTextInEditor,\n  redrawInputArea,\n  setCursorNote,\n  getTextFromEditor,\n} from './misc.js';\nimport { observeSvgContent } from './utility-svg.js';\nimport { HnpMarkup } from './highlight.js';\n\nimport {\n  clearContent,\n  toggleFreeze,\n  showBufferedHumdrumData,\n  displayMei,\n  displayMeiNoType,\n  displayPdf,\n  reloadData,\n  decreaseTab,\n  increaseTab,\n  toggleHumdrumCsvTsv,\n  toggleTextVisibility,\n  playCurrentMidi,\n  displayWork,\n  gotoPreviousPage,\n  gotoNextPage,\n  gotoFirstPage,\n  gotoLastPage,\n  hideRepertoryIndex,\n} from './misc.js';\nimport {\n  addBarlineAboveCurrentPosition,\n  addDataLineAboveCurrentPosition,\n  addInterpretationLineAboveCurrentPosition,\n  addLocalCommentLineAboveCurrentPosition,\n  processNotationKey,\n  setEditorContents,\n  setEditorContentsMany,\n  setInterfaceSingleNumber,\n  transposeNotes,\n} from './editor.js';\nimport {\n  togglePlaceColoring,\n  toggleAppoggiaturaColoring,\n  toggleLayerColoring,\n  goUpHarmonically,\n  goDownHarmonically,\n  goToNextNoteOrRest,\n  goToPreviousNoteOrRest,\n} from './utility-svg.js';\nimport {\n  saveSvgData,\n  restoreEditorContentsLocally,\n  saveEditorContentsLocally,\n} from './buffer.js';\nimport { saveEditorContents } from './saving.js';\nimport { generatePdfFull, generatePdfSnapshot } from './pdf.js';\nimport { getMenu } from '../menu.js';\nimport { yProvider } from '../yjs-setup.js';\n\n// window.HIDEMENU = false;\nvar PDFLISTINTERVAL = null;\n\ndocument.getElementById('play-button')\n  ?.addEventListener('click', () => playCurrentMidi(global_cursor.CursorNote));\n\nif (localStorage.FONT) {\n  global_verovioOptions.FONT = cleanFont(localStorage.FONT);\n}\n\n//////////////////////////////\n//\n// highlighting options --\n//\n\nconst markup = new HnpMarkup();\n\n//////////////////////////////\n//\n// DomContentLoaded event listener -- Display the sample data.\n//\nimport { setEditorMode } from './global-variables.js';\nimport { getTextFromEditorRaw, dataIntoView } from './misc.js';\nimport { loadEditorFontSizes } from './verovio-options.js';\nimport { setupDropArea } from '../drop.js';\nimport { inSvgImage } from './utility-svg.js';\n\nimport { selectService } from '../state/selectStateMachine.js';\nimport { layoutService } from '../state/layoutStateMachine.js';\nimport { unfocusCommentHighlights } from '../collaboration/util-collab.js';\nimport { chordLocation } from './chords.js';\nimport { openFileFromDisk } from './file-operations.js';\nimport { loadKernScoresFile } from './loading.js';\nimport { Base64 } from './utility.js';\n\ndocument.addEventListener('DOMContentLoaded', function () {\n  loadEditorFontSizes();\n  var inputElement = document.querySelector('#input');\n  if (inputElement) {\n    inputElement.style.fontSize = global_editorOptions.INPUT_FONT_SIZE + 'rem';\n  }\n\n  let CGI = GetCgiParameters();\n\n  if (CGI.file || CGI.tasso || CGI.jrp || CGI.bb || CGI.bitbucket || CGI.gh || CGI.github || CGI.poly) {\n\t\tloadKernScoresFile(\n\t\t\t{\n\t\t\t\tfile: CGI.file,\n\t\t\t\ttasso: CGI.tasso,\n\t\t\t\tpoly: CGI.poly,\n\t\t\t\tjrp: CGI.jrp,\n\t\t\t\tbitbucket: CGI.bitbucket,\n\t\t\t\tbb: CGI.bb,\n\t\t\t\tgithub: CGI.github,\n\t\t\t\tgh: CGI.gh,\n\t\t\t\tmeasures: CGI.mm,\n\t\t\t\tnext: true,\n\t\t\t\tprevious: true\n\t\t\t}\n\t\t);\n\t} else {\n\t\tif (CGI.t) {\n\t\t\tvar text = CGI.t;\n\t\t\tif (text.match(/\\*kern/)) {\n\t\t\t\t// do nothing\n\t\t\t} else if (text.match(/\\*mens/)) {\n\t\t\t\t// do nothing\n\t\t\t} else if (text.match(/<xml/)) {\n\t\t\t\t// do nothing\n\t\t\t} else {\n\t\t\t\t// presumably MIME data, so decode\n\t\t\t\t// will have to deal with embedded UTF-8 probably.\n\t\t\t\ttry {\n\t\t\t\t\ttext = Base64.decode(text);\n\t\t\t\t} catch (err) {\n\t\t\t\t\t// text is not MIME encoded\n\t\t\t\t\tconsole.error(\"INPUT TEXT IS NOT MIME ENCODED\");\n\t\t\t\t}\n\t\t\t}\n\t\t\tsetTextInEditor(text);\n\t\t}\n\t}\n\n  setEditorMode('humdrum');\n\n  // The block of code below loads the edits to the Ace editor from the AUTOSAVE local buffer,\n  // but it breaks Ace Editor\n\n  var ctime = new Date().getTime();\n  var otime = localStorage.getItem('AUTOSAVE_DATE');\n  var dur = ctime - otime;\n  var encodedcontents = localStorage.getItem('AUTOSAVE');\n  var autosave = decodeURIComponent(encodedcontents);\n  if (!autosave) {\n    autosave = '';\n  }\n  if (!autosave.match(/^\\s*$/) && dur < 60000) {\n    var input = document.querySelector('#input');\n    if (input) {\n      // input.textContent = autosave;\n      // HERE WE RESTORE THE UPDATED EDITOR STATE FROM LOCAL STORAGE\n      // setTextInEditor(autosave);\n    }\n  }\n\n  getAceEditor()._dispatchEvent('ready');\n  setupDropArea();\n\n  displayNotation();\n\n  setupSplitter();\n\n  // set init (default) state\n  // $('#input').data('x', $('#input').outerWidth());\n  // $('#input').data('y', $('#input').outerHeight());\n  layoutService.start();\n\n  window.layoutService = layoutService;\n\n\n  var body = document.querySelector('body');\n\n  selectService.onTransition((state) => {\n    // console.log('State changed:', state.value, state.context);\n\n    if (!yProvider) return;\n\n    if (state.context?.elemId.length > 0) {\n      let target = document.getElementById(state.context.elemId);\n      yProvider.awareness.setLocalStateField('singleSelect', { elemId: target.id });\n      return;\n    }\n    \n    yProvider.awareness.setLocalStateField('singleSelect', { elemId: null });\n  });\n\n  // selectService.start();\n\n  body.addEventListener('click', function (event) {\n    // turnOffAllHighlights();\n    if (!event.target.closest('.comment-with-replies')) {\n      unfocusCommentHighlights();\n    }\n\n    // console.log(\"SINGLE CLICK\");\n    if (inSvgImage(event.target)) {\n      let target = event.target?.closest('[id]');\n\n      let harmonyElem = event.target.closest('.harm');\n      //alx         \n      if (harmonyElem){\n        chordLocation.line = harmonyElem.id.split('L')[1].split('F')[0];\n        chordLocation.column = harmonyElem.id.split('L')[1].split('F')[1];\n\n        let editBtn = document.getElementById('show-chord-editor-btn');\n        editBtn.style.visibility = 'visible';\n\n                // let pgx = event.clientX + 10;\n        // let pgy = event.clientY + 10;\n        let harmonyBox = harmonyElem.getBoundingClientRect();\n        let pgx = harmonyBox.x + 25;\n        let pgy = harmonyBox.y + 25;\n\n        let jitsiContainer = document.getElementById('jitsi-meeting-container');\n        if (jitsiContainer) {\n          editBtn.style.transform = `translateY(-${jitsiContainer.getBoundingClientRect().height}px)`;\n        }\n\n        editBtn.style.top = `${pgy}px`;\n        editBtn.style.left = `${pgx}px`;;\n      }\n      //alx_\n\n      $('[data-toggle=\"popover\"]').popover('dispose');\n      if (target?.id && target.id.match(/^(note|chord|layer)-L{1}(\\d+)F{1}(\\d+)/g)) {\n        selectService.send({ type: 'SELECT', elemId: target.id });\n      } else {\n        selectService.send({ type: 'RESET' });\n        yProvider?.awareness?.setLocalStateField('singleSelect', { elemId: null });\n        // clearCursorHighlight();\n      }\n      \n      //alx:prosthiki chord argument sto dataIntoView\n      dataIntoView(event);\n    }\n  });\n\n  window.addEventListener('keydown', processNotationKeyCommand, true);\n  window.addEventListener('keydown', processInterfaceKeyCommand);\n\n  observeSvgContent();\n\n});\n\nfunction extractEditorPosition(element) {\n  var id = element.id;\n  var matches;\n\n  if ((matches = id.match(/L(\\d+)/))) {\n    var line = parseInt(matches[1]);\n  } else {\n    return; // required\n  }\n\n  if ((matches = id.match(/F(\\d+)/))) {\n    var field = parseInt(matches[1]);\n  } else {\n    return; // required\n  }\n\n  if ((matches = id.match(/S(\\d+)/))) {\n    var subfield = parseInt(matches[1]);\n  } else {\n    subfield = null;\n  }\n\n  if ((matches = id.match(/N(\\d+)/))) {\n    var number = parseInt(matches[1]);\n  } else {\n    number = 1;\n  }\n\n  if ((matches = id.match(/^([a-z]+)-/))) {\n    var name = matches[1];\n  } else {\n    return; // required\n  }\n\n  if (line < 1 || field < 1) {\n    return;\n  }\n\n  return { id, line, field, subfield };\n}\n\nfunction transposeMultiSelect(state, amount) {\n  const notes = Array.from(\n    document.querySelectorAll(\n      state.multiSelect.map((el) => '#' + el).join(',')\n    )\n  )\n    .map((note) => extractEditorPosition(note))\n    .filter(Boolean)\n    .map((note) => ({ ...note, amount }));\n\n  const transposedNotes = transposeNotes(notes);\n  setEditorContentsMany(transposedNotes);\n  return transposedNotes;\n}\n\n//////////////////////////////\n//\n// keydown event listener -- Notation editor listener.\n//\n\nfunction processNotationKeyCommand(event) {\n  if (!event.preventDefault) {\n    event.preventDefault = function () {};\n  }\n\n  // only works outside of the editor.\n  if (event.altKey || event.target.nodeName == 'TEXTAREA') {\n    return;\n  }\n  if (document.activeElement.nodeName == 'INPUT') {\n    // needed to suppress key commands when running vim command\n    return;\n  }\n\n  //undo doesn't need CursorNote\n  if (event.code === ZKey && (event.ctrlKey || event.metaKey)) {\n    const editor = getAceEditor();\n    if (!editor) {\n      throw new Error('Ace Editor is undefined');\n    }\n    editor.undo();\n    return;\n  }\n\n  const localState = yProvider?.awareness.getLocalState();\n  if (localState?.multiSelect) {\n    // Transposition for multi selected notes\n    // FIX: If the global CursorNote is defined, and we then try to transpose a multi-selected area\n    // the CursorNote is re-assigned to one of the multi-selected note elements\n    if (event.code === UpKey && event.shiftKey) {\n      transposeMultiSelect(localState, 1);\n      return;\n    } else if (event.code === DownKey && event.shiftKey) {\n      transposeMultiSelect(localState, -1);\n      return;\n    } else if (event.code === UpKey && event.ctrlKey) {\n      transposeMultiSelect(localState, 7);\n      return;\n    } else if (event.code === DownKey && event.ctrlKey) {\n      transposeMultiSelect(localState, -7);\n      return;\n    }\n  }\n\n  if (!global_cursor.CursorNote) {\n    return;\n  }\n  if (!global_cursor.CursorNote.id) {\n    return;\n  }\n\n  switch (event.code) {\n    case AKey:\n      processNotationKey('a', global_cursor.CursorNote);\n      break;\n\n    case BKey:\n      processNotationKey('b', global_cursor.CursorNote);\n      break;\n\n    case CKey:\n      processNotationKey('c', global_cursor.CursorNote);\n      break;\n\n    case DKey:\n      if (event.shiftKey) {\n        processNotationKey('D', global_cursor.CursorNote);\n      }\n      break;\n\n    // case EKey:\n\n    case FKey:\n      processNotationKey('f', global_cursor.CursorNote);\n      break;\n\n    // case GKey:\n    // case HKey:\n\n    case IKey:\n      processNotationKey('i', global_cursor.CursorNote);\n      break;\n\n    case JKey:\n      if (event.shiftKey) {\n        processNotationKey('J', global_cursor.CursorNote);\n      }\n      break;\n\n    // case KKey:\n\n    case LKey:\n      if (event.shiftKey) {\n        processNotationKey('L', global_cursor.CursorNote);\n      }\n      break;\n\n    case MKey:\n      if (event.shiftKey) {\n        processNotationKey('M', global_cursor.CursorNote);\n      } else {\n        processNotationKey('m', global_cursor.CursorNote);\n      }\n      break;\n\n    case NKey:\n      processNotationKey('n', global_cursor.CursorNote);\n      break;\n\n    // case OKey:\n\n    case PKey:\n      if (event.shiftKey) {\n        processNotationKey('P', global_cursor.CursorNote);\n      } else {\n        processNotationKey('p', global_cursor.CursorNote);\n      }\n      break;\n\n    case QKey:\n      processNotationKey('q', global_cursor.CursorNote);\n      break;\n\n    // case RKey:\n\n    case SKey:\n      processNotationKey('s', global_cursor.CursorNote);\n      break;\n\n    case TKey:\n      if (event.shiftKey) {\n        processNotationKey('T', global_cursor.CursorNote);\n      } else {\n        processNotationKey('t', global_cursor.CursorNote);\n      }\n      break;\n\n    // case UKey:\n\n    case VKey:\n      if (global_cursor.CursorNote.id.match('note-')) {\n        processNotationKey('^', global_cursor.CursorNote);\n      }\n      break;\n\n    case WKey:\n      if (event.shiftKey) {\n        processNotationKey('W', global_cursor.CursorNote);\n      } else {\n        processNotationKey('w', global_cursor.CursorNote);\n      }\n      break;\n\n    case XKey:\n      processNotationKey('X', global_cursor.CursorNote);\n      break;\n\n    case YKey:\n      processNotationKey('y', global_cursor.CursorNote);\n      break;\n\n    // case ZKey:\n\n    case OneKey:\n      processNotationKey('1', global_cursor.CursorNote);\n      break;\n\n    case TwoKey:\n      if (event.shiftKey) {\n        processNotationKey('@', global_cursor.CursorNote);\n      } else {\n        processNotationKey('2', global_cursor.CursorNote);\n      }\n      break;\n\n    case ThreeKey:\n      if (event.shiftKey) {\n        processNotationKey('#', global_cursor.CursorNote);\n      } else {\n        processNotationKey('3', global_cursor.CursorNote);\n      }\n      break;\n\n    case FourKey:\n      processNotationKey('4', global_cursor.CursorNote);\n      break;\n\n    case FiveKey:\n      processNotationKey('5', global_cursor.CursorNote);\n      break;\n\n    case SixKey:\n      if (global_cursor.CursorNote.id.match('note-')) {\n        if (event.shiftKey) {\n          processNotationKey('^^', global_cursor.CursorNote);\n        } else {\n          processNotationKey('6', global_cursor.CursorNote);\n        }\n      } else {\n        processNotationKey('6', global_cursor.CursorNote);\n      }\n      break;\n\n    case SevenKey:\n      processNotationKey('7', global_cursor.CursorNote);\n      break;\n\n    case EightKey:\n      processNotationKey('8', global_cursor.CursorNote);\n      break;\n\n    case NineKey:\n      processNotationKey('9', global_cursor.CursorNote);\n      break;\n\n    case MinusKey:\n      processNotationKey('-', global_cursor.CursorNote);\n      break;\n\n    case SingleQuoteKey:\n      processNotationKey(\"'\", global_cursor.CursorNote);\n      break;\n\n    case SemiColonKey:\n      if (event.shiftKey) {\n        processNotationKey(':', global_cursor.CursorNote);\n      } else {\n        processNotationKey(';', global_cursor.CursorNote);\n      }\n      break;\n\n    case BackQuoteKey:\n      if (event.shiftKey) {\n        processNotationKey('~', global_cursor.CursorNote);\n      } else {\n        processNotationKey('`', global_cursor.CursorNote);\n      }\n      break;\n\n    case UpKey:\n      if (event.shiftKey) {\n        event.preventDefault();\n        event.stopPropagation();\n        if (global_cursor.CursorNote.id.match('note-')) {\n          console.log('Shift + Up, Current note: ', global_cursor.CursorNote);\n          processNotationKey('transpose-up-step', global_cursor.CursorNote);\n        }\n      } else if (event.ctrlKey) {\n        event.preventDefault();\n        event.stopPropagation();\n        if (global_cursor.CursorNote.id.match('note-')) {\n          processNotationKey('transpose-up-octave', global_cursor.CursorNote);\n        }\n      } else {\n        event.preventDefault();\n        event.stopPropagation();\n        goUpHarmonically(global_cursor.CursorNote);\n      }\n      break;\n\n    case DownKey:\n      if (event.shiftKey) {\n        event.preventDefault();\n        event.stopPropagation();\n        if (global_cursor.CursorNote.id.match('note-')) {\n          processNotationKey('transpose-down-step', global_cursor.CursorNote);\n        }\n      } else if (event.ctrlKey) {\n        event.preventDefault();\n        event.stopPropagation();\n        if (global_cursor.CursorNote.id.match('note-')) {\n          processNotationKey('transpose-down-octave', global_cursor.CursorNote);\n        }\n      } else {\n        event.preventDefault();\n        event.stopPropagation();\n        goDownHarmonically(global_cursor.CursorNote);\n      }\n      break;\n\n    case DeleteKey:\n    case BackKey:\n      processNotationKey('delete', global_cursor.CursorNote);\n      event.stopPropagation();\n      break;\n\n    case LeftKey:\n      if (global_cursor.CursorNote.id.match('slur-')) {\n        event.preventDefault();\n        event.stopPropagation();\n        if (event.shiftKey) {\n          processNotationKey('rightEndMoveBack', global_cursor.CursorNote);\n        } else {\n          processNotationKey('leftEndMoveBack', global_cursor.CursorNote);\n        }\n      } else {\n        // move one note to the left\n        event.preventDefault();\n        event.stopPropagation();\n        goToPreviousNoteOrRest(global_cursor.CursorNote.id);\n      }\n      break;\n\n    case RightKey:\n      if (global_cursor.CursorNote.id.match('slur-')) {\n        event.preventDefault();\n        event.stopPropagation();\n        if (event.shiftKey) {\n          processNotationKey('rightEndMoveForward', global_cursor.CursorNote);\n        } else {\n          processNotationKey('leftEndMoveForward', global_cursor.CursorNote);\n        }\n      } else {\n        // move one note to the right\n        event.preventDefault();\n        event.stopPropagation();\n        goToNextNoteOrRest(global_cursor.CursorNote.id);\n      }\n      break;\n\n    case EscKey:\n      event.preventDefault();\n      event.stopPropagation();\n\n      yProvider.awareness.setLocalStateField('singleSelect', { elemId: null });\n\n      processNotationKey('esc', global_cursor.CursorNote);\n      break;\n  }\n}\n\n//////////////////////////////\n//\n// keydown event listener -- Interface control listener.\n//\n\nexport function processInterfaceKeyCommand(event) {\n  if (!event.preventDefault) {\n    event.preventDefault = function () {};\n  }\n\n  if ((!event.altKey || !event.ctrlKey) && event.target?.nodeName == 'TEXTAREA') {\n    // needed to prevent key commands when editing text\n    return;\n  }\n  if (!event.altKey && document.activeElement.nodeName == 'INPUT') {\n    // needed to prevent key commands when running vim command\n    return;\n  }\n\n  if (event.metaKey) {\n    // usually ignore metaKey unless 0:\n    if (event.code == ZeroKey) {\n      getMenu().resetTextFontSize();\n      // window.MENU.resetTextFontSize();\n      global_verovioOptions.SCALE = 40;\n      localStorage.SCALE = global_verovioOptions.SCALE;\n      displayNotation();\n      // not preventingDefault so that web browser can reset size as well.\n    }\n    return;\n  }\n\n  switch (event.code) {\n    case AKey: // UNUSED\n      // if (event.altKey) {\n      // \tif (event.shiftKey) {\n      // \t\t// toggle display of toolbar\n      // \t\t// toggleNavigationToolbar();\n      // \t} else {\n      // \t\t// toggle display of banner\n      // \t\ttoggleVhvTitle();\n      // \t}\n      // \tevent.preventDefault();\n      // }\n      break;\n\n    case BKey:\n      if (event.altKey) {\n        if (event.shiftKey) {\n          addBarlineAboveCurrentPosition();\n          event.preventDefault();\n        }\n      }\n      break;\n\n    case CKey:\n      if (event.altKey) {\n        if (event.shiftKey) {\n          togglePlaceColoring();\n        }\n        event.preventDefault();\n      }\n      break;\n\n    case DKey: // Add null data line\n      if (event.altKey) {\n        if (event.shiftKey) {\n          addDataLineAboveCurrentPosition();\n        }\n        // else {\n        // \ttoggleMenuDisplay();\n        // }\n        event.preventDefault();\n      }\n      break;\n\n    case EKey: // erase text editor contents or Tooggle display of menu with shift key.\n      if (event.altKey) {\n        // if (event.shiftKey) {\n        // \ttoggleMenuAndToolbarDisplay();\n        // } else {\n        // \tclearContent();\n        // }\n        clearContent();\n        event.preventDefault();\n      }\n      break;\n\n    case FKey: // toogle notation update freezing\n      if (event.altKey) {\n        if (event.shiftKey) {\n          displayNotation(false, true);\n        } else {\n          toggleFreeze();\n        }\n        event.preventDefault();\n      }\n      break;\n\n    case GKey: // save current view to SVG image\n      if (event.altKey) {\n        // displaySvg();\n        saveSvgData();\n        event.preventDefault();\n      }\n      break;\n\n    case HKey: // show Humdrum data in text editor\n      if (event.altKey) {\n        if (!global_interface.ShowingIndex) {\n          showBufferedHumdrumData();\n          event.preventDefault();\n        }\n      }\n      break;\n\n    case IKey: // Add null interpretation line\n      if (event.altKey) {\n        if (event.shiftKey) {\n          addInterpretationLineAboveCurrentPosition();\n          event.preventDefault();\n        }\n      }\n      break;\n\n    case JKey: // UNUSED\n      break;\n\n    case KKey: // UNUSED\n      break;\n\n    case LKey: // toggle color of staff layers\n      if (event.altKey) {\n        if (event.shiftKey) {\n          addLocalCommentLineAboveCurrentPosition();\n        } else {\n          toggleLayerColoring();\n        }\n        event.preventDefault();\n      }\n      break;\n\n    case MKey: // show MEI data in text editor\n      if (event.altKey) {\n        setEditorMode('xml');\n        // EditorMode = \"xml\";\n        if (event.shiftKey) {\n          // display with @type data\n          displayMei();\n        } else {\n          // display without @type data\n          displayMeiNoType();\n        }\n        event.preventDefault();\n      }\n      break;\n\n    case NKey: // toggle display of navigation toolbar\n      // if (event.altKey) {\n      // \tif (event.shiftKey) {\n      // \t\t// toggleNavigationToolbar();\n      // \t\tgotoPrevToolbarDelta();\n      // \t} else {\n      // \t\tchooseToolbarMenu();\n      // \t}\n      // \tevent.preventDefault();\n      // }\n      break;\n\n    case OKey: // toggle display of *oclef data\n      if (event.ctrlKey) {\n        event.preventDefault();\n        openFileFromDisk();\n      }\n\n      if (event.altKey) {\n        global_interface.OriginalClef = !global_interface.OriginalClef;\n        console.log('Original clef changed to:', global_interface.OriginalClef);\n        if (!global_interface.ShowingIndex) {\n          displayNotation();\n        }\n        event.preventDefault();\n      }\n      break;\n\n    case PKey: // show PDF in separate window\n      if (event.altKey) {\n        displayPdf();\n        event.preventDefault();\n      }\n      break;\n\n    case QKey: // toggle coloring of appoggiaturas\n      if (event.altKey) {\n        if (event.shiftKey) {\n          // do nothing\n        } else {\n          toggleAppoggiaturaColoring();\n        }\n        event.preventDefault();\n      }\n      break;\n\n    case RKey: // reload Humdrum data from server\n      if (event.altKey) {\n        if (event.shiftKey) {\n          restoreEditorContentsLocally();\n          event.preventDefault();\n        } else {\n          reloadData();\n          event.preventDefault();\n        }\n      }\n      break;\n\n    case SKey: // save contents of text editor to file\n      if (event.altKey) {\n        if (event.shiftKey) {\n          saveEditorContentsLocally();\n          event.preventDefault();\n        } else {\n          saveEditorContents();\n          event.preventDefault();\n        }\n      }\n      break;\n\n    case TKey: // save PDF file\n      // Needed functions are defined in _includes/pdfkit.html\n      if (event.altKey) {\n        if (event.shiftKey) {\n          if (typeof generatePdfFull === 'function') {\n            generatePdfSnapshot();\n          }\n        } else {\n          if (typeof generatePdfSnapshot === 'function') {\n            generatePdfFull();\n          }\n        }\n        event.preventDefault();\n      }\n      break;\n\n    case UKey: // toggle TSV/CSV display of Humdrum data\n      if (event.shiftKey) {\n        decreaseTab();\n        event.preventDefault();\n      } else {\n        toggleHumdrumCsvTsv();\n        event.preventDefault();\n      }\n      break;\n\n    case WKey: // adjust notation width parameter\n      if (event.altKey) {\n        if (event.shiftKey) {\n          global_editorOptions.SPACINGADJUSTMENT -= 0.05;\n        } else {\n          global_editorOptions.SPACINGADJUSTMENT += 0.05;\n        }\n        if (global_editorOptions.SPACINGADJUSTMENT <= 0.0) {\n          global_editorOptions.SPACINGADJUSTMENT = 0.0;\n        }\n        event.preventDefault();\n        displayNotation();\n      }\n      break;\n\n    case XKey: // UNUSED\n      break;\n\n    case YKey: // show/hide text editor\n      if (event.altKey) {\n        if (!global_interface.ShowingIndex) {\n          toggleTextVisibility();\n        }\n        event.preventDefault();\n      }\n      break;\n\n    /*\t\tcase ZKey:  // use undo key from OS/browser\n\t\t\tif (event.ctrlKey || event.metaKey) {\n\t\t\twindow.EDITOR.undo();\n\t\t\t};\n\t\t\tbreak;\n*/\n\n    case ZeroKey:\n      setInterfaceSingleNumber(0);\n      break;\n    case OneKey:\n      setInterfaceSingleNumber(1);\n      break;\n    case TwoKey:\n      setInterfaceSingleNumber(2);\n      break;\n    case ThreeKey:\n      setInterfaceSingleNumber(3);\n      break;\n    case FourKey:\n      setInterfaceSingleNumber(4);\n      break;\n    case FiveKey:\n      setInterfaceSingleNumber(5);\n      break;\n    case SixKey:\n      setInterfaceSingleNumber(6);\n      break;\n    case SevenKey:\n      setInterfaceSingleNumber(7);\n      break;\n    case EightKey:\n      setInterfaceSingleNumber(8);\n      break;\n    case NineKey:\n      setInterfaceSingleNumber(9);\n      break;\n\n    case SpaceKey: // start/pause MIDI playback\n      if (!global_playerOptions.PLAY) {\n        if (global_playerOptions.PAUSE) {\n          window.play();\n          global_playerOptions.PLAY = true;\n          global_playerOptions.PAUSE = false;\n        } else {\n          playCurrentMidi(global_cursor.CursorNote);\n          global_playerOptions.PLAY = true;\n          global_playerOptions.PAUSE = false;\n        }\n      } else {\n        global_playerOptions.PLAY = false;\n        global_playerOptions.PAUSE = true;\n        window.pause();\n      }\n      event.preventDefault();\n      break;\n\n    case CommaKey: // toggle TSV/CSV display of Humdrum data\n      // decrease tab size in editor\n      // See UKey for relocation of comma-command for\n      // (related to non-US keyboard layout)\n      if (event.shiftKey) {\n        decreaseTab();\n        event.preventDefault();\n      } else {\n        //toggleHumdrumCsvTsv();\n        //event.preventDefault();\n      }\n      break;\n\n    case DotKey: // increase tab size in editor\n      if (event.shiftKey) {\n        increaseTab();\n        event.preventDefault();\n      }\n      break;\n\n    case UpKey: // return to repertory index\n      // if (event.shiftKey) {\n      //   if (FILEINFO['has-index'] == 'true') {\n      //     displayIndex(FILEINFO['location']);\n      //   }\n      // }\n      // event.preventDefault();\n      break;\n\n    case PgUpKey: // shift: go to previous repertory work/movement\n    case LeftKey: // go to previous page\n      if (event.shiftKey) {\n        displayWork(FILEINFO['previous-work']);\n      } else {\n        gotoPreviousPage();\n      }\n      event.preventDefault();\n      break;\n\n    case PgDnKey: // shift: go to next repertory work/movement\n    case RightKey: // go to next page\n      if (event.shiftKey) {\n        displayWork(FILEINFO['next-work']);\n      } else {\n        gotoNextPage();\n      }\n      event.preventDefault();\n      break;\n\n    case HomeKey: // go to the first page\n      gotoFirstPage();\n      event.preventDefault();\n      break;\n\n    case EndKey: // go to the last page\n      gotoLastPage();\n      event.preventDefault();\n      break;\n\n    case SlashKey: // toggle menu display (to be implemented)\n      if (event.shiftKey) {\n        event.preventDefault();\n      }\n      break;\n\n    case EscKey:\n      hideRepertoryIndex();\n      event.preventDefault();\n      break;\n  }\n}\n\n//////////////////////////////\n//\n// beforeunload event -- save the text editor's content when exiting the window.\n//     This is useful if the window is left by accident, and allows the user\n//     to recover their data by loading VHV again within 24 hours.\n//\n\nwindow.addEventListener('beforeunload', function (event) {\n  var encodedcontents = encodeURIComponent(getTextFromEditorRaw());\n  localStorage.setItem('AUTOSAVE', encodedcontents);\n  localStorage.setItem('AUTOSAVE_DATE', new Date().getTime());\n  localStorage.setItem('FONT', global_verovioOptions.FONT);\n});\n\n//////////////////////////////\n//\n// Autosave feature:  Save the contents of the editor every 60 seconds to\n//   local storage (\"SAVE0\")  Which can be recalled by typing 0 shift-R\n//   within one minute after reloading the VHV website.\n//\n\nsetInterval(function () {\n  localStorage.setItem('SAVE0', encodeURIComponent(getTextFromEditorRaw()));\n}, 60000);\n\n// needed for startup, but not afterwards, so adjust later:\nsetInterval(function () {\n  updateEditorMode();\n}, 1000);\n\n//////////////////////////////\n//\n// verovioCallback -- Function that is run after SVG data is calcualted\n//     by verovio.\n//\n\nexport function verovioCallback(data) {\n  console.log('SVG updated');\n  if (global_verovioOptions.GOTOTOPOFNOTATION) {\n    global_verovioOptions.GOTOTOPOFNOTATION = false;\n    let scroller = document.querySelector('#output');\n    if (scroller) {\n      scroller.scrollTo(0, 0);\n    }\n  }\n  markup.loadSvg('svg');\n}","// Convert Humdrum data to MusicXML (server-side conversion),\n// with result being saved to hard disk.\n// vim: ts=3:nowrap\n//\nimport { getTextFromEditor } from './misc.js';\n\nexport function convertToMusicXmlAndSave() {\n  if (document.body.classList.contains('waiting')) {\n    alert('Already converting a score');\n    return;\n  }\n\n  let formdata = new FormData();\n  let inputdata = getTextFromEditor();\n  var blob = new Blob([inputdata], { type: 'text/x-humdrum' });\n  formdata.append('inputdata', blob);\n\n  for (var pair of formdata.entries()) {\n    console.log('FORMDATA', pair[0] + ', ' + pair[1]);\n  }\n\n  document.body.classList.add('waiting');\n  let request = new XMLHttpRequest();\n  request.open('POST', 'https://data.musicxml.humdrum.org');\n  request.responseType = 'blob';\n  request.onload = function () {\n    document.body.classList.remove('waiting');\n    let myblob = this.response;\n    let url = window.URL.createObjectURL(myblob);\n\n    // open in another window:\n    // window.open(url);\n\n    // or save to a file:\n    let link = document.createElement('a');\n    document.body.appendChild(link);\n    link.style = 'display: none';\n    link.href = url;\n    link.download = 'data' + '.musicxml';\n    link.click();\n    // window.URL.revokeObjectURL(url);\n    document.body.removeChild(link);\n  };\n  request.send(formdata);\n}\n","/* global $ */\n\n//\n// menu.js -- functions to interface with the top menu.\n//\n// vim: ts=3\n//\n\n// import { prepareBufferStates } from './vhv-scripts/buffer.js';\nimport { processInterfaceKeyCommand } from './vhv-scripts/listeners.js';\nimport {\n  displayNotation,\n  replaceEditorContentWithHumdrumFile,\n  getTextFromEditorNoCsvProcessing,\n  toggleHumdrumCsvTsv,\n} from './vhv-scripts/misc.js';\nimport { loadKernScoresFile } from './vhv-scripts/loading.js';\n\nimport { humdrumToSvgOptions } from './vhv-scripts/verovio-options.js';\nimport { getVrvWorker } from './humdrum-notation-plugin-worker.js';\nimport { getAceEditor } from './vhv-scripts/setup.js';\nimport {\n  goDownHarmonically,\n  goToNextNoteOrRest,\n  goToPreviousNoteOrRest,\n  goUpHarmonically,\n} from './vhv-scripts/utility-svg.js';\n\nimport { trimTabsInEditor } from './vhv-scripts/utility.js';\n\nimport { convertToMusicXmlAndSave } from './vhv-scripts/convertToMusicXmlAndSave.js';\nimport { processNotationKey } from './vhv-scripts/editor.js';\nimport {\n  global_cursor,\n  global_editorOptions,\n  global_verovioOptions,\n} from './vhv-scripts/global-variables.js';\nimport { layoutService } from './state/layoutStateMachine.js';\nimport { hideCommentSection, showCommentSection } from './collaboration/util-collab.js';\nimport { saveContentAsMIDI } from './vhv-scripts/file-operations.js';\n\nclass MenuInterface {\n  constructor() {\n    this.contextualMenus = {};\n  }\n  initialize() {\n    this.contextualMenus = this.getContextualMenus();\n  }\n  hideContextualMenus() {\n    var keys = Object.keys(this.contextualMenus);\n    for (var i = 0; i < keys.length; i++) {\n      this.contextualMenus[keys[i]].style.display = 'none';\n    }\n  }\n  hideMenus(name) {\n    this.hideContextualMenu();\n  }\n  showMenu(name) {\n    this.showContextualMenu(name);\n  }\n  showContextualMenu(name) {\n    var keys = Object.keys(this.contextualMenus);\n    for (var i = 0; i < keys.length; i++) {\n      if (name === keys[i]) {\n        this.contextualMenus[keys[i]].style.display = 'block';\n      } else {\n        this.contextualMenus[keys[i]].style.display = 'none';\n      }\n    }\n  }\n  showCursorNoteMenu(element) {\n    if (!element) {\n      this.hideContextualMenus();\n      return;\n    }\n    var id = element.id;\n    if (!id) {\n      this.hideContextualMenus();\n      return;\n    }\n    var matches = id.match(/^([A-Z]+)-/i);\n    if (!matches) {\n      this.hideContextualMenus();\n      return;\n    }\n    var name = matches[1];\n    name = name.charAt(0).toUpperCase() + name.slice(1);\n    this.showContextualMenu(name);\n  }\n\n  showComments() {\n    showCommentSection();\n  }\n  \n  hideComments() {\n    hideCommentSection();\n  }\n\n  getContextualMenus() {\n    var output = {};\n    var element = document.querySelector('#navbarNavDropdown');\n    if (!element) {\n      return output;\n    }\n    var items = element.querySelectorAll('li.contextual');\n    if (!items) {\n      return output;\n    }\n    for (var i = 0; i < items.length; i++) {\n      var nameelement = items[i].querySelector('.menu-name');\n      if (!nameelement) {\n        continue;\n      }\n      var name = nameelement.textContent.trim();\n      output[name] = items[i];\n    }\n\n    return output;\n  }\n\n  toggleOriginalClefs() {\n    var event = {};\n    event.code = OKey;\n    event.altKey = true;\n    processInterfaceKeyCommand(event);\n  }\n\n  displaySvgData() {\n    var event = {};\n    event.code = GKey;\n    event.altKey = true;\n    processInterfaceKeyCommand(event);\n  }\n\n  saveSvgData() {\n    var event = {};\n    event.code = GKey;\n    event.altKey = true;\n    processInterfaceKeyCommand(event);\n  }\n\n  loadRepertory(repertory, filter) {\n    var options = {\n      file: repertory,\n      next: true,\n      previous: true,\n    };\n    if (filter) {\n      options.filter = filter;\n    }\n    loadKernScoresFile(options);\n  }\n\n  openScoreFileFromDisk() {\n    var event = {};\n    event.code = OKey;\n    event.ctrlKey = true;\n    processInterfaceKeyCommand(event);\n  }\n\n  saveAsMIDI() {\n    saveContentAsMIDI();\n  }\n\n  saveTextEditorContents() {\n    var event = {};\n    event.code = SKey;\n    event.altKey = true;\n    processInterfaceKeyCommand(event);\n  }\n\n  compileEmbeddedFilters() {\n    var event = {};\n    event.code = CKey;\n    event.altKey = true;\n    processInterfaceKeyCommand(event);\n  }\n\n  clearEditorContents() {\n    var event = {};\n    event.code = EKey;\n    event.altKey = true;\n    processInterfaceKeyCommand(event);\n  }\n\n  showSourceScan() {\n    var event = {};\n    event.code = PKey;\n    event.altKey = true;\n    processInterfaceKeyCommand(event);\n  }\n\n  createPdf() {\n    var event = {};\n    event.code = TKey;\n    event.altKey = true;\n    processInterfaceKeyCommand(event);\n  }\n\n  reloadFromSource() {\n    var event = {};\n    event.code = RKey;\n    event.altKey = true;\n    processInterfaceKeyCommand(event);\n  }\n\n  createPdfPage() {\n    var event = {};\n    event.code = TKey;\n    event.altKey = true;\n    event.shiftKey = true;\n    processInterfaceKeyCommand(event);\n  }\n\n  increaseNotationSpacing() {\n    var event = {};\n    event.code = WKey;\n    event.altKey = true;\n    processInterfaceKeyCommand(event);\n  }\n\n  decreaseNotationSpacing() {\n    var event = {};\n    event.code = WKey;\n    event.altKey = true;\n    event.shiftKey = true;\n    processInterfaceKeyCommand(event);\n  }\n\n  decreaseStaffSpacing() {\n    global_verovioOptions.SPACING_STAFF -= 1;\n    if (global_verovioOptions.SPACING_STAFF < 0) {\n      global_verovioOptions.SPACING_STAFF = 0;\n    }\n    displayNotation();\n  }\n\n  increaseStaffSpacing() {\n    global_verovioOptions.SPACING_STAFF += 1;\n    if (global_verovioOptions.SPACING_STAFF > 24) {\n      global_verovioOptions.SPACING_STAFF = 24;\n    }\n    displayNotation();\n  }\n\n  decreaseSystemSpacing() {\n    global_verovioOptions.SPACING_SYSTEM -= 1;\n    if (global_verovioOptions.SPACING_SYSTEM < 0) {\n      global_verovioOptions.SPACING_SYSTEM = 0;\n    }\n    displayNotation();\n  }\n\n  increaseSystemSpacing() {\n    global_verovioOptions.SPACING_SYSTEM += 1;\n    if (global_verovioOptions.SPACING_SYSTEM > 12) {\n      global_verovioOptions.SPACING_SYSTEM = 12;\n    }\n    displayNotation();\n  }\n\n  decreaseLyricSize() {\n    global_verovioOptions.LYRIC_SIZE -= 0.25;\n    if (global_verovioOptions.LYRIC_SIZE < 2.0) {\n      global_verovioOptions.LYRIC_SIZE = 2.0;\n    }\n    displayNotation();\n  }\n\n  increaseLyricSize() {\n    global_verovioOptions.LYRIC_SIZE += 0.25;\n    if (global_verovioOptions.LYRIC_SIZE > 8.0) {\n      global_verovioOptions.LYRIC_SIZE = 8.0;\n    }\n    displayNotation();\n  }\n\n  useLeipzigFont() {\n    global_verovioOptions.FONT = 'Leipzig';\n    displayNotation();\n  }\n\n  useLelandFont() {\n    global_verovioOptions.FONT = 'Leland';\n    displayNotation();\n  }\n\n  usePetalumaFont() {\n    global_verovioOptions.FONT = 'Petaluma';\n    displayNotation();\n  }\n\n  useBravuraFont() {\n    global_verovioOptions.FONT = 'Bravura';\n    displayNotation();\n  }\n\n  useGootvilleFont() {\n    global_verovioOptions.FONT = 'Gootville';\n    displayNotation();\n  }\n\n  applyFilter(filter, data, callback) {\n    var contents = '';\n    if (!data) {\n      contents = editor.getValue().replace(/^\\s+|\\s+$/g, '');\n    } else {\n      contents = data.replace(/^\\s+|\\s+$/g, '');\n    }\n    var options = humdrumToSvgOptions();\n    var data = contents + '\\n!!!filter: ' + filter + '\\n';\n    // window.vrvWorker.filterData(options, data, \"humdrum\")\n    vrvWorker.filterData(options, data, 'humdrum').then(function (newdata) {\n      newdata = newdata.replace(/\\s+$/m, '');\n      var lines = newdata.match(/[^\\r\\n]+/g);\n      for (var i = lines.length - 1; i >= 0; i--) {\n        if (lines[i].match(/^!!!Xfilter:/)) {\n          lines[i] = '';\n          break;\n        }\n      }\n      newdata = '';\n      for (var i = 0; i < lines.length; i++) {\n        if (lines[i] === '') {\n          continue;\n        }\n        newdata += lines[i] + '\\n';\n      }\n      editor.setValue(newdata, -1);\n      if (callback) {\n        callback(newdata);\n      }\n    });\n  }\n\n  insertLocalCommentLine() {\n    var event = {};\n    event.code = LKey;\n    event.shiftKey = true;\n    event.altKey = true;\n    processInterfaceKeyCommand(event);\n  }\n\n  insertNullDataLine() {\n    var event = {};\n    event.code = DKey;\n    event.shiftKey = true;\n    event.altKey = true;\n    processInterfaceKeyCommand(event);\n  }\n\n  insertInterpretationLine() {\n    var event = {};\n    event.code = IKey;\n    event.shiftKey = true;\n    event.altKey = true;\n    processInterfaceKeyCommand(event);\n  }\n\n  insertBarline() {\n    var event = {};\n    event.code = BKey;\n    event.shiftKey = true;\n    event.altKey = true;\n    processInterfaceKeyCommand(event);\n  }\n\n  toggleDataDisplay() {\n    var event = {};\n    event.code = YKey;\n    event.altKey = true;\n    processInterfaceKeyCommand(event);\n  }\n\n  toggleToolbarDisplay() {\n    // toggleNavigationToolbar();\n  }\n\n  toggleLogoDisplay() {\n    var event = {};\n    event.code = BKey;\n    event.altKey = true;\n    processInterfaceKeyCommand(event);\n  }\n\n  toggleLayerHighlighting() {\n    var event = {};\n    event.code = LKey;\n    event.altKey = true;\n    processInterfaceKeyCommand(event);\n  }\n\n  increaseTabSize() {\n    var event = {};\n    event.code = DotKey;\n    event.altKey = true;\n    event.shiftKey = true;\n    processInterfaceKeyCommand(event);\n  }\n\n  decreaseTabSize() {\n    var event = {};\n    event.code = CommaKey;\n    event.altKey = true;\n    event.shiftKey = true;\n    processInterfaceKeyCommand(event);\n  }\n\n  fitTabSizeToData() {\n    var lines = editor.getValue().match(/[^\\r\\n]+/g);\n    var max = 4;\n    for (var i = 0; i < lines.length; i++) {\n      if (lines[i].match(/^\\s*$/)) {\n        continue;\n      }\n      if (lines[i].match(/^!/)) {\n        // not keeping track of local comments which can be long\n        // due to embedded layout commands.\n        continue;\n      }\n      var line = lines[i].split('\\t');\n      for (var j = 0; j < line.length; j++) {\n        if (line[j].length > 25) {\n          // ignore very long tokens\n          continue;\n        }\n        if (line[j].length > max) {\n          max = line[j].length + 3;\n        }\n      }\n    }\n    // ignore strangely long cases:\n    if (max > 25) {\n      max = 25;\n    }\n    global_editorOptions.TABSIZE = max;\n    editor.getSession().setTabSize(global_editorOptions.TABSIZE);\n  }\n\n  openUrl(url, target) {\n    if (!target) {\n      target = '_blank';\n    }\n    window.open(url, target);\n  }\n\n  toggleCsvTsv() {\n    toggleHumdrumCsvTsv();\n  }\n\n  toggleVimPlainTextMode() {\n    var event = {};\n    event.code = VKey;\n    event.altKey = true;\n    processInterfaceKeyCommand(event);\n  }\n\n  displayHumdrumData() {\n    var event = {};\n    event.code = HKey;\n    event.altKey = true;\n    processInterfaceKeyCommand(event);\n  }\n\n  displayMeiData() {\n    var event = {};\n    event.code = MKey;\n    event.altKey = true;\n    processInterfaceKeyCommand(event);\n  }\n\n  loadFromBuffer(bufferNumber) {\n    var event = {};\n    switch (bufferNumber) {\n      case 0:\n        event.code = ZeroKey;\n        break;\n      case 1:\n        event.code = OneKey;\n        break;\n      case 2:\n        event.code = TwoKey;\n        break;\n      case 3:\n        event.code = ThreeKey;\n        break;\n      case 4:\n        event.code = FourKey;\n        break;\n      case 5:\n        event.code = FiveKey;\n        break;\n      case 6:\n        event.code = SixKey;\n        break;\n      case 7:\n        event.code = SevenKey;\n        break;\n      case 8:\n        event.code = EightKey;\n        break;\n      case 9:\n        event.code = NineKey;\n        break;\n      default:\n        console.log('UNKNOWN BUFFER:', bufferNumber);\n        return;\n    }\n    event.altKey = true;\n    processInterfaceKeyCommand(event);\n\n    event.code = RKey;\n    event.shiftKey = true;\n    processInterfaceKeyCommand(event);\n  }\n\n  saveToBuffer(bufferNumber) {\n    var event = {};\n\n    // First store the buffer number in the number register:\n    switch (bufferNumber) {\n      case 0:\n        event.code = ZeroKey;\n        break;\n      case 1:\n        event.code = OneKey;\n        break;\n      case 2:\n        event.code = TwoKey;\n        break;\n      case 3:\n        event.code = ThreeKey;\n        break;\n      case 4:\n        event.code = FourKey;\n        break;\n      case 5:\n        event.code = FiveKey;\n        break;\n      case 6:\n        event.code = SixKey;\n        break;\n      case 7:\n        event.code = SevenKey;\n        break;\n      case 8:\n        event.code = EightKey;\n        break;\n      case 9:\n        event.code = NineKey;\n        break;\n      default:\n        console.log('UNKNOWN BUFFER:', bufferNumber);\n        return;\n    }\n\n    event.altKey = true;\n    processInterfaceKeyCommand(event);\n\n    // Now run the save buffer command:\n    event.code = SKey;\n    event.shiftKey = true;\n    processInterfaceKeyCommand(event);\n  }\n\n  goToLastPage(event) {\n    if (!event) {\n      event = {};\n    }\n    event.code = EndKey;\n    event.altKey = true;\n    processInterfaceKeyCommand(event);\n  }\n\n  goToFirstPage(event) {\n    if (!event) {\n      event = {};\n    }\n    event.code = HomeKey;\n    event.altKey = true;\n    processInterfaceKeyCommand(event);\n  }\n\n  goToPreviousWork(event) {\n    if (!event) {\n      event = {};\n    }\n    event.code = LeftKey;\n    event.altKey = true;\n    event.shiftKey = true;\n    processInterfaceKeyCommand(event);\n  }\n\n  goToNextWork() {\n    var event = {};\n    event.code = RightKey;\n    event.altKey = true;\n    event.shiftKey = true;\n    processInterfaceKeyCommand(event);\n  }\n\n  goToNextPage(event) {\n    if (!event) {\n      event = {};\n    }\n    event.code = RightKey;\n    event.altKey = true;\n    processInterfaceKeyCommand(event);\n  }\n\n  goToPreviousPage(event) {\n    if (!event) {\n      event = {};\n    }\n    event.code = LeftKey;\n    event.altKey = true;\n    processInterfaceKeyCommand(event);\n  }\n\n  toggleMidiPlayback() {\n    var event = {};\n    event.code = SpaceKey;\n    event.altKey = true;\n    processInterfaceKeyCommand(event);\n  }\n\n  toggleNotationFreezing() {\n    var event = {};\n    event.code = FKey;\n    event.altKey = true;\n    processInterfaceKeyCommand(event);\n  }\n\n  forceNoteStemUp() {\n    processNotationKey('a', global_cursor.CursorNote);\n  }\n\n  forceNoteStemDown() {\n    processNotationKey('b', global_cursor.CursorNote);\n  }\n\n  removeStemDirection() {\n    processNotationKey('c', global_cursor.CursorNote);\n  }\n\n  toggleEditorialAccidental() {\n    processNotationKey('i', global_cursor.CursorNote);\n  }\n\n  toggleNaturalAccidental() {\n    processNotationKey('n', global_cursor.CursorNote);\n  }\n\n  toggleSharpAccidental() {\n    processNotationKey('#', global_cursor.CursorNote);\n  }\n\n  toggleFlatAccidental() {\n    processNotationKey('-', global_cursor.CursorNote);\n  }\n\n  toggleForcedDisplay() {\n    processNotationKey('X', global_cursor.CursorNote);\n  }\n\n  toggleStaccato() {\n    processNotationKey(\"'\", global_cursor.CursorNote);\n  }\n\n  toggleMinorLowerMordent() {\n    processNotationKey('m', global_cursor.CursorNote);\n  }\n\n  toggleMajorLowerMordent() {\n    processNotationKey('M', global_cursor.CursorNote);\n  }\n\n  toggleMinorUpperMordent() {\n    processNotationKey('w', global_cursor.CursorNote);\n  }\n\n  toggleMajorUpperMordent() {\n    processNotationKey('W', global_cursor.CursorNote);\n  }\n\n  toggleFermata() {\n    processNotationKey(';', global_cursor.CursorNote);\n  }\n\n  toggleArpeggio() {\n    processNotationKey(':', global_cursor.CursorNote);\n  }\n\n  toggleAccent() {\n    processNotationKey('^', global_cursor.CursorNote);\n  }\n\n  toggleMarcato() {\n    processNotationKey('^^', global_cursor.CursorNote);\n  }\n\n  toggleStaccatissimo() {\n    processNotationKey('`', global_cursor.CursorNote);\n  }\n\n  toggleTenuto() {\n    processNotationKey('~', global_cursor.CursorNote);\n  }\n\n  toggleMajorTrill() {\n    processNotationKey('T', global_cursor.CursorNote);\n  }\n\n  toggleMinorTrill() {\n    processNotationKey('t', global_cursor.CursorNote);\n  }\n\n  forceSlurAbove() {\n    processNotationKey('a', global_cursor.CursorNote);\n  }\n\n  forceSlurBelow() {\n    processNotationKey('b', global_cursor.CursorNote);\n  }\n\n  removeSlurOrientation() {\n    processNotationKey('c', global_cursor.CursorNote);\n  }\n\n  deleteSlur() {\n    processNotationKey('D', global_cursor.CursorNote);\n  }\n\n  forceBeamAbove() {\n    processNotationKey('a', global_cursor.CursorNote);\n  }\n\n  forceBeamBelow() {\n    processNotationKey('b', global_cursor.CursorNote);\n  }\n\n  removeBeamOrientation() {\n    processNotationKey('c', global_cursor.CursorNote);\n  }\n\n  forceTieAbove() {\n    processNotationKey('a', global_cursor.CursorNote);\n  }\n\n  forceTieBelow() {\n    processNotationKey('b', global_cursor.CursorNote);\n  }\n\n  removeTieOrientation() {\n    processNotationKey('c', global_cursor.CursorNote);\n  }\n\n  breakBeamAfterNote() {\n    processNotationKey('J', global_cursor.CursorNote);\n  }\n\n  breakBeamBeforeNote() {\n    processNotationKey('L', global_cursor.CursorNote);\n  }\n\n  makeRestInvisible() {\n    processNotationKey('y', global_cursor.CursorNote);\n  }\n\n  togglePedalDown() {\n    processNotationKey('p', global_cursor.CursorNote);\n  }\n\n  togglePedalUp() {\n    processNotationKey('P', global_cursor.CursorNote);\n  }\n\n  toggleGraceNoteStyle() {\n    processNotationKey('q', global_cursor.CursorNote);\n  }\n\n  toggleAtMark() {\n    processNotationKey('@', global_cursor.CursorNote);\n  }\n\n  addSlur(number) {\n    if (number < 10 && number > 1) {\n      var event = {};\n\n      // First store the buffer number in the number register:\n      switch (bufferNumber) {\n        case 0:\n          event.code = ZeroKey;\n          break;\n        case 1:\n          event.code = OneKey;\n          break;\n        case 2:\n          event.code = TwoKey;\n          break;\n        case 3:\n          event.code = ThreeKey;\n          break;\n        case 4:\n          event.code = FourKey;\n          break;\n        case 5:\n          event.code = FiveKey;\n          break;\n        case 6:\n          event.code = SixKey;\n          break;\n        case 7:\n          event.code = SevenKey;\n          break;\n        case 8:\n          event.code = EightKey;\n          break;\n        case 9:\n          event.code = NineKey;\n          break;\n        default:\n          console.log('UNKNOWN BUFFER:', bufferNumber);\n          return;\n      }\n\n      event.altKey = true;\n      processInterfaceKeyCommand(event);\n    }\n\n    processNotationKey('s', global_cursor.CursorNote);\n  }\n\n  nextHarmonicNote() {\n    goUpHarmonically(global_cursor.CursorNote);\n  }\n\n  previousHarmonicNote() {\n    goDownHarmonically(global_cursor.CursorNote);\n  }\n\n  nextMelodicNote() {\n    goToNextNoteOrRest(global_cursor.CursorNote.id);\n  }\n\n  previousMelodicNote() {\n    goToPreviousNoteOrRest(global_cursor.CursorNote.id);\n  }\n\n  pitchDownStep(number) {\n    if (number < 10 && number > 1) {\n      var event = {};\n\n      // First store the buffer number in the number register:\n      switch (bufferNumber) {\n        case 0:\n          event.code = ZeroKey;\n          break;\n        case 1:\n          event.code = OneKey;\n          break;\n        case 2:\n          event.code = TwoKey;\n          break;\n        case 3:\n          event.code = ThreeKey;\n          break;\n        case 4:\n          event.code = FourKey;\n          break;\n        case 5:\n          event.code = FiveKey;\n          break;\n        case 6:\n          event.code = SixKey;\n          break;\n        case 7:\n          event.code = SevenKey;\n          break;\n        case 8:\n          event.code = EightKey;\n          break;\n        case 9:\n          event.code = NineKey;\n          break;\n        default:\n          console.log('UNKNOWN BUFFER:', bufferNumber);\n          return;\n      }\n\n      event.altKey = true;\n      processInterfaceKeyCommand(event);\n    }\n    processNotationKey('transpose-down-step', global_cursor.CursorNote);\n  }\n\n  pitchUpStep(number) {\n    if (number < 10 && number > 1) {\n      var event = {};\n\n      // First store the buffer number in the number register:\n      switch (bufferNumber) {\n        case 0:\n          event.code = ZeroKey;\n          break;\n        case 1:\n          event.code = OneKey;\n          break;\n        case 2:\n          event.code = TwoKey;\n          break;\n        case 3:\n          event.code = ThreeKey;\n          break;\n        case 4:\n          event.code = FourKey;\n          break;\n        case 5:\n          event.code = FiveKey;\n          break;\n        case 6:\n          event.code = SixKey;\n          break;\n        case 7:\n          event.code = SevenKey;\n          break;\n        case 8:\n          event.code = EightKey;\n          break;\n        case 9:\n          event.code = NineKey;\n          break;\n        default:\n          console.log('UNKNOWN BUFFER:', bufferNumber);\n          return;\n      }\n\n      event.altKey = true;\n      processInterfaceKeyCommand(event);\n    }\n    processNotationKey('transpose-up-step', global_cursor.CursorNote);\n  }\n\n  pitchUpOctave(number) {\n    if (number < 10 && number > 1) {\n      var event = {};\n\n      // First store the buffer number in the number register:\n      switch (bufferNumber) {\n        case 0:\n          event.code = ZeroKey;\n          break;\n        case 1:\n          event.code = OneKey;\n          break;\n        case 2:\n          event.code = TwoKey;\n          break;\n        case 3:\n          event.code = ThreeKey;\n          break;\n        case 4:\n          event.code = FourKey;\n          break;\n        case 5:\n          event.code = FiveKey;\n          break;\n        case 6:\n          event.code = SixKey;\n          break;\n        case 7:\n          event.code = SevenKey;\n          break;\n        case 8:\n          event.code = EightKey;\n          break;\n        case 9:\n          event.code = NineKey;\n          break;\n        default:\n          console.log('UNKNOWN BUFFER:', bufferNumber);\n          return;\n      }\n\n      event.altKey = true;\n      processInterfaceKeyCommand(event);\n    }\n    processNotationKey('transpose-up-octave', global_cursor.CursorNote);\n  }\n\n  pitchDownOctave(number) {\n    if (number < 10 && number > 1) {\n      var event = {};\n\n      // First store the buffer number in the number register:\n      switch (bufferNumber) {\n        case 0:\n          event.code = ZeroKey;\n          break;\n        case 1:\n          event.code = OneKey;\n          break;\n        case 2:\n          event.code = TwoKey;\n          break;\n        case 3:\n          event.code = ThreeKey;\n          break;\n        case 4:\n          event.code = FourKey;\n          break;\n        case 5:\n          event.code = FiveKey;\n          break;\n        case 6:\n          event.code = SixKey;\n          break;\n        case 7:\n          event.code = SevenKey;\n          break;\n        case 8:\n          event.code = EightKey;\n          break;\n        case 9:\n          event.code = NineKey;\n          break;\n        default:\n          console.log('UNKNOWN BUFFER:', bufferNumber);\n          return;\n      }\n\n      event.altKey = true;\n      processInterfaceKeyCommand(event);\n    }\n    processNotationKey('transpose-down-octave', global_cursor.CursorNote);\n  }\n\n  moveSlurStart(number) {\n    if (number < 0) {\n      if (number < 10 && number > 1) {\n        number = -number;\n        var event = {};\n\n        // First store the buffer number in the number register:\n        switch (bufferNumber) {\n          case 0:\n            event.code = ZeroKey;\n            break;\n          case 1:\n            event.code = OneKey;\n            break;\n          case 2:\n            event.code = TwoKey;\n            break;\n          case 3:\n            event.code = ThreeKey;\n            break;\n          case 4:\n            event.code = FourKey;\n            break;\n          case 5:\n            event.code = FiveKey;\n            break;\n          case 6:\n            event.code = SixKey;\n            break;\n          case 7:\n            event.code = SevenKey;\n            break;\n          case 8:\n            event.code = EightKey;\n            break;\n          case 9:\n            event.code = NineKey;\n            break;\n          default:\n            console.log('UNKNOWN BUFFER:', bufferNumber);\n            return;\n        }\n\n        event.altKey = true;\n        processInterfaceKeyCommand(event);\n      }\n      processNotationKey('leftEndMoveBack', global_cursor.CursorNote);\n    } else {\n      if (number < 10 && number > 1) {\n        var event = {};\n\n        // First store the buffer number in the number register:\n        switch (bufferNumber) {\n          case 0:\n            event.code = ZeroKey;\n            break;\n          case 1:\n            event.code = OneKey;\n            break;\n          case 2:\n            event.code = TwoKey;\n            break;\n          case 3:\n            event.code = ThreeKey;\n            break;\n          case 4:\n            event.code = FourKey;\n            break;\n          case 5:\n            event.code = FiveKey;\n            break;\n          case 6:\n            event.code = SixKey;\n            break;\n          case 7:\n            event.code = SevenKey;\n            break;\n          case 8:\n            event.code = EightKey;\n            break;\n          case 9:\n            event.code = NineKey;\n            break;\n          default:\n            console.log('UNKNOWN BUFFER:', bufferNumber);\n            return;\n        }\n\n        event.altKey = true;\n        processInterfaceKeyCommand(event);\n      }\n      processNotationKey('leftEndMoveForward', global_cursor.CursorNote);\n    }\n  }\n\n  moveSlurEnd(number) {\n    if (number < 0) {\n      number = -number;\n      if (number < 10 && number > 1) {\n        var event = {};\n\n        // First store the buffer number in the number register:\n        switch (bufferNumber) {\n          case 0:\n            event.code = ZeroKey;\n            break;\n          case 1:\n            event.code = OneKey;\n            break;\n          case 2:\n            event.code = TwoKey;\n            break;\n          case 3:\n            event.code = ThreeKey;\n            break;\n          case 4:\n            event.code = FourKey;\n            break;\n          case 5:\n            event.code = FiveKey;\n            break;\n          case 6:\n            event.code = SixKey;\n            break;\n          case 7:\n            event.code = SevenKey;\n            break;\n          case 8:\n            event.code = EightKey;\n            break;\n          case 9:\n            event.code = NineKey;\n            break;\n          default:\n            console.log('UNKNOWN BUFFER:', bufferNumber);\n            return;\n        }\n\n        event.altKey = true;\n        processInterfaceKeyCommand(event);\n      }\n      processNotationKey('rightEndMoveBack', global_cursor.CursorNote);\n    } else {\n      if (number < 10 && number > 1) {\n        var event = {};\n\n        // First store the buffer number in the number register:\n        switch (bufferNumber) {\n          case 0:\n            event.code = ZeroKey;\n            break;\n          case 1:\n            event.code = OneKey;\n            break;\n          case 2:\n            event.code = TwoKey;\n            break;\n          case 3:\n            event.code = ThreeKey;\n            break;\n          case 4:\n            event.code = FourKey;\n            break;\n          case 5:\n            event.code = FiveKey;\n            break;\n          case 6:\n            event.code = SixKey;\n            break;\n          case 7:\n            event.code = SevenKey;\n            break;\n          case 8:\n            event.code = EightKey;\n            break;\n          case 9:\n            event.code = NineKey;\n            break;\n          default:\n            console.log('UNKNOWN BUFFER:', bufferNumber);\n            return;\n        }\n\n        event.altKey = true;\n        processInterfaceKeyCommand(event);\n      }\n      processNotationKey('rightEndMoveForward', global_cursor.CursorNote);\n    }\n  }\n  //////////////////////////////\n  //\n  // MenuInterface::adjustNotationScale -- add or subtract the input value,\n  //     not going below 15 or above 500.\n  //\n  adjustNotationScale(event, number) {\n    if (event && event.shiftKey) {\n      global_verovioOptions.SCALE = 40;\n    } else {\n      global_verovioOptions.SCALE = parseInt(\n        global_verovioOptions.SCALE * number + 0.5\n      );\n      if (global_verovioOptions.SCALE < 15) {\n        global_verovioOptions.SCALE = 15;\n      } else if (global_verovioOptions.SCALE > 500) {\n        global_verovioOptions.SCALE = 500;\n      }\n    }\n    localStorage.SCALE = global_verovioOptions.SCALE;\n\n    displayNotation();\n  }\n\n  // setLanguage(lang) {\n  // \twindow.LANGUAGE = lang;\n\n  // \t// Use handlebars to generate HTML code for menu.\n  // \tvar tsource = document.querySelector(\"#template-menu\").textContent;\n  // \tvar menuTemplate = window.Handlebars.compile(tsource);\n  // \tvar output = menuTemplate(MENUDATA);\n  // \tvar newmenuelement = document.querySelector(\"#menu-div\");\n  // \tif (newmenuelement) {\n  // \t\tnewmenuelement.innerHTML = output;\n  // \t}\n  // }\n\n  increaseTextFontSize(event) {\n    if (event.shiftKey) {\n      global_editorOptions.INPUT_FONT_SIZE = 1.0;\n    } else {\n      global_editorOptions.INPUT_FONT_SIZE *= 1.05;\n      if (global_editorOptions.INPUT_FONT_SIZE > 3.0) {\n        global_editorOptions.INPUT_FONT_SIZE = 3.0;\n      }\n    }\n    var element = document.querySelector('#input');\n    if (!element) {\n      return;\n    }\n    element.style.fontSize = global_editorOptions.INPUT_FONT_SIZE + 'rem';\n    localStorage.INPUT_FONT_SIZE = global_editorOptions.INPUT_FONT_SIZE;\n  }\n\n  resetTextFontSize(event) {\n    global_editorOptions.INPUT_FONT_SIZE = 1.0;\n    var element = document.querySelector('#input');\n    if (!element) {\n      return;\n    }\n    element.style.fontSize = global_editorOptions.INPUT_FONT_SIZE + 'rem';\n    localStorage.INPUT_FONT_SIZE = global_editorOptions.INPUT_FONT_SIZE;\n  }\n\n  decreaseTextFontSize(event) {\n    if (event.shiftKey) {\n      global_editorOptions.INPUT_FONT_SIZE = 1.0;\n    } else {\n      global_editorOptions.INPUT_FONT_SIZE *= 0.95;\n      if (global_editorOptions.INPUT_FONT_SIZE < 0.25) {\n        global_editorOptions.INPUT_FONT_SIZE = 0.25;\n      }\n    }\n    var element = document.querySelector('#input');\n    if (!element) {\n      return;\n    }\n    element.style.fontSize = global_editorOptions.INPUT_FONT_SIZE + 'rem';\n    localStorage.INPUT_FONT_SIZE = global_editorOptions.INPUT_FONT_SIZE;\n  }\n\n  lineBreaksOff() {\n    global_verovioOptions.BREAKS = true;\n    // toggleLineBreaks();\n  }\n\n  lineBreaksOn() {\n    global_verovioOptions.BREAKS = false;\n    // toggleLineBreaks();\n  }\n\n  singlePageView() {\n    var element = document.querySelector('#page-nav');\n    if (element) {\n      element.style.display = 'none';\n    }\n    var element2 = document.querySelector('#multi-page');\n    if (element2) {\n      element2.style.display = 'block';\n    }\n    displayNotation();\n  }\n\n  multiPageView() {\n    return; // disabled until fix for issue https://github.com/rism-digital/verovio/issues/2034\n    window.PAGED = true;\n    var element = document.querySelector('#page-nav');\n    if (element) {\n      element.style.display = 'block';\n    }\n    var element2 = document.querySelector('#multi-page');\n    if (element2) {\n      element2.style.display = 'none';\n    }\n    displayNotation();\n  }\n\n  startSplit(count) {\n    if (!count) {\n      count = 32;\n    }\n    MenuInterface.prototype.removeSplits();\n    var lines = editor.getValue().match(/[^\\r\\n]+/g);\n    var position = editor.getCursorPosition();\n    var output;\n    var counter = 0;\n    var adjust = 0;\n    var change = 0;\n    var i;\n    for (i = 0; i < lines.length; i++) {\n      if (lines[i].match(/^=/)) {\n        counter++;\n        if (counter == count) {\n          lines[i] = '!!ignore\\n' + lines[i];\n          if (i > lines.row) {\n            adjust++;\n          }\n          change = 1;\n          break;\n        }\n      }\n    }\n    if (!change) {\n      return;\n    }\n    var output = '';\n    for (i = 0; i < lines.length; i++) {\n      output += lines[i] + '\\n';\n    }\n    editor.setValue(output, -1);\n    position.row += adjust;\n    editor.moveCursorToPosition(position);\n  }\n\n  nextSplit(count) {\n    if (!count) {\n      count = 32;\n    }\n    var lines = editor.getValue().match(/[^\\r\\n]+/g);\n    var position = editor.getCursorPosition();\n    if (lines.length == 0) {\n      return;\n    }\n    var i;\n    var adjust = 0;\n    var changed = 0;\n    var startpos = -1;\n    var counter = 0;\n    for (i = 1; i < lines.length; i++) {\n      if (lines[i] === '!!Xignore') {\n        lines[i] = 'XXX DELETE XXX';\n        changed = 1;\n        continue;\n      } else if (lines[i] === '!!ignore') {\n        lines[i] = '!!Xignore';\n        changed = 1;\n        startpos = i;\n        break;\n      }\n    }\n    if (!changed) {\n      return;\n    }\n    // mark count measures later with !!ignore\n    for (i = startpos + 1; i < lines.length; i++) {\n      if (lines[i].match(/^=/)) {\n        counter++;\n        if (counter == count) {\n          lines[i] = '!!ignore\\n' + lines[i];\n          if (i > lines.row) {\n            adjust++;\n          }\n          // Was declared global\n          var change = 1;\n          break;\n        }\n      }\n    }\n    if (lines[0] !== '!!ignore') {\n      lines[0] = '!!ignore\\n' + lines[0];\n      adjust++;\n    }\n    var output = '';\n    for (i = 0; i < lines.length; i++) {\n      if (lines[i] === 'XXX DELETE XXX') {\n        continue;\n      }\n      output += lines[i] + '\\n';\n    }\n    editor.setValue(output, -1);\n    position.row += adjust;\n    editor.moveCursorToPosition(position);\n  }\n\n  previousSplit(count) {\n    if (!count) {\n      count = 32;\n    }\n    var lines = editor.getValue().match(/[^\\r\\n]+/g);\n    var position = editor.getCursorPosition();\n    if (lines.length == 0) {\n      return;\n    }\n    var i;\n    var adjust = 0;\n    var changed = 0;\n    var startpos = -1;\n    var counter = 0;\n    for (i = 1; i < lines.length; i++) {\n      if (lines[i] === '!!Xignore') {\n        lines[i] = '!!ignore';\n        changed = 1;\n        startpos = i;\n      } else if (lines[i] === '!!ignore') {\n        lines[i] = 'XXX DELETE XXX';\n      }\n    }\n    if (!changed) {\n      return;\n    }\n\n    // mark count measures later with !!ignore\n    for (i = startpos - 2; i > 0; i--) {\n      if (lines[i].match(/^=/)) {\n        counter++;\n        if (counter == count - 1) {\n          lines[i] = '!!Xignore\\n' + lines[i];\n          if (i > lines.row) {\n            adjust++;\n          }\n          // Was declared global\n          var change = 1;\n          break;\n        }\n      }\n    }\n    if (lines[0] !== '!!ignore') {\n      lines[0] = '!!ignore\\n' + lines[0];\n      adjust++;\n    }\n    var output = '';\n    for (i = 0; i < lines.length; i++) {\n      if (lines[i] === 'XXX DELETE XXX') {\n        continue;\n      }\n      output += lines[i] + '\\n';\n    }\n    editor.setValue(output, -1);\n    position.row += adjust;\n    editor.moveCursorToPosition(position);\n  }\n\n  removeSplits() {\n    var lines = editor.getValue().match(/[^\\r\\n]+/g);\n    var output = '';\n    var position = editor.getCursorPosition();\n    var row = position.row;\n    var col = position.column;\n    var change = 0;\n    for (var i = 0; i < lines.length; i++) {\n      if (lines[i] === '!!ignore') {\n        if (i < row) {\n          row--;\n        }\n        change++;\n        continue;\n      }\n      if (lines[i] === '!!Xignore') {\n        if (i < row) {\n          row--;\n        }\n        change++;\n        continue;\n      }\n      output += lines[i] + '\\n';\n    }\n    if (change) {\n      editor.setValue(output, -1);\n      position.row = row;\n      editor.moveCursorToPosition(position);\n    }\n  }\n\n  undo() {\n    editor.undo();\n  }\n\n  convertToHumdrum() {\n    replaceEditorContentWithHumdrumFile();\n  }\n\n  trimTabsInEditor() {\n    trimTabsInEditor();\n  }\n\n  mimeEncode() {\n    var text = getTextFromEditorNoCsvProcessing();\n    var lines = btoa(text).match(/.{1,80}/g);\n    var output = '';\n    for (var i = 0; i < lines.length; i++) {\n      if (i < lines.length - 1) {\n        output += lines[i] + '\\n';\n      } else {\n        output += lines[i].replace(/=/g, '') + '\\n';\n      }\n    }\n    editor.setValue(output, -1);\n  }\n\n  mimeDecode() {\n    var text = getTextFromEditorNoCsvProcessing();\n    // text is already decoded by getTextFromEditor().\n    editor.setValue(text, -1);\n  }\n\n  convertToMusicXmlAndSave() {\n    convertToMusicXmlAndSave();\n  }\n}\n\nlet menuInterface;\nexport function getMenu() {\n  if (typeof menuInterface === 'undefined') {\n    menuInterface = new MenuInterface();\n    menuInterface.initialize();\n  }\n\n  return menuInterface;\n}\n\nlet vrvWorker = getVrvWorker();\nif (!vrvWorker) {\n  throw new Error('Verovio worker is undefined');\n}\n\nlet editor = getAceEditor();\nif (!editor) {\n  throw new Error('Ace Editor is undefined');\n}\n","/* global $ */\n\n//////////////////////////////\n//\n// goDownHarmonically --\n//\n\nexport function goDownHarmonically(current) {\n  moveHarmonically(current, -1);\n}\n\n//////////////////////////////\n//\n// goUpHarmonically --\n//\n\nexport function goUpHarmonically(current) {\n  moveHarmonically(current, +1);\n}\n\n//////////////////////////////\n//\n// moveHarmonically --\n//\n\nfunction moveHarmonically(current, direction) {\n  if (!current) {\n    return;\n  }\n  var startid = current.id;\n  unhighlightCurrentNote(current);\n  var nextid = getNextHarmonicNote(startid, direction);\n  if (!nextid) {\n    return;\n  }\n  highlightIdInEditor(nextid, 'moveHarmonically');\n}\n\n//////////////////////////////\n//\n// inSvgImage -- Used to prevent processing clicks in the text\n//      editor for the click event listener used in the SVG image.\n//      Returns true if the node is inside of an SVG image, or\n//      false otherwise.\n//\n\nexport function inSvgImage(node) {\n  var current = node;\n  while (current) {\n    if (current.nodeName === 'svg') {\n      return true;\n    }\n    current = current.parentNode;\n  }\n  return false;\n}\n\n//////////////////////////////\n//\n// observeSVGContent --\n//\n\nexport function observeSvgContent() {\n  var content = document.querySelector('#output');\n  var i;\n  var s;\n  var callback = function (mList, observer) {\n    var svg = content.querySelector('svg');\n    if (svg) {\n      // Mark encoding problem messages with red caution symbol.\n      let spans = svg.querySelectorAll(\n        'g.dir.problem tspan.rend tspan.text tspan.text'\n      );\n      for (i = 0; i < spans.length; i++) {\n        s = spans[i];\n        if (s.innerHTML === 'P') {\n          s.innerHTML = '&#xf071;';\n          s.classList.add('p');\n        }\n      }\n\n      // Mark encoding problem messages with green caution symbol.\n      spans = svg.querySelectorAll(\n        'g.dir.sic tspan.rend tspan.text tspan.text'\n      );\n      for (i = 0; i < spans.length; i++) {\n        s = spans[i];\n        if (s.innerHTML === 'S') {\n          s.innerHTML = '&#xf071;';\n          s.classList.add('s');\n        }\n      }\n    }\n\n    for (var mu in mList) {\n      if (svg && svg.isSameNode(mList[mu].target)) {\n        //remove busy class if svg changed\n        document.body.classList.remove('busy');\n      }\n    }\n  };\n  var observer = new MutationObserver(callback);\n\n  observer.observe(content, { childList: true, subtree: true });\n}\n\n//////////////////////////////\n//\n// turnOffAllHighlights -- Remove highlights from all svg elements.\n//\n\nexport function turnOffAllHighlights() {\n  var svg = document.querySelector('svg');\n  var highlights = svg.querySelectorAll('.highlight');\n  for (var i = 0; i < highlights.length; i++) {\n    var cname = highlights[i].className.baseVal;\n    cname = cname.replace(/\\bhighlight\\b/, '');\n    highlights[i].className.className = cname;\n    highlights[i].className.baseVal = cname;\n    highlights[i].className.animVal = cname;\n  }\n}\n\n//////////////////////////////\n//\n// getNextHarmonicNote --\n//\n\nfunction getNextHarmonicNote(startid, direction) {\n  var match = startid.match(/^[^-]+-[^-]*L(\\d+)/);\n  var startline = -1;\n  if (match) {\n    startline = parseInt(match[1]);\n  } else {\n    return undefined;\n  }\n  if (startline == -1) {\n    return undefined;\n  }\n  // Assuming one svg on the page, which is currently correct.\n  var svg = document.querySelector('svg');\n  var allids = svg.querySelectorAll('*[id]:not([id=\"\"])');\n  var regex = new RegExp('^[^-]+-[^-]*L' + startline + '(?!d)');\n  var harmonic = [];\n  var x;\n  var i;\n  for (i = 0; i < allids.length; i++) {\n    if (allids[i].id.match(regex)) {\n      x = allids[i].id.replace(/-.*/, '');\n      if (!(x == 'note' || x == 'rest' || x == 'mrest')) {\n        // only keep track of certain types of elements\n        // should chords be included or not? currently not.\n        continue;\n      }\n      harmonic.push(allids[i]);\n    }\n  }\n  harmonic.sort(function (a, b) {\n    var aloc = getStaffAndLayerNumbersByElement(a);\n    var bloc = getStaffAndLayerNumbersByElement(b);\n    var astaff = aloc.staff | 0;\n    var bstaff = bloc.staff | 0;\n    var alayer = aloc.layer | 0;\n    var blayer = bloc.layer | 0;\n\n    if (astaff > bstaff) {\n      return -1;\n    }\n    if (astaff < bstaff) {\n      return +1;\n    }\n    if (alayer > blayer) {\n      return -1;\n    }\n    if (alayer < blayer) {\n      return +1;\n    }\n\n    // notes are in a chord so sort by pitch from low to high\n    var match;\n    var aoct = 0;\n    var boct = 0;\n    var ab40 = 0;\n    var bb40 = 0;\n    if ((match = a.className.baseVal.match(/oct-(-?\\d+)/))) {\n      aoct = parseInt(match[1]);\n    }\n    if ((match = b.className.baseVal.match(/oct-(-?\\d+)/))) {\n      boct = parseInt(match[1]);\n    }\n    if ((match = a.className.baseVal.match(/b40c-(\\d+)/))) {\n      ab40 = aoct * 40 + parseInt(match[1]);\n    }\n    if ((match = b.className.baseVal.match(/b40c-(\\d+)/))) {\n      bb40 = boct * 40 + parseInt(match[1]);\n    }\n    if (ab40 < bb40) {\n      return -1;\n    }\n    if (ab40 > bb40) {\n      return +1;\n    }\n    return 0;\n  });\n  if (harmonic.length == 1) {\n    // nothing to do\n    return undefined;\n  }\n  for (var j = 0; j < harmonic.length; j++) {\n    var oc = getStaffAndLayerNumbersByElement(harmonic[j]);\n  }\n  var startingindex = -1;\n  for (i = 0; i < harmonic.length; i++) {\n    if (harmonic[i].id === startid) {\n      startingindex = i;\n      break;\n    }\n  }\n  if (startingindex < 0) {\n    return undefined;\n  }\n  var index = startingindex + direction;\n  if (index < 0) {\n    index = harmonic.length - 1;\n  } else if (index >= harmonic.length) {\n    index = 0;\n  }\n  return harmonic[index].id;\n}\n\n//////////////////////////////\n//\n// unhighlightCurrentNote --\n//\n\nfunction unhighlightCurrentNote(element) {\n  if (element) {\n    var classes = element.getAttribute('class');\n    var classlist = classes.split(' ');\n    var outclass = '';\n    for (var i = 0; i < classlist.length; i++) {\n      if (classlist[i] == 'highlight') {\n        continue;\n      }\n      outclass += ' ' + classlist[i];\n    }\n    element.setAttribute('class', outclass);\n  }\n}\n\n//////////////////////////////\n//\n// chooseBestId -- Match to the staff number and the layer number of the\n//    original element.  The original element could be unattached from the\n//    current SVG image, so its id is passed to this\n//\n\nfunction chooseBestId(elist, targetstaff, targetlayer) {\n  var staffelements = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\n  for (var i = 0; i < elist.length; i++) {\n    var location = getStaffAndLayerNumbers(elist[i].id);\n    if (location.staff == targetstaff) {\n      staffelements[location.layer] = elist[i];\n      if (location.layer == targetlayer && !elist[i].id.match(/space/)) {\n        return elist[i].id;\n      }\n    }\n  }\n  // no exact match, so try a different layer on the same staff.\n  if (staffelements.length == 1) {\n    // only one choice so use it\n    return staffelements[0].id;\n  }\n\n  // find a note/rest in a lower layer\n  for (i = targetlayer; i > 0; i--) {\n    if (!staffelements[i]) {\n      continue;\n    }\n    if (staffelements[i].id) {\n      if (staffelements[i].id.match(/space/)) {\n        continue;\n      }\n    }\n    return staffelements[i].id;\n  }\n\n  // find a note/rest in a higher layer\n  for (i = targetlayer; i < staffelements.length; i++) {\n    if (!staffelements[i]) {\n      continue;\n    }\n    if (staffelements[i].id) {\n      if (staffelements[i].id.match(/space/)) {\n        continue;\n      }\n    }\n    return staffelements[i].id;\n  }\n\n  // go back and allow matching to invisible rests\n\n  // find a note/rest in a lower layer\n  for (i = targetlayer; i > 0; i--) {\n    if (!staffelements[i]) {\n      continue;\n    }\n    return staffelements[i].id;\n  }\n\n  // find a note/rest in a higher layer\n  for (i = targetlayer; i < staffelements.length; i++) {\n    if (!staffelements[i]) {\n      continue;\n    }\n    return staffelements[i].id;\n  }\n\n  // found nothing suitable\n  return undefined;\n}\n\n//////////////////////////////\n//\n// getStaffPosition -- Return the nth position of a <staff> elemnet within a\n//   measure.\n//\n\nfunction getStaffPosition(element) {\n  var count = 0;\n  var current = element;\n  while (current) {\n    if (current.className.baseVal.match(/staff/)) {\n      count++;\n    }\n    current = current.previousElementSibling;\n  }\n  return count;\n}\n\n//////////////////////////////\n//\n// getLayerPosition -- Return the nth position of a <layer> elemnet within a\n//   staff.\n//\n\nfunction getLayerPosition(element) {\n  var count = 0;\n  var current = element;\n  while (current) {\n    if (current.className.baseVal.match(/layer/)) {\n      count++;\n    }\n    current = current.previousElementSibling;\n  }\n  return count;\n}\n\n//////////////////////////////\n//\n// getStaffAndLayerNumbers -- Return the staff and layer number of the\n//   location of the given id's element.  The layer and staff numbers\n//   are zero indexed to match MEI's enumeration (but this is not\n//   necessary).\n//\n\nfunction getStaffAndLayerNumbers(id) {\n  var element = document.querySelector('#' + id);\n  return getStaffAndLayerNumbersByElement(element);\n}\n\nfunction getStaffAndLayerNumbersByElement(element) {\n  if (!element) {\n    return {};\n  }\n  var id = element.id;\n  var staff = 0;\n  var layer = 0;\n  var current = element;\n\n  current = current.parentNode;\n  while (current && current.className.baseVal) {\n    // console.log(\"CURRENT\", current.className.baseVal);\n    if (current.className.baseVal.match(/layer/)) {\n      layer = getLayerPosition(current);\n    } else if (current.className.baseVal.match(/staff/)) {\n      staff = getStaffPosition(current);\n    }\n    current = current.parentNode;\n  }\n  return {\n    layer: layer,\n    staff: staff,\n  };\n}\n\n//////////////////////////////\n//\n// getOffClassElements --\n//\n\nfunction getOffClassElements(offclass) {\n  var nlist = document.querySelectorAll('.' + offclass);\n  var rlist = document.querySelectorAll('.r' + offclass);\n  var alist = [];\n  for (var i = 0; i < nlist.length; i++) {\n    // Was declared as global\n    let match = nlist[i].className.baseVal.match(/qon-([^\\s]+)/);\n    if (match) {\n      // Was declared as global\n      var qon = match[1];\n    } else {\n      qon = 'xyz';\n    }\n\n    match = nlist[i].className.baseVal.match(/qoff-([^\\s]+)/);\n    if (match) {\n      // Was declared global\n      var qoff = match[1];\n    } else {\n      qoff = 'xyz';\n    }\n    if (qon === qoff) {\n      // no grace notes\n      continue;\n    }\n\n    alist.push(nlist[i]);\n  }\n  for (var i = 0; i < rlist.length; i++) {\n    alist.push(rlist[i]);\n  }\n  return alist;\n}\n\n//////////////////////////////\n//\n// getOnClassElements --\n//\n\nfunction getOnClassElements(onclass) {\n  var nlist = document.querySelectorAll('.' + onclass);\n  var rlist = document.querySelectorAll('.r' + onclass);\n  var alist = [];\n  var match;\n  var qon;\n  var qoff;\n  for (var i = 0; i < nlist.length; i++) {\n    match = nlist[i].className.baseVal.match(/qon-([^\\s]+)/);\n    if (match) {\n      qon = match[1];\n    } else {\n      qon = 'xyz';\n    }\n\n    match = nlist[i].className.baseVal.match(/qoff-([^\\s]+)/);\n    if (match) {\n      qoff = match[1];\n    } else {\n      qoff = 'xyz';\n    }\n    if (qon === qoff) {\n      // no grace notes\n      continue;\n    }\n\n    alist.push(nlist[i]);\n  }\n  for (var i = 0; i < rlist.length; i++) {\n    alist.push(rlist[i]);\n  }\n  return alist;\n}\n\n//////////////////////////////\n//\n// goToPreviousNoteOrRest --\n//\nimport { getVrvWorker } from '../humdrum-notation-plugin-worker.js';\nimport { getMenu } from '../menu.js';\nimport { chord } from './chords.js';\nimport { global_cursor, global_editorOptions } from './global-variables.js';\n\nlet vrvWorker = getVrvWorker();\nif (!vrvWorker) {\n  throw new Error('Verovio worker is undefined');\n}\n\nexport function goToPreviousNoteOrRest(currentid) {\n  var current = document.querySelector('#' + currentid);\n  if (!current) {\n    console.log('CANNOT FIND ITEM ', currentid);\n    return;\n  }\n  var location = getStaffAndLayerNumbers(current.id);\n  var matches = current.className.baseVal.match(/qon-([^\\s]+)/);\n  if (!matches) {\n    console.log('CANNOT FIND QON IN', current.className);\n    return;\n  }\n  var qon = matches[1];\n  if (qon == 0) {\n    // cannot go before start of work\n    return;\n  }\n  // Was declared global\n  var offclass = 'qoff-' + qon;\n  var alist = getOffClassElements(offclass);\n  var nextid;\n  if (!alist) {\n    return;\n  }\n  unhighlightCurrentNote(current);\n  if (alist.length == 1) {\n    highlightIdInEditor(alist[0].id, 'goToPreviousNoteOrRest');\n  } else if (alist.length == 0) {\n    // gotoNextPage();\n    if (vrvWorker.page == 1) {\n      // at first page, so don't do anything.\n      console.log('AT FIRST PAGE, so not continuing further');\n      return;\n    }\n    vrvWorker.gotoPage(vrvWorker.page - 1).then(function (obj) {\n      // loadPage(vrvWorker.page);\n      var page = obj.page || vrvWorker.page;\n      $('#overlay').hide().css('cursor', 'auto');\n      $('#jump_text').val(page);\n      vrvWorker\n        .renderPage(page)\n        .then(function (svg) {\n          $('#output').html(svg);\n          // adjustPageHeight();\n          // resizeImage();\n        })\n        .then(function () {\n          alist = getOnClassElements(offclass);\n          if (alist.length == 1) {\n            highlightIdInEditor(alist[0].id, 'goToPreviousNoteOrRest2');\n          } else {\n            nextid = chooseBestId(alist, location.staff, location.layer);\n            if (nextid) {\n              global_editorOptions.EDITINGID = nextid;\n              highlightIdInEditor(nextid, 'goToPreviousNoteOrRest3');\n            }\n          }\n        });\n    });\n  } else {\n    nextid = chooseBestId(alist, location.staff, location.layer);\n    if (nextid) {\n      global_editorOptions.EDITINGID = nextid;\n      highlightIdInEditor(nextid, 'goToPreviousNoteOrRest4');\n    }\n  }\n}\n\n//////////////////////////////\n//\n// goToNextNoteOrRest -- current is the value of global variable global_cursor.CursorNote.\n//    This function moves the cursor to the next note or rest in the spine\n//    or subspine.  This is accomplished by examing the timestamps of the\n//    notes and rests in the currently viewed SVG image generated by verovio.\n//\n\nexport function goToNextNoteOrRest(currentid) {\n  var current = document.querySelector('#' + currentid);\n  if (!current) {\n    return;\n  }\n  var location = getStaffAndLayerNumbers(current.id);\n  var matches = current.className.baseVal.match(/qoff-([^\\s]+)/);\n  if (!matches) {\n    return;\n  }\n  var qoff = matches[1];\n  var onclass = 'qon-' + qoff;\n  var alist = getOnClassElements(onclass);\n  var nextid;\n  if (!alist) {\n    return;\n  }\n  unhighlightCurrentNote(current);\n\n  if (alist.length == 1) {\n    highlightIdInEditor(alist[0].id, 'goToNextNoteOrRest');\n  } else if (alist.length == 0) {\n    // console.log(\"NO ELEMENT FOUND (ON NEXT PAGE?)\");\n    // gotoNextPage();\n    if (vrvWorker.pageCount > 0 && vrvWorker.pageCount == vrvWorker.page) {\n      // at last page, so don't do anything.\n      // console.log(\"AT LAST PAGE, so not continuing further\");\n      return;\n    }\n    vrvWorker.gotoPage(vrvWorker.page + 1).then(function (obj) {\n      // loadPage(vrvWorker.page);\n      var page = obj.page || vrvWorker.page;\n      $('#overlay').hide().css('cursor', 'auto');\n      $('#jump_text').val(page);\n      vrvWorker\n        .renderPage(page)\n        .then(function (svg) {\n          $('#output').html(svg);\n          // adjustPageHeight();\n          // resizeImage();\n        })\n        .then(function () {\n          alist = getOnClassElements(onclass);\n          if (alist.length == 1) {\n            highlightIdInEditor(alist[0].id, 'goToNextNoteOrRest2');\n          } else {\n            nextid = chooseBestId(alist, location.staff, location.layer);\n            if (nextid) {\n              global_editorOptions.EDITINGID = nextid;\n              highlightIdInEditor(nextid, 'goToNextNoteOrRest3');\n            }\n          }\n        });\n    });\n  } else {\n    nextid = chooseBestId(alist, location.staff, location.layer);\n    if (nextid) {\n      global_editorOptions.EDITINGID = nextid;\n      highlightIdInEditor(nextid, 'goToNextNoteOrRest4');\n    }\n  }\n}\n\n//////////////////////////////\n//\n// toggleAppoggiaturaColoring -- turn appoggiatura color highlighting on/off.\n//\n\nexport function toggleAppoggiaturaColoring() {\n  // Was declared global\n  var stylesheet = document.querySelector('#appoggiatura-color-stylesheet');\n  if (stylesheet) {\n    var parentElement = stylesheet.parentNode;\n    parentElement.removeChild(stylesheet);\n    return;\n  }\n  stylesheet = document.createElement('style');\n  var text = '';\n  text += 'g.appoggiatura-start { fill: limegreen; }';\n  text += 'g.appoggiatura-stop { fill: forestgreen; }';\n  stylesheet.innerHTML = text;\n  stylesheet.id = 'appoggiatura-color-stylesheet';\n  document.body.appendChild(stylesheet);\n}\n\n//////////////////////////////\n//\n// toggleLayerColoring -- turn layer color highlighting on/off.\n//\n\nexport function toggleLayerColoring() {\n  // Was declared global\n  var stylesheet = document.querySelector('#layer-color-stylesheet');\n  if (stylesheet) {\n    var parentElement = stylesheet.parentNode;\n    parentElement.removeChild(stylesheet);\n    return;\n  }\n  stylesheet = document.createElement('style');\n  var text = '';\n  text += \"g[id^='layer-'][id*='N2'] { fill: #00cc00; }\\n\";\n  text += \"g[id^='layer-'][id*='N3'] { fill: #cc00aa; }\\n\";\n  text += \"g[id^='layer-'][id*='N4'] { fill: #0088cc; }\\n\";\n  text += \"g[id^='layer-'][id*='N5'] { fill: #0000cc; }\\n\";\n  text += \"g[id^='layer-'][id*='N6'] { fill: #cc0000; }\\n\";\n  text += \"g[id^='layer-'][id*='N7'] { fill: #00cc00; }\\n\";\n  // Disable highlighting of clefs in layers:\n  text += 'g.clef { fill: black !important; }';\n  stylesheet.innerHTML = text;\n  stylesheet.id = 'layer-color-stylesheet';\n  document.body.appendChild(stylesheet);\n}\n\n//////////////////////////////\n//\n// togglePlaceColoring -- turn explicitly placed item highlighting on/off.\n//\n\nexport function togglePlaceColoring() {\n  // Was declared global\n  var stylesheet = document.querySelector('#placed-color-stylesheet');\n  if (stylesheet) {\n    var parentElement = stylesheet.parentNode;\n    parentElement.removeChild(stylesheet);\n    return;\n  }\n  stylesheet = document.createElement('style');\n  var text = 'g.placed { fill: orange; } ';\n  text += 'g.placed path { stroke: orange; } ';\n  stylesheet.innerHTML = text;\n  stylesheet.id = 'placed-color-stylesheet';\n  document.body.appendChild(stylesheet);\n}\n\n///////////////////////////////////\n//\n// restoreSelectedSvgElement -- Need to generalize to multiple pages.\n//\n\nexport function restoreSelectedSvgElement(id) {\n  if (!id) {\n    return;\n  }\n  var item = document.querySelector('#' + id);\n  if (!item) {\n    return;\n  }\n  var line;\n  var matches = id.match(/L(\\d+)/);\n  if (matches) {\n    line = parseInt(line);\n    0;\n  } else {\n    return;\n  }\n  markItem(item, line);\n}\n\n//////////////////////////////\n//\n// markItem -- Used by highlightNoteInScore.\n//\nimport { setCursorNote } from './misc.js';\nimport { getAceEditor } from './setup.js';\n\nexport function markItem(item, line) {\n  // console.log('markItem', {item, line, CursorNote: global_cursor.CursorNote})\n  if (!item) {\n    item = global_cursor.CursorNote;\n  }\n  if (!item) {\n    return;\n  }\n  global_editorOptions.EditorLine = line;\n  // This case is not good for editing a note:\n  //if (global_cursor.CursorNote && item && (global_cursor.CursorNote.id == item.id)) {\n  //\tconsole.log(\"THE SAME NOTE\");\n  //\treturn;\n  //}\n  if (global_cursor.CursorNote) {\n    // console.log(\"TURNING OFF OLD NOTE\", global_cursor.CursorNote);\n    /// global_cursor.CursorNote.setAttribute(\"fill\", \"#000\");\n    // global_cursor.CursorNote.removeAttribute(\"fill\");\n\n    var classes = global_cursor.CursorNote.getAttribute('class');\n    var classlist = classes.split(' ');\n    var outclass = '';\n    for (var i = 0; i < classlist.length; i++) {\n      if (classlist[i] == 'highlight') {\n        continue;\n      }\n      outclass += ' ' + classlist[i];\n    }\n    outclass = outclass.replace(/^\\s+/, '');\n    global_cursor.CursorNote.setAttribute('class', outclass);\n  }\n  if (item) {\n    setCursorNote(item, 'markItem');\n  }\n  if (global_cursor.CursorNote) {\n    // console.log(\"TURNING ON NEW NOTE\", global_cursor.CursorNote);\n    // global_cursor.CursorNote.setAttribute(\"fill\", \"#c00\");\n\n    var classes = global_cursor.CursorNote.getAttribute('class');\n    var classlist = classes.split(' ');\n    var outclass = '';\n    for (var i = 0; i < classlist.length; i++) {\n      if (classlist[i] == 'highlight') {\n        continue;\n      }\n      outclass += ' ' + classlist[i];\n    }\n    outclass += ' highlight';\n    global_cursor.CursorNote.setAttribute('class', outclass);\n  }\n}\n\n//////////////////////////////\n//\n// unhighlightAllElements --\n//\n\nfunction unhighlightAllElements() {\n  if (!global_cursor.CursorNote) {\n    return;\n  }\n  var hilights = document.querySelectorAll('svg .highlight');\n  for (var i = 0; i < hilights.length; i++) {\n    var classes = global_cursor.CursorNote.getAttribute('class');\n    var classlist = classes.split(' ');\n    var outclass = '';\n    for (var i = 0; i < classlist.length; i++) {\n      if (classlist[i] == 'highlight') {\n        continue;\n      }\n      outclass += ' ' + classlist[i];\n    }\n    outclass = outclass.replace(/^\\s+/, '');\n    global_cursor.CursorNote.setAttribute('class', outclass);\n  }\n}\n\n//////////////////////////////\n//\n// highlightIdInEditor --\n//\nimport { centerCursorHorizontallyInEditor } from './utility-ace.js';\n\nexport function highlightIdInEditor(id, source) {\n  //alx_\n  unhighlightAllElements(id);\n\n  if (!id) {\n    // no element (off of page or outside of musical range\n    console.log('NO ID so not changing to another element');\n    return;\n  }\n  let matches = id.match(/^([^-]+)-[^-]*L(\\d+)F(\\d+)/);\n  if (!matches) {\n    return;\n  }\n\n  var etype = matches[1];\n  var row = matches[2];\n  var field = matches[3];\n  var subtoken = 0;\n  if ((matches = id.match(/-.*L\\d+F\\d+S(\\d+)/))) {\n    subtoken = matches[1];\n  }\n\n  const editor = getAceEditor();\n  if (!editor) {\n    throw new Error('Ace Editor is undefined');\n  }\n  var linecontent = editor.session.getLine(row - 1);\n\n  var col = 0;\n  if (field > 1) {\n    var tabcount = 0;\n    for (let i = 0; i < linecontent.length; i++) {\n      col++;\n      if (linecontent[i] == '\\t') {\n        if (i > 0 && linecontent[i - 1] != '\\t') {\n          tabcount++;\n        }\n      }\n      if (tabcount == field - 1) {\n        break;\n      }\n    }\n  }\n\n  if (subtoken >= 1) {\n    var scount = 1;\n    while (col < linecontent.length && scount < subtoken) {\n      col++;\n      if (linecontent[col] == ' ') {\n        scount++;\n        if (scount == subtoken) {\n          col++;\n          break;\n        }\n      }\n    }\n  }\n\n  let col2 = col;\n  var searchstring = linecontent[col2];\n  while (col2 < linecontent.length) {\n    col2++;\n    if (linecontent[col2] == ' ') {\n      break;\n    } else if (linecontent[col2] == '\\t') {\n      break;\n    } else {\n      searchstring += linecontent[col2];\n    }\n  }\n\n  global_cursor.CursorNote = document.querySelector('#' + id);\n  // window.MENU.showCursorNoteMenu(global_cursor.CursorNote);\n  getMenu().showCursorNoteMenu(global_cursor.CursorNote);\n  editor.gotoLine(row, col);\n    \n\n\n  //alx     \n  let elmnt = document.getElementById(id);\n\n  if (elmnt.classList.contains(\"harm\") && elmnt.classList.contains(\"highlight\")) {\n    let line = editor.session.doc.getLine(row-1);\n    let stopIndex = col;\n    // while(!line[stopIndex] == '\\t') stopIndex++;\n    chord.current = line.substring(col, stopIndex);\n\n    console.log({ chord, line: line.substring(col, stopIndex), elmnt });\n  }\n  //alx_\n\n  // 0.5 = center the cursor vertically:\n  editor.renderer.scrollCursorIntoView({ row: row - 1, column: col }, 0.5);\n  centerCursorHorizontallyInEditor();\n}","import {\n  editorMode,\n  global_cursor,\n  global_editorOptions,\n} from './global-variables.js';\nimport { getFieldAndSubtoken } from './utility-humdrum.js';\nimport { getAceEditor } from './setup.js';\n\nlet editor = getAceEditor();\nif (!editor) {\n  throw new Error('Ace Editor is undefined');\n}\n\n//////////////////////////////\n//\n// centerCursorHorizontallyInEditor --\n//\n\nexport function centerCursorHorizontallyInEditor() {\n  // Center the cursort horizontally:\n  // Get distance between cursor and left side of textarea in pixels:\n  let cursorLeft =\n    getAceEditor().renderer.$cursorLayer.getPixelPosition(0).left;\n\n  // Get width of visible text area\n  let scrollerWidth = editor.renderer.$size.scrollerWidth;\n\n  // Move scroller so that left side at same point as cursor minus half width of visible area:\n  if (cursorLeft > scrollerWidth / 2) {\n    editor.renderer.scrollToX(cursorLeft - scrollerWidth / 2);\n  }\n}\n\nconst editorModes = {\n  humdrum: {\n    theme: 'ace/theme/humdrum_light',\n  },\n  xml: {\n    theme: 'ace/theme/solarized_light',\n  },\n  musedata: {\n    theme: 'ace/theme/solarized_light',\n  },\n};\n\n//////////////////////////////\n//\n// setEditorModeAndKeyboard --\n//\n\nexport function setEditorModeAndKeyboard() {\n  if (editor) {\n    const mode = editorMode();\n    editor.setTheme(editorModes[mode].theme);\n    editor.getSession().setMode('ace/mode/' + mode);\n    // editor.setTheme(window.EditorModes[EditorMode][window.KeyboardMode].theme);\n    // editor.getSession().setMode(\"ace/mode/\" + EditorMode);\n    // null to reset to default (ace) mode\n    // editor.setKeyboardHandler(window.KeyboardMode === \"ace\" ? null : \"ace/keyboard/\" + window.KeyboardMode);\n  }\n}\n\n//////////////////////////////\n//\n// toggleEditorMode -- Switch between plain text editing and vim editing.\n//     This is used by the alt-v keyboard shortcut.\n//\n\nexport function toggleEditorMode() {\n  // if (window.KeyboardMode == \"ace\") {\n  // \twindow.KeyboardMode  = \"vim\";\n  // } else {\n  // \twindow.KeyboardMode  = \"ace\";\n  // };\n  setEditorModeAndKeyboard();\n}\n\n//////////////////////////////\n//\n// showIdInEditor -- Highlight the current line of data being played,\n//     and center it.  But only do this if Humdrum data is being shown\n//     in the editor (MEI data is not time-ordered by notes, only by\n//     measure).\n//\n\nexport function showIdInEditor(id) {\n  if (editorMode() == 'xml') {\n    return;\n  }\n  // if (EditorMode == \"xml\") {\n  // \treturn;\n  // }\n  var matches = id.match(/-[^-]*L(\\d+)/);\n  if (!matches) {\n    return;\n  }\n  var row = parseInt(matches[1]);\n  editor.gotoLine(row, 0);\n  editor.centerSelection();\n  // console.log(\"PLAYING ROW\", row);\n}\n\n//////////////////////////////\n//\n// getMode -- return the Ace editor mode to display the data in:\n//    ace/mode/humdrum  == for Humdrum\n//    ace/mode/xml   == for XML data (i.e., MEI, or SVG)\n//\n\nexport function getMode(text) {\n  if (!text) {\n    return 'humdrum';\n  }\n  if (text.match(/^\\s*</)) {\n    return 'xml';\n  } else if (text.substring(0, 2000).match(/Group memberships:/)) {\n    return 'musedata';\n  } else if (text.substring(0, 2000).match(/^[A-Za-z0-9+\\/\\s]+$/)) {\n    return 'mime';\n  } else {\n    return 'humdrum';\n  }\n}\n\n//////////////////////////////\n//\n// highlightNoteInScore -- Called when the cursor has changed position\n//     int the editor.\n//\n\nfunction highlightNoteInScore(event) {\n  if (editorMode() == 'xml') {\n    xmlDataNoteIntoView(event);\n  } else {\n    humdrumDataNoteIntoView(event);\n  }\n  // if (EditorMode == \"xml\") {\n  // \txmlDataNoteIntoView(event);\n  // } else {\n  // \thumdrumDataNoteIntoView(event);\n  // }\n}\n\n//////////////////////////////\n//\n// xmlDataNoteIntoView --\n//\nimport { markItem } from './utility-svg.js';\nimport splitter from './splitter.js';\n\nfunction xmlDataNoteIntoView(event) {\n  var location = editor.selection.getCursor();\n  var line = location.row;\n  if (global_editorOptions.EditorLine == line) {\n    // already highlighted (or close enough)\n    return;\n  }\n  // var column = location.column;\n  var text = editor.session.getLine(line);\n  var matches = text.match(/xml:id=\"([^\"]+)\"/);\n  if (!matches) {\n    markItem(null, line);\n    return;\n  }\n  var id = matches[1];\n  var item;\n  if (splitter.rightContent) {\n    // see: https://www.w3.org/TR/selectors\n    item = splitter.rightContent.querySelector('#' + id);\n    // console.log(\"ITEM\", item);\n  }\n  markItem(item, line);\n}\n\n//////////////////////////////\n//\n// humdrumDataNoteIntoView --\n//\n\nexport function humdrumDataNoteIntoView(row, column) {\n  var line;\n  if (!row || !column) {\n    var location = editor.selection.getCursor();\n    line = location.row;\n    column = location.column;\n  }\n  line = row;\n  var text = editor.session.getLine(line);\n  var fys = getFieldAndSubtoken(text, column);\n  var field = fys.field;\n  var subspine = fys.subspine;\n  var query = global_cursor.HIGHLIGHTQUERY;\n  global_cursor.HIGHLIGHTQUERY = '';\n  // the following code causes problems with note highlighting\n  // after another note was edited.\n  //\tif (!query) {\n  //\t\tquery = EDITINGID;\n  //\t\tHIGHLLIGHTQUERY = EDITINGID;\n  //\t\t// EDITINGID = null;\n  //\t}\n  if (!query) {\n    query = 'L' + (line + 1) + 'F' + field;\n    if (subspine > 0) {\n      query += 'S' + subspine;\n    }\n  }\n  var item;\n  // if (splitter.rightContent) {\n    // see: https://www.w3.org/TR/selectors\n    // var items = splitter.rightContent.querySelectorAll(\n    //   \"g[id$='\" + query + \"']\"\n    // );\n    var items = document.getElementById('output').querySelectorAll(\n      \"g[id$='\" + query + \"']\"\n    );\n    if (items.length == 0) {\n      // cannot find (hidden rest for example)\n      return;\n    }\n    // give priority to items that possess qon/qoff classes.\n    for (var i = 0; i < items.length; i++) {\n      if (items[i].className.baseVal.match(/qon/)) {\n        item = items[i];\n        break;\n      }\n    }\n    if (!item) {\n      item = items[items.length - 1];\n    }\n    if (item.id.match(/^accid/)) {\n      item = items[items.length - 2];\n    }\n  // }\n  markItem(item);\n  return item;\n  // sendTarget(item);\n}\n","/* global $, midiUpdate, midiStop, play_midi, basket */\n\n//////////////////////////////\n//\n// displayNotation -- Convert Humdrum data in textarea to notation.\n//  This function seems to be called twice in certain cases (editing).\n//\nimport { setEditorModeAndKeyboard } from './utility-ace.js';\nimport {\n  highlightIdInEditor,\n  restoreSelectedSvgElement,\n} from './utility-svg.js';\nimport {\n  humdrumToSvgOptions,\n  musicxmlToHumdrumOptions,\n  musedataToHumdrumOptions,\n  meiToHumdrumOptions,\n  esacToHumdrumOptions,\n} from './verovio-options.js';\nimport { verovioCallback } from './listeners.js';\nimport { convertDataToCsv, convertDataToTsv } from './utility.js';\nimport { loadIndexFile } from './loading.js';\nimport { getVrvWorker } from '../humdrum-notation-plugin-worker.js';\nimport { getEditorContents, InterfaceSingleNumber } from './editor.js';\n\nlet vrvWorker = getVrvWorker();\nif (!vrvWorker) {\n  throw new Error('Verovio worker is undefined');\n}\n\nexport function displayNotation(page, force, restoreid) {\n  // vrvWorker.checkInitialized();\n  if (!vrvWorker.initialized || (global_interface.FreezeRendering && !force)) {\n    // console.log(\"Ignoring displayNotation request: not initialized or frozen\");\n    // console.log('Ignoring displayNotation', {\n    //   vrvWorker: vrvWorker,\n    //   FreezeRendering: global_interface.FreezeRendering,\n    //   force,\n    // });\n    return;\n  }\n\n  // if input area is a <textarea>, then use .value to access contnets:\n  // let inputarea = document.querySelector(\"#input\");\n  // let data = inputarea.value;\n\n  let data = getTextFromEditor();\n  if (!data) {\n    // This could be a transient state of the text editor before\n    // new contents is added.\n    // console.log(\"Editor contents is empty\");\n    return;\n  }\n  if (data.match(/^\\s*$/)) {\n    console.log('Editor contents is empty (2)');\n    return;\n  }\n  let options = humdrumToSvgOptions();\n  if (data.match(/CUT[[]/)) {\n    options.inputFrom = 'esac';\n  }\n  if (data.match(/Group memberships:/)) {\n    options.inputFrom = 'musedata';\n  }\n\n  setOptions(options);\n  // console.log('Calling vrvWorker.renderData with args:', {options, OPTIONS: OPTIONS, editorValue:editor.getValue(), data, page, force, vrvWorker: vrvWorker})\n  vrvWorker\n    .renderData(options, data, page, force)\n    .then(function (svg) {\n      let ishumdrum = true;\n      if (data.charAt(0) == '<') {\n        ishumdrum = false;\n      } else if (data.match(/CUT[[]/)) {\n        ishumdrum = false;\n      } else if (data.match(/Group memberships:/)) {\n        ishumdrum = false;\n      }\n\n      let output = document.querySelector('#output');\n      // output.innerHTML = svg;\n\n      let oldSvg = output.querySelectorAll('svg');\n      if (oldSvg.length > 0) {\n        oldSvg.forEach(svg => { \n          if (!svg.classList.contains('bi')) {\n            svg.remove();\n          }\n        });\n      }\n\n      let svgElem = document.createElement('svg');\n      output.appendChild(svgElem);\n      svgElem.outerHTML = svg;\n\n      if (ishumdrum) {\n        if (restoreid) {\n          restoreSelectedSvgElement(restoreid);\n        } else if (global_cursor.RestoreCursorNote) {\n          restoreSelectedSvgElement(global_cursor.RestoreCursorNote);\n        }\n        displayFileTitle(data);\n        if (!force) document.querySelector('body').classList.remove('invalid');\n      }\n      verovioCallback(svg);\n      return true;\n    })\n    .catch(function (message) {\n      document.querySelector('body').classList.add('invalid');\n      console.log('>>>>>>>>>> ERROR LOG:', message);\n      return false;\n    })\n    .finally(function () {\n      let indexelement = document.querySelector('#index');\n      indexelement.style.visibility = 'invisibile';\n      indexelement.style.display = 'none';\n      if (global_interface.UndoHide) {\n        showInputArea(true);\n        global_interface.UndoHide = false;\n      }\n      if (global_interface.ApplyZoom) {\n        applyZoom();\n        global_interface.ApplyZoom = false;\n      }\n      if (global_interface.ApplyZoom) {\n        applyZoom();\n        global_interface.ApplyZoom = false;\n      }\n      global_interface.ShowingIndex = false;\n      $('html').css('cursor', 'auto');\n      // these lines are needed to re-highlight the note when\n      // the notation has been updated.\n      //setCursorNote (null, \"displayNotation\");\n      //highlightNoteInScore();\n\n      // if (SEARCHFILTER) {\n      //   // extract the filtered Humdrum data from verovio, and\n      //   // pull out the match count from the data and report\n      //   // search toolbar\n      //   vrvWorker.getHumdrum().then(function (humdrumdata) {\n      //     let data = humdrumdata.match(/[^\\r\\n]+/g);\n      //     let count = 0;\n      //     let matches;\n      //     for (let i = data.length - 1; i > 0; i--) {\n      //       matches = data[i].match(/^!!@MATCHES:\\s*(\\d+)/);\n      //       if (matches) {\n      //         count = parseInt(matches[1]);\n      //         break;\n      //       }\n      //     }\n      //     console.log('COUNT', count);\n      //     let eresults = document.querySelector('#search-results');\n      //     if (eresults) {\n      //       let output = '';\n      //       if (count == 0) {\n      //         output = '0 matches';\n      //       } else if (count == 1) {\n      //         output = '1 match';\n      //       } else {\n      //         output = count + ' matches';\n      //       }\n      //       eresults.innerHTML = output;\n      //       showSearchLinkIcon();\n      //     }\n      //   });\n      // }\n    });\n}\n\nwindow.displayNotation = displayNotation;\n\n//////////////////////////////\n//\n// toggleFreeze --\n//\n\nexport function toggleFreeze() {\n  global_interface.FreezeRendering = !global_interface.FreezeRendering;\n  document.querySelector('body').classList.toggle('frozen');\n  if (!global_interface.FreezeRendering) {\n    displayNotation();\n  }\n\n  let felement = document.querySelector('#text-freeze-icon');\n  let output = '';\n  if (felement) {\n    if (global_interface.FreezeRendering) {\n      // display is frozen so show lock icon\n      output =\n        \"<div title='Unfreeze notation (alt-f)' class='nav-icon fas fa-lock'></div>\";\n    } else {\n      // display is not frozen so show unlock icon\n      output =\n        \"<div title='Freeze notation (alt-f)' class='nav-icon fas fa-unlock'></div>\";\n    }\n    felement.innerHTML = output;\n  }\n}\n\n//////////////////////////////\n//\n// toggleTextVisibility --\n//\nconst editor = getAceEditor();\nif (!editor) {\n  throw new Error('Ace Editor is undefined');\n}\n\nexport function toggleTextVisibility(suppressZoom) {\n  let input = document.querySelector('#input');\n  if (global_interface.InputVisible) {\n    if (global_interface.LastInputWidth == 0) {\n      global_interface.LastInputWidth = 400;\n    }\n\n    layoutService.send('HIDE_TEXT');\n    // splitter.setPositionX(global_interface.LastInputWidth);\n  } else {\n    layoutService.send('SHOW_TEXT');\n    global_interface.LastInputWidth = parseInt(input.style.width);\n    // splitter.setPositionX(0);\n  }\n\n  global_interface.InputVisible = !global_interface.InputVisible;\n\n  // if (!suppressZoom) {\n  //   displayNotation();\n  //   // applyZoom();\n  // }\n  editor.resize();\n  // matchToolbarVisibilityIconToState();\n}\n\nwindow.toggleTextVisibility = toggleTextVisibility;\n\n\n\n// export function toggleTextVisibility(suppressZoom) {\n//   global_interface.InputVisible = !global_interface.InputVisible;\n//   let input = document.querySelector('#input');\n//   if (global_interface.InputVisible) {\n//     if (global_interface.LastInputWidth == 0) {\n//       global_interface.LastInputWidth = 400;\n//     }\n//     splitter.setPositionX(global_interface.LastInputWidth);\n//   } else {\n//     global_interface.LastInputWidth = parseInt(input.style.width);\n//     splitter.setPositionX(0);\n//   }\n//   if (!suppressZoom) {\n//     displayNotation();\n//     // applyZoom();\n//   }\n//   editor.resize();\n//   // matchToolbarVisibilityIconToState();\n// }\n\n//////////////////////////////\n//\n// redrawInputArea --\n//\n\nexport function redrawInputArea(suppressZoom) {\n  let input = document.querySelector('#input');\n  if (global_interface.InputVisible) {\n    if (global_interface.LastInputWidth == 0) {\n      global_interface.LastInputWidth = 400;\n    }\n    splitter.setPositionX(global_interface.LastInputWidth);\n  } else {\n    global_interface.LastInputWidth = parseInt(input.style.width);\n    splitter.setPositionX(0);\n  }\n  if (!suppressZoom) {\n    applyZoom();\n  }\n  editor.resize();\n}\n\n//////////////////////////////\n//\n// hideInputArea --\n//\n\nexport function hideInputArea(suppressZoom) {\n  global_interface.InputVisible = false;\n  let input = document.querySelector('#input');\n  global_interface.LastInputWidth = parseInt(input.style.width);\n  splitter.setPositionX(0);\n  if (!suppressZoom) {\n    applyZoom();\n  }\n}\n\n//////////////////////////////\n//\n// showInputArea --\n//\n\nfunction showInputArea(suppressZoom) {\n  global_interface.InputVisible = true;\n  splitter.setPositionX(global_interface.LastInputWidth);\n  if (!suppressZoom) {\n    applyZoom();\n  }\n  editor.resize();\n}\n\n//////////////////////////////\n//\n// toggleVhvTitle --\n//\n\n// export function toggleVhvTitle() {\n//   window.VrvTitle = !window.VrvTitle;\n//   let area = document.querySelector('#vhv');\n//   if (window.VrvTitle) {\n//     area.style.visibility = 'visible';\n//     area.style.display = 'inline';\n//   } else {\n//     area.style.visibility = 'hidden';\n//     area.style.display = 'none';\n//   }\n// }\n\n//////////////////////////////\n//\n// hideWorkNavigator --\n//\n\nlet erasedWorkNavigator = '';\nlet erasedFileInfo = {};\n\nfunction restoreWorkNavigator(selector) {\n  if (!selector) {\n    selector = '#work-navigator';\n  }\n  // if (window.ERASED_WORK_NAVIGATOR.match(/^\\s*$/)) {\n  //   return;\n  // }\n  if (erasedWorkNavigator.match(/^\\s*$/)) {\n    return;\n  }\n  // FILEINFO = window.ERASED_FILEINFO;\n  // FILEINFO = erasedFileInfo;\n  setFileInfo(erasedFileInfo);\n  let element = document.querySelector(selector);\n  element.innerHTML = erasedWorkNavigator;\n  erasedWorkNavigator = '';\n  // element.innerHTML = window.ERASED_WORK_NAVIGATOR;\n  // window.ERASED_WORK_NAVIGATOR = '';\n}\n\n//////////////////////////////\n//\n// removeWorkNavigator --\n//\n\nfunction removeWorkNavigator(selector) {\n  if (!selector) {\n    selector = '#work-navigator';\n  }\n  let element = document.querySelector(selector);\n  // window.ERASED_WORK_NAVIGATOR = element.innerHTML;\n  erasedWorkNavigator = element.innerHTML;\n  // window.ERASED_FILEINFO = FILEINFO;\n  erasedFileInfo = FILEINFO;\n  element.innerHTML = '';\n}\n\n//////////////////////////////\n//\n// displayWorkNavigation --\n//\n\nfunction displayWorkNavigation(selector) {\n  if (!selector) {\n    selector = '#work-navigator';\n  }\n  let contents = '';\n  const element = document.querySelector(selector);\n  if (!element) {\n    console.log('Error: cannot find work navigator');\n    return;\n  }\n\n  if (FILEINFO['previous-work']) {\n    contents += '<span style=\"cursor:pointer\" onclick=\"displayWork(\\'';\n    contents += FILEINFO['previous-work'];\n    contents += '\\');\"';\n    contents += \" title='previous work/movement (&#8679;+&#8592;)'\";\n    contents += '>';\n    contents += \"<span class='nav-icon fas fa-arrow-circle-left'></span>\";\n    contents += '</span>';\n  }\n\n  if (\n    FILEINFO['previous-work'] &&\n    FILEINFO['next-work'] &&\n    FILEINFO['has-index'] == 'true'\n  ) {\n    contents += '&nbsp;';\n  }\n\n  if (FILEINFO['has-index'] == 'true') {\n    contents += '<span style=\"cursor:pointer\" onclick=\"displayIndex(\\'';\n    contents += FILEINFO['location'];\n    contents += '\\');\"';\n    contents += \" title='repertory index (&#8679;+&#8593;)'\";\n    contents += '>';\n    contents += \"<span class='nav-icon fas fa-arrow-circle-up'></span>\";\n    contents += '</span>';\n  }\n\n  if (\n    FILEINFO['previous-work'] &&\n    FILEINFO['next-work'] &&\n    FILEINFO['has-index'] == 'true'\n  ) {\n    contents += '&nbsp;';\n  }\n\n  if (\n    FILEINFO['previous-work'] &&\n    FILEINFO['next-work'] &&\n    FILEINFO['has-index'] != 'true'\n  ) {\n    contents += '&nbsp;';\n  }\n\n  if (FILEINFO['next-work']) {\n    contents += '<span style=\"cursor:pointer\" onclick=\"displayWork(\\'';\n    contents += FILEINFO['next-work'];\n    contents += '\\');\"';\n    contents += \" title='next work/movement (&#8679;+&#8594;)'\";\n    contents += '>';\n    contents += \"<span class='nav-icon fas fa-arrow-circle-right'></span>\";\n    contents += '</span>';\n  }\n\n  if (FILEINFO['file']) {\n    contents +=\n      '<span style=\"padding-left:3px; cursor:pointer\" onclick=\"displayKeyscape();\"';\n    contents += \" title='Keyscape'\";\n    contents += '>';\n    contents += \"<span class='nav-icon fa fa-key'></span>\";\n    contents += '</span>';\n  }\n\n  if (FILEINFO['has-index'] == 'true') {\n    contents +=\n      '<span style=\"padding-left:3px; cursor:pointer\" onclick=\"copyRepertoryUrl(\\'';\n    contents += FILEINFO['location'];\n    contents += '/';\n    contents += FILEINFO['file'];\n    contents += '\\')\"';\n    contents += \" title='copy link for work'\";\n    contents += '>';\n    contents += \"<span class='nav-icon fas fa-link'></span>\";\n    contents += '</span>';\n  }\n\n  if (FILEINFO['previous-work'] || FILEINFO['next-work']) {\n    contents += '&nbsp;&nbsp;';\n  }\n\n  element.innerHTML = contents;\n}\n\n//////////////////////////////\n//\n// copyRepertoryUrl --\n//\n\nfunction copyRepertoryUrl(file) {\n  if (!file) {\n    if (FILEINFO) {\n      file = FILEINFO.location;\n      file += '/';\n      file += FILEINFO.file;\n    }\n  }\n\n  let url = 'https://verovio.humdrum.org';\n  let initialized = 0;\n\n  if (file) {\n    url += '/?file=';\n    url += file;\n    initialized = 1;\n  }\n\n  let kstring = '';\n  if (!global_interface.InputVisible) {\n    kstring += 'ey';\n  }\n\n  if (kstring.length > 0) {\n    if (!initialized) {\n      url += '/?';\n      initialized = 1;\n    } else {\n      url += '&';\n    }\n    url += 'k=' + kstring;\n  }\n\n  // if (PQUERY && PQUERY.length > 0) {\n  //   if (!initialized) {\n  //     url += '/?';\n  //     initialized = 1;\n  //   } else {\n  //     url += '&';\n  //   }\n  //   url += 'p=';\n  //   url += encodeURIComponent(PQUERY);\n  // }\n  // if (RQUERY && RQUERY.length > 0) {\n  //   if (!initialized) {\n  //     url += '/?';\n  //     initialized = 1;\n  //   } else {\n  //     url += '&';\n  //   }\n  //   url += 'r=';\n  //   url += encodeURIComponent(RQUERY);\n  // }\n  // if (IQUERY && IQUERY.length > 0) {\n  //   if (!initialized) {\n  //     url += '/?';\n  //     initialized = 1;\n  //   } else {\n  //     url += '&';\n  //   }\n  //   url += 'i=';\n  //   url += encodeURIComponent(IQUERY);\n  // }\n  copyToClipboard(url);\n}\n\n//////////////////////////////\n//\n// displayFileTitle --\n//\nimport { getReferenceRecords } from './utility-humdrum.js';\n\nfunction displayFileTitle(contents) {\n  let references = getReferenceRecords(contents);\n\n  let lines = contents.split(/\\r?\\n/);\n  let title = '';\n  let number = '';\n  let composer = '';\n  let sct = '';\n  let matches;\n\n  if (references['title'] && !references['title'].match(/^\\s*$/)) {\n    title = references['title'];\n  } else if (references['OTL'] && !references['OTL'].match(/^\\s*$/)) {\n    title = references['OTL'];\n  }\n\n  if (references['COM'] && !references['COM'].match(/^\\s*$/)) {\n    if ((matches = references['COM'].match(/^\\s*([^,]+),/))) {\n      composer = matches[1];\n    } else {\n      composer = references['COM'];\n    }\n  }\n\n  title = title.replace(/-sharp/g, '&#9839;');\n  title = title.replace(/-flat/g, '&#9837;');\n\n  let tarea;\n  tarea = document.querySelector('#title');\n  if (tarea) {\n    tarea.innerHTML = title;\n  }\n\n  tarea = document.querySelector('#composer');\n  let pretitle = '';\n\n  if (tarea && !composer.match(/^\\s*$/)) {\n    pretitle += composer + ', ';\n  }\n  tarea.innerHTML = pretitle;\n\n  displayWorkNavigation('#work-navigator');\n}\n\n//////////////////////////////\n//\n// displayWork --\n//\nimport { loadKernScoresFile } from './loading.js';\n\nexport async function displayWork(file) {\n  if (!file) {\n    return;\n  }\n\n  console.log(file)\n  moveToTopOfNotation();\n  vrvWorker.page = 1;\n  $('html').css('cursor', 'wait');\n  // window.stop();\n  loadKernScoresFile({\n    file,\n    previous: true,\n    next: true,\n  });\n\n  let { docId } = getURLParams(['docId']);\n\n  await removeByDocumentId(docId, { data: { clientId: yProvider.awareness.clientID }, onSuccess: console.log, onError: console.error })\n}\n\nwindow.displayWork = displayWork;\n\n//////////////////////////////\n//\n// displayIndex --\n//\n\nexport function displayIndex(directory) {\n  global_interface.ShowingIndex = true;\n  if (!directory) {\n    return;\n  }\n  $('html').css('cursor', 'wait');\n  loadIndexFile(directory);\n}\n\n//////////////////////////////\n//\n// replaceEditorContentWithHumdrumFile -- If the editor contents is\n//    MusicXML, then convert to Humdrum and display in the editor.\n//\n\nexport function replaceEditorContentWithHumdrumFile(text, page) {\n  if (!text) {\n    text = getTextFromEditor();\n  }\n  if (!text) {\n    console.log('No content to convert to Humdrum');\n    return;\n  }\n\n  vrvWorker.page = 1;\n  page = page || vrvWorker.page;\n  let options = null;\n  let meiQ = false;\n\n  let mode = getMode(text);\n\n  if (text.slice(0, 1000).match(/<score-partwise/)) {\n    // MusicXML data\n    options = musicxmlToHumdrumOptions();\n  } else if (text.slice(0, 2000).match(/Group memberships:/)) {\n    // MuseData data\n    options = musedataToHumdrumOptions();\n  } else if (text.slice(0, 1000).match(/<mei/)) {\n    // this is MEI data\n    options = meiToHumdrumOptions();\n    meiQ = true;\n  } else if (text.slice(0, 1000).match(/CUT[[]/)) {\n    // EsAC data\n    options = esacToHumdrumOptions();\n  } else {\n    // don't know what it is, but probably Humdrum\n    alert('Cannot convert data to Humdrum');\n    return;\n  }\n\n  if (options) {\n    if (\n      options.inputFrom == 'musedata' ||\n      options.inputFrom == 'musedata-hum'\n    ) {\n      vrvWorker.filterData(options, text, 'humdrum').then(showMei);\n    } else if (\n      options.inputFrom == 'musicxml' ||\n      options.inputFrom == 'musicxml-hum'\n    ) {\n      vrvWorker.filterData(options, text, 'humdrum').then(showMei);\n    } else {\n      vrvWorker.filterData(options, text, 'humdrum').then(function (newtext) {\n        let freezeBackup = global_interface.FreezeRendering;\n        if (global_interface.FreezeRendering == false) {\n          global_interface.FreezeRendering = true;\n        }\n        setTextInEditor(newtext);\n        global_interface.FreezeRendering = freezeBackup;\n        displayNotation(page);\n      });\n    }\n  }\n}\n\n///////////////////////////////\n//\n// applyZoom --\n//\n\nexport function applyZoom() {\n  // let measure = 0;\n\n  let testing = document.querySelector('#output svg');\n  if (!testing) {\n    // console.log(\"NO OUTPUT SVG LOCATION\");\n    return;\n  }\n\n  // if (vrvWorker.page !== 1) {\n  // \tmeasure = $(\"#output .measure\").attr(\"id\");\n  // }\n\n  let options = humdrumToSvgOptions();\n  setOptions(options);\n  stop();\n  vrvWorker.HEIGHT = options.pageHeight;\n  vrvWorker.WIDTH = options.pageWidth;\n\n  vrvWorker.redoLayout(options, 1, vrvWorker.page).then(function () {\n    loadPage(vrvWorker.page);\n  });\n}\n\n//////////////////////////////\n//\n// loadPage --\n//\n\nexport function loadPage(page) {\n  page = page || vrvWorker.page;\n  $('#overlay').hide().css('cursor', 'auto');\n  $('#jump_text').val(page);\n  vrvWorker.renderPage(page).then(function (svg) {\n    $('#output').html(svg);\n    verovioCallback(svg);\n    // adjustPageHeight();\n    // resizeImage();\n  });\n}\n\n//////////////////////////////\n//\n// resizeImage -- Make all SVG images match the width of the new\n//     width of the window.\n//\n\nfunction resizeImage(image) {\n  return; /* not needed anymore */\n  /*\n\tlet ww = window.innerWidth;\n\tlet tw = $(\"#input\").outerWidth();\n\n\t// let newheight = (window.innerHeight - $(\"#navbar\").outerHeight()) / ZOOM - 100;\n\t// let newwidth = (ww - tw) / ZOOM - 100;\n\tlet newheight = (window.innerHeight - $(\"#navbar\").outerHeight());\n\tlet newwidth = (ww - tw);\n\n\tlet image = document.querySelector(\"#output svg\");\n\t//console.log(\"OLD IMAGE HEIGHT\", $(image).height());\n\tconsole.log(\"OLD IMAGE WIDTH\", $(image).width());\n\tif (!image) {\n\t\treturn;\n\t}\n\tconsole.log(\"ZOOM\", ZOOM);\n\nreturn;\n\n\t$(image).width(newwidth);\n\t$(image).height(newheight);\n\t$(image.parentNode).height(newheight);\n\t$(image.parentNode).width(newwidth);\n*/\n}\n\n//////////////////////////////\n//\n// gotoPreviousPage --\n//\n\nexport function gotoPreviousPage() {\n  vrvWorker.gotoPage(vrvWorker.page - 1).then(function () {\n    loadPage(vrvWorker.page);\n  });\n}\n\n//////////////////////////////\n//\n// gotoNextPage --\n//\n\nexport function gotoNextPage() {\n  vrvWorker.gotoPage(vrvWorker.page + 1).then(function () {\n    loadPage(vrvWorker.page);\n  });\n}\n\n//////////////////////////////\n//\n// gotoLastPage --\n//\n\nexport function gotoLastPage() {\n  vrvWorker.gotoPage(0).then(function () {\n    loadPage(vrvWorker.page);\n  });\n}\n\n//////////////////////////////\n//\n// gotoFirstPage --\n//\n\nexport function gotoFirstPage() {\n  vrvWorker.gotoPage(1).then(function () {\n    loadPage(vrvWorker.page);\n  });\n}\n\n//////////////////////////////\n//\n// showBufferedHumdrumData --\n//\nimport {\n  editorMode,\n  FILEINFO,\n  global_cursor,\n  global_editorOptions,\n  global_interface,\n  global_verovioOptions,\n  setEditorMode,\n  setFileInfo,\n  setOptions,\n} from './global-variables.js';\nlet bufferedHumdrumFile = '';\n\nexport function showBufferedHumdrumData() {\n  // let oldmode = EditorMode;\n  let oldmode = editorMode();\n  if (oldmode == 'musedata') {\n    setEditorMode('humdrum');\n    // EditorMode = 'humdrum';\n    setEditorModeAndKeyboard();\n    displayHumdrum();\n  } else {\n    // EditorMode = 'humdrum';\n    setEditorMode('humdrum');\n    setEditorModeAndKeyboard();\n    if (!bufferedHumdrumFile.match(/^\\s*$/)) {\n      displayScoreTextInEditor(bufferedHumdrumFile, vrvWorker.page);\n      bufferedHumdrumFile = '';\n    }\n    // if (!window.BufferedHumdrumFile.match(/^\\s*$/)) {\n    //   displayScoreTextInEditor(window.BufferedHumdrumFile, vrvWorker.page);\n    //   window.BufferedHumdrumFile = '';\n    // }\n  }\n}\n\n//////////////////////////////\n//\n// displayHumdrum --\n//\n\nfunction displayHumdrum() {\n  let options = humdrumToSvgOptions();\n  vrvWorker\n    .filterData(options, getTextFromEditor(), 'humdrum')\n    .then(showHumdrum);\n}\n\n//////////////////////////////\n//\n// showHumdrum --\n//\nlet museDataBuffer = '';\nfunction showHumdrum(humdrumdata) {\n  // if (EditorMode == 'musedata') {\n  if (editorMode() == 'musedata') {\n    // could implement a key to return to MuseData contents\n    // window.MuseDataBuffer = getTextFromEditor();\n    museDataBuffer = getTextFromEditor();\n  }\n  setTextInEditor(humdrumdata);\n}\n\n//////////////////////////////\n//\n// getTextFromEditor -- return the content of the text editor,\n//    removing any leading space (which will cause confusion in\n//    the verovio auto-format detection algorithm).  Trailing\n//    space is not removed.\n//\n// Maybe use for UTF-8, but seems to be working without:\n//     btoa(unescape(encodeURIComponent(str))))\n//\n\nexport function getTextFromEditor() {\n  let text = editor.getValue();\n  if (!text) {\n    return '';\n  }\n  text = ensureTsv(text);\n  if (text.length < 5) {\n    // do not try to unmime if length less than 5 characters\n    return text;\n  }\n  // if the first 100 charcters are only spaces or [A-Za-z0-9/+=], the assume\n  // the text is MIME encoded, so decode before returning:\n  let starting = text.substring(0, 100);\n  if (starting.match(/^[\\nA-Za-z0-9/+=]+$/)) {\n    try {\n      text = atob(text);\n      text = ensureTsv(text);\n    } catch (err) {\n      // console.log(\"text is not mime\", text);\n      // It is still possible that the text is not\n      // MIME data, but it will still be decodeable\n      // into junk.\n    }\n  }\n  return text;\n}\n\n//////////////////////////////\n//\n// getTextFromEditorRaw --\n//\n\nexport function getTextFromEditorRaw() {\n  return editor.getValue();\n}\n\n//////////////////////////////\n//\n// getTextFromEditorNoCsvProcessing --\n//\n\nexport function getTextFromEditorNoCsvProcessing() {\n  let text = editor.getValue();\n  if (!text) {\n    return '';\n  }\n  if (text.length < 5) {\n    // do not try to unmime if length less than 5 characters\n    return text;\n  }\n  // if the first 100 charcters are only spaces or [A-Za-z0-9/+=], the assume\n  // the text is MIME encoded, so decode before returning:\n  let starting = text.substring(0, 100);\n  if (starting.match(/^[\\nA-Za-z0-9/+=]+$/)) {\n    try {\n      text = atob(text);\n    } catch (err) {\n      // console.log(\"text is not mime\", text);\n      // It is still possible that the text is not\n      // MIME data, but it will still be decodeable\n      // into junk.\n    }\n  }\n  return text;\n}\n\n//////////////////////////////\n//\n// ensureTsv -- convert to TSV if in CSV format.\n//\n\nfunction ensureTsv(text) {\n  let lines = text.split('\\n');\n  let commacount = 0;\n  let linecount = 0;\n  for (let i = 0; i < lines.length; i++) {\n    if (lines[i].match(/^!!/)) {\n      continue;\n    }\n    linecount++;\n    if (lines[i].match(/,/)) {\n      commacount++;\n    }\n    if (linecount > 10) {\n      break;\n    }\n  }\n  if (linecount && linecount == commacount) {\n    return convertDataToTsv(lines);\n  } else {\n    return text;\n  }\n}\n\n//////////////////////////////\n//\n// setTextInEditor -- Sets the text in the editor, remving the last\n//   newline in the file to prevent an empty line in the ace editor\n//   (the ace editor will add an empty line if the last line of\n//   data ends with a newline).  The cursor is moved to the start\n//   of the data, but the view is not moved to the start (this is needed\n//   for keeping a used filter in view when compiling filters, in\n//   particular).  Also the selection of the entire copied data\n//   is deselected.\n//\n\nexport function setTextInEditor(text) {\n  console.log('setTextInEditor', { splash: text })\n  if (!text) {\n    editor.setValue('');\n  } else if (text.charAt(text.length - 1) === '\\n') {\n    // Get rid of #@%! empty line at end of text editor:\n    // editor.setValue(text.slice(0, -1), -1);\n    editor.setValue(text, -1);\n    console.log('else if')\n  } else {\n    editor.setValue(text, -1);\n    console.log('else', {text})\n  }\n  editor.getSession().selection.clearSelection();\n}\n\n//////////////////////////////\n//\n// getTextFromEditorWithGlobalFilter -- Same as getTextFromEditor(),\n//    but with global filter added.\n//\n\nfunction getTextFromEditorWithGlobalFilter(data) {\n  if (!data) {\n    data = getTextFromEditor();\n  }\n  // remove leading/trailing spaces:\n  data = data.replace(/^\\s+/, '').replace(/\\s+$/, '');\n\n  return data;\n}\n\n//////////////////////////////\n//\n// showMei --\n//\n\nfunction showMei(meidata) {\n  // console.log('showMei', meidata);\n  if (global_interface.ShowingIndex) {\n    return;\n  }\n  setEditorMode('xml');\n  // EditorMode = 'xml';\n  setEditorModeAndKeyboard();\n  if (bufferedHumdrumFile.match(/^\\s*$/)) {\n    bufferedHumdrumFile = getTextFromEditor();\n  }\n  // if (window.BufferedHumdrumFile.match(/^\\s*$/)) {\n  //   window.BufferedHumdrumFile = getTextFromEditor();\n  // }\n  displayScoreTextInEditor(meidata, vrvWorker.page);\n}\n\n//////////////////////////////\n//\n// displayMeiNoType --\n//\n\nexport function displayMeiNoType() {\n  let options = humdrumToSvgOptions();\n  options.humType = 0;\n  let text = getTextFromEditor();\n  vrvWorker.filterData(options, text, 'mei').then(function (meidata) {\n    showMei(meidata);\n  });\n}\n\n//////////////////////////////\n//\n// displayMei --\n//\n\nexport function displayMei() {\n  vrvWorker.getMEI().then(function (meidata) {\n    showMei(meidata);\n  });\n}\n\n//////////////////////////////\n//\n// displaySvg --\n//\n\nfunction displaySvg() {\n  if (global_interface.ShowingIndex) {\n    return;\n  }\n  vrvWorker.renderPage(vrvWorker.page).then(function (data) {\n    let prefix =\n      \"<textarea style='spellcheck=false; width:100%; height:100%;'>\";\n    let postfix = '</textarea>';\n    let w = window.open(\n      'about:blank',\n      'SVG transcoding',\n      'width=600,height=800,resizeable,scrollabars,location=false'\n    );\n    w.document.write(prefix + data + postfix);\n    w.document.close();\n\n    // Set the title of the window.  It cannot be set immediately and must wait\n    // until the content has been loaded.\n    function checkTitle() {\n      if (w.document) {\n        w.document.title = 'SVG transcoding';\n      } else {\n        setTimeout(checkTitle, 40);\n      }\n    }\n    checkTitle();\n\n    verovioCallback(data);\n  });\n}\n\n//////////////////////////////\n//\n// displayPdf --\n//\n\nexport function displayPdf() {\n  // If a humdrum file has a line starting with\n  //     !!!URL-pdf: (https?://[^\\s]*)\n  // then load that file.\n  let loaded = false;\n  // if (EditorMode === 'humdrum') {\n  if (editorMode() === 'humdrum') {\n    let loaded = displayHumdrumPdf();\n  }\n\n  if (loaded) {\n    return;\n  }\n\n  if (!FILEINFO['has-pdf']) {\n    return;\n  }\n  if (FILEINFO['has-pdf'] != 'true') {\n    return;\n  }\n\n  let url = 'https://kern.humdrum.org/data?l=' + FILEINFO['location'];\n  url += '&file=' + FILEINFO['file'];\n  url += '&format=pdf&#view=FitH';\n\n  openPdfAtBottomThirdOfScreen(url);\n}\n\n//////////////////////////////\n//\n// displayKeyscape --\n//\n\nfunction displayKeyscape() {\n  let fileinfo = FILEINFO;\n  if (!fileinfo) {\n    console.log('Error: no fileinfo');\n    return;\n  }\n  if (typeof fileinfo.file === 'undefined') {\n    console.log('Error: filename not found');\n    return;\n  }\n  let file = fileinfo.file;\n  if (!file) {\n    console.log('Error: filename is empty');\n    return;\n  }\n  if (typeof fileinfo.location === 'undefined') {\n    console.log('Error: location not found');\n    return;\n  }\n  let location = fileinfo.location;\n  if (!location) {\n    console.log('Error: location is empty');\n    return;\n  }\n\n  let url = 'https://kern.humdrum.org/data?file=';\n  url += encodeURIComponent(file);\n  url += '&l=';\n  url += encodeURIComponent(location);\n  url += '&format=keyscape-html';\n  console.log('Keyscape URL is', url);\n\n  console.log('Loading Keyscape', url);\n\n  // https://developer.mozilla.org/en-US/docs/Web/API/Window/open#window____features\n  let features = '';\n  // width and height are not the dimensions of the PNG image (600x461)\n  // features += \"width=950\";\n  // features += \", height=775\";\n  features += 'width=664';\n  features += ', height=511';\n  features += ', left=10';\n  features += ', top=10';\n  features += ', resizeable';\n  features += ', scrollbars';\n  features += ', toolbar=no';\n  features += ', location=0';\n  console.log('FEATURES', features);\n}\n\n//////////////////////////////\n//\n// displayHumdrumPdf --\n//\n//         !!!URL-pdf: (https?://[^\\s]*)\n// If there is a number in the keyboard buffer:\n//         !!!URL-pdf[1-9]: (https?://[^\\s]*)\n// Return value: false if not loaded from reference record\n//\n//\n\nfunction displayHumdrumPdf() {\n  let urllist = getPdfUrlList();\n\n  let url = '';\n  let i;\n  if (InterfaceSingleNumber > 1) {\n    for (i = 0; i < urllist.length; i++) {\n      if (urllist[i].number == InterfaceSingleNumber) {\n        url = urllist[i].url;\n        break;\n      }\n    }\n  } else {\n    for (i = 0; i < urllist.length; i++) {\n      if (urllist[i].number <= 1) {\n        url = urllist[i].url;\n        break;\n      }\n    }\n  }\n\n  // if the URL is empty but the urls array is not, then\n  // select the last url (which is the first URL entry\n  // in the file.\n  // console.log(\"URLs:\", urls);\n\n  if (url) {\n    openPdfAtBottomThirdOfScreen(url);\n    return 1;\n  } else {\n    return 0;\n  }\n}\n\n//////////////////////////////\n//\n// getPdfUrlList --\n//\n\nexport function getPdfUrlList() {\n  // if (EditorMode !== 'humdrum') {\n  if (editorMode() !== 'humdrum') {\n    // can't handle MEI mode yet\n    return 0;\n  }\n  let predata = getTextFromEditor();\n  if (!predata) {\n    return [];\n  }\n  let data = predata.split(/\\r?\\n/);\n  let refrecords = {};\n  let output = [];\n  let title = '';\n\n  let query;\n  query = '^!!!URL(\\\\d*)-pdf:\\\\s*((?:ftp|https?)://[^\\\\s]+)';\n  query += '\\\\s+(.*)\\\\s*$';\n  let rex = new RegExp(query);\n\n  let references = [];\n\n  let i;\n  for (i = 0; i < data.length; i++) {\n    let line = data[i];\n    let matches = line.match(rex);\n    if (matches) {\n      let obj = {};\n      if (!matches[1]) {\n        obj.number = -1;\n      } else {\n        obj.number = parseInt(matches[1]);\n      }\n      obj.url = matches[2];\n      obj.title = matches[3];\n      output.push(obj);\n    }\n\n    matches = line.match(/^!!!([^:]+)\\s*:\\s*(.*)\\s*$/);\n    if (matches) {\n      // Was declared global\n      let obj = {};\n      obj.key = matches[1];\n      obj.value = matches[2];\n      if (!refrecords[obj.key]) {\n        refrecords[obj.key] = [];\n      }\n      refrecords[obj.key].push(obj);\n    }\n  }\n\n  for (let i = 0; i < output.length; i++) {\n    output[i].title = templateExpansion(output[i].title, refrecords);\n  }\n\n  return output;\n}\n\n//////////////////////////////\n//\n// templateExpansion --\n//\n\nfunction templateExpansion(title, records) {\n  let matches = title.match(/@{(.*?)}/);\n  if (!matches) {\n    return title;\n  }\n\n  let replacement = getReferenceValue(matches[1], records);\n  let rex = new RegExp('@{' + matches[1] + '}', 'g');\n  title = title.replace(rex, replacement);\n\n  matches = title.match(/@{(.*?)}/);\n  while (matches) {\n    replacement = getReferenceValue(matches[1], records);\n    rex = new RegExp('@{' + matches[1] + '}', 'g');\n    title = title.replace(rex, replacement);\n\n    matches = title.match(/@{(.*?)}/);\n  }\n\n  return title;\n}\n\n//////////////////////////////\n//\n// getReferenceValue -- return the (first) reference record\n//    value for the given key.\n//\n\nfunction getReferenceValue(key, records) {\n  let entry = records[key];\n  if (!entry) {\n    return '';\n  }\n\n  return entry[0].value;\n}\n\n//////////////////////////////\n//\n// openPdfAtBottomThirdOfScreen --\n//\n// Reference: https://www.adobe.com/content/dam/acom/en/devnet/acrobat/pdfs/pdf_open_parameters.pdf\n//\n\nfunction openPdfAtBottomThirdOfScreen(url, keepfocus) {\n  if (!url) {\n    return;\n  }\n\n  console.log('Loading URL', url);\n  let features = 'left=0';\n  features += ',top=' + parseInt((screen.height * 2) / 3);\n  features += ',width=' + screen.width;\n  features += ',height=' + parseInt(screen.height / 3);\n  features += ',resizeable';\n  features += ',scrollbars';\n  features += ',location=false';\n  let wpdf = window.open(url, '', features);\n\n  if (!keepfocus) {\n    if (window.focus) {\n      wpdf.focus();\n    }\n  }\n}\n\n//////////////////////////////\n//\n// reloadData -- Expand later to work with other input URIs.\n//\n\nexport function reloadData() {\n  // delete all sessionStorage keys starting with \"basket-\"\n  for (let key in sessionStorage) {\n    if (sessionStorage.hasOwnProperty(key) && /^basket-/.test(key)) {\n      console.log('DELETING', key);\n      delete sessionStorage[key];\n    }\n  }\n\n  // if (CGI && CGI.file) {\n  //   // Reload from URL file parameter if this method was used.\n  //   // (Don't know if a different work was loaded differently, however).\n  //   let basket = 'basket-' + CGI.file;\n  //   if (CGI.mm) {\n  //     basket += '&mm=' + CGI.mm;\n  //   }\n  //   sessionStorage.removeItem(basket);\n  //   loadKernScoresFile(\n  //     {\n  //       file: CGI.file,\n  //       measures: CGI.mm,\n  //       previous: false,\n  //       next: false,\n  //     },\n  //     true\n  //   );\n  // } else {\n  //   // (assume) reload a repertory score\n  //   console.log(\"Don't know what to reload\");\n  // }\n}\n\n//////////////////////////////\n//\n// initializeVerovioToolkit --\n//\n\nexport function initializeVerovioToolkit() {\n  // console.log(\"Verovio toolkit being initialized.\");\n\n  let inputarea = document.querySelector('#input');\n\n  // now done with Ace editor callback:\n  // inputarea.addEventListener(\"keyup\", function() {\n  //\t\tdisplayNotation();\n  //});\n  if (editor) {\n    editor.session.on('change', function (e) {\n      // console.log(\"EDITOR content changed\", e);\n      monitorNotationUpdating();\n    });\n  } else {\n    console.log('Warning: Editor not setup yet');\n  }\n\n  // $(window).resize(function() { applyZoom(); });\n  $(window).resize(function () {\n    displayNotation();\n  });\n\n  $('#input').mouseup(function () {\n    let $this = $(this);\n    if (\n      $this.outerWidth() != $this.data('x') ||\n      $this.outerHeight() != $this.data('y')\n    ) {\n      applyZoom();\n    }\n    $this.data('x', $this.outerWidth());\n    $this.data('y', $this.outerHeight());\n  });\n\n  if (!global_interface.ShowingIndex) {\n    console.log('Score will be displayed after verovio has finished loading');\n    displayNotation();\n  }\n\n  // downloadWildWebMidi('scripts/midiplayer/wildwebmidi.js');\n  initializeWildWebMidi();\n}\n\n//////////////////////////////\n//\n// monitorNotationUpdating --\n//\n\nexport function monitorNotationUpdating() {\n  updateEditorMode();\n  displayNotation();\n}\n\n//////////////////////////////\n//\n// dataIntoView -- When clicking on a note (or other itmes in SVG images later),\n//      go to the corresponding line in the editor.\n//\n\nexport function dataIntoView(event) {\n  if (editorMode() == 'xml') {\n    xmlDataIntoView(event);\n  } else {\n    humdrumDataIntoView(event);\n  }\n}\n\n//////////////////////////////\n//\n// xmlDataIntoView -- When clicking on a note (or other itmes in SVG\n//      images later), make the text line in the MEI data visible in\n//      the text area.\n//\n// https://github.com/ajaxorg/ace/wiki/Embedding-API\n//\n\nexport function xmlDataIntoView(event) {\n  let target = event.target;\n  let id = target.id;\n  let matches;\n  let regex;\n  let range;\n  let searchstring;\n\n  while (target) {\n    if (!target.id) {\n      target = target.parentNode;\n      continue;\n    }\n    let id = target.id;\n    // if (!id.match(/-L\\d+F\\d+/)) {\n    if (!id) {\n      target = target.parentNode;\n      continue;\n    }\n    if (!id.match(/-L\\d+F\\d+/)) {\n      // find non-humdrum ID.\n      searchstring = 'xml:id=\"' + target.id + '\"';\n      regex = new RegExp(searchstring);\n      range = editor.find(regex, {\n        wrap: true,\n        caseSensitive: true,\n        wholeWord: true,\n      });\n      break;\n    }\n    // still need to verify if inside of svg element in the first place.\n    searchstring = 'xml:id=\"' + target.id + '\"';\n    regex = new RegExp(searchstring);\n    range = editor.find(regex, {\n      wrap: true,\n      caseSensitive: true,\n      wholeWord: true,\n    });\n    break; // assume that the first formatted id found is valid.\n  }\n}\n\nexport function humdrumDataIntoView(event) {\n  let target;\n  if (typeof event === 'string') {\n    target = document.querySelector('#' + event);\n  } else {\n    target = event.target;\n  }\n  let matches;\n  while (target) {\n    if (!target.id) {\n      target = target.parentNode;\n      continue;\n    }\n    matches = target.id.match(/-[^-]*L(\\d+)F(\\d+)/);\n    if (!matches) {\n      target = target.parentNode;\n      continue;\n    }\n\n    // TODO: Check this part\n    if (target.id.match(/^harm-L(\\d+)F(\\d+)/)) {\n      let line = parseInt(matches[1], 10);\n      let field = parseInt(matches[2], 10);\n\n      if (Number.isInteger(line) && Number.isInteger(field)) {\n        let inputChord = getEditorContents(line, field);\n        document.getElementById('chord-editor').value = inputChord;\n      }\n    }\n\n    global_cursor.HIGHLIGHTQUERY = target.id;\n    highlightIdInEditor(target.id, 'humdrumDataIntoView');\n    break;\n  }\n}\n//alx_\n\n//////////////////////////////\n//\n// displayScoreTextInEditor --\n//\n\nexport function displayScoreTextInEditor(text, page) {\n  let mode = getMode(text);\n\n  // if (mode != EditorMode) {\n  //   EditorMode = mode;\n  //   setEditorModeAndKeyboard();\n  // }\n\n  if (mode != editorMode()) {\n    // EditorMode = mode;\n    setEditorMode(mode);\n    setEditorModeAndKeyboard();\n  }\n\n  // -1 is to unselect added text, and move cursor to start\n  setTextInEditor(text);\n\n  // update the notation display\n  displayNotation(page);\n}\n\n//////////////////////////////\n//\n// toggleHumdrumCsvTsv --\n//\n\nexport function toggleHumdrumCsvTsv() {\n  console.log('converting from CSV TO TSV');\n  if (editorMode() == 'xml') {\n    // not editing Humdrum data\n    return;\n  }\n  // if (EditorMode == 'xml') {\n  //   // not editing Humdrum data\n  //   return;\n  // }\n  let data = getTextFromEditorNoCsvProcessing();\n  let lines = data.split('\\n');\n  for (let i = 0; i < lines.length; i++) {\n    if (lines[i].match(/^\\*\\*/)) {\n      if (lines[i].match(/,/)) {\n        console.log('CONVERTING TO TSV');\n        setTextInEditor(convertDataToTsv(lines));\n      } else {\n        console.log('CONVERTING TO CSV');\n        setTextInEditor(convertDataToCsv(lines));\n      }\n      break;\n    }\n  }\n}\n\n//////////////////////////////\n//\n// decreaseTab --\n//\n\nexport function decreaseTab() {\n  global_editorOptions.TABSIZE--;\n  if (global_editorOptions.TABSIZE < 1) {\n    global_editorOptions.TABSIZE = 1;\n  }\n  editor.getSession().setTabSize(global_editorOptions.TABSIZE);\n}\n\n//////////////////////////////\n//\n// increaseTab --\n//\n\nexport function increaseTab() {\n  global_editorOptions.TABSIZE++;\n  if (global_editorOptions.TABSIZE > 100) {\n    global_editorOptions.TABSIZE = 100;\n  }\n  editor.getSession().setTabSize(global_editorOptions.TABSIZE);\n}\n\n//////////////////////////////\n//\n// clearContent -- Used by the alt-e option or the erase button\n// in the main toolbar.\n//\nlet erasedData = '';\n\nexport function clearContent() {\n  let data = getTextFromEditorNoCsvProcessing();\n  moveToTopOfNotation();\n  if (data.match(/^\\s*$/)) {\n    // restore the text (which may have accidentally been erased)\n    setTextInEditor(erasedData);\n    displayFileTitle(erasedData);\n    restoreWorkNavigator();\n    // The left/right arrows are still active for navigating to\n    // other works in the repertory.\n  } else {\n    // Erase the text, but store it in a buffer in case\n    // the user wants to recall it if the editor is still empty.\n    erasedData = data;\n    setTextInEditor('');\n    let output = document.querySelector('#output');\n    if (output) {\n      output.innerHTML = '';\n    }\n    displayFileTitle('');\n    removeWorkNavigator();\n  }\n  editor.focus();\n}\n\n//////////////////////////////\n//\n// playCurrentMidi -- If a note is selected start playing from that note;\n//     otherwise, start from the start of the music.\n//\n\nimport { midiStop, midiUpdate, play_midi } from '../midifunctions.js';\nexport function playCurrentMidi(noteElem) {\n  if (!noteElem?.id) {\n    play_midi();\n    return;\n  }\n\n  vrvWorker.getTimeForElement(noteElem.id).then(function (time) {\n    play_midi(time);\n  });\n}\n\n//////////////////////////////\n//\n// setCursorNote --\n//\n\nexport function setCursorNote(item, location) {\n  global_cursor.CursorNote = item;\n  getMenu().showCursorNoteMenu(global_cursor.CursorNote);\n}\n\n//////////////////////////////\n//\n// hideRepertoryIndex --\n//\n\nexport function hideRepertoryIndex() {\n  let element = document.querySelector('#index');\n  if (element && element.style.display != 'none') {\n    element.style.display = 'none';\n    // element.style.visibility = \"hidden\";\n    let output = document.querySelector('#output');\n    if (output) {\n      console.log('FOCUSING ON OUTPUT');\n      output.focus();\n    }\n    global_interface.ShowingIndex = 0;\n  }\n}\n\n//////////////////////////////\n//\n// updateEditorMode -- Automatically detect the type of data and change edit mode:\n//\nimport { getMode } from './utility-ace.js';\nimport { getAceEditor } from './setup.js';\nimport { getMenu } from '../menu.js';\nimport splitter from './splitter.js';\nimport { layoutService } from '../state/layoutStateMachine.js';\nimport { removeByDocumentId } from '../api/comments.js';\nimport { getURLParams } from '../api/util.js';\nimport { yProvider } from '../yjs-setup.js';\n\nexport function updateEditorMode() {\n  if (!editor) {\n    return;\n  }\n  let text = getTextFromEditorRaw();\n  if (!text) {\n    // This check is needed to prevent intermediate\n    // states when the editor has been cleared in preparation\n    // for new contents.\n    // console.log(\"EDITOR IS EMPTY\");\n    return;\n  }\n  let shorttext = text.substring(0, 2000);\n  let xmod = getMode(shorttext);\n  if (xmod !== editorMode()) {\n    setEditorMode(xmod);\n    setEditorModeAndKeyboard();\n    console.log('Changing to', xmod, 'mode.');\n  }\n  // if (xmod !== EditorMode) {\n  //   EditorMode = xmod;\n  //   setEditorModeAndKeyboard();\n  //   console.log('Changing to', xmod, 'mode.');\n  // }\n}\n\n//////////////////////////////\n//\n// nextPageClick -- this is a click event for the next page.  If the shift key is\n//     pressed, go to the last page instead of the next page.\n//\n\nfunction nextPageClick(event) {\n  const menu = getMenu();\n  if (!event) {\n    menu.goToNextPage(event);\n  }\n  if (event.shiftKey) {\n    menu.goToLastPage(event);\n  } else {\n    menu.goToNextPage(event);\n  }\n}\n\n//////////////////////////////\n//\n// previousPageClick -- this is a click event for the previous page.\n//     If the shift key is pressed, go to the last page instead of\n//     the next page.\n//\n\nfunction previousPageClick(event) {\n  const menu = getMenu();\n\n  if (!event) {\n    menu.goToPreviousPage(event);\n  }\n  if (event.shiftKey) {\n    menu.goToFirstPage(event);\n  } else {\n    menu.goToPreviousPage(event);\n  }\n}\n\n//////////////////////////////\n//\n// copyToClipboard --\n//\n\nfunction copyToClipboard(string) {\n  // console.log(\"Copying\", string, \"to clipboard\");\n  let element = document.createElement('textarea');\n  element.value = string;\n  document.body.appendChild(element);\n  element.select();\n  document.execCommand('copy');\n  document.body.removeChild(element);\n}\n\n//////////////////////////////\n//\n// dataHasLineBreaks --\n//\n\nfunction dataHasLineBreaks(data) {\n  if (!data) {\n    data = getTextFromEditor();\n  }\n  // do something here ggg\n}\n\n//////////////////////////////\n//\n// removeLastLineInTextEditorIfMatches -- Remove the last non-empty line\n//    in the text editor if it matches the given input string.  This function\n//    is used by compileFilters() to remove the used GLOBALFILTER.\n//\n\nfunction removeLastLineInTextEditorIfMatches(line) {\n  if (!line) {\n    return;\n  }\n  let text = getTextFromEditor();\n  if (!text) {\n    return;\n  }\n  let lines = text.replace(/^\\s+/, '').replace(/\\s+$/, '').split(/\\r?\\n/);\n\n  let deleteindex = -1;\n  for (let i = lines.length - 1; i >= 0; i--) {\n    if (lines[i].match(/^\\s*$/)) {\n      continue;\n    }\n    if (lines[i] === line) {\n      deleteindex = i;\n      // also delete #@%! empty lines before the delete line\n      for (let j = deleteindex - 1; j <= 0; j--) {\n        if (lines[j].match(/^\\s*$/)) {\n          deleteindex--;\n          continue;\n        }\n        break;\n      }\n      break;\n    }\n    break;\n  }\n\n  if (deleteindex < 0) {\n    return;\n  }\n\n  let newtext = '';\n  for (let i = 0; i < deleteindex; i++) {\n    newtext += lines[i] + '\\n';\n  }\n\n  setTextInEditor(newtext);\n}\n\n//////////////////////////////\n//\n// moveToTopOfNotation --\n//\n\nfunction moveToTopOfNotation() {\n  global_verovioOptions.GOTOTOPOFNOTATION = true;\n}\n\n//////////////////////////////\n//\n// cleanFont --\n//\n\nexport function cleanFont(font) {\n  // Make sure that the font name is not corrupted:\n  let found = 0;\n  if (font.match(/bravura/i)) {\n    font = 'Bravura';\n    found = 1;\n  } else if (font.match(/goo?tvil?e?/i)) {\n    font = 'Gootville';\n    found = 1;\n  } else if (font.match(/leipzig/i)) {\n    font = 'Leipzig';\n    found = 1;\n  } else if (font.match(/leland/i)) {\n    font = 'Leland';\n    found = 1;\n  } else if (font.match(/petaluma/i)) {\n    font = 'Petaluma';\n    found = 1;\n  }\n  if (!found) {\n    font = 'Leland';\n  }\n  return font;\n}\n","//\n// Programmer:     Craig Stuart Sapp <craig@ccrma.stanford.edu>\n// Creation Date:  Mon Jun 27 04:31:26 PDT 2016\n// Last Modified:  Tue Dec 22 20:58:43 PST 2020\n// Filename:       drop.js\n// Web Address:    https://verovio.humdrum.org/scripts/drop.js\n// Syntax:         JavaScript 1.8/ECMAScript 5\n// vim:            ts=3: ft=javascript\n//\n// Description:   Event listeners for drag/drop of Humdrum files onto page.\n//\n\n/* global $ */\n\nvar DROPAREA = '';\n\n//////////////////////////////\n//\n// setupDropArea --\n//\n\nexport function setupDropArea(target) {\n  if (!target) {\n    target = '#dropArea';\n  }\n  var droparea = document.querySelector(target);\n  DROPAREA = droparea;\n\n  window.addEventListener('dragenter', function (event) {\n    showDropArea();\n  });\n\n  droparea.addEventListener('dragenter', allowDrag);\n  droparea.addEventListener('dragover', allowDrag);\n  droparea.addEventListener('dragleave', function (event) {\n    hideDropArea();\n  });\n  droparea.addEventListener('drop', handleDrop);\n}\n\n//////////////////////////////\n//\n// showDropArea --\n//\n\nfunction showDropArea(droparea) {\n  if (!droparea) {\n    droparea = DROPAREA;\n  }\n  droparea.style.visibility = 'visible';\n}\n\n//////////////////////////////\n//\n// hideDropArea --\n//\n\nfunction hideDropArea(droparea) {\n  if (!droparea) {\n    droparea = DROPAREA;\n  }\n  droparea.style.visibility = 'hidden';\n}\n\n//////////////////////////////\n//\n// allowDrag --\n//\n\nfunction allowDrag(event) {\n  if (true) {\n    // Test that the item being dragged is a valid one\n    event.dataTransfer.dropEffect = 'copy';\n    event.preventDefault();\n  }\n}\n\n//////////////////////////////\n//\n// handleDrop --\n//\nimport { replaceEditorContentWithHumdrumFile } from './vhv-scripts/misc.js';\nimport { getAceEditor } from './vhv-scripts/setup.js';\n\nfunction handleDrop(event) {\n  event.preventDefault();\n  $('html').css('cursor', 'wait');\n  hideDropArea();\n  var file;\n  var files = event.dataTransfer.files;\n  for (var i = 0; i < files.length; i++) {\n    file = files[i];\n    // console.log(\"NAME\", escape(file.name));\n    // console.log(\"SIZE\", file.size);\n    // console.log(\"DATE\", file.lastModifiedDate.toLocaleDateString());\n\n    var reader = new FileReader();\n\n    // reader.readAsDataURL(file); // loads MIME64 version of file\n    // reader.readAsBinaryString(file);\n    // file has to be read as Text with UTF-8 encoding\n    // in order that files with UTF-8 characters are read\n    // properly:\n    reader.readAsText(file, 'UTF-8');\n\n    var myevent = event;\n\n    reader.onload = function (event) {\n      var contents = reader.result;\n      if (myevent.shiftKey) {\n        replaceEditorContentWithHumdrumFile(contents);\n      } else {\n        getAceEditor().setValue(contents, -1);\n      }\n\n      $('html').css('cursor', 'auto');\n    };\n\n    // Only reading the first file if more than one.\n    // Maybe allow multiple files, but then the order\n    // might be undefined.  Alternatively allow a method\n    // of appending a data file to the end of the text (such\n    // as if the control key is held down when drag-and-dropping.\n    break;\n  }\n}\n","// Watch for addition/removal of a specific class attribute on a DOM element\n// https://stackoverflow.com/questions/10612024/event-trigger-on-a-class-change\nexport class ClassWatcher {\n  constructor(\n    targetNode,\n    classToWatch,\n    classAddedCallback,\n    classRemovedCallback\n  ) {\n    this.targetNode = targetNode;\n    this.classToWatch = classToWatch;\n    this.classAddedCallback = classAddedCallback;\n    this.classRemovedCallback = classRemovedCallback;\n    this.observer = null;\n    this.lastClassState = targetNode.classList.contains(this.classToWatch);\n\n    this.init();\n  }\n\n  init() {\n    this.observer = new MutationObserver(this.mutationCallback);\n    this.observe();\n  }\n\n  observe() {\n    this.observer.observe(this.targetNode, { attributes: true });\n  }\n\n  disconnect() {\n    this.observer.disconnect();\n  }\n\n  mutationCallback = (mutationsList) => {\n    for (let mutation of mutationsList) {\n      if (mutation.type === 'attributes' &&\n        mutation.attributeName === 'class') {\n        let currentClassState = mutation.target.classList.contains(\n          this.classToWatch\n        );\n        if (this.lastClassState !== currentClassState) {\n          this.lastClassState = currentClassState;\n          if (currentClassState) {\n            this.classAddedCallback();\n          } else {\n            this.classRemovedCallback();\n          }\n        }\n      }\n    }\n  };\n}\n","/* Click listeners for navbar menu items generated by src/generate-menu-DOM.js */\nimport { getMenu } from './menu.js';\nimport { ClassWatcher } from './collaboration/ClassWatcher.js';\n\nconst menu = getMenu();\n\ndocument\n  .querySelector('#open__submenu-item')\n  .addEventListener('click', () => menu.openScoreFileFromDisk());\ndocument\n  .querySelector('#save-editor-contents__submenu-item')\n  .addEventListener('click', () => menu.saveTextEditorContents());\ndocument\n  .querySelector('#save-as-midi__submenu-item')\n  .addEventListener('click', () => menu.saveAsMIDI());\ndocument\n  .querySelector('#save-as-pdf__submenu-item')\n  .addEventListener('click', () => menu.createPdf());\ndocument\n  .querySelector('#save-view-as-pdf__submenu-item')\n  .addEventListener('click', () => menu.createPdfPage());\ndocument\n  .querySelector('#save-view-as-svg__submenu-item')\n  .addEventListener('click', () => menu.saveSvgData());\ndocument\n  .querySelector('#save-as-musicxml__submenu-item')\n  .addEventListener('click', () => menu.convertToMusicXmlAndSave());\ndocument\n  .querySelector('#display-mei-data__submenu-item')\n  .addEventListener('click', () => menu.displayMeiData());\ndocument\n  .querySelector('#display-humdrum-data__submenu-item')\n  .addEventListener('click', () => menu.displayHumdrumData());\ndocument\n  .querySelector('#save-to-buffer-1__submenu-item')\n  .addEventListener('click', () => menu.saveToBuffer(1));\ndocument\n  .querySelector('#save-to-buffer-2__submenu-item')\n  .addEventListener('click', () => menu.saveToBuffer(2));\ndocument\n  .querySelector('#save-to-buffer-3__submenu-item')\n  .addEventListener('click', () => menu.saveToBuffer(3));\ndocument\n  .querySelector('#save-to-buffer-4__submenu-item')\n  .addEventListener('click', () => menu.saveToBuffer(4));\ndocument\n  .querySelector('#save-to-buffer-5__submenu-item')\n  .addEventListener('click', () => menu.saveToBuffer(5));\ndocument\n  .querySelector('#save-to-buffer-6__submenu-item')\n  .addEventListener('click', () => menu.saveToBuffer(6));\ndocument\n  .querySelector('#save-to-buffer-7__submenu-item')\n  .addEventListener('click', () => menu.saveToBuffer(7));\ndocument\n  .querySelector('#save-to-buffer-8__submenu-item')\n  .addEventListener('click', () => menu.saveToBuffer(8));\ndocument\n  .querySelector('#save-to-buffer-9__submenu-item')\n  .addEventListener('click', () => menu.saveToBuffer(9));\ndocument\n  .querySelector('#load-from-buffer-1__submenu-item')\n  .addEventListener('click', () => menu.loadFromBuffer(1));\ndocument\n  .querySelector('#load-from-buffer-2__submenu-item')\n  .addEventListener('click', () => menu.loadFromBuffer(2));\ndocument\n  .querySelector('#load-from-buffer-3__submenu-item')\n  .addEventListener('click', () => menu.loadFromBuffer(3));\ndocument\n  .querySelector('#load-from-buffer-4__submenu-item')\n  .addEventListener('click', () => menu.loadFromBuffer(4));\ndocument\n  .querySelector('#load-from-buffer-5__submenu-item')\n  .addEventListener('click', () => menu.loadFromBuffer(5));\ndocument\n  .querySelector('#load-from-buffer-6__submenu-item')\n  .addEventListener('click', () => menu.loadFromBuffer(6));\ndocument\n  .querySelector('#load-from-buffer-7__submenu-item')\n  .addEventListener('click', () => menu.loadFromBuffer(7));\ndocument\n  .querySelector('#load-from-buffer-8__submenu-item')\n  .addEventListener('click', () => menu.loadFromBuffer(8));\ndocument\n  .querySelector('#load-from-buffer-9__submenu-item')\n  .addEventListener('click', () => menu.loadFromBuffer(9));\ndocument\n  .querySelector('#load-from-autosave-buffer__submenu-item')\n  .addEventListener('click', () => menu.loadFromBuffer(0));\ndocument\n  .querySelector('#reload-data-from-source__submenu-item')\n  .addEventListener('click', () => menu.reloadFromSource());\ndocument\n  .querySelector('#convert-to-humdrum__submenu-item')\n  .addEventListener('click', () => menu.convertToHumdrum());\ndocument\n  .querySelector('#toggle-csv-tsv__submenu-item')\n  .addEventListener('click', () => menu.toggleCsvTsv());\ndocument\n  .querySelector('#play-pause-midi-performance__submenu-item')\n  .addEventListener('click', () => menu.toggleMidiPlayback());\ndocument\n  .querySelector('#make-notation-larger__submenu-item')\n  .addEventListener('click', () => menu.adjustNotationScale(event, 1.05));\ndocument\n  .querySelector('#make-notation-smaller__submenu-item')\n  .addEventListener('click', () => menu.adjustNotationScale(event, 0.95));\ndocument\n  .querySelector('#increase-horizontal-notation-spacing__submenu-item')\n  .addEventListener('click', () => menu.increaseNotationSpacing());\ndocument\n  .querySelector('#decrease-horizontal-notation-spacing__submenu-item')\n  .addEventListener('click', () => menu.decreaseNotationSpacing());\ndocument\n  .querySelector('#increase-vertical-staff-spacing__submenu-item')\n  .addEventListener('click', () => menu.increaseStaffSpacing());\ndocument\n  .querySelector('#decrease-vertical-staff-spacing__submenu-item')\n  .addEventListener('click', () => menu.decreaseStaffSpacing());\ndocument\n  .querySelector('#increase-vertical-system-spacing__submenu-item')\n  .addEventListener('click', () => menu.increaseSystemSpacing());\ndocument\n  .querySelector('#decrease-vertical-system-spacing__submenu-item')\n  .addEventListener('click', () => menu.decreaseSystemSpacing());\ndocument\n  .querySelector('#ignore-encoded-line-breaks__submenu-item')\n  .addEventListener('click', () => menu.lineBreaksOff());\ndocument\n  .querySelector('#display-with-encoded-line-breaks__submenu-item')\n  .addEventListener('click', () => menu.lineBreaksOn());\ndocument\n  .querySelector('#increase-text-size__submenu-item')\n  .addEventListener('click', () => menu.increaseLyricSize());\ndocument\n  .querySelector('#decrease-text-size__submenu-item')\n  .addEventListener('click', () => menu.decreaseLyricSize());\ndocument\n  .querySelector('#auto-tab-width__submenu-item')\n  .addEventListener('click', () => menu.fitTabSizeToData());\ndocument\n  .querySelector('#increase-tab-width__submenu-item')\n  .addEventListener('click', () => menu.increaseTabSize());\ndocument\n  .querySelector('#decrease-tab-width__submenu-item')\n  .addEventListener('click', () => menu.decreaseTabSize());\ndocument\n  .querySelector('#start-splitting--32-measure-splits-__submenu-item')\n  .addEventListener('click', () => menu.startSplit(32));\ndocument\n  .querySelector('#next-split__submenu-item')\n  .addEventListener('click', () => menu.nextSplit(32));\ndocument\n  .querySelector('#previous-split__submenu-item')\n  .addEventListener('click', () => menu.previousSplit(32));\ndocument\n  .querySelector('#remove-splits__submenu-item')\n  .addEventListener('click', () => menu.removeSplits());\ndocument\n  .querySelector('#bravura__submenu-item')\n  .addEventListener('click', () => menu.useBravuraFont());\ndocument\n  .querySelector('#gootville__submenu-item')\n  .addEventListener('click', () => menu.useGootvilleFont());\ndocument\n  .querySelector('#leipzig__submenu-item')\n  .addEventListener('click', () => menu.useLeipzigFont());\ndocument\n  .querySelector('#leland__submenu-item')\n  .addEventListener('click', () => menu.useLelandFont());\ndocument\n  .querySelector('#petaluma__submenu-item')\n  .addEventListener('click', () => menu.usePetalumaFont());\ndocument\n  .querySelector('#toggle-text-display__submenu-item')\n  .addEventListener('click', () => menu.toggleDataDisplay());\ndocument\n  .querySelector('#increase-font-size__submenu-item')\n  .addEventListener('click', (e) => menu.increaseTextFontSize(e));\ndocument\n  .querySelector('#decrease-font-size__submenu-item')\n  .addEventListener('click', (e) => menu.decreaseTextFontSize(e));\ndocument\n  .querySelector('#toggle-csv-tsv-humdrum-display__submenu-item')\n  .addEventListener('click', () => menu.toggleCsvTsv());\ndocument\n  .querySelector('#toggle-layer-highlighting__submenu-item')\n  .addEventListener('click', () => menu.toggleLayerHighlighting());\ndocument\n  .querySelector('#freeze-unfreeze-notation-rendering__submenu-item')\n  .addEventListener('click', () => menu.toggleNotationFreezing());\ndocument\n  .querySelector('#toggle-original-clefs__submenu-item')\n  .addEventListener('click', () => menu.toggleOriginalClefs());\ndocument\n  .querySelector('#clear-text-editor__submenu-item')\n  .addEventListener('click', () => menu.clearEditorContents());\ndocument\n  .querySelector('#undo-last-change__submenu-item')\n  .addEventListener('click', () => menu.undo());\ndocument\n  .querySelector('#compile-embedded-filters__submenu-item')\n  .addEventListener('click', () => menu.compileEmbeddedFilters());\ndocument\n  .querySelector('#remove-trailing-tabs__submenu-item')\n  .addEventListener('click', () => menu.trimTabsInEditor());\ndocument\n  .querySelector('#beam-by-meter__submenu-item')\n  .addEventListener('click', () => menu.applyFilter('autobeam'));\ndocument\n  .querySelector('#split-beams-by-lyrics__submenu-item')\n  .addEventListener('click', () => menu.applyFilter('autobeam -l'));\ndocument\n  .querySelector('#remove-beams__submenu-item')\n  .addEventListener('click', () => menu.applyFilter('autobeam -r'));\ndocument\n  .querySelector('#sort-chords-highest-note-first__submenu-item')\n  .addEventListener('click', () => menu.applyFilter('chord -d'));\ndocument\n  .querySelector('#sort-chords-lowest-note-first__submenu-item')\n  .addEventListener('click', () => menu.applyFilter('chord -u'));\ndocument\n  .querySelector('#extract-first-note-in-chord__submenu-item')\n  .addEventListener('click', () => menu.applyFilter('chord -f'));\ndocument\n  .querySelector('#extract-last-note-in-chord__submenu-item')\n  .addEventListener('click', () => menu.applyFilter('chord -l'));\ndocument\n  .querySelector('#highest-note-in-chord__submenu-item')\n  .addEventListener('click', () => menu.applyFilter('chord -d | chord -f'));\ndocument\n  .querySelector('#lowest-note-in-chord__submenu-item')\n  .addEventListener('click', () => menu.applyFilter('chord -u | chord -f'));\ndocument\n  .querySelector('#compress-chords__submenu-item')\n  .addEventListener('click', () => menu.applyFilter('chord -m'));\ndocument\n  .querySelector('#expand-chords__submenu-item')\n  .addEventListener('click', () => menu.applyFilter('chord -M'));\ndocument\n  .querySelector(\n    '#bass-melody-chord-notes--for-grand-staff-scores-__submenu-item'\n  )\n  .addEventListener('click', () =>\n    menu.applyFilter('chord -u | chord -fs1 | chord -ls2')\n  );\ndocument\n  .querySelector('#insert-local-comment-line--above-cursor-__submenu-item')\n  .addEventListener('click', () => menu.insertLocalCommentLine());\ndocument\n  .querySelector('#insert-null-data-line--above-cursor-__submenu-item')\n  .addEventListener('click', () => menu.insertNullDataLine());\ndocument\n  .querySelector('#insert-barline--above-cursor-__submenu-item')\n  .addEventListener('click', () => menu.insertBarline());\ndocument\n  .querySelector('#remove-null-lines__submenu-item')\n  .addEventListener('click', () => menu.applyFilter('rid -glid'));\ndocument\n  .querySelector('#remove-null-data-lines__submenu-item')\n  .addEventListener('click', () => menu.applyFilter('rid -d'));\ndocument\n  .querySelector('#remove-null-interpretation-lines__submenu-item')\n  .addEventListener('click', () => menu.applyFilter('rid -i'));\ndocument\n  .querySelector('#remove-null-local-comment-lines__submenu-item')\n  .addEventListener('click', () => menu.applyFilter('rid -l'));\ndocument\n  .querySelector('#remove-accidentals-from-trills-and-ornaments__submenu-item')\n  .addEventListener('click', () => menu.applyFilter('trillspell'));\ndocument\n  .querySelector('#remove-non-kern-spines__submenu-item')\n  .addEventListener('click', () => menu.applyFilter('extract -i kern'));\ndocument\n  .querySelector('#add-staff-above-system__submenu-item')\n  .addEventListener('click', () =>\n    menu.applyFilter('extract -s 1-$,0 | restfill -i blank')\n  );\ndocument\n  .querySelector('#add-staff-above-system-with-hidden-rests__submenu-item')\n  .addEventListener('click', () =>\n    menu.applyFilter('extract -s 1-$,0 | restfill -yi blank')\n  );\ndocument\n  .querySelector('#add-staff-below-system__submenu-item')\n  .addEventListener('click', () =>\n    menu.applyFilter('extract -s 0,1-$ | restfill -i blank')\n  );\ndocument\n  .querySelector('#add-staff-below-system-with-hidden-rests__submenu-item')\n  .addEventListener('click', () =>\n    menu.applyFilter('extract -s 0,1-$ | restfill -yi blank')\n  );\ndocument\n  .querySelector('#add-note-stem-directions__submenu-item')\n  .addEventListener('click', () => menu.applyFilter('autostem'));\ndocument\n  .querySelector('#remove-note-stem-directions__submenu-item')\n  .addEventListener('click', () => menu.applyFilter('autostem -r'));\ndocument\n  .querySelector('#add-lyric-verse-to-top-staff__submenu-item')\n  .addEventListener('click', () =>\n    menu.applyFilter('extract -s 1-$,0 -n text')\n  );\ndocument\n  .querySelector('#remove-lyric-text__submenu-item')\n  .addEventListener('click', () => menu.applyFilter('extract -I text'));\ndocument\n  .querySelector('#split-beams-by-lyrics__submenu-item')\n  .addEventListener('click', () => menu.applyFilter('autobeam -l'));\ndocument\n  .querySelector('#tonic-to-c__submenu-item')\n  .addEventListener('click', () => menu.applyFilter('transpose -k c'));\ndocument\n  .querySelector('#tonic-to-c-sharp-__submenu-item')\n  .addEventListener('click', () => menu.applyFilter('transpose -k c#'));\ndocument\n  .querySelector('#tonic-to-d-flat-__submenu-item')\n  .addEventListener('click', () => menu.applyFilter('transpose -k d-'));\ndocument\n  .querySelector('#tonic-to-d__submenu-item')\n  .addEventListener('click', () => menu.applyFilter('transpose -k d'));\ndocument\n  .querySelector('#tonic-to-e-flat-__submenu-item')\n  .addEventListener('click', () => menu.applyFilter('transpose -k e-'));\ndocument\n  .querySelector('#tonic-to-e__submenu-item')\n  .addEventListener('click', () => menu.applyFilter('transpose -k e'));\ndocument\n  .querySelector('#tonic-to-f__submenu-item')\n  .addEventListener('click', () => menu.applyFilter('transpose -k f'));\ndocument\n  .querySelector('#tonic-to-f-sharp-__submenu-item')\n  .addEventListener('click', () => menu.applyFilter('transpose -k f#'));\ndocument\n  .querySelector('#tonic-to-g__submenu-item')\n  .addEventListener('click', () => menu.applyFilter('transpose -k g'));\ndocument\n  .querySelector('#tonic-to-a-flat-__submenu-item')\n  .addEventListener('click', () => menu.applyFilter('transpose -k a-'));\ndocument\n  .querySelector('#tonic-to-a__submenu-item')\n  .addEventListener('click', () => menu.applyFilter('transpose -k a'));\ndocument\n  .querySelector('#tonic-to-b-flat-__submenu-item')\n  .addEventListener('click', () => menu.applyFilter('transpose -k b-'));\ndocument\n  .querySelector('#tonic-to-b__submenu-item')\n  .addEventListener('click', () => menu.applyFilter('transpose -k b'));\ndocument\n  .querySelector('#up-a-minor-second__submenu-item')\n  .addEventListener('click', () => menu.applyFilter('transpose -t m2'));\ndocument\n  .querySelector('#up-a-major-second__submenu-item')\n  .addEventListener('click', () => menu.applyFilter('transpose -t M2'));\ndocument\n  .querySelector('#up-a-minor-third__submenu-item')\n  .addEventListener('click', () => menu.applyFilter('transpose -t m3'));\ndocument\n  .querySelector('#up-a-major-third__submenu-item')\n  .addEventListener('click', () => menu.applyFilter('transpose -t M3'));\ndocument\n  .querySelector('#up-a-perfect-fourth__submenu-item')\n  .addEventListener('click', () => menu.applyFilter('transpose -t P4'));\ndocument\n  .querySelector('#up-an-augmented-fourth__submenu-item')\n  .addEventListener('click', () => menu.applyFilter('transpose -t A4'));\ndocument\n  .querySelector('#up-a-diminished-fifth__submenu-item')\n  .addEventListener('click', () => menu.applyFilter('transpose -t d5'));\ndocument\n  .querySelector('#up-a-perfect-fifth__submenu-item')\n  .addEventListener('click', () => menu.applyFilter('transpose -t P5'));\ndocument\n  .querySelector('#up-a-minor-sixth__submenu-item')\n  .addEventListener('click', () => menu.applyFilter('transpose -t m6'));\ndocument\n  .querySelector('#up-a-major-sixth__submenu-item')\n  .addEventListener('click', () => menu.applyFilter('transpose -t M6'));\ndocument\n  .querySelector('#up-a-minor-seventh__submenu-item')\n  .addEventListener('click', () => menu.applyFilter('transpose -t m7'));\ndocument\n  .querySelector('#up-a-major-seventh__submenu-item')\n  .addEventListener('click', () => menu.applyFilter('transpose -t M7'));\ndocument\n  .querySelector('#up-a-perfect-octave__submenu-item')\n  .addEventListener('click', () => menu.applyFilter('transpose -t P8'));\ndocument\n  .querySelector('#down-a-minor-second__submenu-item')\n  .addEventListener('click', () => menu.applyFilter('transpose -t -m2'));\ndocument\n  .querySelector('#down-a-major-second__submenu-item')\n  .addEventListener('click', () => menu.applyFilter('transpose -t -M2'));\ndocument\n  .querySelector('#down-a-minor-third__submenu-item')\n  .addEventListener('click', () => menu.applyFilter('transpose -t -m3'));\ndocument\n  .querySelector('#down-a-major-third__submenu-item')\n  .addEventListener('click', () => menu.applyFilter('transpose -t -M3'));\ndocument\n  .querySelector('#down-a-perfect-fourth__submenu-item')\n  .addEventListener('click', () => menu.applyFilter('transpose -t -P4'));\ndocument\n  .querySelector('#down-an-augmented-fourth__submenu-item')\n  .addEventListener('click', () => menu.applyFilter('transpose -t -A4'));\ndocument\n  .querySelector('#down-an-diminished-fifth__submenu-item')\n  .addEventListener('click', () => menu.applyFilter('transpose -t -d5'));\ndocument\n  .querySelector('#down-a-perfect-fifth__submenu-item')\n  .addEventListener('click', () => menu.applyFilter('transpose -t -P5'));\ndocument\n  .querySelector('#down-a-minor-sixth__submenu-item')\n  .addEventListener('click', () => menu.applyFilter('transpose -t -m6'));\ndocument\n  .querySelector('#down-a-major-sixth__submenu-item')\n  .addEventListener('click', () => menu.applyFilter('transpose -t -M6'));\ndocument\n  .querySelector('#down-a-minor-seventh__submenu-item')\n  .addEventListener('click', () => menu.applyFilter('transpose -t -m7'));\ndocument\n  .querySelector('#down-a-major-seventh__submenu-item')\n  .addEventListener('click', () => menu.applyFilter('transpose -t -M7'));\ndocument\n  .querySelector('#down-a-perfect-octave__submenu-item')\n  .addEventListener('click', () => menu.applyFilter('transpose -t -P8'));\ndocument\n  .querySelector('#tassoize__submenu-item')\n  .addEventListener('click', () => menu.applyFilter('tassoize'));\ndocument\n  .querySelector('#force-beam-above__submenu-item')\n  .addEventListener('click', () => menu.forceBeamAbove());\ndocument\n  .querySelector('#force-beam-below__submenu-item')\n  .addEventListener('click', () => menu.forceBeamBelow());\ndocument\n  .querySelector('#clear-beam-direction__submenu-item')\n  .addEventListener('click', () => menu.removeBeamOrientation());\ndocument\n  .querySelector('#next-melodic-note__submenu-item')\n  .addEventListener('click', () => menu.nextMelodicNote());\ndocument\n  .querySelector('#previous-melodic-note__submenu-item')\n  .addEventListener('click', () => menu.previousMelodicNote());\ndocument\n  .querySelector('#next-harmonic-note__submenu-item')\n  .addEventListener('click', () => menu.nextHarmonicNote());\ndocument\n  .querySelector('#previous-harmonic-note__submenu-item')\n  .addEventListener('click', () => menu.previousHarmonicNote());\ndocument\n  .querySelector('#up-a-step__submenu-item')\n  .addEventListener('click', () => menu.pitchUpStep(1));\ndocument\n  .querySelector('#down-a-step__submenu-item')\n  .addEventListener('click', () => menu.pitchDownStep(1));\ndocument\n  .querySelector('#up-an-octave__submenu-item')\n  .addEventListener('click', () => menu.pitchUpOctave(1));\ndocument\n  .querySelector('#down-an-octave__submenu-item')\n  .addEventListener('click', () => menu.pitchDownOctave(1));\ndocument\n  .querySelector('#up-a-fifth__submenu-item')\n  .addEventListener('click', () => menu.pitchUpStep(5));\ndocument\n  .querySelector('#down-a-third__submenu-item')\n  .addEventListener('click', () => menu.pitchDownStep(3));\ndocument\n  .querySelector('#force-stem-above__submenu-item')\n  .addEventListener('click', () => menu.forceNoteStemUp());\ndocument\n  .querySelector('#force-stem-below__submenu-item')\n  .addEventListener('click', () => menu.forceNoteStemUp());\ndocument\n  .querySelector('#clear-stem-direction__submenu-item')\n  .addEventListener('click', () => menu.removeStemDirection());\ndocument\n  .querySelector('#toggle-natural-accidental__submenu-item')\n  .addEventListener('click', () => menu.toggleNaturalAccidental());\ndocument\n  .querySelector('#toggle-sharp-accidental__submenu-item')\n  .addEventListener('click', () => menu.toggleSharpAccidental());\ndocument\n  .querySelector('#toggle-flat-accidental__submenu-item')\n  .addEventListener('click', () => menu.toggleFlatAccidental());\ndocument\n  .querySelector('#toggle-forced-display-of-accidental__submenu-item')\n  .addEventListener('click', () => menu.toggleForcedDisplay());\ndocument\n  .querySelector('#toggle-editorial-accidental__submenu-item')\n  .addEventListener('click', () => menu.toggleEditorialAccidental());\ndocument\n  .querySelector('#toggle-staccato__submenu-item')\n  .addEventListener('click', () => menu.toggleStaccato());\ndocument\n  .querySelector('#toggle-staccatissimo__submenu-item')\n  .addEventListener('click', () => menu.toggleStaccatissimo());\ndocument\n  .querySelector('#toggle-tenuto__submenu-item')\n  .addEventListener('click', () => menu.toggleTenuto());\ndocument\n  .querySelector('#toggle-accent__submenu-item')\n  .addEventListener('click', () => menu.toggleAccent());\ndocument\n  .querySelector('#toggle-marcato__submenu-item')\n  .addEventListener('click', () => menu.toggleMarcato());\ndocument\n  .querySelector('#toggle-fermata__submenu-item')\n  .addEventListener('click', () => menu.toggleFermata());\ndocument\n  .querySelector('#toggle-arpeggio__submenu-item')\n  .addEventListener('click', () => menu.toggleArpeggio());\ndocument\n  .querySelector('#toggle-minor-trill__submenu-item')\n  .addEventListener('click', () => menu.toggleMinorTrill());\ndocument\n  .querySelector('#toggle-major-trill__submenu-item')\n  .addEventListener('click', () => menu.toggleMajorTrill());\ndocument\n  .querySelector('#toggle-minor-lower-mordent__submenu-item')\n  .addEventListener('click', () => menu.toggleMinorLowerMordent());\ndocument\n  .querySelector('#toggle-major-lower-mordent__submenu-item')\n  .addEventListener('click', () => menu.toggleMajorLowerMordent());\ndocument\n  .querySelector('#toggle-minor-upper-mordent__submenu-item')\n  .addEventListener('click', () => menu.toggleMinorUpperMordent());\ndocument\n  .querySelector('#toggle-major-upper-mordent__submenu-item')\n  .addEventListener('click', () => menu.toggleMajorUpperMordent());\ndocument\n  .querySelector('#add-slur-to-next-note__submenu-item')\n  .addEventListener('click', () => menu.addSlur(1));\ndocument\n  .querySelector('#break-beam-before-note__submenu-item')\n  .addEventListener('click', () => menu.breakBeamBeforeNote());\ndocument\n  .querySelector('#break-beam-after-note__submenu-item')\n  .addEventListener('click', () => menu.breakBeamAfterNote());\ndocument\n  .querySelector('#toggle-pedal-down-before-note__submenu-item')\n  .addEventListener('click', () => menu.togglePedalDown());\ndocument\n  .querySelector('#toggle-pedal-up-after-note__submenu-item')\n  .addEventListener('click', () => menu.togglePedalUp());\ndocument\n  .querySelector('#toggle-gracenote-style__submenu-item')\n  .addEventListener('click', () => menu.toggleGraceNoteStyle());\ndocument\n  .querySelector('#toggle---mark__submenu-item')\n  .addEventListener('click', () => menu.toggleAtMark());\ndocument\n  .querySelector('#next-melodic-note__submenu-item')\n  .addEventListener('click', () => menu.nextMelodicNote());\ndocument\n  .querySelector('#previous-melodic-note__submenu-item')\n  .addEventListener('click', () => menu.previousMelodicNote());\ndocument\n  .querySelector('#next-harmonic-note__submenu-item')\n  .addEventListener('click', () => menu.nextHarmonicNote());\ndocument\n  .querySelector('#previous-harmonic-note__submenu-item')\n  .addEventListener('click', () => menu.previousHarmonicNote());\ndocument\n  .querySelector('#make-rest-invisible__submenu-item')\n  .addEventListener('click', () => menu.makeRestInvisible());\ndocument\n  .querySelector('#force-slur-above__submenu-item')\n  .addEventListener('click', () => menu.forceSlurAbove());\ndocument\n  .querySelector('#force-slur-below__submenu-item')\n  .addEventListener('click', () => menu.forceSlurBelow());\ndocument\n  .querySelector('#clear-slur-direction__submenu-item')\n  .addEventListener('click', () => menu.removeSlurOrientation());\ndocument\n  .querySelector('#delete-slur__submenu-item')\n  .addEventListener('click', () => menu.deleteSlur());\ndocument\n  .querySelector('#move-slur-start-left__submenu-item')\n  .addEventListener('click', () => menu.moveSlurStart(-1));\ndocument\n  .querySelector('#move-slur-start-right__submenu-item')\n  .addEventListener('click', () => menu.moveSlurStart(1));\ndocument\n  .querySelector('#move-slur-end-left__submenu-item')\n  .addEventListener('click', () => menu.moveSlurEnd(-1));\ndocument\n  .querySelector('#move-slur-end-right__submenu-item')\n  .addEventListener('click', () => menu.moveSlurEnd(1));\ndocument\n  .querySelector('#move-slur-end-3-notes-right__submenu-item')\n  .addEventListener('click', () => menu.moveSlurEnd(3));\ndocument\n  .querySelector('#force-tie-above__submenu-item')\n  .addEventListener('click', () => menu.forceTieAbove());\ndocument\n  .querySelector('#force-tie-below__submenu-item')\n  .addEventListener('click', () => menu.forceTieBelow());\ndocument\n  .querySelector('#clear-tie-direction__submenu-item')\n  .addEventListener('click', () => menu.removeTieOrientation());\ndocument\n  .querySelector('#bach-370-chorales__submenu-item')\n  .addEventListener('click', () => menu.loadRepertory('chorales'));\ndocument\n  .querySelector('#bach-wtc-fugues__submenu-item')\n  .addEventListener('click', () => menu.loadRepertory('bach-wtc-fugues'));\ndocument\n  .querySelector('#beethoven-piano-sonatas__submenu-item')\n  .addEventListener('click', () => menu.loadRepertory('beethoven/sonatas'));\ndocument\n  .querySelector('#beethoven-string-quartets__submenu-item')\n  .addEventListener('click', () => menu.loadRepertory('beethoven/quartets'));\ndocument\n  .querySelector('#chopin-first-editions__submenu-item')\n  .addEventListener('click', () => menu.loadRepertory('chopin-first-editions'));\ndocument\n  .querySelector('#chopin-mazurkas__submenu-item')\n  .addEventListener('click', () => menu.loadRepertory('chopin/mazurkas'));\ndocument\n  .querySelector('#haydn-keyboard-sonatas__submenu-item')\n  .addEventListener('click', () => menu.loadRepertory('haydn/sonatas'));\ndocument\n  .querySelector('#hummel-preludes--op--67__submenu-item')\n  .addEventListener('click', () => menu.loadRepertory('hummel/preludes'));\ndocument\n  .querySelector('#joplin__submenu-item')\n  .addEventListener('click', () => menu.loadRepertory('joplin'));\ndocument\n  .querySelector('#mozart-piano-sonatas__submenu-item')\n  .addEventListener('click', () => menu.loadRepertory('mozart/sonatas'));\ndocument\n  .querySelector(\n    '#mozart--100-contradances--k-sup-6--sup--anh--c30-01__submenu-item'\n  )\n  .addEventListener('click', () => menu.loadRepertory('mozart/sonatas'));\ndocument\n  .querySelector('#scarlatti-sonatas__submenu-item')\n  .addEventListener('click', () => menu.loadRepertory('scarlatti/sonatas'));\ndocument\n  .querySelector('#barbershop-quartets__submenu-item')\n  .addEventListener('click', () => menu.loadRepertory('osu/barbershop'));\ndocument\n  .querySelector('#barbershop-quartets--grand-staff-__submenu-item')\n  .addEventListener('click', () =>\n    menu.loadRepertory('osu/barbershop', satb2gs)\n  );\ndocument\n  .querySelector('#deutscher-liderschatz__submenu-item')\n  .addEventListener('click', () => menu.loadRepertory('liederschatz1'));\ndocument\n  .querySelector('#polyrhythm-project__submenu-item')\n  .addEventListener('click', () => menu.loadRepertory('poly'));\ndocument\n  .querySelector('#show-comments__submenu-item')\n  .addEventListener('click', () => menu.showComments());\ndocument\n  .querySelector('#hide-comments__submenu-item')\n  .addEventListener('click', () => menu.hideComments());\n\ndocument.querySelectorAll('li.dropdown').forEach(\n  (item) =>\n    new ClassWatcher(\n      item,\n      'show',\n      () => {\n        document.documentElement.style.setProperty('--collab-layer-zIndex', 1);\n      },\n      () => {\n        document.documentElement.style.setProperty(\n          '--collab-layer-zIndex',\n          1000\n        );\n      }\n    )\n);\n"],"names":["editor","commentState","commentService.removeById","html","commentService.create","render","Y.Doc","Cookies","Y.UndoManager","userService.getByDocumentId","classMap","vrvWorker","cleanRepertoryEntryText"],"mappings":"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"}