var go=Object.defineProperty,ho=Object.defineProperties;var po=Object.getOwnPropertyDescriptors;var Yt=Object.getOwnPropertySymbols;var vo=Object.prototype.hasOwnProperty,yo=Object.prototype.propertyIsEnumerable;var ft=(t,e,r)=>e in t?go(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,oe=(t,e)=>{for(var r in e||(e={}))vo.call(e,r)&&ft(t,r,e[r]);if(Yt)for(var r of Yt(e))yo.call(e,r)&&ft(t,r,e[r]);return t},ne=(t,e)=>ho(t,po(e));var Ae=(t,e,r)=>(ft(t,typeof e!="symbol"?e+"":e,r),r);import{c as bo,s as Eo,a as jt,b as q,i as Zt,p as _,w as he,D as So,W as No,d as Ao,U as wo,o as Io}from"./vendor.7a9baf1f.js";const fs={},ko=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function r(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerpolicy&&(a.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?a.credentials="include":n.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(n){if(n.ep)return;n.ep=!0;const a=r(n);fetch(n.href,a)}};ko();let Qt={};function Jt(t){Qt=t}let F={};function er(t){F=t}let mt="humdrum";const ae=()=>mt,be=t=>{if(!["humdrum","xml","musedata"].includes(t)){console.log("Invalid editor mode");return}return mt=t,mt};window.Range=function(){console.log("Range is undefined")};const I={GOTOTOPOFNOTATION:!1,SCALE:40,SPACING_STAFF:12,SPACING_SYSTEM:18,LYRIC_SIZE:4.5,FONT:"Leland",BREAKS:!1,ZOOM:.4},M={INPUT_FONT_SIZE:1,EditorLine:-1,TABSIZE:12,EDITINGID:null,SAVEFILENAME:"data.txt",SPACINGADJUSTMENT:0},u={HIGHLIGHTQUERY:null,CursorNote:null,RestoreCursorNote:""};window.global_cursor=u;const ie={PLAY:!1,PAUSE:!1},g={InputVisible:!1,LastInputWidth:0,OriginalClef:!1,UndoHide:!1,ApplyZoom:!1,ShowingIndex:!1,FreezeRendering:!1};window.AKey="KeyA";window.BKey="KeyB";window.CKey="KeyC";window.DKey="KeyD";window.EKey="KeyE";window.FKey="KeyF";window.GKey="KeyG";window.HKey="KeyH";window.IKey="KeyI";window.JKey="KeyJ";window.KKey="KeyK";window.LKey="KeyL";window.MKey="KeyM";window.NKey="KeyN";window.OKey="KeyO";window.PKey="KeyP";window.QKey="KeyQ";window.RKey="KeyR";window.SKey="KeyS";window.TKey="KeyT";window.UKey="KeyU";window.VKey="KeyV";window.WKey="KeyW";window.XKey="KeyX";window.YKey="KeyY";window.ZKey="KeyZ";window.ZeroKey="Digit0";window.OneKey="Digit1";window.TwoKey="Digit2";window.ThreeKey="Digit3";window.FourKey="Digit4";window.FiveKey="Digit5";window.SixKey="Digit6";window.SevenKey="Digit7";window.EightKey="Digit8";window.NineKey="Digit9";window.BackKey="Backspace";window.BackQuoteKey="Backquote";window.BackSlashKey="Backslash";window.CommaKey="Comma";window.DeleteKey="Delete";window.DotKey="Period";window.EnterKey="Enter";window.EscKey="Escape";window.MinusKey="Minus";window.SemiColonKey="Semicolon";window.SingleQuoteKey="Quote";window.SlashKey="Slash";window.SpaceKey="Space";window.TabKey="Tab";window.BracketLeftKey="BracketLeft";window.BracketRightKey="BracketRight";window.EqualKey="Equal";window.ControlLeftKey="ControlLeft";window.ControlRightKey="ControlRight";window.ShiftLeftKey="ShiftLeft";window.ShiftRightKey="ShiftRight";window.LeftKey="ArrowLeft";window.UpKey="ArrowUp";window.RightKey="ArrowRight";window.DownKey="ArrowDown";window.PgUpKey="PageUp";window.PgDnKey="PageDown";window.EndKey="End";window.HomeKey="Home";window.F1Key="F1";window.F2Key="F2";window.F3Key="F3";window.F4Key="F4";window.F5Key="F5";window.F6Key="F6";window.F7Key="F7";window.F8Key="F8";window.F9Key="F9";window.F10Key="F10";window.F11Key="F11";window.F12Key="F12";function tr(){return this.mouseState=0,this.positionX=null,this.leftContent=null,this.splitContent=null,this.splitWidth=5,this.minXPos=100,this.maxXPos=2e3,this.rightPadding=10,this.defaultPos=400,this.snapTolerance=30,this}tr.prototype.setPositionX=function(t){t<this.defaultPos+this.snapTolerance&&t>this.defaultPos-this.snapTolerance&&(t=this.defaultPos),t<0&&(t=0),t>this.maxXPos&&(t=this.maxXPos),this.positionX=t,this.leftContent||(this.leftContent=document.querySelector("#input")),this.splitContent||(this.splitContent=document.querySelector("#splitter")),this.rightContent||(this.rightContent=document.querySelector("#output")),this.leftContent&&(this.leftContent.style.left=0,this.leftContent.style.width=t+"px"),this.splitContent&&(this.splitContent.style.left=t+"px")};var G=new tr;let K,gt=!0;function P(){return K||Lo("input"),K}function Lo(t){K=ace.edit(t),window.EDITOR=K,K.on("ready",()=>{gt||Ce()});let e="/scripts/ace";console.log({configPath:e,meta:fs.url}),ace.config.set("basePath",e),ace.config.set("modePath",e),ace.config.set("workerPath",e),ace.config.set("themePath",e),gt&&(Mo(),gt=!1)}function Mo(){K.getSession().setUseWorker(!0),K.$blockScrolling=1/0,K.setAutoScrollEditorIntoView(!0),K.setBehavioursEnabled(!1),K.commands.removeCommand("fold",!0),K.commands.removeCommand("unfold",!0),K.getSession().setTabSize(M.TABSIZE),K.getSession().setUseSoftTabs(!1),K.setShowPrintMargin(!1),window.Range=ace.require("ace/range").Range,K.renderer.$cursorLayer.smoothBlinking=!0,K.renderer.$cursorLayer.setBlinking(!0),K.renderer.setOption("minLines",50),K.renderer.setOption("hScrollBarAlwaysVisible",!0),K.renderer.setOption("vScrollBarAlwaysVisible",!0);var t=document.querySelector(".ace_content .ace_cursor-layer");t&&(rr=new MutationObserver(To),rr.observe(t,{attributes:!0})),K.setTheme("ace/theme/humdrum_light")}var rr,ht;function To(){let t=document.activeElement.nodeName,e=K.renderer.$cursorLayer.cursor,r=null;for(let o=0;o<e.classList.length;o++){if(e.classList[o]=="blurred"){r="blurred";break}if(e.classList[o]=="focused"){r="focused";break}}t==="TEXTAREA"?r!="focused"&&(ht||(ht=!0),e.classList.add("focused"),e.classList.remove("blurred"),K.renderer.$cursorLayer.setBlinking(!0),K.renderer.$cursorLayer.showCursor()):ht&&r!="blurred"&&(e.classList.add("blurred"),e.classList.remove("focused"),K.renderer.$cursorLayer.showCursor(),K.renderer.$cursorLayer.setBlinking(!0))}function Co(){var t=document.querySelector("#splitter");!t||(G.leftContent||(G.leftContent=document.querySelector("#input")),G.splitContent||(G.splitContent=document.querySelector("#splitter")),G.rightContent||(G.rightContent=document.querySelector("#output")),t.addEventListener("mousedown",function(e){G.mouseState=1,G.leftContent||(G.leftContent=document.querySelector("#input")),G.splitContent||(G.splitContent=document.querySelector("#splitter")),G.rightContent||(G.rightContent=document.querySelector("#output")),G.setPositionX(e.pageX)}),window.addEventListener("mouseup",function(e){G.mouseState!=0&&(G.mouseState=0,K.resize(),T())}),window.addEventListener("mousemove",function(e){if(G.mouseState){var r=G.minXPos;if(e.pageX<r){e.pageX<r-70&&(G.setPositionX(0),g.InputVisible=!1);return}G.setPositionX(e.pageX),g.InputVisible=!0}}))}function Fo(t){var e=t.split(/\r?\n/),r={},o;for(let m=e.length-1;m>=0;m--){if(o=e[m].match(/^\!\!\!([^\s]+):\s*(.*)\s*$/)){var n=o[1],a=o[2];r[n]=a,(o=n.match(/(.*)@@(.*)/))&&(r[o[1]]=a),(o=n.match(/(.*)@(.*)/))&&(r[o[1]]=a)}(o=e[m].match(/^\!?\!\!title:\s*(.*)\s*/))&&(r.title=o[1])}(!r.title||r.title.match(/^\s*$/))&&(r.title=F["title-expansion"]);var i=0,s="",l="",c;if(r.title&&!r.title.match(/^\s*$/)){for(var d=r.title;(o=d.match(/@\{([^\}]*)\}/))&&(s="",l="",n="",(o=d.match(/@\{([^\}]*)\}\{([^\}]*)\}\{([^\}]*)\}/))?(s=o[1],n=o[2],l=o[3],d=d.replace(/@\{([^\}]*)\}\{([^\}]*)\}\{([^\}]*)\}/,"ZZZZZ")):(o=d.match(/@\{([^\}]*)\}\{([^\}]*)\}/))?(s=o[1],n=o[2],l="",d=d.replace(/@\{([^\}]*)\}\{([^\}]*)\}/,"ZZZZZ")):(o=d.match(/@\{([^\}]*)\}/))&&(s="",n=o[1],l="",d=d.replace(/@\{([^\}]*)\}/,"ZZZZZ")),!(!n||n.match(/^\s*$/)||(r[n]?c=s+r[n]+l:c="",d=d.replace(/ZZZZZ/,c),i++,i>20))););r.title=d}return r}function Ro(t){for(var e=0,r=t.split(/\r?\n/),o=0;o<r.length;o++)if(!!r[o].match(/^\*\*/)){for(var n=r[o].split(/\t+/),a=0,i=0,s=0;s<n.length;s++)n[s]==="**kern"?a++:n[s]==="**mens"&&i++;i>0&&(a=0),e=i+a;break}return e}function _o(t){t=parseInt(t);var e=parseInt(t/7),r=t%7,o="x";r==0?o="c":r==1?o="d":r==2?o="e":r==3?o="f":r==4?o="g":r==5?o="a":r==6&&(o="b");var n,a,i="";if(e<4)for(o=o.toUpperCase(),a=4-e,n=0;n<a;n++)i+=o;else for(a=e-3,n=0;n<a;n++)i+=o;return i}function Oo(t){var e=t.length,r=0,o=t.charAt(0),n=o.toLowerCase();o===n?r=3+e:r=4-e;var a=0;return n==="d"?a=1:n==="e"?a=2:n==="f"?a=3:n==="g"?a=4:n==="a"?a=5:n==="b"&&(a=6),7*r+a}function or(t,e){var r=t.length;if(e=parseInt(e),r==0)return"";var o=Oo(t);return o+=e,o<1||o>=70?t:_o(o)}function Ko(t,e){var r={field:-1,subspine:-1};if(t.match(/^[*!=]/)||t=="")return r;var o=0,n=0,a;for(a=0;a<e;a++)a>0&&t[a]=="	"&&t[a-1]!="	"?(o++,n=0):t[a]==" "&&n++;var i=!1;if(n>0)i=!0;else for(a=e;a<t.length;a++)if(t[a]==" "){i=!0;break}else if(t[a]=="	")break;return i&&n++,o++,r.field=o,r.subspine=n,r}const z=P();if(!z)throw new Error("Ace Editor is undefined");function Do(){var t=20,e="",r,o,n=P().session.getLength();for(o=n-1;o>=0&&!(n-o>t);o--){var a=z.session.getLine(o);if((r=a.match(/^!!!RDF\*\*kern:\s+([^\s])\s*=.*mark.*\s+note/))&&(e=r[1]),e!=="")break}if(e==="")for(o=0;o<n&&!(o>t||(a=z.session.getLine(o),(r=a.match(/^\!\!\!RDF\*\*kern:\s+([^\s])\s*=.*mark.*\s+note/))&&(e=r[1]),e!==""));o++);if(e!=="")return e;var i="";e===""?(i+="!!!RDF**kern: @ = marked note",e="@"):i+="!!!RDF**kern: "+e+" = marked note";var s=g.FreezeRendering;return g.FreezeRendering==!1&&(g.FreezeRendering=!0),z.session.insert({row:z.session.getLength(),column:0},`
`+i),g.FreezeRendering=s,e}function ce(){var t=20,e="",r="",o,n,a=z.session.getLength();for(n=a-1;n>=0&&!(a-n>t);n--){var i=z.session.getLine(n);if((o=i.match(/^!!!RDF\*\*kern:\s+([^\s])\s*=.*above/))?e=o[1]:(o=i.match(/^!!!RDF\*\*kern:\s+([^\s])\s*=.*below/))&&(r=o[1]),e!==""&&r!=="")break}if(e===""||r==="")for(n=0;n<a&&!(n>t||(i=z.session.getLine(n),(o=i.match(/^\!\!\!RDF\*\*kern:\s+([^\s])\s*=.*above/))?e=o[1]:(o=i.match(/^\!\!\!RDF\*\*kern:\s+([^\s])\s*=.*below/))&&(r=o[1]),e!==""&&r!==""));n++);if(e!==""&&r!=="")return[e,r];var s="";e===""?(s+=`!!!RDF**kern: > = above
`,e=">"):s+="!!!RDF**kern: "+e+` = above
`,r===""?(s+="!!!RDF**kern: < = below",r="<"):s+="!!!RDF**kern: "+r+" = below";var l=g.FreezeRendering;return g.FreezeRendering==!1&&(g.FreezeRendering=!0),z.session.insert({row:z.session.getLength(),column:0},`
`+s),g.FreezeRendering=l,[e,r]}function Go(){var t=20,e="",r,o,n=z.session.getLength();for(o=n-1;o>=0&&!(n-o>t);o--){var a=z.session.getLine(o);if((r=a.match(/^!!!RDF\*\*kern:\s+([^\s])\s*=.*edit.*\s+acc/))&&(e=r[1]),e!=="")break}if(e==="")for(o=0;o<n&&!(o>t||(a=z.session.getLine(o),(r=a.match(/^\!\!\!RDF\*\*kern:\s+([^\s])\s*=.*edit.*\s+acc/))&&(e=r[1]),e!==""));o++);if(e!=="")return e;var i="";e===""?(i+=`!!!RDF**kern: i = editorial accidental
`,e="i"):i+="!!!RDF**kern: "+e+` = editorial accidental
`;var s=g.FreezeRendering;return g.FreezeRendering==!1&&(g.FreezeRendering=!0),z.session.insert({row:z.session.getLength(),column:0},`
`+i),g.FreezeRendering=s,e}const xo="modulepreload",nr={},qo="/",ar=function(e,r){return!r||r.length===0?e():Promise.all(r.map(o=>{if(o=`${qo}${o}`,o in nr)return;nr[o]=!0;const n=o.endsWith(".css"),a=n?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${o}"]${a}`))return;const i=document.createElement("link");if(i.rel=n?"stylesheet":xo,n||(i.as="script",i.crossOrigin=""),i.href=o,document.head.appendChild(i),n)return new Promise((s,l)=>{i.addEventListener("load",s),i.addEventListener("error",l)})})).then(()=>e())},Ho=!0,Bo=!1,Po=!1,$o=!1;var pt={score:Ho,collaboration:Bo,videoConference:Po,waveSurfer:$o};class Xo{constructor(e,r,o,{yUndoManager:n=null}={}){const a=bo(),i=e.doc;if(this.mux=a,this.type=e,this.doc=i,this.ace=r,this.ace.session.getUndoManager().reset(),this.aceCursors=new Uo(this.ace),this.yUndoManager=n,n){n.trackedOrigins.add(this);const s=()=>{n.undo()},l=()=>{n.redo()};this.ace.commands.addCommand({name:"undo",bindKey:{win:"Ctrl-Z",mac:"Command-Z"},exec:s}),this.ace.commands.addCommand({name:"redo",bindKey:{win:"Ctrl-Y",mac:"Command-Y"},exec:l}),n.on("stack-item-added",this._onStackItemAdded),n.on("stack-item-popped",this._onStackItemPopped)}this.awareness=o,this._awarenessChange=({added:s,removed:l,updated:c})=>{this.aceCursors.marker.cursors=[];const d=this.awareness.getStates();s.forEach(m=>{this.aceCursors.updateCursors(d.get(m),m)}),c.forEach(m=>{this.aceCursors.updateCursors(d.get(m),m)}),l.forEach(m=>{this.aceCursors.updateCursors(d.get(m),m)}),this.aceCursors.marker.redraw()},this._typeObserver=s=>{const l=this.ace.getSession().getDocument();let c=this.ace.session.$undoManager.startNewGroup();a(()=>{const d=s.delta;let m=0;for(const p of d)if(p.retain)m+=p.retain;else if(p.insert){const v=l.indexToPosition(m,0);l.insert(v,p.insert),m+=p.insert.length}else if(p.delete){const v=l.indexToPosition(m,0),b=l.indexToPosition(m+p.delete,0),y=new Range(v.row,v.column,b.row,b.column);l.remove(y)}this.ace.session.$undoManager.markIgnored(c),this._cursorObserver()})},e.observe(this._typeObserver),this._aceObserver=(s,l)=>{const c=this.ace.getSession().getDocument();a(()=>{this.type.doc.transact(()=>{if(s.lines.length>1){const d=Eo(this.type.toString(),c.getValue());console.log(">>>Ace Observer: diff",{diff:d}),this.type.delete(d.index,d.remove),this.type.insert(d.index,d.insert)}else if(s.action==="insert"){const d=c.positionToIndex(s.start,0);window.navigator.userAgent.indexOf("Win")!=-1&&s.lines.forEach(m=>m.replaceAll("\r","")),e.insert(d,s.lines.join(`
`))}else if(s.action==="remove"){const d=c.positionToIndex(s.start,0);window.navigator.userAgent.indexOf("Win")!=-1&&s.lines.forEach(p=>p.replaceAll("\r",""));const m=s.lines.join(`
`).length;e.delete(d,m)}e.applyDelta(s),this._cursorObserver()},this)})},this.ace.on("change",this._aceObserver),this._cursorObserver=()=>{let s=this.awareness.getLocalState().user,l=this.ace.getSession().selection,c={id:i.clientID,name:s.name,sel:!0,color:s.color},d=this.ace.getSession().doc.positionToIndex(l.getSelectionAnchor()),m=this.ace.getSession().doc.positionToIndex(l.getSelectionLead());c.anchor=d,c.head=m,d>m&&(c.anchor=m,c.head=d),c.pos=c.head,c.anchor===c.head&&(c.sel=!1);const p=this.awareness.getLocalState();l===null?this.awareness.getLocalState()!==null&&this.awareness.setLocalStateField("cursor",null):(!p||!p.cursor||c.anchor!==p.cursor.anchor||c.head!==p.cursor.head)&&this.awareness.setLocalStateField("cursor",c)},this.ace.getSession().selection.on("changeCursor",()=>this._cursorObserver()),this.awareness&&this.awareness.on("change",this._awarenessChange)}_onStackItemPopped(e){}_onStackItemAdded(e){}destroy(){console.log("destroyed"),this.type.unobserve(this._typeObserver),this.ace.off("change",this._aceObserver),this.awareness&&this.awareness.off("change",this._awarenessChange),this.yUndoManager&&(this.yUndoManager.off("stack-item-added",this._onStackItemAdded),this.yUndoManager.off("stack-item-popped",this._onStackItemPopped),this.yUndoManager.trackedOrigins.delete(this))}}class Uo{constructor(e){this.ace=e,this.marker={},this.marker.self=this,this.markerID={},this.marker.cursors=[],this.aceID=this.ace.container.id,this.marker.update=function(r,o,n,a){let i=a.firstRow,s=a.lastRow,l=this.cursors;for(let c=0;c<l.length;c++){let d=this.cursors[c];if(!(d.row<i)){if(d.row>s)break;{let m=n.documentToScreenPosition(d.row,d.column),p=document.getElementsByClassName("ace_gutter")[0].offsetWidth,v=a.lineHeight,b=a.characterWidth,y=o.$getTop(m.row,a),E=o.$padding+p+m.column*b,k=document.getElementById(this.self.aceID+"_cursor_"+d.id);k==null?(k=document.createElement("div"),k.id=this.self.aceID+"_cursor_"+d.id,k.className="cursor",k.style.position="absolute",k.innerHTML='<div class="cursor-label" style="background: '+d.color+';top: -1.8em;white-space: nowrap;">'+d.name+"</div>",this.self.ace.container.appendChild(k)):(k.style.height=v+"px",k.style.width=b+"px",k.style.top=y+"px",k.style.left=E+"px",k.style.borderLeft="2px solid "+d.color,k.style.zIndex=100,k.style.color="#000",k.style.cursor="help")}}}},this.marker.redraw=function(){this.session._signal("changeFrontMarker")},this.marker.session=this.ace.getSession(),this.marker.session.addDynamicMarker(this.marker,!0)}updateCursors(e,r){if(e!==void 0&&e.hasOwnProperty("cursor")){let o=e.cursor,n=this.ace.getSession().doc.indexToPosition(o.pos),a={row:n.row,column:n.column,color:o.color,id:o.id,name:o.name};if(o.sel){this.markerID[o.id]!==void 0&&this.markerID[o.id].hasOwnProperty("sel")&&this.markerID[o.id].sel!==void 0&&(this.ace.session.removeMarker(this.markerID[o.id].sel),this.markerID[o.id].sel=void 0);let i=this.ace.getSession().doc.indexToPosition(o.anchor),s=this.ace.getSession().doc.indexToPosition(o.head),l=document.getElementById("style_"+o.id);if(l)l.innerHTML=".selection-"+o.id+" { position: absolute; z-index: 20; opacity: 0.5; background: "+o.color+"; }";else{let c=document.createElement("style");c.type="text/css",c.id="style_"+o.id,document.getElementsByTagName("head")[0].appendChild(c)}this.markerID[o.id]={id:o.id,sel:this.ace.session.addMarker(new Range(i.row,i.column,s.row,s.column),"selection-"+o.id,"text")}}else this.markerID[o.id]!==void 0&&this.markerID[o.id].hasOwnProperty("sel")&&this.markerID[o.id].sel!==void 0&&(this.ace.session.removeMarker(this.markerID[o.id].sel),this.markerID[o.id].sel=void 0);this.marker.cursors.push(a)}else{let o=document.getElementById(this.aceID+"_cursor_"+r);o&&(o.parentNode.removeChild(o),this.markerID[r]!==void 0&&this.markerID[r].hasOwnProperty("sel")&&this.markerID[r].sel!==void 0&&(this.ace.session.removeMarker(this.markerID[r].sel),this.markerID[r].sel=void 0))}}}let zo=document.querySelector("#input"),Vo=document.querySelector("#output"),Wo=document.querySelector(".output-with-comments");const $e=(t,e)=>{if(!t)return;let r=[...t.classList].find(n=>/^col/g.test(n)),o=!1;if(r){let n=r.match(/\d+/g);n&&n!=e&&(o=!0),t.classList.remove(r)}return t.classList.add(`col-${e}`),o},J=(t,e,r)=>{let o=document.querySelector("#comments-section");return()=>{var i;$e(zo,t);let n=$e(Wo,e+r-t),a=$e(Vo,e);if($e(o,r),n||a){T();let s=document.querySelector("#output > svg");yt.svgHeight=(i=s==null?void 0:s.height.baseVal.value)!=null?i:window.innerHeight}}},Yo=jt({initial:"notationVisible",context:{inputCol:0,outputCol:0,commentsCol:0},states:{idle:{id:"idleState",on:{SHOW_NOTATION:{target:"notationVisible",actions:[q({inputCol:0,outputCol:12,commentsCol:0}),({inputCol:t,outputCol:e,commentsCol:r})=>J(t,e,r)()]}}},notationVisible:{on:{SHOW_TEXT:{target:"notationAndTextVisible",actions:[q({inputCol:4,outputCol:12,commentsCol:0}),({inputCol:t,outputCol:e,commentsCol:r})=>J(t,e,r)()]},SHOW_COMMENTS:{target:"notationAndCommentsVisible",actions:[q({inputCol:0,outputCol:8,commentsCol:4}),({inputCol:t,outputCol:e,commentsCol:r})=>{J(t,e,r)(),ke(x.comments)}]},SHOW_COMMENTS_HIDE_TEXT:{target:"notationAndCommentsVisible",actions:[q({inputCol:0,outputCol:8,commentsCol:4}),({inputCol:t,outputCol:e,commentsCol:r})=>{J(t,e,r)(),ke(x.comments)}]}}},notationAndTextVisible:{on:{SHOW_COMMENTS:{target:"allVisible",actions:[q({inputCol:2,outputCol:10,commentsCol:2}),({inputCol:t,outputCol:e,commentsCol:r})=>{J(t,e,r)(),ke(x.comments)}]},HIDE_TEXT:{target:"notationVisible",actions:[q({inputCol:0,outputCol:12,commentsCol:0}),({inputCol:t,outputCol:e,commentsCol:r})=>J(t,e,r)()]},SHOW_COMMENTS_HIDE_TEXT:{target:"notationAndCommentsVisible",actions:[q({inputCol:0,outputCol:8,commentsCol:4}),({inputCol:t,outputCol:e,commentsCol:r})=>{J(t,e,r)(),ke(x.comments)}]}}},notationAndCommentsVisible:{on:{SHOW_TEXT:{target:"allVisible",actions:[q({inputCol:2,outputCol:10,commentsCol:2}),({inputCol:t,outputCol:e,commentsCol:r})=>{J(t,e,r)(),ke(x.comments)}]},HIDE_COMMENTS:{target:"notationVisible",actions:[q({inputCol:0,outputCol:12,commentsCol:0}),({inputCol:t,outputCol:e,commentsCol:r})=>{J(t,e,r)(),Ee({updated:[...C.awareness.getStates().keys()],added:[],removed:[]})}]}}},allVisible:{on:{HIDE_TEXT:{target:"notationAndCommentsVisible",actions:[q({inputCol:0,outputCol:8,commentsCol:4}),({inputCol:t,outputCol:e,commentsCol:r})=>J(t,e,r)()]},HIDE_COMMENTS:{target:"notationAndTextVisible",actions:[q({inputCol:4,outputCol:12,commentsCol:0}),({inputCol:t,outputCol:e,commentsCol:r})=>{J(t,e,r)(),Ee({updated:[...C.awareness.getStates().keys()],added:[],removed:[]})}]},HIDE_ALL:{target:"notationVisible",actions:[q({inputCol:0,outputCol:12,commentsCol:0}),({inputCol:t,outputCol:e,commentsCol:r})=>J(t,e,r)()]}}}}});let ue=Zt(Yo);const jo=.3;function ir(t,e){var s,l;const r=t.getBoundingClientRect(),o=t==null?void 0:t.closest(".staff");let n=o==null?void 0:o.getBoundingClientRect(),i=document.querySelector("#output").closest("[class*=output-container]").scrollTop;return{staffX:(s=n.x)!=null?s:r.x,staffY:(l=n.y)!=null?l:r.y,targetX:r.x-e.offsetWidth,targetY:r.y-e.offsetTop+i,targetBounds:r,staffBounds:n}}function Zo(t,e){var r;if(/^#([A-Fa-f0-9]{3}){1,2}$/.test(t))return r=t.substring(1).split(""),r.length==3&&(r=[r[0],r[0],r[1],r[1],r[2],r[2]]),r="0x"+r.join(""),"rgba("+[r>>16&255,r>>8&255,r&255,e||"1"].join(",")+")";throw new Error("Bad Hex")}function Qo(t,e,r=0){if(!t||!Array.isArray(t)||t.length==0){console.log('Argument "selectedNotes" must be an array of elements',t);return}if(!e||!(e instanceof HTMLElement)){console.log('Argument "offsetElem" must be an HTMLElement');return}if(typeof r!="number"){console.log('Argument "scrollTop" must be a number');return}const o=t.reduce((n,a)=>{const i=a.getBoundingClientRect();return{left:Math.min(n.left,i.left),top:Math.min(n.top,i.top),right:Math.max(n.right,i.right),bottom:Math.max(n.bottom,i.bottom)}},{left:1/0,top:1/0,right:Number.NEGATIVE_INFINITY,bottom:Number.NEGATIVE_INFINITY});return{left:o.left-e.offsetWidth,top:o.top-e.offsetTop+r,width:o.right-o.left,height:o.bottom-o.top}}function Jo(t){let e=Math.floor((new Date-t)/1e3),r=e/31536e3;return r>1?Math.floor(r)+" years":(r=e/2592e3,r>1?Math.floor(r)+" months":(r=e/86400,r>1?Math.floor(r)+" days":(r=e/3600,r>1?Math.floor(r)+" hours":(r=e/60,r>1?Math.floor(r)+" minutes":Math.floor(e)+" seconds"))))}function sr(){document.querySelectorAll(".highlight-area").forEach(t=>t.classList.remove("highlight-area-focus"))}function en(){if(u.CursorNote){for(var t=u.CursorNote.getAttribute("class"),e=t.split(" "),r="",o=0;o<e.length;o++)e[o]!="highlight"&&(r+=" "+e[o]);r=r.replace(/^\s+/,""),u.CursorNote.setAttribute("class",r),u.CursorNote=""}}function tn(){x.comments.some(t=>t.highlight==null),ue.send("SHOW_COMMENTS_HIDE_TEXT")}function rn(){ue.send("HIDE_COMMENTS"),ue.send("SHOW_TEXT")}function we(t=[]){let e=new URL(document.location).searchParams;return t.map(r=>({[r]:e.get(r)})).reduce((r,o)=>Object.assign({},r,o),{})}let pe=()=>{},on=new URL("http://localhost:3001/"),_e=on;const vt=async({data:t,onSuccess:e=pe,onError:r=pe})=>{let o=_e+"api/comments";try{let n=await fetch(o,{method:"POST",credentials:"include",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}}),a=await n.json();n.ok&&e(a)}catch(n){r(n)}},nn=async(t,{data:e,onSuccess:r=pe,onError:o=pe})=>{let n=`${_e}api/comments/${t}`;try{let a=await fetch(n,{method:"DELETE",credentials:"include",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}}),i=await a.json();a.ok&&r(i)}catch(a){o(a)}},an=async(t,{data:e,onSuccess:r=pe,onError:o=pe})=>{let n=`${_e}api/comments`;try{let a=await fetch(n,{method:"DELETE",credentials:"include",body:JSON.stringify(ne(oe({},e),{documentId:t})),headers:{"Content-Type":"application/json"}}),i=await a.json();a.ok&&r(i)}catch(a){o(a)}};var lr="/assets/person.321f14cd.svg";let cr=(t,e,r,o,n,a)=>{let i=C.awareness.getLocalState().user;const s=(v,b)=>v.find(y=>y.dataset.commentId==b),l=v=>{if(v.target.nodeName=="BUTTON")return;let b=Array.from(document.querySelectorAll(".highlight-area"));if(b.length!=0){let y=a?s(b,a):s(b,t);y&&(b.forEach(E=>E.classList.remove("highlight-area-focus")),y.classList.add("highlight-area-focus"))}};let{docId:c}=we(["docId"]);const d=async()=>{await nn(t,{data:{userId:i.id,documentId:c,clientId:C.awareness.clientID},onSuccess:()=>{console.log("Deleted comment with id: ",t),de({comments:x.comments.filter(v=>v.id!=t)}),Ee()}})},m=()=>e===i.email?_`<button type="button" class="btn btn-danger" @click=${d}>X</button>`:null;let p=Jo(new Date(o));return _`<div id=${"comment-"+t} @click=${l} class="p-2 mb-2 border-bottom" data-parent-id=${a}>
    <div>
      <div class="d-inline-flex justify-content-between w-100 mb-3">
        <div class="d-flex">
          <div style="background-color: white; border-radius: 50%;">
            <img src=${n} alt="user profile icon" width="24" height="24" />
          </div>
          <div class="d-inline-flex flex-column ml-2">
            <h5 class="m-0">${e}</h5>
            <small class="text-muted font-italic">${p.charAt(0)==="0"?"Now":p+" ago"}</small>
          </div>
        </div>
        <div>${m()}</div>
      </div>
      <p class="card-text">${r}</p>
    </div>
  </div>`},sn=(t,e)=>{let r=`reply-collapse-${t.id}`;const o=()=>{$(`.collapse.reply-form-container:not(#${r})`).collapse("hide"),$(`#${r}`).collapse("show")},n=async i=>{i.preventDefault();let s=new FormData(i.target).get("content");console.log({content:s});let{docId:l}=we(["docId"]);await vt({data:{content:s,parentCommentId:t.id,documentId:l,clientId:C.awareness.clientID},onSuccess:c=>{console.log("Added comment reply",c),de({comments:x.comments.concat(c)}),console.log("Comments after adding comment reply",x.comments),$(`#${r}`).collapse("hide"),i.target.reset()}})},a=()=>(sr(),$(`#${r}`).collapse("hide"));return console.log("Comment parent: ",t),_`
    <div id=${"comment-with-replies-"+t.id} aria-expanded="false" aria-controls=${r} style="width: 18rem; top: ${t.highlight.top}px; left:${e/2-bt(18)/2}px; position: absolute;" class="card shadow comment-with-replies" @click=${o}>

      <div class="card-body p-0">
        
        ${_`${cr(t.id,t.usersDocuments[0].user.email,t.content,t.createdAt,lr)}`}
        
        ${t.children.length>0?_`${t.children.map(i=>cr(i.id,i.usersDocuments[0].user.email,i.content,i.createdAt,lr,i.parentCommentId))}`:null}

        <div class="collapse p-2 reply-form-container" id=${r}>
          <form class="reply-form" @submit=${n}>
              <div class="form-group">
                <input class="form-control" placeholder="Reply" name="content" type="text" />
              </div>
              <div class="form-group m-0">
                <button class="btn btn-primary" type="submit">Reply</button>
                <button class="btn btn-light" type="button" @click=${a}>Cancel</button>
              </div>
          </form>
        </div>
      </div>
    </div>
  `},yt={outputSVGHeight:10,set svgHeight(t){this.outputSVGHeight=typeof t=="string"?parseInt(t,10):t,he(cn(this.outputSVGHeight),document.querySelector(".output-container"))},get svgHeight(){return this.outputSVGHeight}},ln=(t,...e)=>_`<div id="collab-container" style="height: ${t}px">${e}</div>`;const Ie=t=>{const e=t.map(o=>"#"+o).join(",");let r=document.querySelector("#output");return Qo(Array.from(document.querySelectorAll(e)),document.querySelector("#input"),r.closest("[class*=output-container]").scrollTop)};let cn=t=>_`
    <div
      id="comments-section"
      class="col-0 h-100"
      style="min-height: 95vh; max-height: 95vh; position: relative;"
    >
      <div
        id="comments-container"
        style="height: 100vh; background-color: rgba(216, 215, 215, 0.8);"
      ></div>
    </div>
  `;function bt(t){return t*parseFloat(getComputedStyle(document.documentElement).fontSize)}let ke=(t,e=[])=>{let r=document.querySelector("#comments-container"),o=ue.state.toStrings().some(n=>n.toLowerCase().includes("comment"));if(r&&o){let n=[];for(let i of t){if(!(i==null?void 0:i.parentCommentId)){n.push(ne(oe({},i),{children:[]}));continue}let s=n.find(l=>l.id==i.parentCommentId);!s||(s.children=[...s.children,i])}let a=r.offsetWidth;console.log("commentsWithReplies",n),he(_`${n.map(i=>sn(i,a))}`,r),Ee({added:[...C.awareness.getStates().keys()],updated:[],removed:[]})}},x={comments:[],users:[]},un=()=>({reRender:!0}),de=(t={},e=un())=>{if(!typeof t==="object")throw new Error("State argument has to be an object");return x=Object.assign({},x,t),e.reRender&&Object.keys(t).includes("comments")&&ke(x.comments),x};const dn=async(t,{onSuccess:e=pe,onError:r=pe})=>{let o=`${_e}api/users?docId=${t}`;try{let n=await fetch(o,{credentials:"include"}),a=await n.json();if(n.ok)return e(a),a}catch(n){r(n)}},fn=["Michael","John","Jim","Maria","Nick","Jake","Isabella","Kate"],ur=["#30bced","#6eeb83","#ffbc42","#ecd444","#ee6352","#9ac2c9","#8acb88","#1be7ff"],Et=t=>t[Math.floor(Math.random()*t.length)];let dr=Et(fn),mn={name:dr,color:Et(ur),email:dr+"@test.com",id:1},C;function gn(){const t=new So;let{docId:e,roomname:r}=we(["docId","roomname"]),o=`docId=${e}&roomname=${r}`;typeof C=="undefined"&&(C=new No("ws://localhost:3001",o,t),C.on("status",l=>{console.log(l.status)}));let n=Ao.get("user");if(n){let l=JSON.parse(n);l.name||(l.name=l.email.split("@")[0]),C.awareness.setLocalStateField("user",ne(oe({},l),{color:Et(ur)}))}else C.awareness.setLocalStateField("user",mn);const a=t.getText("ace"),i=new wo(a),s=P();if(!s)throw new Error("Ace Editor is undefined");new Xo(a,s,C.awareness,{yUndoManager:i}),C.awareness.on("change",Ee),window.example={yProvider:C,ydoc:t,type:a},window.awareness=C.awareness,hn(e)}function hn(t){let e=new EventSource(`${_e}events/comments?docId=${t}&clientId=${C.awareness.clientID}`,{withCredentials:!0});e.addEventListener("open",async()=>{console.log("Event source connection for comments open"),dn(t,{onSuccess:n=>{let a=[...C.awareness.getStates().values()].map(s=>s.user.id),i=[];for(let s of n)s.online=a.includes(s.id),i.push(s);de({users:i})}})});function r(n){let a=JSON.parse(n.data);if(console.log("Message event",a),Array.isArray(a)){let i=a.some(s=>s.highlight==null);document.querySelector("#output svg")&&i?o(a):de({comments:a},{reRender:!1});return}if(a.hasOwnProperty("type")){let[i,s]=a.type.split(":");if(Object.keys(x).includes(i))switch(s){case"create":i==="comments"&&(o(x.comments.concat(a.createdComment)),Ee());break;case"delete":i==="comments"&&Array.isArray(a.ids)&&de({comments:x.comments.filter(l=>!a.ids.includes(l.id))}),Ee();break;default:console.log(`Unknown method: ${s}`)}return}}function o(n){de({comments:n.map(a=>a.highlight==null&&typeof(a==null?void 0:a.multiSelectElements)=="string"?ne(oe({},a),{highlight:Object.assign({},Ie(a.multiSelectElements.split(",")))}):a)})}e.addEventListener("message",r),e.addEventListener("error",n=>{console.log("Error",n),e.close()}),window.addEventListener("beforeunload",()=>{e.close()})}const pn=async t=>{var n;t.preventDefault();let e=t.target.querySelector('input[name="comment-text"]');console.log("You sent:",e.value);let{docId:r}=we(["docId"]),o=(n=C.awareness.getLocalState())==null?void 0:n.multiSelect;if(Array.isArray(o)&&o.length>0){let a=Ie(o);await vt({data:{content:e.value,parentCommentId:null,documentId:r?Number(r):1,clientId:C.awareness.clientID,multiSelectElements:o.join(",")},onSuccess:i=>{console.log("Added comment",i),i.highlight=Object.assign({},a),de({comments:x.comments.map(s=>s.highlight==null&&typeof(s==null?void 0:s.multiSelectElements)=="string"?ne(oe({},s),{highlight:Object.assign({},Ie(s.multiSelectElements.split(",")))}):s).concat(i)}),console.log("Comments after calculating coords",x.comments)}})}C.awareness.setLocalStateField("multiSelect",null),e.value="",$("#post-comment").modal("hide")};let fr=t=>_` <div class="modal-body">
    <form id="post-comment-form" @submit=${t}>
      <div class="form-group">
        <label for="comment-text" class="col-form-label">Comment:</label>
        <input type="text" class="form-control" id="comment-text" name="comment-text" />
      </div>
      <div class="form-group float-right">
        <button type="button" class="btn btn-secondary" role="button" data-dismiss="modal">Close</button>
        <button type="submit" class="btn btn-primary" role="button">Post</button>
      </div>
    </form>
  </div>`,vn=(t,e)=>{let r=2.5,o=2.5;const n=()=>{he(fr(pn),document.querySelector("#post-comment .modal-content"))};return _`<div
    style="transform: translate(${t.left+t.width-bt(r)}px, ${t.top-bt(o)}px);
  width: ${r}rem; height: ${o}rem; cursor: pointer; position: absolute; pointer-events: all;"
    class="p-2"
    data-toggle="modal" data-target="#post-comment" @click=${n}
  >
    <svg xmlns="http://www.w3.org/2000/svg" id="comment-create-svg" width="28" height="28" fill="currentColor" class="bi bi-card-text" viewBox="0 0 16 16">
      <path d="M14.5 3a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-13a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5h13zm-13-1A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h13a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 14.5 2h-13z"/>
      <path d="M3 5.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zM3 8a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9A.5.5 0 0 1 3 8zm0 2.5a.5.5 0 0 1 .5-.5h6a.5.5 0 0 1 0 1h-6a.5.5 0 0 1-.5-.5z"/>
    </svg>
    </div>`},yn=(t,e=!1,r,o)=>{var a;const n=Ie(r);return _`<div
    class="multi-select-area"
    style="transform: translate(${n.left}px, ${n.top}px); width: ${n.width}px; height:${n.height}px; background-color: ${(a=Zo(o,jo))!=null?a:"rgba(0, 0, 255, 0.09)"};"
    data-client-id=${t}
  ></div>
  ${e?vn(n,n.top):null}`},mr=(t,e,r,o,n=!0)=>_`<div
    id="select-area"
    ?hidden=${n}
    style="transform: translate(${t}px, ${e}px);
    width: ${r}px; height: ${o}px;"
  ></div>`;class bn{constructor(e){Ae(this,"coords",{left:0,top:0,right:0,bottom:0});Ae(this,"offsetCoords",{left:0,top:0,right:0,bottom:0});Ae(this,"isSelecting",!1);Ae(this,"selectAreaElem",document.querySelector("#select-area"));this.coords=e!=null?e:this.coords}setUpperCoords(e){this.coords.left=e.clientX,this.coords.top=e.clientY,this.offsetCoords.left=e.offsetX,this.offsetCoords.top=e.offsetY}setLowerCoords(e){this.coords.right=e.clientX,this.coords.bottom=e.clientY,this.offsetCoords.right=e.offsetX,this.offsetCoords.bottom=e.offsetY}updateElemPosition(){let{left:e,top:r,right:o,bottom:n}=this.coords,a=Math.min(e,o),i=Math.max(e,o),s=Math.min(r,n),l=Math.max(r,n);return this.renderSelectArea(),{left:a,top:s,right:i,bottom:l}}renderSelectArea(){let{left:e,top:r,right:o,bottom:n}=this.offsetCoords,a=Math.min(e,o),i=Math.max(e,o),s=Math.min(r,n),l=Math.max(r,n),c=document.querySelector("#collab-container");c&&he(mr(a,s,i-a,l-s,!1),c)}reCalculateCoords(){return this.coords=this.updateElemPosition()}resetCoords(){this.coords={left:0,top:0,right:0,bottom:0},this.updateElemPosition()}show(){this.updateElemPosition()}hide(){let e=document.querySelector("#collab-container");e&&he(mr(0,0,0,0,!0),e)}selectNoteElements(e){return e.filter(r=>{const o=r.getBoundingClientRect();return this.coords.left<=o.left&&this.coords.top<=o.top&&this.coords.right>=o.right&&this.coords.bottom>=o.bottom})}}let En=(t,e,r,o,n)=>_`
    <div class="dropup btn-group" style="pointer-events: bounding-box">
      <div
        id=${"dropdownMenuButton-"+e}
        class="users-div btn dropdown-toggle p-0"
        data-toggle="dropdown"
        aria-expanded="false"
        style="transform: translate(${r}px, ${o-30}px)"
        data-client-id=${t}
        data-ref-id=${e}
      >
        You
      </div>

      <div
        class="dropdown-menu p-0 border border-rounded shadow"
        aria-labelledby=${"dropdownMenuButton-"+e}
        @click=${n}
      >
        <div class="w-100 d-flex flex-column">
          <a
            id=${"add-comment-"+e}
            class="context-menu-dropdown-item text-decoration-none text-reset p-1 border-bottom border-secondary"
            href="#"
            data-toggle="modal"
            data-target="#post-comment"
            >Add Comment</a
          >
          <a
            class="context-menu-dropdown-item text-decoration-none text-reset p-1 border-bottom border-secondary"
            id=${"details-"+e}
            href="#"
            data-toggle="popover"
            >Element details</a
          >
          <!-- <a
            class="context-menu-dropdown-item text-decoration-none text-reset p-1"
            id=${"history-"+e}
            href="#"
            data-toggle="popover"
            >History</a
          > -->
        </div>
      </div>
    </div>
  `,Sn=(t,e,r,o,n)=>_`<div
    class="users-div"
    style="transform: translate(${r}px, ${document.querySelector(".dropup.btn-group")?o-50:o-25}px)"
    data-client-id=${t}
    data-ref-id=${e}
  >
    ${n}
  </div> `,Nn=(t,e,r)=>{let o=document.getElementById(e);if(!o)return _`<div class="users-div"></div>`;let n;const a=l=>{console.log("click",{target:l.target});let c=l.target.id;if(/^details/.test(c))n||(n=Tn(o),$(`#${c}`).popover({container:"body",placement:"auto",content:()=>Object.entries(JSON.parse(n).attrs).map(([d,m])=>`<div>${d}: ${m}</div>`).join(`
`),html:!0}),$(`#${c}`).popover("show"),console.log({details:JSON.parse(n)}));else if(/^add-comment/.test(c)){const d=Ie([e]);console.log(d),he(fr(wn([e],d)),document.querySelector("#post-comment .modal-content"))}else if(/^history/.test(c)){let m=P().getSession().getUndoManager();console.log(m.$undoStack),console.log({elemRefId:e});let[,p,v,b]=e.match(/-.*L(\d+)F(\d+)S?(\d+)?/);p=parseInt(p,10)-1;for(let y of m.$undoStack)y[0].start.row==p&&y[0].end.row==p&&console.log("change for element line",y)}else console.log("Element does not have id")},{targetX:i,targetY:s}=ir(o,document.querySelector("#input"));return _`${t==C.awareness.clientID?En(t,e,i,s,a):Sn(t,e,i,s,r)}`},An=(t,e,r)=>{let o=document.getElementById(e);if(!o)return _`<div class="single-select"></div>`;const{staffY:n,targetX:a,targetY:i,targetBounds:s}=ir(o,document.querySelector("#input"));return _`<div
    class="single-select"
    style="transform: translate(${a}px, ${i}px);
    width: ${Math.abs(s.x-s.right)}px;
    height: ${Math.abs(n-s.bottom)}px;
    background-color: ${r}"
    data-client-id=${t}
    data-ref-id=${e}
  ></div>`};const wn=(t,e)=>async r=>{r.preventDefault();let o=r.target.querySelector('input[name="comment-text"]');console.log("You sent:",o.value);let{docId:n}=we(["docId"]);Array.isArray(t)&&t.length>0&&await vt({data:{content:o.value,parentCommentId:null,documentId:n?Number(n):1,clientId:C.awareness.clientID,multiSelectElements:t.join(",")},onSuccess:a=>{a.highlight=Object.assign({},e),console.log("Added comment",a),de({comments:x.comments.map(i=>i.highlight==null&&typeof(i==null?void 0:i.multiSelectElements)=="string"?ne(oe({},i),{highlight:Object.assign({},Ie(i.multiSelectElements.split(",")))}):i).concat(a)}),console.log("Comments after calculating coords",x.comments)},onError:console.log}),C.awareness.setLocalStateField("multiSelect",null),o.value="",$("#post-comment").modal("hide")};let In=t=>_`
    <ul class="users-online m-0 p-0 d-flex justify-content-between">
      ${t.map(e=>kn(e))}
    </ul>`,kn=t=>{let e={"online-status":t.online,"offline-status":!t.online};return _`<li data-toggle="tooltip" title=${t.name}>
    <span class="position-relative d-inline-flex">
      <div style="background-color: white; border-radius: 50%;">
        <img src=${t.imageProfileURL} alt="user profile icon" width="40" height="40" style="border-radius: 50%;" />
      </div>
      <span class=${Io(e)}></span>
    </span>
  </li>`},Ln=(t,...e)=>_`<div id="highlight-container" style="height: ${t}px">${e}</div>`,Mn=(t,e)=>_`<div
  class="highlight-area highlight-color"
  style="left: ${e.left}px; top: ${e.top}px; width: ${e.width}px; height:${e.height}px;"
  data-comment-id=${t}
  tabindex="0"
></div>`;function Tn(t){const[,e,r,o,n,a]=t.classList,i={};return i.attrs=Cn({qOn:e,qOff:r,pitchName:o,accidental:n,octave:a}),JSON.stringify(i,null,2)}function Cn(t){let e=gr(t.qOn),o=gr(t.qOff)-e;switch(o){case .25:o="1/4";break;case .5:o="1/2";break;case 1:case 2:case 4:o=o.toString();break}let n=t.accidental.split("-")[1];switch(n){case"n":n="natural";break;case"s":n="sharp";break;case"f":n="flat";break;case"ff":n="double flat";break;case"ss":n="double sharp";break}return{duration:o,pitch:t.pitchName.split("-")[1],accidental:n,octave:t.octave.split("-")[1]}}function gr(t){let[e,r]=t.split(/\D/).filter(Boolean);return e=parseInt(e,10),t.includes("_")?e/r:e}function Fn(){return{added:[],updated:[],removed:[]}}function Ee(t=Fn()){var o,n,a;const e=Array.from(C.awareness.getStates().entries()),r=()=>{var v,b;let i=document.querySelector("#output #collab");i||(console.log("Element div#collab is not found. Cannot render collaboration elements."),i=document.createElement("div"),i.id="collab",(v=document.querySelector("#output"))==null||v.prepend(i));let s=_`${e.filter(([y,E])=>{var k;return E.multiSelect!=null&&((k=E==null?void 0:E.user)==null?void 0:k.color)!=null}).map(([y,E])=>yn(y,y===C.awareness.clientID,E.multiSelect,E.user.color))}`,l=_`${e.filter(([y,E])=>{var k,O;return((k=E==null?void 0:E.singleSelect)==null?void 0:k.elemId)!=null&&((O=E==null?void 0:E.user)==null?void 0:O.color)!=null}).map(([y,E])=>An(y,E.singleSelect.elemId,E.user.color))}`,c=_`${e.filter(([y,E])=>{var k,O;return((k=E==null?void 0:E.singleSelect)==null?void 0:k.elemId)!=null&&((O=E==null?void 0:E.user)==null?void 0:O.name)!=null}).map(([y,E])=>Nn(y,E.singleSelect.elemId,E.user.name))}`,d=ue.state.toStrings().some(y=>y.toLowerCase().includes("comment")),m=_`${d?_`${(b=x.comments)==null?void 0:b.filter(y=>(y==null?void 0:y.highlight)!=null).map(y=>Mn(y.id,y.highlight))}`:null}`;he(_`
        ${Rn(s,l,c)}
        ${_n(m)}
      `,i);let p=document.querySelector("#online-users");if(p){let y=[...C.awareness.getStates().values()].map(k=>k.user.id),E=[...x.users];de({users:E.map(k=>ne(oe({},k),{online:y.includes(k.id)})).sort((k,O)=>O.online-k.online)}),he(_`${In(x.users)}`,p),$('[data-toggle="tooltip"]').tooltip()}else console.log("Element div#online-users is not found. Cannot display online user info.")};(o=t==null?void 0:t.added)==null||o.forEach(r),(n=t==null?void 0:t.updated)==null||n.forEach(r),(a=t==null?void 0:t.removed)==null||a.forEach(r)}function Rn(...t){var r;document.querySelector("#output");let e=document.querySelector("#output > svg");return yt.svgHeight=(r=e==null?void 0:e.height.baseVal.value)!=null?r:window.innerHeight,ln(yt.svgHeight,...t)}function _n(...t){var n;let e=document.querySelector("#output"),r=document.querySelector("#output > svg");e.querySelector("#collab-container");let o=(n=r==null?void 0:r.height.baseVal.value)!=null?n:window.innerHeight;return Ln(o,...t)}function On(t){let e,r,o=!1;const n=new bn;console.log(">>>Adding listeners to output"),document.addEventListener("mousedown",i=>{if(i.target.nodeName!="svg")return;e=performance.now(),n.isSelecting=!0,n.setUpperCoords(i),[...document.querySelectorAll(".multi-select-area")].find(c=>c.dataset.clientId==C.awareness.clientID)&&C.awareness.setLocalStateField("multiSelect",null)}),document.addEventListener("mousemove",i=>{n.isSelecting&&(r=performance.now(),r-e>=300&&(n.setLowerCoords(i),n.show(),o=!0))}),document.addEventListener("mouseup",a(C.awareness));function a(i){return()=>{if(n.reCalculateCoords(),n.isSelecting=!1,o){const s=Array.from(document.querySelectorAll(".note, .beam")),c=n.selectNoteElements(s).map(d=>d.id).filter(d=>/^note/g.test(d));c.length>0&&(i==null||i.setLocalStateField("multiSelect",c)),o=!1}n.resetCoords(),n.hide(),e=r=void 0}}}function Kn(t,e){let r=Object.keys(t).sort(),o=Object.keys(e).sort();if(r.length!==o.length)return!1;for(let n=0;n<r.length;n++)if(r[n]!==o[n])return!1;return!0}const Oe={score:!1,collaboration:!1,videoConference:!1,waveSurfer:!1};let Xe=document.getElementById("feature-form"),Le=Xe.querySelectorAll('input[type="checkbox"]');function Dn(t=Oe){let e=Object.assign({},t);return{setFeature(r,o){let n;return r in e||(n=new Error(`Feature ${r} not found on feature config ${JSON.stringify(e,null,2)}`)),typeof o!="boolean"&&(n=new Error("Value must be boolean")),new Promise((a,i)=>{n&&i(n);let s=e[r];e[r]=o,a({config:e,changed:s!=o?{[r]:o}:null})})},featureIsEnabled(r){return e[r]}}}let St=Kn(pt,Oe);const Se=Dn(St?pt:Oe);St&&hr().then(()=>console.log("Loaded features from file configuration"));function Gn(t){return Se.featureIsEnabled(t)}async function hr(){if(Se.featureIsEnabled("score")&&(pr(),Ue("score",Le)),Se.featureIsEnabled("collaboration")&&(vr(),Ue("collaboration",Le)),Se.featureIsEnabled("videoConference")){let{default:t}=await ar(()=>import("./index.8cdb46ce.js"),["assets/index.8cdb46ce.js","assets/vendor.7a9baf1f.js"]);yr(t)}Se.featureIsEnabled("waveSurfer")}function Ue(t,e){console.log(`Disabling ${t}`);let r=[...e].find(o=>o.name===t);if(!r){console.error("Option to disable was not found.");return}r.disabled=!0}function xn(){var t;(t=document.getElementById("comments__menu-item"))==null||t.classList.remove("hidden")}function pr(){let t=document.getElementById("score-editor");if(!t){console.error("Score editor element was not found. Check index.html");return}t.style.display="block"}function vr(){gn(),On(),xn()}function yr(t){let e=document.getElementById("jitsi-meeting-container");if(!e){console.error("Jitsi container element was not found. Check index.html");return}e.style.display="block",t.setup()}function qn(t){let e=document.getElementById("jitsi-meeting-container");if(!e){console.error("Jitsi container element was not found. Check index.html");return}e.style.display="none",t.destroy()}function Hn(t){return function(){Le.forEach(r=>{r.checked=t[r.name]}),Xe==null||Xe.addEventListener("submit",e);function e(r){r.preventDefault();const o=Array.from(Le).map(n=>({name:n.name,checked:n.checked}));console.log(o),o.forEach(async n=>{let a=await Se.setFeature(n.name,n.checked);if(a.changed!==null)switch(n.name){case"score":a.changed[n.name]&&(pr(),Ue("score",Le));break;case"collaboration":a.changed[n.name]&&a.config.score&&(vr(),Ue("collaboration",Le));break;case"videoConference":let{default:i}=await ar(()=>import("./index.8cdb46ce.js"),["assets/index.8cdb46ce.js","assets/vendor.7a9baf1f.js"]);a.changed[n.name]?yr(i):qn(i);return}})}}}window.addEventListener("load",Hn(St?pt:Oe));window.bts=hr;window.FeatureConfig=Oe;window.toggler=Se;var Ke=-1,Nt=600;function br(t){t=t||0,t==0,Nt=600;let e=ve();if(!e)throw new Error("Verovio worker is undefined");e.renderToMidi().then(function(r){var o="data:audio/midi;base64,"+r;console.log("Midi song",o),$("#play-button").hide(),$("#midiPlayer_play").show(),$("#midiPlayer_stop").show(),$("#midiPlayer_pause").show(),$("#player").show(),$("#player").midiPlayer.play(o,t),ie.PLAY=!0,Ke=-1}).catch(r=>console.log("Error when trying to play midi",r))}var De=[];const Er=function(t){let e=ve();if(!e)throw new Error("Verovio worker is undefined");var r=Math.max(0,t-Nt);e.getElementsAtTime(r).then(function(o){var n;if(o.page>0&&(o.page!=e.page&&(e.page=o.page,Fe()),o.notes.length>0&&De!=o.notes)){De.forEach(function(c){if($.inArray(c,o.notes)==-1){var d=document.querySelector("#"+c);d&&d.classList.remove("highlight")}}),De=o.notes;var a=document.querySelector("#output"),i=a.getBoundingClientRect(),s=!1,l=1/3;De.forEach(function(c){if(n=c.match(/-L(\d+)/)){var d=parseInt(n[1]);d!=Ke&&d>Ke&&(Ri(c),Ke=d)}var m=document.querySelector("#"+c);if(m&&(m.classList.add("highlight"),!s)){let p=m.closest(".system"),v,b=p.nextElementSibling;if(p){v=p.getBoundingClientRect();let y,E,k,O;b?(b.nextElementSibling,y=b.getBoundingClientRect(),E=v.top,k=y.top,O=k-E):(E=v.top,k=v.bottom,O=k-E),E<i.top?(a.scrollTop=a.scrollTop-(i.top-E)-O*l,s=!0):k>i.bottom&&(a.scrollTop=a.scrollTop+(E-i.top)-i.height/20,s=!0)}}})}})};window.midiUpdate=Er;const Bn=function(){De.forEach(function(t){var e=document.querySelector("#"+t);if(e){for(var r=e.getAttribute("class"),o=r.split(" "),n="",a=0;a<o.length;a++)o[a]!="highlight"&&(n+=" "+o[a]);e.setAttribute("class",n)}}),document.querySelectorAll(".highlight").forEach(t=>t.classList.remove("highlight")),$("#player").hide(),$("#play-button").show(),u.CursorNote=null,ie.PLAY=!1,Ke=-1};$.fn.addClassSVG=function(t){return $(this).attr("class",function(e,r){return r+" "+t}),this};$.fn.removeClassSVG=function(t){return $(this).attr("class",function(e,r){}),this};let At;function ve(){return typeof At=="undefined"&&Pn("true"),At}function Pn(t){console.log("Downloading vrv toolkit from humdrum-notation-plugin-worker.js"),At=new H(t,$n)}function $n(){console.log("Initialized verovio worker"),Xn()}function Xn(){let t=P();t?(t.session.on("change",function(e){Ji()}),t.getSession().selection.on("changeCursor",function(){const{row:e,column:r}=t.selection.getCursor(),o=_i(e,r);if(o&&o.classList.contains("note")&&(Pt(o),Gn("collaboration")&&C)){const n=C.awareness.getLocalState();C.awareness.setLocalState(ne(oe({},n),{singleSelect:{elemId:o.id},multiSelect:null}))}})):console.log("Warning: Editor not setup yet"),$(window).resize(function(){T()}),$("#input").mouseup(function(){let e=$(this);(e.outerWidth()!=e.data("x")||e.outerHeight()!=e.data("y"))&&Be(),e.data("x",e.outerWidth()),e.data("y",e.outerHeight())}),g.ShowingIndex||(console.log("Score will be displayed after verovio has finished loading"),T()),Un()}function Un(){$("#player").midiPlayer({color:null,onUnpdate:Er,onStop:Bn,width:250}),$("#input").keydown(function(){stop()}),window.addEventListener("blur",function(){window.pause()})}function H(t,e){this.WIDTH=0,this.HEIGHT=0,this.page=1,this.pageCount=0,this.options={},this.initialized=!1,this.usingWorker=t,t?this.createWorkerInterface(e):this.createDefaultInterface(e)}H.prototype.createWorkerInterface=function(t){var e=this;function r(a){switch(a.data.method){case"ready":e.initialized=!0,t();break;default:for(;e.resolvedIdx<=a.data.idx;)e.resolvedIdx===a.data.idx?a.data.success?e.promises[e.resolvedIdx].deferred.resolve(a.data.result):e.promises[e.resolvedIdx].deferred.reject(a.data.result):e.promises[e.resolvedIdx].deferred.reject(),e.promises[e.resolvedIdx].method==="renderData"&&(e.renderDataPending--,e.renderDataPending===0&&e.handleWaitingRenderData()),delete e.promises[e.resolvedIdx],e.resolvedIdx++}}console.log("creating verovio worker interface"),this.promises={},this.promiseIdx=0,this.resolvedIdx=0,this.renderDataPending=0,this.renderDataWaiting=null,console.log("LOADING /scripts/verovio-worker.js");var o="/scripts/verovio-worker.js";this.worker=null;var n=this;try{n.worker=new Worker(o),n.worker.addEventListener("message",r),n.worker.onerror=function(a){a.preventDefault(),n.worker=Sr(o),n.worker.addEventListener("message",r)}}catch{n.worker=Sr(o),n.worker.addEventListener("message",r)}};function Sr(t){console.log("Getting cross-origin worker");var e=null;try{var r;try{console.log("humdrum plugin createWorkerFallback URL",t),r=new Blob(["importScripts('"+t+"');"],{type:"application/javascript"})}catch{var o=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder);console.log("createWorkerFallback BlobBuilder URL",t),o.append("importScripts('"+t+"');"),r=o.getBlob("application/javascript")}var n=window.URL||window.webkitURL,a=n.createObjectURL(r);e=new Worker(a)}catch{}return e}H.prototype.checkInitialized=function(){if(console.log(new Error().stack),!this.initialized)throw"Verovio toolkit not (yet) initialized"};H.prototype.filterData=function(t,e,r){return this.execute("filterData",arguments)};H.prototype.renderData=function(t,e,r){return this.options=t,this.execute("renderData",arguments)};H.prototype.getHumdrum=function(){var t=this.execute("getHumdrum",arguments);return t};H.prototype.redoLayout=function(t,e,r){return this.options=t,this.execute("redoLayout",arguments)};H.prototype.renderPage=function(t){return this.execute("renderPage",arguments)};H.prototype.renderAllPages=function(t,e){return this.execute("renderAllPages",arguments)};H.prototype.gotoPage=function(t){var e=this;return this.execute("gotoPage",arguments).then(function(r){return e.page=r.page,e.pageCount=r.pageCount,t})};H.prototype.getMEI=function(t){return this.execute("getMEI",arguments)};H.prototype.renderToMidi=function(){var t=this.execute("renderToMidi",arguments);return t};H.prototype.getElementsAtTime=function(t){return this.execute("getElementsAtTime",arguments)};H.prototype.getTimeForElement=function(t){return this.execute("getTimeForElement",arguments)};H.prototype.execute=function(t,e){var r=this;if(this.usingWorker){var o=Array.prototype.slice.call(e);switch(t){case"renderData":return r.postRenderData(t,o);default:return r.handleWaitingRenderData(),r.post(t,o)}}else return new RSVP.Promise(function(n,a){try{r.checkInitialized(),n(r.verovio[t].apply(r.verovio,e))}catch(i){a(i)}})};H.prototype.handleWaitingRenderData=function(){this.renderDataWaiting&&(this.postDeferredMessage("renderData",this.renderDataWaiting.args,this.renderDataWaiting.deferred),this.renderDataWaiting=null,this.renderDataPending++)};H.prototype.postRenderData=function(t,e){return this.renderDataPending>0?(this.renderDataWaiting||(this.renderDataWaiting={deferred:new RSVP.defer}),this.renderDataWaiting.args=e,this.renderDataWaiting.deferred.promise):(this.renderDataPending++,this.renderDataWaiting=null,this.post(t,e))};H.prototype.post=function(t,e){return this.postDeferredMessage(t,e,new RSVP.defer)};H.prototype.postDeferredMessage=function(t,e,r){return this.worker.postMessage({idx:this.promiseIdx,method:t,args:e}),this.promises[this.promiseIdx]={method:t,deferred:r},this.promiseIdx++,r.promise};function fe(){return this.clear(),this}fe.prototype.clear=function(){this.clearSvgInfo()};fe.prototype.clearSvgInfo=function(){this.m_svg=new Ne};fe.prototype.loadSvg=function(t){let e=this.m_svg.loadSvg(t);return e||console.warn("Warning: could not load SVG image"),e};fe.prototype.getMeasure=function(t){return this.m_svg?this.m_svg.getMeasure(t):null};fe.prototype.getMeasureElement=function(t){if(!this.m_svg)return null;let e=this.m_svg.getMeasure(t);return!e||typeof e.element=="undefined"?null:e.element};fe.prototype.getLowerSystemMarkupElement=function(){return this.m_svg.getLowerSystemMarkupElement()};fe.prototype.getLowerMeasureMarkupElement=function(){return this.m_svg.getLowerMeasureMarkupElement()};fe.prototype.highlightMeasure=function(t){let e,r,o,n;if(typeof t=="number"?(e=t,r="goldenrod",o=.25,n=1):typeof t=="string"?(e=parseInt(t),r="goldenrod",o=.25,n=1):(e=t.measure||1,r=t.color||"goldenrod",o=t.opacity||.25,typeof t.padding!="undefined"?n=t.padding:n=1),e<0)return null;let a=this.getMeasure(e);if(!a)return null;let i=a.getX(),s=a.getY(),l=a.getWidth(),c=a.getHeight(),d=a.getVuScale();n>0&&d>0&&(i=i-n*d,s=s-n*d,l=l+2*n*d,c=c+2*n*d);let m=document.createElementNS("http://www.w3.org/2000/svg","rect");m.setAttribute("x",i),m.setAttribute("y",s),m.setAttribute("width",l),m.setAttribute("height",c),m.setAttribute("fill",r),m.setAttribute("opacity",o);let p=this.getLowerMeasureMarkupElement();return p?(p.appendChild(m),m):null};function Ne(){return this.clear(),this}Ne.prototype.clear=function(){this.element=null,this.svgSystems=[],this.svgSystemMeasures=[],this.svgMeasures=[],this.pagemargin=null,this.lowerMarkupElement=null,this.lowerSystemMarkupElement=null,this.lowerMeasureMarkupElement=null};Ne.prototype.loadSvg=function(t){if(this.clear(),typeof t=="string"){let o=document.querySelector(t);if(!o)return console.warn("Warning: Selector for SVG element is invalid",t),!1;t=o}if(!t)return console.warn("Warning: SVG element not found"),!1;if(t.nodeName!=="svg")return console.warn("Warning: SVG element is not an SVG element:",t),!1;this.element=t;let r=t.querySelectorAll('g[id^="system-"].system');if(!r)return console.warn("Warning: no systems in SVG image"),!1;this.svgSystems=[];for(let o=0;o<r.length;o++){let n={};n.element=r[o],this.svgSystems.push(n)}this.svgSystemMeasures=[];for(let o=0;o<this.svgSystems.length;o++){let a=this.svgSystems[o].element.querySelectorAll('g[id^="measure-"].measure'),i=[];if(this.svgSystemMeasures.push(i),!!a)for(let s=0;s<a.length;s++){let l=new W;l.element=a[s],l.systemIndex=o,l.systemMeasureIndex=s,l.m_setMeasureNumber(),i.push(l)}}this.svgMeasures=[];for(let o=0;o<this.svgSystemMeasures.length;o++){let n=this.svgSystemMeasures[o];for(let a=0;a<n.length;a++)n[a].measureIndex=this.svgMeasures.length,this.svgMeasures.push(n[a])}this.measures={};for(let o=0;o<this.svgMeasures.length;o++){let n=this.svgMeasures[o],a=n.number,i=this.measures[a];i||(this.measures[a]=[]),i=this.measures[a],i.push(n)}return this.m_insertLowerMarkupLayer(),!0};Ne.prototype.m_insertLowerMarkupLayer=function(){if(!this.element){console.warn("Error: no SVG image");return}let t=this.element,e=t.querySelector(".page-margin");if(!e){console.warn("Error: invalid SVG image",t);return}this.pagemargin=e;let r=e.firstElementChild,o=r.classList,n=!1;for(let i=0;i<o.length;i++)if(o[i]==="lowerMarkupLayer"){n=!0;break}if(n)this.lowerMarkupElement=r;else{let i=document.createElementNS("http://www.w3.org/2000/svg","g");r.parentNode.prepend(i),i.classList.add("lowerMarkupLayer"),this.lowerMarkupElement=i}this.lowerMarkupElement.innerHTML="";let a;a=document.createElementNS("http://www.w3.org/2000/svg","g"),a.classList.add("lowerSystemMarkups"),this.lowerMarkupElement.appendChild(a),this.lowerSystemMarkupElement=a,a=document.createElementNS("http://www.w3.org/2000/svg","g"),a.classList.add("lowerMeasureMarkups"),this.lowerMarkupElement.appendChild(a),this.lowerMeasureMarkupElement=a};Ne.prototype.getLowerSystemMarkupElement=function(){return this.lowerSystemMarkupElement?this.lowerSystemMarkupElement:null};Ne.prototype.getLowerMeasureMarkupElement=function(){return this.lowerMeasureMarkupElement?this.lowerMeasureMarkupElement:null};Ne.prototype.getMeasure=function(t){if(typeof t=="undefined"){console.log("Warning: no bar number given as input.");return}return this.measures?(typeof t=="string"&&(t=parseInt(t)),this.measures[t][0]):null};function W(){return this.clear(),this}W.prototype.clear=function(){delete this.element,delete this.number};W.prototype.getMeasureNumber=function(){return typeof this.number!="undefined"?this.number:(this.m_setMeasureNumber(),this.number)};W.prototype.getMeasureElement=function(){return typeof this.element!="undefined"?this.element:null};W.prototype.m_setMeasureNumber=function(){if(typeof this.number!="undefined")return this.number;let t=-1,e=this.element;if(!e)return t;let r=e.classList;for(let o=0;o<r.length;o++){let n=r[o].match(/m-(\d+)/);if(n){t=parseInt(n[1]);break}}return this.number=t,t};W.prototype.getX=function(){return typeof this.x!="undefined"?this.x:(this.m_setMeasureInfo(),this.x)};W.prototype.getY=function(){return typeof this.y!="undefined"?this.y:(this.m_setMeasureInfo(),this.y)};W.prototype.getHeight=function(){return typeof this.height!="undefined"?this.height:(this.m_setMeasureInfo(),this.height)};W.prototype.getWidth=function(){return typeof this.width!="undefined"?this.width:(this.m_setMeasureInfo(),this.width)};W.prototype.getVuScale=function(){return typeof this.vu!="undefined"?this.vu:(this.m_setMeasureInfo(),this.vu)};W.prototype.m_setMeasureInfo=function(){if(typeof this.x!="undefined")return!1;if(!this.element)return console.log("NO SVG ELEMENT"),!1;let t=this.element.getBBox(),e=this.element.querySelectorAll(".staff path");if(e.length<=0)return this.width=t.width,console.warn("Warning: NO STAFF LINES IN MEASURE"),!1;this.stafflines=e,this.m_setX(),this.y=t.y,this.height=t.height;let r=this.stafflines[0].getBBox();return this.width=r.width,this.m_setVuScale()};W.prototype.m_setX=function(){let t=this.stafflines;if(t.length<=0)return console.log("STAFFLINES NOT FOUND"),this.x=0,!1;var r=t[0].getAttribute("d").match(/M([\d.+-]+)/);return r?(this.x=parseFloat(r[1]),!0):(this.x=0,console.log("STAFFLINES NOT FOUND B"),!1)};W.prototype.m_setVuScale=function(){let t=this.stafflines;if(t.length<=0)return this.vu=0,!1;let e=t[0].getAttribute("d"),r,o;var n=e.match(/M[\d.+-]+\s+([\d.+-]+)/);if(n)r=parseInt(n[1]);else return this.vu=0,!1;if(n=t[1].getAttribute("d").match(/M[\d.+-]+\s+([\d.+-]+)/),n)o=parseInt(n[1]);else return this.vu=0,!1;let i=Math.abs(o-r);return this.vu=i,!0};let N=0;function ee(t){N=parseInt(t,10)%10}function h(t,e){var r=e.id,o;if(o=r.match(/L(\d+)/))var n=parseInt(o[1]);else return;if(o=r.match(/F(\d+)/))var a=parseInt(o[1]);else return;if(o=r.match(/S(\d+)/))var i=parseInt(o[1]);else i=null;if(o=r.match(/N(\d+)/))var s=parseInt(o[1]);else s=1;if(o=r.match(/^([a-z]+)-/))var l=o[1];else return;if(!(n<1||a<1)){var c=0,d=0,m=1;if((o=r.match(/^[^-]+-[^-]+-.*L(\d+)/))&&(c=parseInt(o[1])),(o=r.match(/^[^-]+-[^-]+-.*F(\d+)/))&&(d=parseInt(o[1])),(o=r.match(/^[^-]+-[^-]+-.*S(\d+)/))&&parseInt(o[1]),(o=r.match(/^[^-]+-[^-]+-.*N(\d+)/))&&(m=parseInt(o[1])),t==="esc"){if(Te().hideContextualMenus(),u.HIGHLIGHTQUERY="",!e)return;for(var p=e.getAttribute("class"),v=p.split(" "),b="",y=0;y<v.length;y++)v[y]!="highlight"&&(b+=" "+v[y]);e.setAttribute("class",b),u.CursorNote="";return}l==="note"?t==="y"?Mr(r,n,a):t==="a"?fa(r,n,a):t==="b"?ma(r,n,a):t==="c"?ga(r,n,a):t==="#"?va(r,n,a,i):t==="-"?ya(r,n,a,i):t==="i"?pa(r,n,a,i):t==="n"?ba(r,n,a,i):t==="m"?Ve("m",r,n,a,i):t==="M"?Ve("M",r,n,a,i):t==="w"?Ve("w",r,n,a,i):t==="W"?Ve("W",r,n,a,i):t==="X"?Ea(r,n,a,i):t==="L"?Fr(e):t==="J"?Rr(e):t==="transpose-up-step"?ze(r,n,a,i,1):t==="transpose-down-step"?ze(r,n,a,i,-1):t==="transpose-up-octave"?ze(r,n,a,i,7):t==="transpose-down-octave"?ze(r,n,a,i,-7):t==="'"?Sa(r,n,a):t==="^"?Na(r,n,a):t==="^^"?Aa(r,n,a):t==="~"?wa(r,n,a):t==="s"?aa(r,n,a):t==="q"?ka(r,n,a):t==="p"?(console.log("p pressed"),Ca(r,n,a)):t==="P"?_a(r,n,a):t==="t"?La(r,n,a):t==="T"?Oa(r,n,a):t==="`"?Ia(r,n,a):t===";"?Lr(r,n,a):t===":"?Ka(r,n,a):t==="1"?N=1:t==="2"?N=2:t==="3"?N=3:t==="4"?N=4:t==="5"?N=5:t==="6"?N=6:t==="7"?N=7:t==="8"?N=8:t==="9"?N=9:t==="@"&&xa(r,n,a,i):l==="rest"?t==="y"?Mr(r,n,a):t===";"?Lr(r,n,a):t==="L"?Fr(e):t==="J"&&Rr(e):l==="dynam"?t==="a"?Yn(r,n,a,s):t==="b"?jn(r,n,a,s):t==="c"&&Zn(r,n,a,s):l==="hairpin"?t==="a"?Qn(r,n,a,s):t==="b"?Jn(r,n,a,s):t==="c"&&ea(r,n,a,s):l==="slur"?t==="a"?ta(r,n,a,s):t==="b"?ra(r,n,a,s):t==="c"?oa(r,n,a,s):t==="D"||t==="delete"?kr(r,n,a,s,c,d,m):t==="leftEndMoveBack"?na(r,n,a,s,c):t==="leftEndMoveForward"?ia(r,n,a,s,c):t==="rightEndMoveForward"?sa(r,n,a,s,c,d,m):t==="rightEndMoveBack"?la(r,n,a,s,c,d,m):t==="1"?N=1:t==="2"?N=2:t==="3"?N=3:t==="4"?N=4:t==="5"?N=5:t==="6"?N=6:t==="7"?N=7:t==="8"?N=8:t==="9"&&(N=9):l==="tie"?t==="a"?ca(r,n,a,i):t==="b"?ua(r,n,a,i):t==="c"&&da(r,n,a,i):l==="beam"&&(t==="a"?zn(r,n,a):t==="b"?Vn(r,n,a):t==="c"&&Wn(r,n,a))}}function zn(t,e,r){var o=A(e,r);if(!(o==="."||o[0]=="!"||o[0]=="*")){var n=ce(),a=n[0],i=n[1],s=new RegExp("([^LJKk]*)([LJKk]+)(["+a+i+"]*)([^LJKk]*)"),l=s.exec(o);if(l){var c=l[1];c+=l[2],c+=a,c+=l[4]}else return;c!==o&&(u.RestoreCursorNote=t,u.HIGHLIGHTQUERY=t,w(e,r,c))}}function Vn(t,e,r){var o=A(e,r);if(!(o==="."||o[0]=="!"||o[0]=="*")){var n=ce(),a=n[0],i=n[1],s=new RegExp("([^LJKk]*)([LJKk]+)(["+a+i+"]*)([^LJKk]*)"),l=s.exec(o);if(l){var c=l[1];c+=l[2],c+=i,c+=l[4]}else return;c!==o&&(u.RestoreCursorNote=t,u.HIGHLIGHTQUERY=t,w(e,r,c))}}function Wn(t,e,r){var o=A(e,r);if(!(o==="."||o[0]=="!"||o[0]=="*")){var n=ce(),a=n[0],i=n[1],s=new RegExp("([^LJKk]*)([LJKk]+)(["+a+i+"]*)([^LJKk]*)"),l=s.exec(o);if(l){var c=l[1];c+=l[2],c+=l[4]}else return;c!==o&&(u.RestoreCursorNote=t,u.HIGHLIGHTQUERY=t,w(e,r,c))}}function Yn(t,e,r,o){Nr(t,e,r,o,"DY")}function jn(t,e,r,o){Ar(t,e,r,o,"DY")}function Zn(t,e,r,o){wr(t,e,r,o,"DY")}function Qn(t,e,r,o){Nr(t,e,r,o,"HP")}function Jn(t,e,r,o){Ar(t,e,r,o,"HP")}function ea(t,e,r,o){wr(t,e,r,o,"HP")}function Nr(t,e,r,o,n){var a=A(e,r);if(!(a==="."||a[0]=="!"||a[0]=="*")){var i=!1,s=e-1,l=A(s,r),c=0;l.match(/^!LO/)||(Ir(e),c=1,e+=1,s=e-1,l="!",i=!0),l.match(/^!LO/)?l.match(/:b(?=:|=|$)/)?(l=l.replace(/:b(?=:|=|$)/,":a"),i=!0):l.match(/:a(:|=|$)/)||(l="!LO:"+n+":a",i=!0):l=="!"?(l="!LO:"+n+":a",i=!0):console.log("ERROR TOGGLING ABOVE DIRECTION"),c!=0&&(t=t.replace("L"+(e-1),"L"+(e+c-1))),i&&(u.RestoreCursorNote=t,u.HIGHLIGHTQUERY=t,w(s,r,l))}}function Ar(t,e,r,o,n){var a=A(e,r);if(!(a==="."||a[0]=="!"||a[0]=="*")){var i=!1,s=e-1,l=A(s,r),c=0;l.match(/^!LO/)||(Ir(e),c=1,e+=1,s=e-1,l="!",i=!0),l.match(/^!LO/)?l.match(/:a(?=:|=|$)/)?(l=l.replace(/:a(?=:|=|$)/,":b"),i=!0):l.match(/:b(:|=|$)/)||(l="!LO:"+n+":b",i=!0):l=="!"?(l="!LO:"+n+":b",i=!0):console.log("ERROR TOGGLING ABOVE DIRECTION"),c!=0&&(t=t.replace("L"+(e-1),"L"*+(e+c-1))),i&&(u.RestoreCursorNote=t,u.HIGHLIGHTQUERY=t,w(s,r,l))}}const S=P();if(!S)throw new Error("Ace Editor is undefined");function wr(t,e,r,o,n){e=parseInt(e);var a=A(e-1,r);if(a[0]==="!"){var i=!1,s=new RegExp("^!LO:"+n+":");if(a.match(s))a="!",i=!0;else return;if(!!i){w(e-1,r,a,t,!0);var l=S.session.getLine(e-2);if(l.match(/^[!\t]+$/)){var c=new Range(e-2,0,e-1,0);S.session.remove(c),u.RestoreCursorNote=t.replace("L"+e,"L"+(e-1)),T(),Z(u.RestoreCursorNote)}}}}function Ir(t){var e=g.FreezeRendering;g.FreezeRendering==!1&&(g.FreezeRendering=!0);var r=S.session.getLine(t-1),o="";r[0]=="	"?o+="	":o+="!";var n;for(n=1;n<r.length;n++)r[n]=="	"?o+="	":r[n]!="	"&&r[n-1]=="	"&&(o+="!");o+=`
`+r;var a=new Range(t-1,0,t-1,r.length);S.session.replace(a,o),g.FreezeRendering=e}function ta(t,e,r,o){var n=A(e,r);if(!(n==="."||n[0]=="!"||n[0]=="*")){for(var a=ce(),i=a[0],s=a[1],l=0,c="",d=0;d<n.length;d++)if(n[d]=="("&&l++,c+=n[d],l==o)if(n[d+1]==i){l++;continue}else if(n[d+1]==s){c+=i,d++,l++;continue}else{c+=i,l++;continue}c!==n&&(u.RestoreCursorNote=t,u.HIGHLIGHTQUERY=t,w(e,r,c))}}function ra(t,e,r,o){var n=A(e,r);if(!(n==="."||n[0]=="!"||n[0]=="*")){for(var n=A(e,r),a=ce(),i=a[0],s=a[1],l=0,c="",d=0;d<n.length;d++)if(n[d]=="("&&l++,c+=n[d],l==o)if(n[d+1]==s){l++;continue}else if(n[d+1]==i){c+=s,d++,l++;continue}else{c+=s,l++;continue}c!==n&&(u.RestoreCursorNote=t,u.HIGHLIGHTQUERY=t,w(e,r,c))}}function oa(t,e,r,o){var n=A(e,r);if(!(n==="."||n[0]=="!"||n[0]=="*")){for(var a=ce(),i=a[0],s=a[1],l=0,c="",d=0;d<n.length;d++)if(n[d]=="("&&l++,c+=n[d],l==o)if(n[d+1]==s){d++,l++;continue}else if(n[d+1]==i){d++,l++;continue}else{l++;continue}c!==n&&(u.RestoreCursorNote=t,u.HIGHLIGHTQUERY=t,w(e,r,c))}}function na(t,e,r,o,n,a,i){console.log("LEFT END MOVE BACK");var s=A(e,r);if(!(parseInt(e)>=parseInt(n))){var l=e-2,c=0,d=N;for(d||(d=1);l>0;){var m=S.session.getLine(l);if(m.match(/^\*/)||m.match(/^=/)||m.match(/^!/)||m===""){l--;continue}var p=A(l+1,r);if(p.match(/[A-G]/i)&&c++,c!=d){l--;continue}break}if(console.log("LEFTENDMOVEBACK NEW",s,e,r,o,p,l+1,t),!(l<=0)&&!(m[0]=="*"||m[0]=="!"||m==="")){var v=g.FreezeRendering;g.FreezeRendering=!0;var b=kt(t,e,r,o);b!==""&&wt(t,l+1,r,b),g.FreezeRendering=v,T(),N=0}}}function aa(t,e,r){A(e,r);var o=g.FreezeRendering;g.FreezeRendering=!0,wt(t,e,r,"(");var n=parseInt(e),a=0,i=S.session.getLength(),s=N;for(s||(s=1);n<i;){var l=S.session.getLine(n);if(l.match(/^\*/)||l.match(/^=/)||l.match(/^!/)||l===""){n++;continue}var c=A(n+1,r);if(c.match(/[A-G]/i)&&a++,a!=s){n++;continue}break}if(!(n>=i)&&!(l[0]=="*"||l[0]=="!"||l==="")&&!(n+1<=e)){It(t,n+1,r,")");var d=t.replace(/^note-/,"slur-"),m="-L"+(n+1)+"F"+r+"N"+1;d+=m,g.FreezeRendering=o,g.FreezeRendering||T(null,null,d),N=0,setTimeout(function(){var p=document.querySelector("svg g#"+t);if(p){var v=p.getAttribute("class");v.match(/\bhighlight\b/)||(v+=" highlight",p.setAttribute("class",v)),u.CursorNote=p}},300)}}function wt(t,e,r,o){for(var n=A(e,r),a="",i=n.length-1;i>=0;i--)if(n[i]=="("){a=n.substring(0,i+1),a+=o,a+=n.substring(i+1);break}a===""&&(a=o+n);var s=0;for(i=0;i<a.length;i++)a[i]=="("&&s++;var l=t.replace(/L\d+/,"L"+e);l=l.replace(/F\d+/,"F"+r),l=l.replace(/N\d+/,"N"+s),a!==n&&(u.RestoreCursorNote=l,u.HIGHLIGHTQUERY=l,w(e,r,a))}function It(t,e,r,o){for(var n=A(e,r),a="",i=0;i<n.length;i++)n[i]=="("&&(a=n.substring(0,i+1),a+=o,a+=n.substring(i+1));for(a===""&&(a=n+o),i=0;i<a.length;i++)a[i]=="(";a!==n&&(u.RestoreCursorNote=t,u.HIGHLIGHTQUERY=t,w(e,r,a))}function kt(t,e,r,o){for(var n=A(e,r),a="",i=0,s="",l=0;l<n.length;l++){if(n[l]=="("&&i++,i!=o){a+=n[l];continue}s+=n[l],n[l+1]==">"?(s+=">",l++):n[l+1]=="<"&&(s+="<",l++),i++}return a!==n&&(u.RestoreCursorNote=t,u.HIGHLIGHTQUERY=t,w(e,r,a)),s}function Lt(t,e,r,o){for(var n=A(e,r),a="",i=0,s="",l=0;l<n.length;l++){if(n[l]==")"&&(i++,s=")"),i==o){i++;continue}a+=n[l]}return a!==n&&(u.RestoreCursorNote=t,u.HIGHLIGHTQUERY=t,w(e,r,a)),s}function kr(t,e,r,o,n,a,i){var s=g.FreezeRendering;kt(t,e,r,o),Lt(t,n,a,i),g.FreezeRendering=s,u.RestoreCursorNote=null,u.HIGHLIGHTQUERY=null,g.FreezeRendering||T()}function ia(t,e,r,o,n,a,i){if(console.log("LEFT END MOVE FORWARD"),A(e,r),!(parseInt(e)>=parseInt(n))){var s=parseInt(e),l=0,c=S.session.getLength(),d=N;for(d||(d=1);s<c;){var m=S.session.getLine(s);if(m.match(/^\*/)||m.match(/^=/)||m.match(/^!/)||m===""){s++;continue}var p=A(s+1,r);if(p.match(/[A-G]/i)&&l++,l!=d){s++;continue}break}if(!(s>=c)&&!(m[0]=="*"||m[0]=="!"||m==="")&&!(s+1>=n)){var v=g.FreezeRendering;g.FreezeRendering=!0;var b=kt(t,e,r,o);b!==""&&wt(t,s+1,r,b),g.FreezeRendering=v,T(),N=0}}}function sa(t,e,r,o,n,a,i){if(A(n,r),!(parseInt(e)>=parseInt(n))){var s=parseInt(n),l=0,c=S.session.getLength(),d=N;for(d||(d=1);s<c;){var m=S.session.getLine(s);if(m.match(/^\*/)||m.match(/^=/)||m.match(/^!/)||m===""){s++;continue}var p=A(s+1,r);if(p.match(/[A-G]/i)&&l++,l!=d){s++;continue}break}if(!(s>=c)&&!(m[0]=="*"||m[0]=="!"||m==="")&&!(s+1<=e)){var v=g.FreezeRendering;g.FreezeRendering=!0;var b=Lt(t,n,a,i);b!==""&&It(t,s+1,r,b);var y="L"+(s+1)+"F"+a+"N"+i,E=t.replace(/-[^-]+$/,"-"+y);u.RestoreCursorNote=E,u.HIGHLIGHTQUERY=E,g.FreezeRendering=v,T(),N=0}}}function la(t,e,r,o,n,a,i){if(A(n,r),!(parseInt(e)>=parseInt(n))){var s=parseInt(n)-2,l=0,c=N;for(c||(c=1);s>=0;){var d=S.session.getLine(s);if(d.match(/^\*/)||d.match(/^=/)||d.match(/^!/)||d===""){s--;continue}var m=A(s+1,r);if(m.match(/[A-G]/i)&&l++,l!=c){s--;continue}break}if(!(s<=0)&&!(d[0]=="*"||d[0]=="!"||d==="")&&!(s+1<=e)){var p=g.FreezeRendering;g.FreezeRendering=!0;var v=Lt(t,n,a,i);v!==""&&It(t,s+1,r,v);var b="L"+(s+1)+"F"+a+"N"+i,y=t.replace(/-[^-]+$/,"-"+b);u.RestoreCursorNote=y,u.HIGHLIGHTQUERY=y,g.FreezeRendering=p,T(),N=0}}}function ca(t,e,r,o){console.log("TIE ABOVE",n,e,r,o,t);var n=A(e,r);if(!(n==="."||n[0]=="!"||n[0]=="*")){if(o){var a=n.split(" ");n=a[o-1]}if(!n.match("r")){var i="",s;if(!!(n.match(/[[]/)||n.match("_"))){var l=ce(),c=l[0],d=l[1],m=new RegExp("([^_[]*)([_[]+)(["+c+d+"]*)([^_[]*)");(s=m.exec(n))?i=s[1]+s[2]+c+s[4]:i=n,o&&(a[o-1]=i,i=a.join(" ")),i!==n&&(u.RestoreCursorNote=t,u.HIGHLIGHTQUERY=t,w(e,r,i))}}}}function ua(t,e,r,o){console.log("TIE BELOW",n,e,r,o,t);var n=A(e,r);if(!(n==="."||n[0]=="!"||n[0]=="*")){if(o){var a=n.split(" ");n=a[o-1]}if(!n.match("r")){var i="",s;if(!!(n.match(/[[]/)||n.match("_"))){var l=ce(),c=l[0],d=l[1],m=new RegExp("([^_[]*)([_[]+)(["+c+d+"]*)([^_[]*)");(s=m.exec(n))?i=s[1]+s[2]+d+s[4]:i=n,o&&(a[o-1]=i,i=a.join(" ")),i!==n&&(u.RestoreCursorNote=t,u.HIGHLIGHTQUERY=t,w(e,r,i))}}}}function da(t,e,r,o){console.log("TIE DIRECTION REMOVE",n,e,r,o,t);var n=A(e,r);if(!(n==="."||n[0]=="!"||n[0]=="*")){if(o){var a=n.split(" ");n=a[o-1]}if(!n.match("r")){var i="",s;if(!!(n.match(/[[]/)||n.match("_"))){var l=ce(),c=l[0],d=l[1],m=new RegExp("([^_[]*)([_[]+)(["+c+d+"]*)([^_[]*)");(s=m.exec(n))?i=s[1]+s[2]+s[4]:i=n,o&&(a[o-1]=i,i=a.join(" ")),i!==n&&(u.RestoreCursorNote=t,u.HIGHLIGHTQUERY=t,w(e,r,i))}}}}function fa(t,e,r){console.log("STEM ABOVE",e,r,t);var o=A(e,r);if(!(o==="."||o[0]=="!"||o[0]=="*")&&!o.match("r")){for(var n,a=o.split(" "),i=0;i<a.length;i++)(n=a[i].match(/([^\\\\\\\/]*)([\\\\\\\/]+)([^\\\\\\\/]*)/))?a[i]=n[1]+"/"+n[3]:(n=a[i].match(/([^A-Ga-g#XxYyTt:'~oOS$MmWw\^<>n-]*)([A-Ga-g#Xx<>yYnTt:'~oOS$MmWw\^-]+)(.*)/))&&(a[i]=n[1]+n[2]+"/"+n[3]);var s=a.join(" ");s!==o&&(u.RestoreCursorNote=t,u.HIGHLIGHTQUERY=t,w(e,r,s))}}function ma(t,e,r){console.log("STEM BELOW",e,r,t);var o=A(e,r);if(console.log("TOKEN EXTRACTED IS",o),!(o==="."||o[0]=="!"||o[0]=="*")&&!o.match("r")){for(var n,a=o.split(" "),i=0;i<a.length;i++)(n=a[i].match(/([^\\\/]*)([\\\\\\\/]+)([^\\\\\\\/]*)/))?a[i]=n[1]+"\\"+n[3]:(n=a[i].match(/([^A-Ga-g#XxYyTt:'~oOS$MmWw\^<>n-]*)([A-Ga-g#Xx<>yYnTt:'~oOS$MmWw\^-]+)(.*)/))&&(a[i]=n[1]+n[2]+"\\"+n[3]);var s=a.join(" ");s!==o&&(u.RestoreCursorNote=t,u.HIGHLIGHTQUERY=t,w(e,r,s))}}function ga(t,e,r){console.log("REMOVE STEMS",e,r,t);var o=A(e,r);if(!(o==="."||o[0]=="!"||o[0]=="*")&&!o.match("r")){var n=o.replace(/[\\\/]/g,"");n!==o&&(u.RestoreCursorNote=t,u.HIGHLIGHTQUERY=t,w(e,r,n))}}function ze(t,e,r,o,n){var a=A(e,r);n=parseInt(n);var i=N;if(i||(i=1),i>1&&(n>0?n=i-1:n=-i+1,N=0),o){var s=a.split(" ");a=s[o-1]}if(!(a==="."||a[0]=="!"||a[0]=="*")&&!a.match("r")){var l,c;(c=a.match(/([^a-gA-G]*)([a-gA-G]+)([^a-gA-G]*)/))&&(l=c[1],l+=or(c[2],n),l+=c[3]),o&&(s[o-1]=l,l=s.join(" ")),l!==a&&(u.RestoreCursorNote=t,u.HIGHLIGHTQUERY=t,w(e,r,l))}}function ha(t){const e=[];for(let{id:r,line:o,field:n,subfield:a,amount:i}of t){let s=A(o,n);i=parseInt(i);let l;if(a&&(l=s.split(" "),s=l[a-1]),s==="."||s[0]=="!"||s[0]=="*"||s.match("r"))continue;let c,d;(d=s.match(/([^a-gA-G]*)([a-gA-G]+)([^a-gA-G]*)/))&&(c=d[1],c+=or(d[2],i),c+=d[3]),a&&(l[a-1]=c,c=l.join(" ")),c!==s&&e.push({line:o,field:n,token:c,id:r})}return e}function pa(t,e,r,o){console.log("TOGGLE EDITORIAL ACCIDENTAL",e,r,o,t);var n=A(e,r);if(o){var a=n.split(" ");n=a[o-1]}if(!(n==="."||n[0]=="!"||n[0]=="*")&&!n.match("r")){var i=Go(),s,l,c=new RegExp(i);c.exec(n)?s=n.replace(new RegExp(i,"g"),""):n.match(/[-#n]/)?(l=n.match(/(.*[a-gA-Gn#xXyY-]+)(.*)/),s=l[1]+i+l[2]):(l=n.match(/(.*[a-gA-GxXyY]+)(.*)/),s=l[1]+"n"+i+l[2]),o&&(a[o-1]=s,s=a.join(" ")),s!==n&&(u.RestoreCursorNote=t,u.HIGHLIGHTQUERY=t,w(e,r,s))}}function va(t,e,r,o){var n=A(e,r);if(o){var a=n.split(" ");n=a[o-1]}if(!(n==="."||n[0]=="!"||n[0]=="*")&&!n.match("r")){var i;N==2?(n.match("##")?i=n.replace(/#+i?/,""):(i=n.replace(/[#n-]+/,""),i=i.replace(/([a-gA-G]+)/,function(s,l){return l?l+"##":s})),N=0):n.match("##")||!n.match("#")?(i=n.replace(/[#n-]+/,""),i=i.replace(/([a-gA-G]+)/,function(s,l){return l?l+"#":s})):i=n.replace(/#+i?/,""),o&&(a[o-1]=i,i=a.join(" ")),i!==n&&(u.RestoreCursorNote=t,u.HIGHLIGHTQUERY=t,w(e,r,i))}}function ya(t,e,r,o){var n=A(e,r);if(o){var a=n.split(" ");n=a[o-1]}if(!(n==="."||n[0]=="!"||n[0]=="*")&&!n.match("r")){var i;N==2?(n.match("--")?i=n.replace(/-+i?/,""):(i=n.replace(/[#n-]+/,""),i=i.replace(/([a-gA-G]+)/,function(s,l){return l?l+"--":s})),N=0):n.match("--")||!n.match("-")?(i=n.replace(/[#n-]+/,""),i=i.replace(/([a-gA-G]+)/,function(s,l){return l?l+"-":s})):i=n.replace(/-+i?/,""),o&&(a[o-1]=i,i=a.join(" ")),i!==n&&(u.RestoreCursorNote=t,u.HIGHLIGHTQUERY=t,w(e,r,i))}}function ba(t,e,r,o){console.log("TOGGLE NATURAL ACCIDENTAL",e,r,o,t);var n=A(e,r);if(o){var a=n.split(" ");n=a[o-1]}if(!(n==="."||n[0]=="!"||n[0]=="*")&&!n.match("r")){var i;n.match("n")?i=n.replace(/n+i?/,""):(i=n.replace(/[#n-]+/,""),i=i.replace(/([a-gA-G]+)/,function(s,l){return l?l+"n":s})),o&&(a[o-1]=i,i=a.join(" ")),i!==n&&(u.RestoreCursorNote=t,u.HIGHLIGHTQUERY=t,w(e,r,i))}}function Ea(t,e,r,o){console.log("TOGGLE EXPLICIT ACCIDENTAL",e,r,o,t);var n=A(e,r);if(o){var a=n.split(" ");n=a[o-1]}if(!(n==="."||n[0]=="!"||n[0]=="*")&&!n.match("r")){var i,s;n.match(/n/)?i=n.replace(/n/g,""):(s=n.match(/([^#-]*)([#-]+)(X?)([^#-]*)/))?s[3]==="X"?i=s[1]+s[2]+s[4]:i=s[1]+s[2]+"X"+s[4]:(s=n.match(/([^A-G]*)([A-G]+)([^A-G]*)/i))&&(i=s[1]+s[2]+"n"+s[3]),o&&(a[o-1]=i,i=a.join(" ")),i!==n&&(u.RestoreCursorNote=t,u.HIGHLIGHTQUERY=t,w(e,r,i))}}function Sa(t,e,r){var o=0,n=S.session.getLength(),a=g.FreezeRendering;g.FreezeRendering=!0;var i=N;for(i||(i=1);e<n&&o<i;){var s=A(e,r);if(s.match(/^\*/)||s.match(/^=/)||s.match(/^!/)||s===""){e++;continue}if(s==="."){e++;continue}if(s.match("r")){e++;continue}s.match("'")?(s=s.replace(/'[<>]*/g,""),u.RestoreCursorNote=t,w(e,r,s),o++,e++):(s=s.replace(/'+/,""),s=s.replace(/([a-gA-G]+[-#nXxYy<>]*)/g,function(l,c){return c?c+"'":l}),u.RestoreCursorNote=t,w(e,r,s),o++,e++)}N=0,g.FreezeRendering=a,T()}function Na(t,e,r){var o=0,n=S.session.getLength(),a=g.FreezeRendering;g.FreezeRendering=!0;var i=N;for(i||(i=1);e<n&&o<i;){var s=A(e,r);if(s.match(/^\*/)||s.match(/^=/)||s.match(/^!/)||s===""){e++;continue}if(s==="."){e++;continue}if(s.match("r")){e++;continue}s.match(/\^+/)?(s=s.replace(/\^+[<>]*/g,""),u.RestoreCursorNote=t,w(e,r,s),o++,e++):(s=s.replace(/\^+/,""),s=s.replace(/([a-gA-G]+[-#nXxYy<>]*)/,function(l,c){return c?c+"^":l}),u.RestoreCursorNote=t,w(e,r,s),o++,e++)}N=0,g.FreezeRendering=a,T()}function Aa(t,e,r){var o=0,n=S.session.getLength(),a=g.FreezeRendering;g.FreezeRendering=!0;var i=N;for(i||(i=1);e<n&&o<i;){var s=A(e,r);if(s.match(/^\*/)||s.match(/^=/)||s.match(/^!/)||s===""){e++;continue}if(s==="."){e++;continue}if(s.match("r")){e++;continue}s.match(/\^+/)?(s=s.replace(/\^+[<>]*/g,""),u.RestoreCursorNote=t,w(e,r,s),o++,e++):(s=s.replace(/\^+/,""),s=s.replace(/([a-gA-G]+[-#nXxYy<>]*)/,function(l,c){return c?c+"^^":l}),u.RestoreCursorNote=t,w(e,r,s),o++,e++)}N=0,g.FreezeRendering=a,T()}function wa(t,e,r){var o=0,n=S.session.getLength(),a=g.FreezeRendering;g.FreezeRendering=!0;var i=N;for(i||(i=1);e<n&&o<i;){var s=A(e,r);if(s.match(/^\*/)||s.match(/^=/)||s.match(/^!/)||s===""){e++;continue}if(s==="."){e++;continue}if(s.match("r")){e++;continue}s.match(/~/)?(s=s.replace(/~[<>]*/g,""),u.RestoreCursorNote=t,w(e,r,s),w(e,r,s),o++):(s=s.replace(/~+/g,""),s=s.replace(/([a-gA-G]+[-#nXxYy<>]*)/,function(l,c){return c?c+"~":l}),u.RestoreCursorNote=t,w(e,r,s),o++,e++)}N=0,g.FreezeRendering=a,T()}function Ia(t,e,r){var o=0,n=S.session.getLength(),a=g.FreezeRendering;g.FreezeRendering=!0;var i=N;for(i||(i=1);e<n&&o<i;){var s=A(e,r);if(s.match(/^\*/)||s.match(/^=/)||s.match(/^!/)||s===""){e++;continue}if(s==="."){e++;continue}if(s.match("r")){e++;continue}s.match(/`/)?(s=s.replace(/`[<>]*/g,""),u.RestoreCursorNote=t,w(e,r,s),o++,e++):(s=s.replace(/`/g,""),s=s.replace(/([a-gA-G]+[-#nXxYy<>]*)/,function(l,c){return c?c+"`":l}),u.RestoreCursorNote=t,w(e,r,s),o++,e++)}N=0,g.FreezeRendering=a,T()}function ka(t,e,r){for(var o=A(e,r),n=o.split(" "),a=0;a<n.length;a++)n[a].match("qq")?n[a]=n[a].replace(/qq/g,"q"):n[a].match("q")&&(n[a]=n[a].replace(/q/g,"qq"));var i=n.join(" ");i!==o&&(u.RestoreCursorNote=t,u.HIGHLIGHTQUERY=t,w(e,r,i))}function La(t,e,r){var o=A(e,r);o!=="."&&(o.match("r")||(o.match(/T/i)?o.match(/T/)?(o=o.replace(/T/g,"t"),u.RestoreCursorNote=t,w(e,r,o)):(o=o.replace(/T[<>]*/gi,""),u.RestoreCursorNote=t,w(e,r,o)):(o=o.replace(/T/gi,""),o=o.replace(/([a-gA-G]+[-#nXxYy<>]*)/,function(n,a){return a?a+"t":n}),u.RestoreCursorNote=t,w(e,r,o))))}function Ve(t,e,r,o,n){console.log("TOGGLE MORDENT",a,r,o,n,e);var a=A(r,o);if(!(a==="."||a[0]=="!"||a[0]=="*")){if(n){var i=a.split(" ");a=i[n-1]}if(!a.match("r")){var s="",l,l=a.match(/[MmWw]/),c=!1;l&&(c=!0);var d=!1;if(c){var m=new RegExp(t);m.exec(a)&&(d=!0)}d?s=a.replace(/[MmWw][<>]*/g,""):c?s=a.replace(/[MmWw]/g,t):s=a+t,n&&(i[n-1]=s,s=i.join(" ")),s!==a&&(u.RestoreCursorNote=e,u.HIGHLIGHTQUERY=e,w(r,o,s))}}}function Ma(t,e,r){var o=!0,n=S.session.getLine(e);if(n.match(/^\*/)&&n.match(/\*lig/)&&(o=!1),o){let i=S.session.getLine(e-1);i=i.replace(/\t+$/,"").replace(/^\t+/,"");let l=i.split(/\t+/).length,c="";for(let d=0;d<l;d++)c+="*",d==r-1&&(c+="lig"),d<l-1&&(c+="	");c+=`
`,S.session.insert({row:e-1,column:0},c),a=t.replace(/L\d+/,"L"+(e+1)),u.RestoreCursorNote=a,u.HIGHLIGHTQUERY=a}else{let i=S.session.getLine(e);i=i.replace(/\t+$/,"").replace(/^\t+/,"");let s=i.split(/\t+/);s[r-1]==="*"?s[r-1]="*lig":s[r-1]="*";let l=s.join("	");if(l.match(/^[*\t]+$/))console.log("DELETING BLANK LINE"),S.session.replace(new Range(e-2,0,e-1,0),""),a=t.replace(/L\d+/,"L"+(e-1)),u.RestoreCursorNote=a,u.HIGHLIGHTQUERY=a;else{console.log("UPDATING LINE:",l),l+=`
`,S.session.replace(new Range(e,0,e+1,0),l);var a=t;u.RestoreCursorNote=a,u.HIGHLIGHTQUERY=a}}}function Ta(t,e,r){var o=!0,n=S.session.getLine(e);if(n.match(/^\*/)&&n.match(/\*col/)&&(o=!1),o){let i=S.session.getLine(e-1);i=i.replace(/\t+$/,"").replace(/^\t+/,"");let l=i.split(/\t+/).length,c="";for(let d=0;d<l;d++)c+="*",d==r-1&&(c+="col"),d<l-1&&(c+="	");c+=`
`,S.session.insert({row:e-1,column:0},c),a=t.replace(/L\d+/,"L"+(e+1)),u.RestoreCursorNote=a,u.HIGHLIGHTQUERY=a}else{let i=S.session.getLine(e);i=i.replace(/\t+$/,"").replace(/^\t+/,"");let s=i.split(/\t+/);s[r-1]==="*"?s[r-1]="*col":s[r-1]="*";let l=s.join("	");if(l.match(/^[*\t]+$/))console.log("DELETING BLANK LINE"),S.session.replace(new Range(e-2,0,e-1,0),""),a=t.replace(/L\d+/,"L"+(e-1)),u.RestoreCursorNote=a,u.HIGHLIGHTQUERY=a;else{console.log("UPDATING LINE:",l),l+=`
`,S.session.replace(new Range(e,0,e+1,0),l);var a=t;u.RestoreCursorNote=a,u.HIGHLIGHTQUERY=a}}}function Ca(t,e,r){if(N==4){Ma(t,e,r),N=0;return}else if(N==5){Ta(t,e,r),N=0;return}var o=S.session.getLine(e-1);if(!o.match(/^!/)&&!o.match(/^\*/)){var n=!0,a=S.session.getLine(e-2);a.match(/^\*/)&&a.match(/\*ped/)&&(n=!1);var i;if(!n){console.log("DELETING PEDAL START"),S.session.replace(new Range(e-2,0,e-1,0),""),i=t.replace(/L\d+/,"L"+(e-1)),u.RestoreCursorNote=i,u.HIGHLIGHTQUERY=i;return}var s=Mt("*",o);s=s.replace(/^(\t*)\*(\t*)/,"$1*ped$2"),S.session.insert({row:e-1,column:0},s),i=t.replace(/L\d+/,"L"+(e+1)),u.RestoreCursorNote=i,u.HIGHLIGHTQUERY=i}}function Fa(t,e,r){var o=!0,n=S.session.getLine(e);if(n.match(/^\*/)&&n.match(/\*Xcol/)&&(o=!1),o){let i=S.session.getLine(e-1);i=i.replace(/\t+$/,"").replace(/^\t+/,"");let l=i.split(/\t+/).length,c="";for(let m=0;m<l;m++)c+="*",m==r-1&&(c+="Xcol"),m<l-1&&(c+="	");c+=`
`,S.session.replace(new Range(e,0,e,0),c);var a=t;u.RestoreCursorNote=a,u.HIGHLIGHTQUERY=a}else{let i=S.session.getLine(e);i=i.replace(/\t+$/,"").replace(/^\t+/,"");let s=i.split(/\t+/);s[r-1]==="*"?s[r-1]="*Xcol":s[r-1]="*";let l=s.join("	");if(l.match(/^[*\t]+$/)){console.log("DELETING BLANK LINE"),S.session.replace(new Range(e,0,e+1,0),"");var a=t;u.RestoreCursorNote=a,u.HIGHLIGHTQUERY=a}else{console.log("UPDATING LINE:",l),l+=`
`,S.session.replace(new Range(e,0,e+1,0),l);var a=t;u.RestoreCursorNote=a,u.HIGHLIGHTQUERY=a}}}function Ra(t,e,r){var o=!0,n=S.session.getLine(e);if(n.match(/^\*/)&&n.match(/\*Xlig/)&&(o=!1),o){let i=S.session.getLine(e-1);i=i.replace(/\t+$/,"").replace(/^\t+/,"");let l=i.split(/\t+/).length,c="";for(let m=0;m<l;m++)c+="*",m==r-1&&(c+="Xlig"),m<l-1&&(c+="	");c+=`
`,S.session.replace(new Range(e,0,e,0),c);var a=t;u.RestoreCursorNote=a,u.HIGHLIGHTQUERY=a}else{let i=S.session.getLine(e);i=i.replace(/\t+$/,"").replace(/^\t+/,"");let s=i.split(/\t+/);s[r-1]==="*"?s[r-1]="*Xlig":s[r-1]="*";let l=s.join("	");if(l.match(/^[*\t]+$/)){console.log("DELETING BLANK LINE"),S.session.replace(new Range(e,0,e+1,0),"");var a=t;u.RestoreCursorNote=a,u.HIGHLIGHTQUERY=a}else{console.log("UPDATING LINE:",l),l+=`
`,S.session.replace(new Range(e,0,e+1,0),l);var a=t;u.RestoreCursorNote=a,u.HIGHLIGHTQUERY=a}}}function _a(t,e,r){if(N==4){Ra(t,e,r),N=0;return}else if(N==5){Fa(t,e,r),N=0;return}var o=S.session.getLine(e-1);if(!o.match(/^!/)&&!o.match(/^\*/)){var n=!0,a=S.session.getLine(e);a.match(/^\*/)&&a.match(/\*Xped/)&&(n=!1);var i;if(!n){S.session.replace(new Range(e,0,e+1,0),""),i=t,u.RestoreCursorNote=i,u.HIGHLIGHTQUERY=i;return}var s=g.FreezeRendering;g.FreezeRendering=!0;var l=Mt("*",o);l=l.replace(/^(\t*)\*(\t*)/,"$1*Xped$2"),S.session.replace(new Range(e,0,e,0),l),i=t,console.log("OLDID",t,"NEWID",i),u.RestoreCursorNote=i,u.HIGHLIGHTQUERY=i,g.FreezeRendering=s,T()}}function Oa(t,e,r){var o=A(e,r);o!=="."&&(o.match("r")||(o.match(/T/i)?o.match(/t/)?(o=o.replace(/t/g,"T"),u.RestoreCursorNote=t,w(e,r,o)):(o=o.replace(/T[<>]*/gi,""),u.RestoreCursorNote=t,w(e,r,o)):(o=o.replace(/T/gi,""),o=o.replace(/([a-gA-G]+[-#nXxYy<>]*)/,function(n,a){return a?a+"T":n}),u.RestoreCursorNote=t,w(e,r,o))))}function Ka(t,e,r){var o=A(e,r);o!=="."&&(o.match("r")||(o.match(/:/i)?(o=o.replace(/:/gi,""),u.RestoreCursorNote=t,w(e,r,o)):(o=o.replace(/:/gi,""),o=o.replace(/([a-gA-G]+[-#nXxYy<>]*)/g,function(n,a){return a?a+":":n}),u.RestoreCursorNote=t,w(e,r,o))))}function Lr(t,e,r){console.log("TOGGLING FERMATA");var o=A(e,r);o!=="."&&(o.match(/;/i)?(o=o.replace(/;[<>]*/gi,""),u.RestoreCursorNote=t,w(e,r,o)):(o=o.replace(/;/gi,""),o=o.replace(/([ra-gA-G]+[-#nXxYy<>]*)/,function(n,a){return a?a+";":n}),u.RestoreCursorNote=t,w(e,r,o)))}function Mr(t,e,r){var o=A(e,r);o!=="."&&(o.match(/yy/)?(o=o.replace(/yy/,""),u.RestoreCursorNote=t,w(e,r,o)):(o=o+"yy",u.RestoreCursorNote=t,w(e,r,o)))}function w(t,e,r,o,n){var a=g.FreezeRendering;g.FreezeRendering==!1&&(g.FreezeRendering=!0);var i,s=S.session.getLine(t-1),l=new Range(t-1,0,t-1,s.length),c=s.split(/\t+/);c[e-1]=r;var d=[];for(i=0;i<c.length+1;i++)d[i]="";var m=0;for(s[0]!="	"&&m++,i=1;i<s.length;i++)s[i]=="	"?d[m]+="	":s[i]!="	"&&s[i-1]=="	"&&m++;var p="";for(i=0;i<d.length;i++)p+=d[i],c[i]&&(p+=c[i]);var v=0;for(i=0;i<e-1;i++)v+=c[i].length,v+=d[i].length;S.session.replace(l,p),g.FreezeRendering=a,n||T()}function Da(t,e,r,o){var n,a=S.session.getLine(t-1),i=new Range(t-1,0,t-1,a.length),s=a.split(/\t+/);s[e-1]=r;var l=[];for(n=0;n<s.length+1;n++)l[n]="";var c=0;for(a[0]!="	"&&c++,n=1;n<a.length;n++)a[n]=="	"?l[c]+="	":a[n]!="	"&&a[n-1]=="	"&&c++;var d="";for(n=0;n<l.length;n++)d+=l[n],s[n]&&(d+=s[n]);S.session.replace(i,d)}function Ga(t){g.FreezeRendering=!0,t.forEach(e=>Da(e.line,e.field,e.token,e.id)),g.FreezeRendering=!1,T()}function A(t,e){var r="",o=S.session.getLine(t-1),n=0;if(e>1){var a=0;for(let s=0;s<o.length&&(n++,o[s]=="	"&&s>0&&o[s-1]!="	"&&a++,a!=e-1);s++);}for(var i=n;i<o.length&&o[i]!="	";i++){if(o[i]==null){console.log("undefined index",i);break}r+=o[i]}return r}function xa(t,e,r,o){console.log("TOGGLE MARKED NOTE ",e,r,o,t);var n=A(e,r);if(o){var a=n.split(" ");n=a[o-1]}if(!(n==="."||n[0]=="!"||n[0]=="*")&&!n.match("r")){var i=Do(),s,l=new RegExp(i);l.exec(n)?s=n.replace(new RegExp(i,"g"),""):s=n+i,o&&(a[o-1]=s,s=a.join(" ")),s!==n&&(u.RestoreCursorNote=t,u.HIGHLIGHTQUERY=t,w(e,r,s))}}function qa(){We("!","**blank")}function Ha(){We("*","**blank")}function Ba(){We(".","**dynam")}function Pa(){We("=","**blank")}function Mt(t,e){var r="";e[0]=="	"?r+="	":r+=t;var o;for(o=1;o<e.length;o++)e[o]=="	"?r+="	":e[o]!="	"&&e[o-1]=="	"&&(r+=t);return r+=`
`,r}function We(t,e,r){if(t||(t="."),e||(e="**blank"),!r){var o=S.getCursorPosition();r=o.row}var n=S.session.getLine(r);if(!n.match(/^!!/)&&!n.match(/^$/)){if(n.match(/^\*\*/)){$a(e,n,o);return}var a=Mt(t,n);S.session.insert({row:r,column:0},a)}}function $a(t,e,r){console.log("EXINTERP",t,"CURRENTLINE",e,"LOCATION",r),r.column;var o=0,n,a=0;for(n=0;n<r.column+1;n++)e[n]=="	"?a==1&&(a=0):a==0&&(a=1,o++);var i=0;for(a=0,n=0;n<e.length;n++)e[n]=="	"?a==1&&(a=0):a==0&&(a=1,i++);console.log("   SPINE NUMBER IS ",o,"TOTAL",i);var s="extract -s ";o==1?i==1?s+="1,0":i==2?s+="1,0,2":s+="1,0,2-$":(s+="1-"+o+",0",o==i||(o+1==i?s+=","+i:s+=","+(o+1)+"-$")),t!=="**blank"&&(s+=" -n "+t),Te().applyFilter(s)}function Tr(t){for(var e=t.parentNode;e;){if(e.id.match(/^beam-/))return e;e=e.parentNode}}function Cr(t){for(var e=t;e;){if(e.parentNode&&e.parentNode.id.match(/^beam-/))return e;e=e.parentNode}}function Fr(t,e,r){var o=Tr(t),n=Cr(t);if(!!o){var a=o.id;if(!!a.match(/^beam/)){var i="#"+a+" > g[id^='note']";i+=", #"+a+" > g[id^='rest']",i+=", #"+a+" > g[id^='chord']";for(var s=o.querySelectorAll(i),l=-1,c=0;c<s.length;c++)if(s[c]===n){l=c;break}if(!(l<=0)){var d=g.FreezeRendering;g.FreezeRendering==!1&&(g.FreezeRendering=!0),l==1?(Ge(s[0]),s.length==2?Ge(s[1]):Ye(s[l])):l<s.length-1?(Ye(s[l]),je(s[l-1])):(je(s[l-1]),Ge(s[l])),M.EDITINGID=t.id,u.RestoreCursorNote=t.id,g.FreezeRendering=d,g.FreezeRendering||T(),Yr(),Z(M.EDITINGID)}}}}function Rr(t,e,r){var o=Tr(t),n=Cr(t);if(!!o){var a=o.id;if(!!a.match(/^beam/)){var i="#"+a+" > g[id^='note']";i+=", #"+a+" > g[id^='rest']",i+=", #"+a+" > g[id^='chord']";for(var s=o.querySelectorAll(i),l=-1,c=0;c<s.length;c++)if(s[c]===n){l=c;break}if(!(l<0)&&s.length!=1&&l!=s.length-1){var d=g.FreezeRendering;g.FreezeRendering==!1&&(g.FreezeRendering=!0),l==0?(Ge(s[0]),Ye(s[l+1])):l==s.length-2?(Ge(s[l+1]),je(s[l])):(je(s[l]),Ye(s[l+1])),M.EDITINGID=t.id,u.RestoreCursorNote=t.id,g.FreezeRendering=d,g.FreezeRendering||T(),Yr(),Z(M.EDITINGID)}}}}function Ge(t){if(!!t){var e=t.id,r=e.match(/[^-]+-.*L(\d+).*F(\d+)/);if(!!r){var o=parseInt(r[1]),n=parseInt(r[2]),a=A(o,n).replace(/[LJKk]+[<>]?/g,"");w(o,n,a,e,!0)}}}function Ye(t){if(!!t){var e=t.id,r=e.match(/[^-]+-.*L(\d+).*F(\d+)/);if(!!r){var o=parseInt(r[1]),n=parseInt(r[2]),a=A(o,n).replace(/[LJKk]+[<>]?/g,"");a+="L",w(o,n,a,e,!0)}}}function je(t){if(!!t){var e=t.id,r=e.match(/[^-]+-.*L(\d+).*F(\d+)/);if(!!r){var o=parseInt(r[1]),n=parseInt(r[2]),a=A(o,n).replace(/[LJKk]+[<>]?/g,"");a+="J",w(o,n,a,e,!0)}}}function Tt(t){if(t||(t=Q()),!t)return"";var e=t.match(/^!!!!SEGMENT:\s*([^\s'"!*]+)/),r;return e&&(r=e[1],r=r.replace(/.*\//,"").replace(/\..*?$/,""),r.length>0)||F&&F.file&&(r=F.file,r=r.replace(/.*\//,"").replace(/\..*?$/,""),r.length>0)?r:"data"}function Xa(t){if(t||(t=Re()),!t)return"txt";var e=t.substring(0,1e3).replace(/^\s+/,"");if(e.match(/<meiHead/))return"mei";if(e.match(/<score-(part|time)wise/)||e.match(/<opus/))return"musicxml";if(e.match(/^[A-Za-z0-9+\/\s]+$/))return"mime";var r,o,n;return e.match(/^[!*]/)?(r=e.match(/^!!!!SEGMENT:\s*([^\s'"!*]+)/),r&&(n=r[1],n.match(/\./)&&(o=n.replace(/.*\./,""),o&&o.length>0))||F&&F.file&&(n=F.file.replace(/.*\//,""),o=n.replace(/.*\./,""),o&&o.length>0)?o:"krn"):e.match(/group memberships:/i)?".msd":"txt"}function Ua(t){return t||(t=Q()),!!t.match(/^\s*[!*]/)}function za(t){for(var e=t.split(/\r?\n/),r="",o=0;o<e.length;o++){let n=e[o].replace(/\t+$/,"");n.match(/^\s*$/)||(n.match(/^!!![^\s]+:\t/)&&(n=n.replace(/\t/," ")),r+=n+`
`)}return r}function Va(t){if(t||(t=Q()),!t){console.log("No content to convert to Humdrum");return}var e=za(t);ge(e)}const Ct={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(t){var e="",r,o,n,a,i,s,l,c=0;for(t=Ct._utf8_encode(t);c<t.length;)r=t.charCodeAt(c++),o=t.charCodeAt(c++),n=t.charCodeAt(c++),a=r>>2,i=(r&3)<<4|o>>4,s=(o&15)<<2|n>>6,l=n&63,isNaN(o)?s=l=64:isNaN(n)&&(l=64),e=e+this._keyStr.charAt(a)+this._keyStr.charAt(i)+this._keyStr.charAt(s)+this._keyStr.charAt(l);return e},decode:function(t){var e="",r,o,n,a,i,s,l,c=0;for(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");c<t.length;)a=this._keyStr.indexOf(t.charAt(c++)),i=this._keyStr.indexOf(t.charAt(c++)),s=this._keyStr.indexOf(t.charAt(c++)),l=this._keyStr.indexOf(t.charAt(c++)),r=a<<2|i>>4,o=(i&15)<<4|s>>2,n=(s&3)<<6|l,e=e+String.fromCharCode(r),s!=64&&(e=e+String.fromCharCode(o)),l!=64&&(e=e+String.fromCharCode(n));return e=Ct._utf8_decode(e),e},_utf8_encode:function(t){t=t.replace(/\r\n/g,`
`);for(var e="",r=0;r<t.length;r++){var o=t.charCodeAt(r);o<128?e+=String.fromCharCode(o):o>127&&o<2048?(e+=String.fromCharCode(o>>6|192),e+=String.fromCharCode(o&63|128)):(e+=String.fromCharCode(o>>12|224),e+=String.fromCharCode(o>>6&63|128),e+=String.fromCharCode(o&63|128))}return e},_utf8_decode:function(t){for(var e="",r=0,o=0,n=0;r<t.length;)if(o=t.charCodeAt(r),o<128)e+=String.fromCharCode(o),r++;else if(o>191&&o<224)n=t.charCodeAt(r+1),e+=String.fromCharCode((o&31)<<6|n&63),r+=2;else{n=t.charCodeAt(r+1);var a=t.charCodeAt(r+2);e+=String.fromCharCode((o&15)<<12|(n&63)<<6|a&63),r+=3}return e}};function _r(t){for(var e="",r=0;r<t.length;r++)e+=Ya(t[r])+`
`;return e}function Wa(t){for(var e="",r=0;r<t.length;r++)e+=ja(t[r])+`
`;return e}function Ya(t){var e=t.split(""),r="";if(e.length<1)return r;var o=0;if(e.length>=2&&e[0]=="!"&&e[1]=="!")return t;for(var n=",",a=0;a<e.length;a++){if(e[a]=='"'&&!o){o=1;continue}if(o&&e[a]=='"'&&e[a+1]=='"'&&a<e.length-1){r+='"',a++;continue}if(e[a]=='"'){o=0;continue}if(!o&&t.substr(a,n.length)==n){r+="	",a+=n.length-1;continue}r+=e[a]}return r}function ja(t){if(t.match(/^!!/))return t;for(var e=t.split(/\t/),r="",o=0;o<e.length;o++)r+=Za(e[o]),o<e.length-1&&(r+=",");return r}function Za(t){var e="";return t.match(/,/)||t.match(/"/)?(e+='"',e+=t.replace(/"/g,'""'),e+='"',e):t}function Qa(){var t=encodeURIComponent(Re());localStorage.setItem("SAVE0",t);var e=N;e||(e=1);var r="SAVE"+e,o=localStorage.getItem(r);if(!!o){var n=decodeURIComponent(localStorage.getItem(r));ge(n),ee(0)}}function Ja(){var t=N;t||(t=1);var e="SAVE"+t,r=Re(),o=!1,n="";r.match(/^\s*$/)?(n="",o=!1):(n=encodeURIComponent(r),o=!0),localStorage.setItem(e,n);var a=document.querySelector("#title-info"),i="";a&&(i=a.textContent.replace(/^\s+/,"").replace(/\s+$/,"")),localStorage.setItem(e+"-TITLE",i);var s=document.querySelector("#save-"+t);s&&(s.title=i,o?s.classList.add("filled"):s.classList.remove("filled"));var l=document.querySelector("#load-"+t);l&&(l.title=i,o?l.classList.add("filled"):l.classList.remove("filled")),ee(0)}let Ze=ve();if(!Ze)throw new Error("Verovio worker is undefined");let Ft=P();if(!Ft)throw new Error("Ace Editor is undefined");function ei(){if(!g.ShowingIndex){var t=JSON.parse(JSON.stringify(Qt));console.log("SVG PRINTING OPTIONS",t);var e=Q();if(!e.match(/^\s*$/)){Ua(e);var r=Ze.page,o=!0;Ze.renderData(t,e,r,o).then(function(n){console.log("buffer vrvWorker.renderData",n);for(var a=M.SAVEFILENAME,i=Ft.session.getLength(),s,l,c=0;c<i;c++)l=Ft.session.getLine(c),(s=l.match(/^!!!!SEGMENT:\s*([^\s].*)\s*$/))&&(a=s[1]);a=a.replace(/\.[^.]+/,".svg"),a.match(/svg$/)||(a+=".svg");var d=new Blob([n],{type:"text/plain"});saveAs(d,a),t.adjustPageWidth=0,Ze.renderData(t,n,r,o)})}}}function ti(){var t=Tt();t||(t="data");var e=t,r=Xa();r&&(e+="."+r);var o=Q(),n=new Blob([o],{type:"text/plain"});saveAs(n,e)}let Me=ve();if(!Me)throw new Error("Verovio worker is undefined");function Or(t){return RSVP.all([xe(t,"Times","/scripts/pdfkit/EBGaramond-Regular.ttf"),xe(t,"TimesItalic","/scripts/pdfkit/EBGaramond-Italic.ttf"),xe(t,"TimesBold","/scripts/pdfkit/EBGaramond-Bold.ttf"),xe(t,"TimesBoldItalic","/scripts/pdfkit/EBGaramond-BoldItalic.ttf"),xe(t,"VerovioText","/scripts/pdfkit/VerovioText-1.0.ttf")])}function xe(t,e,r){var o=new RSVP.Promise(function(n,a){var i=new XMLHttpRequest;i.open("GET",r),i.responseType="arraybuffer",i.onreadystatechange=function(){this.readyState===this.DONE&&(this.status===200?n(this.response):a(this))},i.send(null)});return o.then(function(n){return t.registerFont(e,n),!0})}function Kr(t,e,r,o){return t=="VerovioText"?t:(t.match(/(?:^|,)\s*sans-serif\s*$/),e?r?"TimesBoldItalic":"TimesBold":r?"TimesItalic":"Times")}function Dr(t,e){$("html").css("cursor","wait");var r=document.querySelector("#output svg"),o=r.getAttribute("width"),n=r.getAttribute("height");o=parseInt(o),n=parseInt(n);var a=n/o,t=t||"letter",i=2159,s=2794;t==="A4"?(i=2100,s=2970):t==="B3"&&(i=2500,s=3530),e||o>n&&(e="landscape");var e=e||"portrait";e==="landscape"&&(i=[s,s=i][0]);var l=s/i,c=.99,d,m;a<l?(d=i/10*c,m=i/10*a*c):(m=s/10*c,d=s/10/a*c);var p=i/10,v=0,b=0;d<p&&(v=p-d),v+=1;var y=document.createElement("span");y.innerHTML=r.outerHTML;var E=y.querySelector("svg");E.setAttribute("width",d+"mm"),E.setAttribute("height",m+"mm");var k={};k.fontCallback=Kr;var O=new PDFDocument({useCSS:!0,compress:!0,autoFirstPage:!1,layout:e}),U=O.pipe(blobStream());U.on("finish",function(){var te=U.toBlob("application/pdf"),re=Tt(),ye=re;ye?ye+="-snapshot.pdf":ye="snapshot.pdf",saveAs(te,ye),$("html").css("cursor","auto")}),Or(O).then(function(){O.addPage({size:t,layout:e}),SVGtoPDF(O,E,v,b,k),O.end()})}function Gr(t,e){var r=Me.options;r.mmOutput=0,$("html").css("cursor","wait");var t=t||"letter",e=e||"portrait",o=2159,n=2920;t==="A4"?(o=2100,n=2970):t==="B3"&&(o=2500,n=3530),e==="landscape"&&(o=[n,n=o][0]);var a={};a.fontCallback=Kr;var i=new PDFDocument({useCSS:!0,compress:!0,autoFirstPage:!1,layout:e}),s=i.pipe(blobStream());s.on("finish",function(){var k=s.toBlob("application/pdf"),O=Tt(),U=O;U?U+=".pdf":U="data.pdf",saveAs(k,U),$("html").css("cursor","auto")});var l=95;n/=l/100,o/=l/100;var c=10,d=14,m=100,p=100,v=50,b=50,y={pageHeight:n-m,pageWidth:o,pageMarginLeft:v,pageMarginRight:b,pageMarginTop:m,pageMarginBottom:p,spacingSystem:d,spacingStaff:c,scale:l,adjustPageHeight:0,justifyVertically:1,breaks:I.BREAKS?"encoded":"auto",mmOutput:1,header:"auto",footer:"encoded",usePgFooterForAll:1,barLineWidth:.12,staffLineWidth:.12,font:I.FONT},E=P().getValue().replace(/^\s+/,"");Ro(E),y=xr(E,y),console.log("PRINTING OPTIONS",y),RSVP.hash({fonts:Or(i),svglist:Me.renderAllPages(E,y)}).then(function(k){for(var O=0;O<k.svglist.length;O++){i.addPage({size:t,layout:e});var U=0,te=0;SVGtoPDF(i,k.svglist[O],U,te,a)}return i.end(),!0}).finally(function(){Me.page,xr(E,r),Me.redoLayout(r,!0),Me.options=r})}function xr(t,e){var r=t.match(/[^\r\n]+/g),o=e,n=[""],a={};a[""]={};var i;for(i=0;i<r.length;i++){var s=r[i].match(/^!!!verovio([^\s]*):\s*(.*)\s*$/);if(!!s){if(s[1]=="-parameter-group"){n.push(s[2]);continue}var l=s[2].match(/^\s*([^\s]+)\s+(.*)\s*$/);if(!!l){var c=s[1].match(/^-([^\s]+)\s*$/),d="";c&&(d=c[1]),typeof a[d]=="undefined"&&(a[d]={}),a[d][l[1]]=l[2]}}}for(i=0;i<n.length;i++)if(!!a[n[i]]){var m=Object.keys(a[n[i]]),p;for(p=0;p<m.length;p++)typeof o[m[p]]!="undefined"&&delete o[m[p]]}return o}let qr={OPTION:[{NAME:"help",ABBR:"?",INFO:"Display help message.",ARG:"boolean",CLI_ONLY:"true"},{NAME:"allPages",ABBR:"a",INFO:"Output all pages.",ARG:"boolean",CLI_ONLY:"true?"},{NAME:"inputFrom",ABBR:"f",INFO:"Select input data type.",ARG:"string",DEF:"mei",ALT:["auto","darms","pae","xml","humdrum","humdrum-xml"],CLI_ONLY:"true?"},{NAME:"outfile",ABBR:"o",INFO:'Output file name (use "-" for standard output).',ARG:"string",CLI_ONLY:"true"},{NAME:"page",ABBR:"p",INFO:"Select the page to engrave.",ARG:"integer",DEF:"1",MIN:"1",CLI_ONLY:"true"},{NAME:"resources",ABBR:"r",INFO:"Path to SVG resources.",ARG:"string",DEF:"/usr/local/share/verovio",CLI_ONLY:"true"},{NAME:"scale",ABBR:"s",INFO:"Scale percentage",ARG:"integer",DEF:"100",MIN:"1"},{NAME:"minLastJustification",INFO:"Minimum length of last system which can be stretched to 100% width of page.",ARG:"float",DEF:"0.8",MIN:"0.0",MAX:"1.0"},{NAME:"outputTo",ABBR:"t",INFO:"Select output data format",ARG:"string",DEF:"svg",ALT:["mei","midi"]},{NAME:"version",ABBR:"v",INFO:"Display verovio version number.",ARG:"boolean",CLI_ONLY:"true"},{NAME:"xmlIdSeed",ABBR:"x",INFO:"Seed the random number generator for XML IDs.",ARG:"integer"},{NAME:"adjustPageHeight",CAT:"Input and page layout options",INFO:"Crop the page height to the actual height of the content.",ARG:"boolean"},{NAME:"adjustPageWidth",CAT:"Input and page layout options.",INFO:"Crop the page width to the actual width of the content.",ARG:"boolean"},{NAME:"breaks",CAT:"Input and page layout options",INFO:"Define page and system breaks layout.",ARG:"string",DEF:"auto",ALT:["none","line","smart","encoded"]},{NAME:"breaksSmartSb",CAT:"Input and page layout options",INFO:`In smart breaks mode, the portion of the system width usage
	at which an encoded system break will be used.`,ARG:"float",DEF:"0.66",MIN:"0.00",MAX:"1.00"},{NAME:"condense",CAT:"Input and page layout options",INFO:"Control condensed score layout.",ARG:"string",DEF:"auto",ALT:["none","encoded"]},{NAME:"condenseFirstPage",CAT:"Input and page layout options",INFO:"When condensing a score, also condense the first page.",ARG:"boolean"},{NAME:"condenseTempoPages",CAT:"Input and page layout options",INFO:"When condensing a score, also condense pages with a tempo.",ARG:"boolean"},{NAME:"evenNoteSpacing",CAT:"Input and page layout options",INFO:"Specify the linear spacing factor.  This is useful for mensural notation display.",ARG:"boolean"},{NAME:"expand",CAT:"Input and page layout options",INFO:"Expand all referenced elements in the expanion.  Input is an xml:id of the expansion list.",ARG:"string"},{NAME:"humType",CAT:"Input and page layout options",INFO:"Include type attributes when importing rom Humdrum",ARG:"boolean"},{NAME:"justifyVertically",CAT:"Input and page layout options",INFO:"Justify spacing veritcally to fill a page.",ARG:"boolean"},{NAME:"landscape",CAT:"Input and page layout options",INFO:"The landscape paper orientation flag.",ARG:"boolean"},{NAME:"mensuralToMeasure",CAT:"Input and page layout options",INFO:"Convert mensural sections to measure-based MEI.",ARG:"boolean"},{NAME:"mmOutput",CAT:"Input and page layout options",INFO:"Specify that the output in the SVG is given in mm (default is px).",ARG:"boolean"},{NAME:"footer",CAT:"Input and page layout options",INFO:"Do not add any footer, add a footer, use automatic footer.",ARG:"string",DEF:"auto",ALT:["none","encoded","always"]},{NAME:"header",CAT:"Input and page layout options",INFO:"Do not add any header, add a header, use automatic header.",ARG:"string",DEF:"auto",ALT:["none","encoded"]},{NAME:"noJustification",CAT:"Input and page layout options",INFO:"Do not justify the system.",ARG:"boolean"},{NAME:"openControlEvents",CAT:"Input and page layout options",INFO:"Render open control events.",ARG:"boolean"},{NAME:"outputIndent",CAT:"Input and page layout options",INFO:"Output indent value for MEI and SVG.",ARG:"integer",DEF:"3",MIN:"1",MAX:"10"},{NAME:"outputFormatRaw",CAT:"Input and page layout options",INFO:"Output MEI with no line indents or non-content newlines. See svgFormatRaw.",ARG:"boolean"},{NAME:"outputIndentTab",CAT:"Input and page layout options",INFO:"Use tabs rather than spaces for indenting XML output.",ARG:"boolean"},{NAME:"outputSmuflXmlEntities",CAT:"Input and page layout options",INFO:"Output SMuFL characters as XML entities instead of hex byte codes.",ARG:"boolean"},{NAME:"pageHeight",CAT:"Input and page layout options",INFO:"The page height.",ARG:"integer",DEF:"2970",MIN:"100",MAX:"60000"},{NAME:"pageMarginBottom",CAT:"Input and page layout options",INFO:"Bottom margin of pages.",ARG:"integer",DEF:"50",MIN:"0",MAX:"500"},{NAME:"pageMarginLeft",CAT:"Input and page layout options",INFO:"Left margin of pages.",ARG:"integer",DEF:"50",MIN:"0",MAX:"500"},{NAME:"pageMarginRight",CAT:"Input and page layout options",INFO:"Right margin of pages.",ARG:"integer",DEF:"50",MIN:"0",MAX:"500"},{NAME:"pageMarginTop",CAT:"Input and page layout options",INFO:"Top margin of pages.",ARG:"integer",DEF:"50",MIN:"0",MAX:"500"},{NAME:"pageWidth",CAT:"Input and page layout options",INFO:"Page width.",ARG:"integer",DEF:"2100",MIN:"100",MAX:"60000"},{NAME:"preserveAnalyticalMarkup",CAT:"Input and page layout options",INFO:"Preserves the analytical markup in MEI.",ARG:"boolean"},{NAME:"removeIDs",CAT:"Input and page layout options",INFO:"Remove XML IDs in the MEI output when not referenced.",ARG:"boolean"},{NAME:"shrinkToFit",CAT:"Input and page layout options",INFO:"Scale down page content to fit the page height if needed.",ARG:"boolean"},{NAME:"svgBoundingBoxes",CAT:"Input and page layout options",INFO:"Include bounding boxes in SVG output.",ARG:"boolean"},{NAME:"svgViewBox",CAT:"Input and page layout options",INFO:"Use viewbox on SVG root element for easy scaling of document.",ARG:"boolean"},{NAME:"svgHtml5",CAT:"Input and page layout options",INFO:"Write data-id and data-class attributes for JS usage and ID clash avoidance.",ARG:"boolean"},{NAME:"svgFormatRaw",CAT:"Input and page layout options",INFO:"Writes SVG with no line indenting or non-content newlines. See outputFormatRaw.",ARG:"boolean"},{NAME:"svgRemoveXlink",CAT:"Input and page layout options",INFO:'Removes the "xlink:" prefix from href attributes for compatibility with some newer browsers.',ARG:"boolean"},{NAME:"unit",CAT:"Input and page layout options",INFO:"The MEI unit (1/2 of the distance between the staff lines).",ARG:"integer",DEF:"9",MIN:"6",MAX:"20"},{NAME:"useBraceGlyph",CAT:"Input and page layout options",INFO:"Use brace glyph from current font.",ARG:"boolean"},{NAME:"useFacsimile",CAT:"Input and page layout options",INFO:"Use information in the facsimile element to control the layout.",ARG:"boolean"},{NAME:"usePgFooterForAll",CAT:"Input and page layout options",INFO:"Use the pgFooter element for all pages.",ARG:"boolean"},{NAME:"usePgHeaderForAll",CAT:"Input and page layout options",INFO:"Use the pgHeader element for all pages.",ARG:"boolean"},{NAME:"clefChangeFactor",CAT:"Input and page layout options",INFO:"Set the size ratio of normal clefs to changing clefs.",ARG:"float",DEF:"0.66",MIN:"0.25;",MAX:"1.00;"},{NAME:"midiTempoAdjustment",CAT:"General layout",INFO:"MIDI tempo adjustment factor.",ARG:"float",DEF:"1.00",MIN:"0.20",MAX:"4.00"},{NAME:"barLineSeparation",CAT:"General layout",INFO:"Default distance between multiple barlines when locked together.",ARG:"float",DEF:"0.80",MIN:"0.50",MAX:"2.00"},{NAME:"barLineWidth",CAT:"General layout",ARG:"float",INFO:"The width of a barline.",DEF:"0.30",MIN:"0.10",MAX:"0.80"},{NAME:"beamMaxSlope",INFO:"The maximum beam slope.",CAT:"General layout",ARG:"integer",DEF:"10",MIN:"1",MAX:"20"},{NAME:"beamMinSlope",INFO:"The minimum beam slope.",CAT:"General layout",ARG:"integer",DEF:"0",MIN:"0",MAX:"0"},{NAME:"bracketThickness",INFO:"Thickness of the system bracket.",CAT:"General layout",ARG:"float",DEF:"1.0",MIN:"0.5",MAX:"2.0"},{NAME:"dynamDist",INFO:"Default distance from staff to dynamic marks.",CAT:"General layout",ARG:"float",DEF:"1.00",MIN:"0.50",MAX:"16.00"},{NAME:"engravingDefaults",INFO:"JSON describing defaults for engraving SMuFL elements.",CAT:"General layout",ARG:"string"},{NAME:"engravingDefaultsFile",INFO:"Path to JSON file describing defaults for engraving SMuFL elements.",CAT:"General layout",ARG:"string"},{NAME:"font",INFO:"Set the music font.",CAT:"General layout",ARG:"string",DEF:"Leipzig",ALT:["Bravura","Gootville","Leland"]},{NAME:"graceFactor",INFO:"The grace size ratio numerator.",CAT:"General layout",ARG:"float",DEF:"0.75",MIN:"0.50",MAX:"1.00"},{NAME:"graceRhythmAlign",INFO:"Align grace notes rhythmically with all staves.",CAT:"General layout",ARG:"boolean"},{NAME:"graceRightAlign",INFO:"Align the right position of a grace group with all staves.",CAT:"General layout",ARG:"boolean"},{NAME:"hairpinSize",CAT:"General layout",ARG:"float",INFO:"Size of hairpins (crescendo lines).",DEF:"3.00",MIN:"1.00",MAX:"8.00"},{NAME:"hairpinThickness",CAT:"General layout",INFO:"Hairpin thickness (crescendo lines).",ARG:"float",DEF:"0.20",MIN:"0.10",MAX:"0.80"},{NAME:"harmDist",CAT:"General layout",INFO:"Default distance from haromonic labels to the staff.",ARG:"float",DEF:"1.00",MIN:"0.50",MAX:"16.00"},{NAME:"justificationStaff",CAT:"General layout",INFO:"Staff justification.",ARG:"float",DEF:"1.00",MIN:"0.00",MAX:"10.00"},{NAME:"justificationSystem",CAT:"General layout",INFO:"Vertical system spacing justification.",ARG:"float",DEF:"1.00",MIN:"0.00",MAX:"10.00"},{NAME:"justificationBracketGroup",CAT:"General layout",INFO:"Space between staves inside a bracket group justification.",ARG:"float",DEF:"1.00",MIN:"0.00",MAX:"10.00"},{NAME:"justificationBraceGroup",CAT:"General layout",INFO:"Space between staves inside a brace group justification.",ARG:"float",DEF:"1.00",MIN:"0.00",MAX:"10.00"},{NAME:"ledgerLineThickness",CAT:"General layout",INFO:"Thickness of ledger lines.",ARG:"float",DEF:"0.25",MIN:"0.10",MAX:"0.50"},{NAME:"ledgerLineExtension",CAT:"General layout",INFO:"Amount by which ledger lines should extend on either side of a notehead.",ARG:"float",DEF:"0.54",MIN:"0.20",MAX:"1.00"},{NAME:"lyricSize",CAT:"General layout",ARG:"float",INFO:"Size of lyric text.",DEF:"4.50",MIN:"2.00",MAX:"8.00"},{NAME:"lyricHyphenLength",CAT:"General layout",ARG:"float",INFO:"Lyric hyphen and dash lengths.",DEF:"1.20",MIN:"0.50",MAX:"3.00"},{NAME:"lyricLineThickness",CAT:"General layout",INFO:"Lyric extender line thicknesses.",ARG:"float",DEF:"0.25",MIN:"0.10",MAX:"0.50"},{NAME:"lyricNoStartHyphen",CAT:"General layout",INFO:"Do not show hyphens at system beginnings.",ARG:"boolean"},{NAME:"lyricTopMinMargin",CAT:"General layout",INFO:"The minmal margin above the lyrics",ARG:"float",DEF:"3.00",MIN:"3.00",MAX:"8.00"},{NAME:"lyricWordSpace",CAT:"General layout",INFO:"Minimum width of spaces separating lyric text.",ARG:"float",DEF:"1.20",MIN:"0.50",MAX:"3.00"},{NAME:"minMeasureWidth",INFO:"The minimal measure width.",CAT:"General layout",ARG:"integer",DEF:"15",MIN:"1",MAX:"30"},{NAME:"mnumInterval",INFO:"Repeat measure numbers at the given cycle size.",CAT:"General layout",ARG:"integer"},{NAME:"multiRestStyle",INFO:"Rendering style of multiple measure rests.",CAT:"General layout",ARG:"string",DEF:"auto",ALT:["default","block","symbols"]},{NAME:"repeatBarLineDotSeparation",INFO:"Default horizontal distance between dots and inner repeat barline.",CAT:"General layout",ARG:"float",DEF:"0.30",MIN:"0.10",MAX:"1.00"},{NAME:"repeatEndingLineThickness",INFO:"Repeat and endling line thickness.",CAT:"General layout",ARG:"float",DEF:"0.15",MIN:"0.10",MAX:"2.00"},{NAME:"slurControlPoints",INFO:"Slur control points.  Higher values mean more curvature at endpoints.",CAT:"General layout",ARG:"integer",DEF:"5",MIN:"1",MAX:"10"},{NAME:"slurHeightFactor",INFO:"Slur height factor.  Higher values mean flatter slurs.",CAT:"General layout",ARG:"integer",DEF:"5",MIN:"1",MAX:"100"},{NAME:"slurMinHeight",INFO:"Minimum slur height.",CAT:"General layout",ARG:"float",DEF:"1.20",MIN:"0.30",MAX:"2.00"},{NAME:"slurMaxHeight",INFO:"Maximum slur height.",CAT:"General layout",ARG:"float",DEF:"3.00",MIN:"2.00",MAX:"6.00"},{NAME:"slurMaxSlope",INFO:"Maximum slur slope in degrees.",CAT:"General layout",ARG:"float",DEF:"20",MIN:"0",MAX:"60"},{NAME:"slurEndpointThickness",INFO:"Slur endpoint thickness.",CAT:"General layout",ARG:"float",DEF:"0.10",MIN:"0.05",MAX:"0.25"},{NAME:"slurMidpointThickness",INFO:"Slur midpoint thickness.",CAT:"General layout",ARG:"float",DEF:"0.60",MIN:"0.20",MAX:"1.20"},{NAME:"spacingBraceGroup",INFO:"Minimum space between staves inside of a braced group.",CAT:"General layout",ARG:"float",DEF:"12",MIN:"0",MAX:"48"},{NAME:"spacingBracketGroup",INFO:"Minimum space between staves inside a bracketed group.",CAT:"General layout",ARG:"float",DEF:"12",MIN:"0",MAX:"48"},{NAME:"spacingDurDetection",INFO:"Detect long duration for adjusting spacing.",CAT:"General layout",ARG:"boolean"},{NAME:"slurCurveFactor",INFO:"Slur curve factor.  Higher values mean rounder slurs.",CAT:"General layout",ARG:"integer",DEF:"10",MIN:"1",MAX:"100"},{NAME:"octaveAlternativeSymbols",INFO:"Use alternative symbols for displaying octaves.",CAT:"General layout",ARG:"boolean"},{NAME:"octaveLineThickness",INFO:"Octave line thickness.",CAT:"General layout",ARG:"float",DEF:"0.20",MIN:"0.10",MAX:"1.00"},{NAME:"spacingLinear",CAT:"General layout",ARG:"float",INFO:"Specify the linear spacing factor",DEF:"0.25",MIN:"0.00",MAX:"1.00"},{NAME:"spacingNonLinear",CAT:"General layout",ARG:"float",INFO:"Specify the non-linear spacing factor.",DEF:"0.60",MIN:"0.00",MAX:"1.00"},{NAME:"spacingStaff",ARG:"integer",INFO:"The staff minimal spacing",CAT:"General layout",DEF:"12",MIN:"0",MAX:"48"},{NAME:"spacingSystem",ARG:"integer",INFO:"The system minimal spacing",CAT:"General layout",DEF:"12",MIN:"0",MAX:"48"},{NAME:"staffLineWidth",CAT:"General layout",ARG:"float",INFO:"The staff line width in unit",DEF:"0.15",MIN:"0.10",MAX:"0.30"},{NAME:"stemWidth",CAT:"General layout",ARG:"float",INFO:"The stem width",DEF:"0.20",MIN:"0.10",MAX:"0.50"},{NAME:"subBracketThickness",CAT:"General layout",ARG:"float",INFO:"Thickness of system sub-brackets.",DEF:"0.20",MIN:"0.10",MAX:"2.00"},{NAME:"systemDivider",CAT:"General layout",INFO:"Display style of system dividers",ARG:"string",DEF:"auto",ALT:["none","left","left-right"]},{NAME:"systemMaxPerPage",CAT:"General layout",INFO:"Maximum number of systems per page",ARG:"integer"},{NAME:"textEnclosureThickness",CAT:"General layout",INFO:"Thickness of text-enclosing boxes.",ARG:"float",DEF:"0.20",MIN:"0.10",MAX:"0.80"},{NAME:"thickBarlineThickness",CAT:"General layout",INFO:"Thickness of thick barlines.",ARG:"float",DEF:"1.00",MIN:"0.50",MAX:"2.00"},{NAME:"tieEndpointThickness",CAT:"General layout",INFO:"Endpoint tie thickenesses",ARG:"float",DEF:"0.10",MIN:"0.05",MAX:"0.25"},{NAME:"tieMidpointThickness",CAT:"General layout",INFO:"Tie midpoint thickenesses",ARG:"float",DEF:"0.50",MIN:"0.20",MAX:"1.00"},{NAME:"tupletBracketThickness",CAT:"General layout",INFO:"Tuplet bracket thicknesses.",ARG:"float",DEF:"0.20",MIN:"0.10",MAX:"0.80"},{NAME:"tupletNumHead",CAT:"General layout",INFO:"Placement of tuplet number on the notehead-side.",ARG:"boolean"},{NAME:"defaultBottomMargin",CAT:"element margins",INFO:"Default bottom margin",ARG:"float",DEF:"0.50",MIN:"0.00",MAX:"5.00"},{NAME:"defaultLeftMargin",CAT:"element margins",INFO:"Default left margin.",ARG:"float",DEF:"0.00",MIN:"0.00",MAX:"2.00"},{NAME:"defaultRightMargin",CAT:"element margins",INFO:"The default right margin",ARG:"float",DEF:"0.00",MIN:"0.00",MAX:"2.00"},{NAME:"defaultTopMargin",CAT:"element margins",INFO:"The default top margin",ARG:"float",DEF:"0.50",MIN:"0.00",MAX:"6.00"},{NAME:"leftMarginAccid",CAT:"element margins",INFO:"The margin for accid",ARG:"float",DEF:"1.00",MIN:"0.00",MAX:"2.00"},{NAME:"bottomMarginArtic",CAT:"element margins",INFO:"Bottom margin for articulations.",ARG:"float",DEF:"0.75",MIN:"0.00",MAX:"10.00"},{NAME:"bottomMarginHarm",CAT:"element margins",INFO:"Bottom margin for harmony labels.",ARG:"float",DEF:"1.00",MIN:"0.00",MAX:"10.00"},{NAME:"bottomMarginHeader",CAT:"element margins",INFO:"Bottom margin for page headers.",ARG:"float",DEF:"8.00",MIN:"0.00",MAX:"24.00"},{NAME:"leftMarginBarLine",CAT:"element margins",INFO:"Left margin for barLines.",ARG:"float",DEF:"0.00",MIN:"0.00",MAX:"2.00"},{NAME:"leftMarginBeatRpt",CAT:"element margins",INFO:"Left margin for beatRpt.",ARG:"float",DEF:"2.00",MIN:"0.00",MAX:"2.00"},{NAME:"leftMarginChord",CAT:"element margins",INFO:"Left margin for chords.",ARG:"float",DEF:"1.00",MIN:"0.00",MAX:"2.00"},{NAME:"leftMarginClef",CAT:"element margins",INFO:"Left margin for clefs.",ARG:"float",DEF:"1.00",MIN:"0.00",MAX:"2.00"},{NAME:"leftMarginKeySig",CAT:"element margins",INFO:"Left margin for key signatures.",ARG:"float",DEF:"1.00",MIN:"0.00",MAX:"2.00"},{NAME:"leftMarginLeftBarLine",CAT:"element margins",INFO:"Left margin for left barLines.",ARG:"float",DEF:"1.00",MIN:"0.00",MAX:"2.00"},{NAME:"leftMarginMensur",CAT:"element margins",INFO:"Left margin for mensur.",ARG:"float",DEF:"1.00",MIN:"0.00",MAX:"2.00"},{NAME:"leftMarginMeterSig",CAT:"element margins",INFO:"Left margin for meterSig.",ARG:"float",DEF:"1.00",MIN:"0.00",MAX:"2.00"},{NAME:"leftMarginMRest",CAT:"element margins",INFO:"Left margin for mRest.",ARG:"float",DEF:"0.00",MIN:"0.00",MAX:"2.00"},{NAME:"leftMarginMRpt2",CAT:"element margins",INFO:"Left margin for mRpt2.",ARG:"float",DEF:"0.00",MIN:"0.00",MAX:"2.00"},{NAME:"leftMarginMultiRest",CAT:"element margins",INFO:"Left margin for multiRest.",ARG:"float",DEF:"0.00",MIN:"0.00",MAX:"2.00"},{NAME:"leftMarginMultiRpt",CAT:"element margins",INFO:"Left  margin for multiRpt.",ARG:"float",DEF:"0.00",MIN:"0.00",MAX:"2.00"},{NAME:"leftMarginNote",CAT:"element margins",INFO:"Right margin for note.",ARG:"float",DEF:"1.00",MIN:"0.00",MAX:"2.00"},{NAME:"leftMarginRest",CAT:"element margins",INFO:"Left margin for rest.",ARG:"float",DEF:"1.00",MIN:"0.00",MAX:"2.00"},{NAME:"leftMarginRightBarLine",CAT:"element margins",INFO:"Margin for right barLine.",ARG:"float",DEF:"1.00",MIN:"0.00",MAX:"2.00"},{NAME:"leftMarginTabDurSym",CAT:"element margins",INFO:"Margin for tabDurSym.",ARG:"float",DEF:"1.00",MIN:"0.00",MAX:"2.00"},{NAME:"rightMarginAccid",CAT:"element margins",INFO:"Right margin for accid.",ARG:"float",DEF:"0.00",MIN:"0.00",MAX:"2.00"},{NAME:"rightMarginBarLine",CAT:"element margins",INFO:"Right margin for barLine.",ARG:"float",DEF:"0.00",MIN:"0.00",MAX:"2.00"},{NAME:"rightMarginBeatRpt",CAT:"element margins",INFO:"Right margin for beatRpt.",ARG:"float",DEF:"0.00",MIN:"0.00",MAX:"2.00"},{NAME:"rightMarginChord",CAT:"element margins",INFO:"Right margin for chord.",ARG:"float",DEF:"0.00",MIN:"0.00",MAX:"2.00"},{NAME:"rightMarginClef",CAT:"element margins",INFO:"Right margin for clef.",ARG:"float",DEF:"1.00",MIN:"0.00",MAX:"2.00"},{NAME:"rightMarginKeySig",CAT:"element margins",INFO:"Right margin for keySig.",ARG:"float",DEF:"1.00",MIN:"0.00",MAX:"2.00"},{NAME:"rightMarginLeftBarLine",CAT:"element margins",INFO:"Right margin for left barLine.",ARG:"float",DEF:"1.00",MIN:"0.00",MAX:"2.00"},{NAME:"rightMarginMensur",CAT:"element margins",INFO:"Right margin for mensur.",ARG:"float",DEF:"1.00",MIN:"0.00",MAX:"2.00"},{NAME:"rightMarginMeterSig",CAT:"element margins",INFO:"Right margin for meterSig.",ARG:"float",DEF:"1.00",MIN:"0.00",MAX:"2.00"},{NAME:"rightMarginMRest",CAT:"element margins",INFO:"Right margin for mRest.",ARG:"float",DEF:"0.00",MIN:"0.00",MAX:"2.00"},{NAME:"rightMarginMRpt2",CAT:"element margins",INFO:"Right margin for mRpt2.",ARG:"float",DEF:"0.00",MIN:"0.00",MAX:"2.00"},{NAME:"rightMarginMultiRest",CAT:"element margins",INFO:"Right margin for multiRest.",ARG:"float",DEF:"0.00",MIN:"0.00",MAX:"2.00"},{NAME:"rightMarginMultiRpt",CAT:"element margins",INFO:"Right margin for multiRpt.",ARG:"float",DEF:"0.00",MIN:"0.00",MAX:"2.00"},{NAME:"rightMarginNote",CAT:"element margins",INFO:"The right margin for note.",ARG:"float",DEF:"0.00",MIN:"0.00",MAX:"2.00"},{NAME:"rightMarginRest",CAT:"element margins",INFO:"The right margin for rest.",ARG:"float",DEF:"0.00",MIN:"0.00",MAX:"2.00"},{NAME:"rightMarginRightBarLine",CAT:"element margins",ARG:"float",INFO:"The right margin for right barLine.",DEF:"0.00",MIN:"0.00",MAX:"2.00"},{NAME:"rightMarginTabDurSym",CAT:"element margins",INFO:"Right margin for tabDurSym.",ARG:"float",DEF:"0.00",MIN:"0.00",MAX:"2.00"},{NAME:"topMarginArtic",CAT:"element margins",INFO:"Top margin for articulations.",ARG:"float",DEF:"0.75",MIN:"0.00",MAX:"10.00"},{NAME:"topMarginHarm",CAT:"element margins",INFO:"Top margin for harmony labels.",ARG:"float",DEF:"1.00",MIN:"0.00",MAX:"10.00"}]};function ri(){let t={};if(!qr)return t;var e=qr.OPTION;for(let r=0;r<e.length;r++)typeof e[r].DEF!="undefined"&&(e[r].NAME,typeof e[r].CLI_ONLY!="undefined"&&e[r].CLI_ONLY!=="true"&&(t[e[r].NAME]=e[r].DEF));return t}function qe(){var t=ri();t.adjustPageHeight=1,t.barLineWidth=.12,t.breaks=I.BREAKS?"encoded":"auto",t.font=I.FONT,t.inputFrom="auto",t.humType=1,t.tupletNumHead=0,t.justifyVertically=0,t.leftMarginClef=1.5,t.lyricSize=I.LYRIC_SIZE,t.minLastJustification=.5,t.footer="none",t.header="none",t.pageHeight=6e4,t.pageMarginBottom=40,t.pageMarginLeft=30,t.pageMarginRight=20,t.pageMarginTop=100,t.pageWidth=2500,t.scale=I.SCALE,t.spacingLinear=.25,t.spacingNonLinear=.6,t.spacingStaff=I.SPACING_STAFF,t.spacingSystem=I.SPACING_SYSTEM,t.staffLineWidth=.12,t.outputIndent=1;let e=document.querySelector("#comments-section"),r=0;if(e){r=e.getBoundingClientRect().width;let a=[...e.classList].find(i=>/^col/g.test(i));(a==null?void 0:a.includes("col-0"))&&(r=0)}var o=$("#input").outerWidth();$("#input").css("display")=="none"&&(o=0),t.pageWidth=(window.innerWidth-o-r)/(I.ZOOM*I.SCALE/40)-100;var n=M.SPACINGADJUSTMENT+t.spacingLinear;return n<.05&&(n=.05),t.spacingLinear=n,t}function oi(){return{inputFrom:"musicxml-hum"}}function ni(){return{inputFrom:"musedata-hum"}}function ai(){return{inputFrom:"mei-hum",breaks:"auto"}}function ii(){return{inputFrom:"esac"}}function si(){var t=localStorage.INPUT_FONT_SIZE;t?t*=1:t=1,t<.25&&(t=.25),t>3&&(t=3),M.INPUT_FONT_SIZE=t;var e=localStorage.SCALE;e?e*=1:e=40,(e<1||e>1e3)&&(e=40),I.SCALE=e}const Qe=t=>(e,r)=>{let o=document.querySelector(`#${r.elemId}`);return o=o==null?void 0:o.closest(`.${t}`),(o==null?void 0:o.id)?o.id:""},li=jt({initial:"idle",context:{elemId:""},states:{idle:{id:"idleState",on:{SELECT:{target:"noteSelected",actions:q({elemId:Qe("note")})}}},noteSelected:{on:{SELECT:[{target:"chordSelected",actions:q({elemId:Qe("chord")}),cond:(t,e)=>{var r;return!!((r=document.querySelector(`#${e.elemId}`))==null?void 0:r.closest(".chord"))}},{target:"layerSelected",actions:q({elemId:Qe("layer")})}],RESET:{target:"idle",actions:q({elemId:(t,e)=>""})}}},chordSelected:{on:{SELECT:{target:"layerSelected",actions:q({elemId:Qe("layer")})},RESET:{target:"idle",actions:q({elemId:(t,e)=>""})}}},layerSelected:{id:"layer",on:{SELECT:{target:"idle",actions:q({elemId:(t,e)=>""})},RESET:{target:"idle",actions:q({elemId:(t,e)=>""})}}}}});let Rt=Zt(li),_t=document.getElementById("chord-editor"),Ot=document.getElementById("show-chord-editor-btn"),Kt=document.getElementById("send-chord-btn"),Y={current:null,new:{root:null,accidental:null,variation:null}},Dt={},B={root:null,accidental:null,variation:null};for(let t of document.querySelectorAll(".Chords td"))t.closest("#chord-editor")&&t.addEventListener("click",function(e){e.target.style.color="tomato";let r=document.getElementsByClassName(e.target.className);for(let o of r)o!==e.target&&(o.style.color="white");switch(e.target.className){case"root":Y.new.root=e.target.innerText,B.root=e.target,console.log({chord:Y,chordSelected:B});break;case"accidental":Y.new.accidental=e.target.innerText,B.accidental=e.target;break;case"variation":Y.new.variation=e.target.innerText,B.variation=e.target;break}Y.new.root&&Y.new.variation&&(Kt.style.display="block")});document.getElementById("close-chord-btn").addEventListener("click",function(t){B.root&&(B.root.style.color="white"),B.accidental&&(B.accidental.style.color="white"),B.variation&&(B.variation.style.color="white"),Object.keys(B).forEach(e=>B[e]=null),Object.keys(Y.new).forEach(e=>Y.new[e]=null),_t.style.display="none"});Ot.addEventListener("click",t=>{_t.style.display="block",Ot.style.visibility="hidden"});document.querySelector("#output").parentElement.addEventListener("scroll",function(){Ot.style.visibility="hidden"});Kt.addEventListener("click",function(t){_t.style.display="none",B.root.style.color="white",B.accidental&&(B.accidental.style.color="white"),B.variation.style.color="white",Object.keys(B).forEach(a=>B[a]=null);let e=P();if(!e)throw new Error("Ace Editor is undefined");let o={kernfile:e.session.getValue(),chordLocation:Dt,chord:Y};console.log(o);let n=new XMLHttpRequest;n.onload=function(){let i=JSON.parse(n.response)[0];e.setValue(i)},Object.keys(Y.new).forEach(a=>Y.new[a]=null),Kt.style.display="none"});var mo;(mo=document.getElementById("play-button"))==null||mo.addEventListener("click",()=>so());localStorage.FONT&&(I.FONT=ss(localStorage.FONT));const ci=new fe;document.addEventListener("DOMContentLoaded",function(){si();var t=document.querySelector("#input");t&&(t.style.fontSize=M.INPUT_FONT_SIZE+"rem"),be("humdrum");var e=new Date().getTime(),r=localStorage.getItem("AUTOSAVE_DATE"),o=e-r,n=localStorage.getItem("AUTOSAVE"),a=decodeURIComponent(n);a||(a=""),!a.match(/^\s*$/)&&o<6e4&&document.querySelector("#input"),P()._dispatchEvent("ready"),ls(),T(),Co(),ue.start(),window.layoutService=ue;var i=document.querySelector("body");Rt.onTransition(s=>{var l;if(!!C){if(((l=s.context)==null?void 0:l.elemId.length)>0){let c=document.getElementById(s.context.elemId);C.awareness.setLocalStateField("singleSelect",{elemId:c.id});return}C.awareness.setLocalStateField("singleSelect",{elemId:null})}}),i.addEventListener("click",function(s){var l,c;if(s.target.closest(".comment-with-replies")||sr(),Ei(s.target)){let d=(l=s.target)==null?void 0:l.closest("[id]"),m=s.target.closest(".harm");if(m){Dt.line=m.id.split("L")[1].split("F")[0],Dt.column=m.id.split("L")[1].split("F")[1];let p=document.getElementById("show-chord-editor-btn");p.style.visibility="visible";let v=m.getBoundingClientRect(),b=v.x+25,y=v.y+25,E=document.getElementById("jitsi-meeting-container");E&&(p.style.transform=`translateY(-${E.getBoundingClientRect().height}px)`),p.style.top=`${y}px`,p.style.left=`${b}px`}$('[data-toggle="popover"]').popover("dispose"),(d==null?void 0:d.id)&&d.id.match(/^(note|chord|layer)-L{1}(\d+)F{1}(\d+)/g)?Rt.send({type:"SELECT",elemId:d.id}):(Rt.send({type:"RESET"}),(c=C==null?void 0:C.awareness)==null||c.setLocalStateField("singleSelect",{elemId:null}),en()),es(s)}}),window.addEventListener("keydown",di,!0),window.addEventListener("keydown",L),Si()});function ui(t){var e=t.id,r;if(r=e.match(/L(\d+)/))var o=parseInt(r[1]);else return;if(r=e.match(/F(\d+)/))var n=parseInt(r[1]);else return;if(r=e.match(/S(\d+)/))var a=parseInt(r[1]);else a=null;if((r=e.match(/N(\d+)/))&&parseInt(r[1]),r=e.match(/^([a-z]+)-/))r[1];else return;if(!(o<1||n<1))return{id:e,line:o,field:n,subfield:a}}function Je(t,e){const r=Array.from(document.querySelectorAll(t.multiSelect.map(n=>"#"+n).join(","))).map(n=>ui(n)).filter(Boolean).map(n=>ne(oe({},n),{amount:e})),o=ha(r);return Ga(o),o}function di(t){if(t.preventDefault||(t.preventDefault=function(){}),t.altKey||t.target.nodeName=="TEXTAREA"||document.activeElement.nodeName=="INPUT")return;if(t.code===ZKey&&(t.ctrlKey||t.metaKey)){const r=P();if(!r)throw new Error("Ace Editor is undefined");r.undo();return}const e=C==null?void 0:C.awareness.getLocalState();if(e==null?void 0:e.multiSelect){if(t.code===UpKey&&t.shiftKey){Je(e,1);return}else if(t.code===DownKey&&t.shiftKey){Je(e,-1);return}else if(t.code===UpKey&&t.ctrlKey){Je(e,7);return}else if(t.code===DownKey&&t.ctrlKey){Je(e,-7);return}}if(!!u.CursorNote&&!!u.CursorNote.id)switch(t.code){case AKey:h("a",u.CursorNote);break;case BKey:h("b",u.CursorNote);break;case CKey:h("c",u.CursorNote);break;case DKey:t.shiftKey&&h("D",u.CursorNote);break;case FKey:h("f",u.CursorNote);break;case IKey:h("i",u.CursorNote);break;case JKey:t.shiftKey&&h("J",u.CursorNote);break;case LKey:t.shiftKey&&h("L",u.CursorNote);break;case MKey:t.shiftKey?h("M",u.CursorNote):h("m",u.CursorNote);break;case NKey:h("n",u.CursorNote);break;case PKey:t.shiftKey?h("P",u.CursorNote):h("p",u.CursorNote);break;case QKey:h("q",u.CursorNote);break;case SKey:h("s",u.CursorNote);break;case TKey:t.shiftKey?h("T",u.CursorNote):h("t",u.CursorNote);break;case VKey:u.CursorNote.id.match("note-")&&h("^",u.CursorNote);break;case WKey:t.shiftKey?h("W",u.CursorNote):h("w",u.CursorNote);break;case XKey:h("X",u.CursorNote);break;case YKey:h("y",u.CursorNote);break;case OneKey:h("1",u.CursorNote);break;case TwoKey:t.shiftKey?h("@",u.CursorNote):h("2",u.CursorNote);break;case ThreeKey:t.shiftKey?h("#",u.CursorNote):h("3",u.CursorNote);break;case FourKey:h("4",u.CursorNote);break;case FiveKey:h("5",u.CursorNote);break;case SixKey:u.CursorNote.id.match("note-")&&t.shiftKey?h("^^",u.CursorNote):h("6",u.CursorNote);break;case SevenKey:h("7",u.CursorNote);break;case EightKey:h("8",u.CursorNote);break;case NineKey:h("9",u.CursorNote);break;case MinusKey:h("-",u.CursorNote);break;case SingleQuoteKey:h("'",u.CursorNote);break;case SemiColonKey:t.shiftKey?h(":",u.CursorNote):h(";",u.CursorNote);break;case BackQuoteKey:t.shiftKey?h("~",u.CursorNote):h("`",u.CursorNote);break;case UpKey:t.shiftKey?(t.preventDefault(),t.stopPropagation(),u.CursorNote.id.match("note-")&&(console.log("Shift + Up, Current note: ",u.CursorNote),h("transpose-up-step",u.CursorNote))):t.ctrlKey?(t.preventDefault(),t.stopPropagation(),u.CursorNote.id.match("note-")&&h("transpose-up-octave",u.CursorNote)):(t.preventDefault(),t.stopPropagation(),Vr(u.CursorNote));break;case DownKey:t.shiftKey?(t.preventDefault(),t.stopPropagation(),u.CursorNote.id.match("note-")&&h("transpose-down-step",u.CursorNote)):t.ctrlKey?(t.preventDefault(),t.stopPropagation(),u.CursorNote.id.match("note-")&&h("transpose-down-octave",u.CursorNote)):(t.preventDefault(),t.stopPropagation(),zr(u.CursorNote));break;case DeleteKey:case BackKey:h("delete",u.CursorNote),t.stopPropagation();break;case LeftKey:u.CursorNote.id.match("slur-")?(t.preventDefault(),t.stopPropagation(),t.shiftKey?h("rightEndMoveBack",u.CursorNote):h("leftEndMoveBack",u.CursorNote)):(t.preventDefault(),t.stopPropagation(),jr(u.CursorNote.id));break;case RightKey:u.CursorNote.id.match("slur-")?(t.preventDefault(),t.stopPropagation(),t.shiftKey?h("rightEndMoveForward",u.CursorNote):h("leftEndMoveForward",u.CursorNote)):(t.preventDefault(),t.stopPropagation(),Zr(u.CursorNote.id));break;case EscKey:t.preventDefault(),t.stopPropagation(),C.awareness.setLocalStateField("singleSelect",{elemId:null}),h("esc",u.CursorNote);break}}function L(t){if(t.preventDefault||(t.preventDefault=function(){}),!(!t.altKey&&t.target.nodeName=="TEXTAREA")&&!(!t.altKey&&document.activeElement.nodeName=="INPUT")){if(t.metaKey){t.code==ZeroKey&&(Te().resetTextFontSize(),I.SCALE=40,localStorage.SCALE=I.SCALE,T());return}switch(t.code){case AKey:break;case BKey:t.altKey&&t.shiftKey&&(Pa(),t.preventDefault());break;case CKey:t.altKey&&(t.shiftKey&&Mi(),t.preventDefault());break;case DKey:t.altKey&&(t.shiftKey&&Ba(),t.preventDefault());break;case EKey:t.altKey&&(ns(),t.preventDefault());break;case FKey:t.altKey&&(t.shiftKey?T(!1,!0):Oi(),t.preventDefault());break;case GKey:t.altKey&&(ei(),t.preventDefault());break;case HKey:t.altKey&&(g.ShowingIndex||($i(),t.preventDefault()));break;case IKey:t.altKey&&t.shiftKey&&(Ha(),t.preventDefault());break;case JKey:break;case KKey:break;case LKey:t.altKey&&(t.shiftKey?qa():Li(),t.preventDefault());break;case MKey:t.altKey&&(be("xml"),t.shiftKey?Vi():zi(),t.preventDefault());break;case NKey:break;case OKey:t.altKey&&(g.OriginalClef=!g.OriginalClef,console.log("Original clef changed to:",g.OriginalClef),g.ShowingIndex||T(),t.preventDefault());break;case PKey:t.altKey&&(Wi(),t.preventDefault());break;case QKey:t.altKey&&(t.shiftKey||ki(),t.preventDefault());break;case RKey:t.altKey&&(t.shiftKey?(Qa(),t.preventDefault()):(Qi(),t.preventDefault()));break;case SKey:t.altKey&&(t.shiftKey?(Ja(),t.preventDefault()):(ti(),t.preventDefault()));break;case TKey:t.altKey&&(t.shiftKey?typeof Gr=="function"&&Dr():typeof Dr=="function"&&Gr(),t.preventDefault());break;case UKey:t.shiftKey?(io(),t.preventDefault()):(ao(),t.preventDefault());break;case WKey:t.altKey&&(t.shiftKey?M.SPACINGADJUSTMENT-=.05:M.SPACINGADJUSTMENT+=.05,M.SPACINGADJUSTMENT<=0&&(M.SPACINGADJUSTMENT=0),t.preventDefault(),T());break;case XKey:break;case YKey:t.altKey&&(g.ShowingIndex||Jr(),t.preventDefault());break;case ZeroKey:ee(0);break;case OneKey:ee(1);break;case TwoKey:ee(2);break;case ThreeKey:ee(3);break;case FourKey:ee(4);break;case FiveKey:ee(5);break;case SixKey:ee(6);break;case SevenKey:ee(7);break;case EightKey:ee(8);break;case NineKey:ee(9);break;case SpaceKey:ie.PLAY?(ie.PLAY=!1,ie.PAUSE=!0,window.pause()):ie.PAUSE?(window.play(),ie.PLAY=!0,ie.PAUSE=!1):(so(),ie.PLAY=!0,ie.PAUSE=!1),t.preventDefault();break;case CommaKey:t.shiftKey&&(io(),t.preventDefault());break;case DotKey:t.shiftKey&&(os(),t.preventDefault());break;case UpKey:break;case PgUpKey:case LeftKey:t.shiftKey?Ut(F["previous-work"]):qi(),t.preventDefault();break;case PgDnKey:case RightKey:t.shiftKey?Ut(F["next-work"]):Hi(),t.preventDefault();break;case HomeKey:Pi(),t.preventDefault();break;case EndKey:Bi(),t.preventDefault();break;case SlashKey:t.shiftKey&&t.preventDefault();break;case EscKey:is(),t.preventDefault();break}}}window.addEventListener("beforeunload",function(t){var e=encodeURIComponent(Re());localStorage.setItem("AUTOSAVE",e),localStorage.setItem("AUTOSAVE_DATE",new Date().getTime()),localStorage.setItem("FONT",I.FONT)});setInterval(function(){localStorage.setItem("SAVE0",encodeURIComponent(Re()))},6e4);setInterval(function(){lo()},1e3);function Hr(t){if(console.log("SVG updated"),I.GOTOTOPOFNOTATION){I.GOTOTOPOFNOTATION=!1;let e=document.querySelector("#output");e&&e.scrollTo(0,0)}ci.loadSvg("svg")}function V(t){return this.clear(),this.parse(t),this}V.prototype.clear=function(){this.parameters={},this.items=[],this.groupedItems={},this.sortIndex={}};V.prototype.setParameter=function(t,e){this.parameters[t]=e};V.prototype.getParameter=function(t){return this.parameters[t]};V.prototype.parse=function(t){this.clear();var e=0,r={},o=t.match(/[^\r\n]+/g);if(o.length==1&&o[0].match(/^https?:\/\//))return this.parseURL(o[0]);for(var n=0;n<o.length;n++){var a=o[n];if(!a.match(/^\s*$/)){var i=a.match(/^!!!([^!:\s]+)\s*:\s*(.*)\s*$/);if(i){this.setParameter(i[1],i[2]);continue}if(!a.match(/^!/)){if(a.match(/^\*\*/)){e=1;for(var s=a.split(/\t+/),l=0;l<s.length;l++){var c=s[l].match(/^\*\*(.*)/);c&&(r[c[1]]=l)}}if(!!e&&!a.match(/^\*/)){var d=a.split(/\t+/);if(!(d.length<1)){var m="",p="",v="",b="",y="";d[r.file]&&(m=d[r.file]),d[r.sort]&&(p=d[r.sort]),d[r.available]&&(v=d[r.available]),d[r.pdf]&&(b=d[r.pdf]),d[r.description]&&(y=cleanTitle(d[r.description])),this.addEntry({filename:m,sortkey:p,available:v,pdfname:b,description:y})}}}}}return this.sortEntries(),this};V.prototype.sortEntries=function(){this.items.sort(function(t,e){return t.sortkey<e.sortkey?-1:t.sortkey>e.sortkey?1:0})};V.prototype.parseURL=function(t){var e=this,r=new XMLHttpRequest;r.open("GET",t),r.onload=function(){r.status==200?e.parse(r.responseText):reject("ERROR:",r.status)},r.send()};V.prototype.addEntry=function(t){var e=t.filename,r=t.sortkey,o=t.available,n=t.pdfname,a=cleanTitle(t.description),i;if(!(!e||e===".")){(!o||o===".")&&(o="Y"),o!=="Y"&&o!=="N"&&(o.match(/y/i)?o="Y":o="N"),o||(o="Y"),(!r||r===".")&&(r=e),(!n||n===".")&&(n=""),(!a||a===".")&&(a=e);var s="",l="",c="",d={sortkey:r,description:a,pdfname:n};if(e.match(/^@/)){d.group=e.replace(/^@/,"").split(":");for(var m=0;m<d.group.length;m++)this.groupedItems[d.group[m]]=!0}else i=e.match(/(.*)\//),i&&(s=i[1]),i=e.match(/([^\/]+?)(\.[^\/.]*)?$/),i?(c=i[2],l=i[1]):(i=e.match(/([^\/]+)$/),i&&(l=i[1])),d.available=o,d.file={fullname:e,extension:c,directory:s,basename:l};this.items.push(d),this.sortIndex[r]=d}};V.prototype.generatHtml=V.prototype.generateHTML;V.prototype.generateHTML=function(){console.log("OBJECT HMD",this),this.parameters&&this.parameters.github;var t="";t+=`<table class='index-list'>
`;for(var e=0;e<this.items.length;e++){var r=this.items[e].sortkey;this.groupedItems[r]!==!0&&(this.items[e].file?t+=this.generateFileHTML(this.items[e]):this.items[e].group&&(t+=this.generateGroupHTML(this.items[e])))}return t+=`</table>
`,t};V.prototype.cleanTitle=function(t){return cleanRepertoryEntryText(t)};V.prototype.generateFileHTML=function(t,e){var r="";r+="<tr>",r+="<td>";var o=cleanTitle(t.description),n=o.match(/(.*)<link>(.*?)<\/link>(.*)/),a="",i="";return n&&(a=n[1],i=n[3],o=n[2]),o.match(/^\s*$/)&&(o=t.file.basename),e&&(r+="<span class='indenter'></span>"),r+=a,r+="<span class='ilink'",r+=` onclick='displayWork("`,r+=this.parameters.githubbase,r+="/",r+=t.file.fullname,r+='");',r+="'>",r+=o,r+="</span>",r+=i,r+="</td>",r+=`</tr>
`,r};V.prototype.generateGroupHTML=function(t){var e="";e+=`<tr><td class='igroup'>
`,e+=cleanTitle(t.description),e+=`</td></tr>
`;for(var r=1,o=0;o<t.group.length;o++){var n=this.sortIndex[t.group[o]];e+=this.generateFileHTML(n,r)}return e};let me=ve();if(!me)throw new Error("Verovio worker is undefined");let Br=0,He;function et(t,e){var r=t.file,o=t.measures;t.page;var n=t.next;if(t.previous,r=vi(r),o)var n=!1;if(Br++,Br>1e4){console.log("RECURSION TOO LARGE",r);return}var a="",i="",s;r?r.match(/^https?:/)?(a=r,i=r):r.match(/^bb:/)||r.match(/^bitbucket:/)?(s=tt(r),s&&(a=s.url,i=s.key)):r.match(/^github:/)?(s=Pr(r),s&&(a=s.url,i=s.key)):(s=mi(r,o),s&&(a=s.url,i=s.url)):t.tasso?(s=fi(t.tasso,o),s&&(a=s.url,i=s.key)):t.bb?(s=tt(t.bb),s&&(a=s.url,i=s.key)):t.github?(s=Pr(t.bb),s&&(a=s.url,i=s.key)):t.bitbucket&&(s=tt(t.bitbucket),s&&(a=s.url,i=s.key)),i||(i="DATA");var l=yi(a,i),c=rt(i);if(e)for(var d=0;d<c.length;d++)basketSession.remove(i[d]),console.log("removed ",i[d]);it();var m=142,p,v=basketSession.get(c[0]);if(t&&t.file&&t.file.match(/musedata/))basketSession.require(...l).then(function(){for(var b=[],y=0;y<c.length;y++)b[y]=basketSession.get(c[y]);var E="";for(rt(i),y=0;y<b.length;y++){E+=`&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
`;var k=b[y].url;E+="@filename=="+k+`
`,E+=`&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
`;var O=b[y];E+=O.data,E+=`/eof
`}if(E+=`//
`,le(E,me.page),!(b.length>1)){if(b.length==1){if(v=basketSession.get(i),console.log("INFO = ",v),v)try{if(p=JSON.parse(v.data),e){try{var U=atob(p.content)}catch{}U.match(/^\s*$/)&&(U=`!!!ONB: No data content
`);try{le(atob(p.content),me.page)}catch{le(p.content,me.page)}}n&&Gt(p,t,!1,!1)}catch(te){console.log("Error downloading",i,"Error:",te),le(v.data,me.page)}else console.log("Error retrieving",i);it()}}},function(){console.log("Error retrieving",i)});else if(!v)console.log("Going to download",i),basketSession.require({url:a,key:i,expire:m,execute:!1}).then(function(){if(v=basketSession.get(i),v)if(v.url.match(/\/index.hmd$/))He=new V(v.data),He.parameters.githubbase=r,Xr(He,a);else try{if(p=JSON.parse(v.data),e){var b=atob(p.content);b.match(/^\s*$/)&&(b=`!!!ONB: No data content
`),le(atob(p.content),me.page)}n&&Gt(p,t,!1,!1)}catch(y){console.log("Error downloading",i,"Error:",y),le(v.data,me.page)}else console.log("Error1 retrieving",i);it()},function(){console.log("Error2 retrieving",i)});else try{p=JSON.parse(v.data),n&&Gt(p,t,!1,!1)}catch{le(v.data,me.page),it()}}function fi(t,e){var r=t.replace(/\.krn$/,""),o="https://josquin.stanford.edu/cgi-bin/tasso?&file="+r;o+="&a=humdrum";var n=r;return e&&(o+="&mm="+e,n+="&mm="+e),{url:o,key:n}}function Pr(t,e){t=t.replace(/^github:\/*/,"");var r="",o="",n="",a="";a="https://raw.githubusercontent.com/";var i=t.match("^/*([^/]+)/([^/]+)/?(.*)");i&&(r=i[1],o=i[2],n=i[3]),a+=r,a+="/",a+=o,a+="/master/",n?a+=n:a+="index.hmd";var s=n,l={url:a,key:s};return l}function tt(t,e){t=t.replace(/^(bb|bitbucket):/,"");var r="",o="",n="",a="";a="https://bitbucket.org/";var i=t.match("^/?([^/]+)/([^/]+)/(.*)");i&&(r=i[1],o=i[2],n=i[3]),a+=r,a+="/",a+=o,a+="/raw/master/",a+=n;var s=n;return{url:a,key:s}}function mi(t,e){var r,o,n="",a="",i,s=!1,l=!1,c=!1;if((i=t.match(/^(j|jrp):\/?\/?(.*)/))?(s=!0,t=i[2]):(i=t.match(/^(g|gh|github):\/?\/?([^\/]+)\/([^\/]+)\/(.+)/))?(l=!0,n=i[2],a=i[3],t=i[4]):(i=t.match(/^nifc:\/?\/?(?:krn)?(.*)/i))&&(c=!0,t=i[1]),s?(o=t,r=""):l||c?o=t:(i=t.match(/(.*)\/([^\/]+)/))&&(r=i[1],o=i[2]),(!o||!o.match(/\.[a-z][a-z][a-z]$/))&&!s){$r(t);return}if(o.match(/^\s*$/)&&!s){$r(t);return}var d;s?(d="https://josquin.stanford.edu/cgi-bin/jrp?id="+o,d+="&a=humdrum"):c?d="https://humdrum.nifc.pl/krn/"+o:l?d="https://raw.githubusercontent.com/"+n+"/"+a+"/master/"+o:(d="https://kern.humdrum.org/data?l="+r+"&file="+o,d+="&format=info-json");var m="";return l||(m=r+"/"+o,e&&(d+="&mm="+e,m+="&mm="+e)),{url:d,key:m}}function gi(t){var e=new XMLHttpRequest;e.open("GET",url),e.addEventListener("load",function(){e.status==200&&(e.responseText,He=new V(info.data),$("html").css("cursor","auto"),Xr(He,t))}),e.send()}function $r(t){if(t.match(/index.hmd$/)){gi(t);return}var e="https://kern.humdrum.org/data?l="+t;e+="&format=index",console.log("Loading index",e);var r=new XMLHttpRequest;r.open("GET",e),r.addEventListener("load",function(){if(r.status==200){var o=r.responseText;$("html").css("cursor","auto"),hi(o,t)}}),r.send()}function hi(t,e){g.ShowingIndex=!0,g.InputVisible==!0&&(g.UndoHide=!0,g.ApplyZoom=!0);var r=t.split(/\r?\n/),o,n=[],a;for(o=0;o<r.length;o++)if(!r[o].match(/^\s*$/)&&(a=r[o].split(/\t+/),a.length>=3)){a[1].match(/(.*)HIDE$/)&&(a[2]=a[2].replace(/<hlstart>/g,""),a[2]=a[2].replace(/<hlend>/g,""));let y=a[1]+"	"+a[0]+"	"+a[2];n.push(y)}n.sort();var i=[];for(o=0;o<n.length;o++){a=n[o].split(/\t+/);var s={};s.sorter=a[0],s.filename=a[1],s.text=pi(a[2]),i.push(s)}var l={},c="<table class='index-list'>";for(o=0;o<i.length;o++)if(!i[o].text.match(/^All /)){if(i[o].text=i[o].text.replace(/\[?<a[^>]*wikipedia[^<]*.*?<\/a>\]?/gi,""),c+="<tr><td>",(l[i[o].sorter]||l[i[o].sorter.replace(/HIDE$/,"")])&&(c+="<span class='indenter'></span>"),i[o].filename.match(/^@/)){i[o].text.replace(/<not>.*?<\/not>/g,""),c+=i[o].text;var d=i[o].filename;d=d.replace(/^@/,"");var m=d.split(/:/);l={};for(var p=0;p<m.length;p++)l[m[p]]="true"}else if(i[o].sorter.match(/HIDE$/)){var v="";v+=e,v+="/"+i[o].filename,v+=`');">`,i[o].text=i[o].text.replace(/<hlstart>/,v),c+=i[o].text}else if(!i[o].text.match(/hlstart/))c+=`<span class='ilink' onclick="displayWork('`,c+=e,c+="/"+i[o].filename,c+=`');">`,c+=i[o].text,c+="</span>";else{var v="";v+=`<span class='ilink' onclick="displayWork('`,v+=e,v+="/"+i[o].filename,v+=`');">`,i[o].text=i[o].text.replace(/<hlstart>/,v),i[o].text.match(/<hlend>/)?i[o].text=i[o].text.replace(/<hlend>/,"</span>"):i[o].text+="</span>",c+=i[o].text}c+="</td></tr>"}c+="</table>";var b=document.querySelector("#index");b.innerHTML=c,b.style.visibility="visible",b.style.display="block"}function pi(t){t=t.replace(/-sharp/g,"&sharp;").replace(/-flat/g,"&flat;"),t=t.replace(/<not>.*?<\/not>/g,"");let e=t.match(/@\{link:([^}]+)\}/);if(e){let r=e[1],o="";r.match(/https?:\/\/.*wikipedia/)&&(o+='<a target="_blank" href="'+r+'">',o+=`<span style="float:right; font-size:60%" class="fa-stack fa-1x">
`,o+=`<i class="fas fa-square fa-stack-2x"></i>
`,o+=`<i class="fab fa-wikipedia-w fa-stack-1x fa-inverse"></i>
`,o+=`</span>
`,o+=`</a>
`,t=t.replace(/@\{link:[^}]+\}/,o))}return t}function Xr(t,e){if(t.parameters.hmdindexurl||(t.parameters.hmdindexurl=e),t.parameters.hmdindexurl&&!t.parameters.baseurl){var r=t.parameters.hmdindexurl.replace(/\/index.hmd$/,"");t.parameters.baseurl=r}g.ShowingIndex=!0,g.InputVisible==!0&&(g.UndoHide=!0,g.ApplyZoom=!0);var o=document.querySelector("#index");o.innerHTML=t.generateHTML(),o.style.visibility="visible",o.style.display="block"}function vi(t){if(!t)return t;var e;if(e=t.match(/https:\/\/github.com\/([^\/]+)\/([^\/]+)\/blob\/([^\/]+)\/(.*)/),e){var r=e[1],o=e[2],n=e[3],a=e[4];t="https://raw.githubusercontent.com/"+r+"/"+o+"/",t+=n+"/"+a}return t}function yi(t,e){var r=172,o;if(!e.match(/,/))return o=[{url:t,key:e,expire:r,execute:!1}],o;var n=rt(t),a=rt(e);o=[];for(var i=0;i<n.length;i++)o.push({url:n[i],key:a[i],expire:r,execute:!1});return o}function rt(t){var e=t.split(/\s*,\s*/),r=e[0],o=r.match(/^(.*\/)([^\/]+)/);if(!o)return t;var n=o[1];e[0]=o[2];for(var a=[],i=0;i<e.length;i++)a.push(n+e[i]);return a}function Gt(t,e,r,o){var n;if(t)er(t),n=Ct.decode(t.content);else{console.log("Impossible error for",t);return}var a;e&&e.file&&(a=e.file.match(/([^\/]+)$/))&&(M.SAVEFILENAME=a[1]),le(n,me.page),e.next=!1,e.previous=!1,!!e&&(t["next-work"]&&(e.file=t["next-work"],et(e)),t["previous-work"]&&(e.file=t["previous-work"],et(e)))}function bi(){if(document.body.classList.contains("waiting")){alert("Already converting a score");return}let t=new FormData,e=Q();var r=new Blob([e],{type:"text/x-humdrum"});t.append("inputdata",r);for(var o of t.entries())console.log("FORMDATA",o[0]+", "+o[1]);document.body.classList.add("waiting");let n=new XMLHttpRequest;n.open("POST","https://data.musicxml.humdrum.org"),n.responseType="blob",n.onload=function(){document.body.classList.remove("waiting");let a=this.response,i=window.URL.createObjectURL(a),s=document.createElement("a");document.body.appendChild(s),s.style="display: none",s.href=i,s.download="data.musicxml",s.click(),document.body.removeChild(s)},n.send(t)}class xt{constructor(){this.contextualMenus={}}initialize(){this.contextualMenus=this.getContextualMenus()}hideContextualMenus(){for(var e=Object.keys(this.contextualMenus),r=0;r<e.length;r++)this.contextualMenus[e[r]].style.display="none"}hideMenus(e){this.hideContextualMenu()}showMenu(e){this.showContextualMenu(e)}showContextualMenu(e){for(var r=Object.keys(this.contextualMenus),o=0;o<r.length;o++)e===r[o]?this.contextualMenus[r[o]].style.display="block":this.contextualMenus[r[o]].style.display="none"}showCursorNoteMenu(e){if(!e){this.hideContextualMenus();return}var r=e.id;if(!r){this.hideContextualMenus();return}var o=r.match(/^([A-Z]+)-/i);if(!o){this.hideContextualMenus();return}var n=o[1];n=n.charAt(0).toUpperCase()+n.slice(1),this.showContextualMenu(n)}showComments(){tn()}hideComments(){rn()}getContextualMenus(){var e={},r=document.querySelector("#navbarNavDropdown");if(!r)return e;var o=r.querySelectorAll("li.contextual");if(!o)return e;for(var n=0;n<o.length;n++){var a=o[n].querySelector(".menu-name");if(!!a){var i=a.textContent.trim();e[i]=o[n]}}return e}toggleOriginalClefs(){var e={};e.code=OKey,e.altKey=!0,L(e)}displaySvgData(){var e={};e.code=GKey,e.altKey=!0,L(e)}saveSvgData(){var e={};e.code=GKey,e.altKey=!0,L(e)}loadRepertory(e,r){var o={file:e,next:!0,previous:!0};r&&(o.filter=r),et(o)}saveTextEditorContents(){var e={};e.code=SKey,e.altKey=!0,L(e)}compileEmbeddedFilters(){var e={};e.code=CKey,e.altKey=!0,L(e)}clearEditorContents(){var e={};e.code=EKey,e.altKey=!0,L(e)}showSourceScan(){var e={};e.code=PKey,e.altKey=!0,L(e)}createPdf(){var e={};e.code=TKey,e.altKey=!0,L(e)}reloadFromSource(){var e={};e.code=RKey,e.altKey=!0,L(e)}createPdfPage(){var e={};e.code=TKey,e.altKey=!0,e.shiftKey=!0,L(e)}increaseNotationSpacing(){var e={};e.code=WKey,e.altKey=!0,L(e)}decreaseNotationSpacing(){var e={};e.code=WKey,e.altKey=!0,e.shiftKey=!0,L(e)}decreaseStaffSpacing(){I.SPACING_STAFF-=1,I.SPACING_STAFF<0&&(I.SPACING_STAFF=0),T()}increaseStaffSpacing(){I.SPACING_STAFF+=1,I.SPACING_STAFF>24&&(I.SPACING_STAFF=24),T()}decreaseSystemSpacing(){I.SPACING_SYSTEM-=1,I.SPACING_SYSTEM<0&&(I.SPACING_SYSTEM=0),T()}increaseSystemSpacing(){I.SPACING_SYSTEM+=1,I.SPACING_SYSTEM>12&&(I.SPACING_SYSTEM=12),T()}decreaseLyricSize(){I.LYRIC_SIZE-=.25,I.LYRIC_SIZE<2&&(I.LYRIC_SIZE=2),T()}increaseLyricSize(){I.LYRIC_SIZE+=.25,I.LYRIC_SIZE>8&&(I.LYRIC_SIZE=8),T()}useLeipzigFont(){I.FONT="Leipzig",T()}useLelandFont(){I.FONT="Leland",T()}usePetalumaFont(){I.FONT="Petaluma",T()}useBravuraFont(){I.FONT="Bravura",T()}useGootvilleFont(){I.FONT="Gootville",T()}applyFilter(e,r,o){var n="";r?n=r.replace(/^\s+|\s+$/g,""):n=D.getValue().replace(/^\s+|\s+$/g,"");var a=qe(),r=n+`
!!!filter: `+e+`
`;Ur.filterData(a,r,"humdrum").then(function(i){i=i.replace(/\s+$/m,"");for(var s=i.match(/[^\r\n]+/g),l=s.length-1;l>=0;l--)if(s[l].match(/^!!!Xfilter:/)){s[l]="";break}i="";for(var l=0;l<s.length;l++)s[l]!==""&&(i+=s[l]+`
`);D.setValue(i,-1),o&&o(i)})}insertLocalCommentLine(){var e={};e.code=LKey,e.shiftKey=!0,e.altKey=!0,L(e)}insertNullDataLine(){var e={};e.code=DKey,e.shiftKey=!0,e.altKey=!0,L(e)}insertInterpretationLine(){var e={};e.code=IKey,e.shiftKey=!0,e.altKey=!0,L(e)}insertBarline(){var e={};e.code=BKey,e.shiftKey=!0,e.altKey=!0,L(e)}toggleDataDisplay(){var e={};e.code=YKey,e.altKey=!0,L(e)}toggleToolbarDisplay(){}toggleLogoDisplay(){var e={};e.code=BKey,e.altKey=!0,L(e)}toggleLayerHighlighting(){var e={};e.code=LKey,e.altKey=!0,L(e)}increaseTabSize(){var e={};e.code=DotKey,e.altKey=!0,e.shiftKey=!0,L(e)}decreaseTabSize(){var e={};e.code=CommaKey,e.altKey=!0,e.shiftKey=!0,L(e)}fitTabSizeToData(){for(var e=D.getValue().match(/[^\r\n]+/g),r=4,o=0;o<e.length;o++)if(!e[o].match(/^\s*$/)&&!e[o].match(/^!/))for(var n=e[o].split("	"),a=0;a<n.length;a++)n[a].length>25||n[a].length>r&&(r=n[a].length+3);r>25&&(r=25),M.TABSIZE=r,D.getSession().setTabSize(M.TABSIZE)}openUrl(e,r){r||(r="_blank"),window.open(e,r)}toggleCsvTsv(){ao()}toggleVimPlainTextMode(){var e={};e.code=VKey,e.altKey=!0,L(e)}displayHumdrumData(){var e={};e.code=HKey,e.altKey=!0,L(e)}displayMeiData(){var e={};e.code=MKey,e.altKey=!0,L(e)}loadFromBuffer(e){var r={};switch(e){case 0:r.code=ZeroKey;break;case 1:r.code=OneKey;break;case 2:r.code=TwoKey;break;case 3:r.code=ThreeKey;break;case 4:r.code=FourKey;break;case 5:r.code=FiveKey;break;case 6:r.code=SixKey;break;case 7:r.code=SevenKey;break;case 8:r.code=EightKey;break;case 9:r.code=NineKey;break;default:console.log("UNKNOWN BUFFER:",e);return}r.altKey=!0,L(r),r.code=RKey,r.shiftKey=!0,L(r)}saveToBuffer(e){var r={};switch(e){case 0:r.code=ZeroKey;break;case 1:r.code=OneKey;break;case 2:r.code=TwoKey;break;case 3:r.code=ThreeKey;break;case 4:r.code=FourKey;break;case 5:r.code=FiveKey;break;case 6:r.code=SixKey;break;case 7:r.code=SevenKey;break;case 8:r.code=EightKey;break;case 9:r.code=NineKey;break;default:console.log("UNKNOWN BUFFER:",e);return}r.altKey=!0,L(r),r.code=SKey,r.shiftKey=!0,L(r)}goToLastPage(e){e||(e={}),e.code=EndKey,e.altKey=!0,L(e)}goToFirstPage(e){e||(e={}),e.code=HomeKey,e.altKey=!0,L(e)}goToPreviousWork(e){e||(e={}),e.code=LeftKey,e.altKey=!0,e.shiftKey=!0,L(e)}goToNextWork(){var e={};e.code=RightKey,e.altKey=!0,e.shiftKey=!0,L(e)}goToNextPage(e){e||(e={}),e.code=RightKey,e.altKey=!0,L(e)}goToPreviousPage(e){e||(e={}),e.code=LeftKey,e.altKey=!0,L(e)}toggleMidiPlayback(){var e={};e.code=SpaceKey,e.altKey=!0,L(e)}toggleNotationFreezing(){var e={};e.code=FKey,e.altKey=!0,L(e)}forceNoteStemUp(){h("a",u.CursorNote)}forceNoteStemDown(){h("b",u.CursorNote)}removeStemDirection(){h("c",u.CursorNote)}toggleEditorialAccidental(){h("i",u.CursorNote)}toggleNaturalAccidental(){h("n",u.CursorNote)}toggleSharpAccidental(){h("#",u.CursorNote)}toggleFlatAccidental(){h("-",u.CursorNote)}toggleForcedDisplay(){h("X",u.CursorNote)}toggleStaccato(){h("'",u.CursorNote)}toggleMinorLowerMordent(){h("m",u.CursorNote)}toggleMajorLowerMordent(){h("M",u.CursorNote)}toggleMinorUpperMordent(){h("w",u.CursorNote)}toggleMajorUpperMordent(){h("W",u.CursorNote)}toggleFermata(){h(";",u.CursorNote)}toggleArpeggio(){h(":",u.CursorNote)}toggleAccent(){h("^",u.CursorNote)}toggleMarcato(){h("^^",u.CursorNote)}toggleStaccatissimo(){h("`",u.CursorNote)}toggleTenuto(){h("~",u.CursorNote)}toggleMajorTrill(){h("T",u.CursorNote)}toggleMinorTrill(){h("t",u.CursorNote)}forceSlurAbove(){h("a",u.CursorNote)}forceSlurBelow(){h("b",u.CursorNote)}removeSlurOrientation(){h("c",u.CursorNote)}deleteSlur(){h("D",u.CursorNote)}forceBeamAbove(){h("a",u.CursorNote)}forceBeamBelow(){h("b",u.CursorNote)}removeBeamOrientation(){h("c",u.CursorNote)}forceTieAbove(){h("a",u.CursorNote)}forceTieBelow(){h("b",u.CursorNote)}removeTieOrientation(){h("c",u.CursorNote)}breakBeamAfterNote(){h("J",u.CursorNote)}breakBeamBeforeNote(){h("L",u.CursorNote)}makeRestInvisible(){h("y",u.CursorNote)}togglePedalDown(){h("p",u.CursorNote)}togglePedalUp(){h("P",u.CursorNote)}toggleGraceNoteStyle(){h("q",u.CursorNote)}toggleAtMark(){h("@",u.CursorNote)}addSlur(e){if(e<10&&e>1){var r={};switch(bufferNumber){case 0:r.code=ZeroKey;break;case 1:r.code=OneKey;break;case 2:r.code=TwoKey;break;case 3:r.code=ThreeKey;break;case 4:r.code=FourKey;break;case 5:r.code=FiveKey;break;case 6:r.code=SixKey;break;case 7:r.code=SevenKey;break;case 8:r.code=EightKey;break;case 9:r.code=NineKey;break;default:console.log("UNKNOWN BUFFER:",bufferNumber);return}r.altKey=!0,L(r)}h("s",u.CursorNote)}nextHarmonicNote(){Vr(u.CursorNote)}previousHarmonicNote(){zr(u.CursorNote)}nextMelodicNote(){Zr(u.CursorNote.id)}previousMelodicNote(){jr(u.CursorNote.id)}pitchDownStep(e){if(e<10&&e>1){var r={};switch(bufferNumber){case 0:r.code=ZeroKey;break;case 1:r.code=OneKey;break;case 2:r.code=TwoKey;break;case 3:r.code=ThreeKey;break;case 4:r.code=FourKey;break;case 5:r.code=FiveKey;break;case 6:r.code=SixKey;break;case 7:r.code=SevenKey;break;case 8:r.code=EightKey;break;case 9:r.code=NineKey;break;default:console.log("UNKNOWN BUFFER:",bufferNumber);return}r.altKey=!0,L(r)}h("transpose-down-step",u.CursorNote)}pitchUpStep(e){if(e<10&&e>1){var r={};switch(bufferNumber){case 0:r.code=ZeroKey;break;case 1:r.code=OneKey;break;case 2:r.code=TwoKey;break;case 3:r.code=ThreeKey;break;case 4:r.code=FourKey;break;case 5:r.code=FiveKey;break;case 6:r.code=SixKey;break;case 7:r.code=SevenKey;break;case 8:r.code=EightKey;break;case 9:r.code=NineKey;break;default:console.log("UNKNOWN BUFFER:",bufferNumber);return}r.altKey=!0,L(r)}h("transpose-up-step",u.CursorNote)}pitchUpOctave(e){if(e<10&&e>1){var r={};switch(bufferNumber){case 0:r.code=ZeroKey;break;case 1:r.code=OneKey;break;case 2:r.code=TwoKey;break;case 3:r.code=ThreeKey;break;case 4:r.code=FourKey;break;case 5:r.code=FiveKey;break;case 6:r.code=SixKey;break;case 7:r.code=SevenKey;break;case 8:r.code=EightKey;break;case 9:r.code=NineKey;break;default:console.log("UNKNOWN BUFFER:",bufferNumber);return}r.altKey=!0,L(r)}h("transpose-up-octave",u.CursorNote)}pitchDownOctave(e){if(e<10&&e>1){var r={};switch(bufferNumber){case 0:r.code=ZeroKey;break;case 1:r.code=OneKey;break;case 2:r.code=TwoKey;break;case 3:r.code=ThreeKey;break;case 4:r.code=FourKey;break;case 5:r.code=FiveKey;break;case 6:r.code=SixKey;break;case 7:r.code=SevenKey;break;case 8:r.code=EightKey;break;case 9:r.code=NineKey;break;default:console.log("UNKNOWN BUFFER:",bufferNumber);return}r.altKey=!0,L(r)}h("transpose-down-octave",u.CursorNote)}moveSlurStart(e){if(e<0){if(e<10&&e>1){e=-e;var r={};switch(bufferNumber){case 0:r.code=ZeroKey;break;case 1:r.code=OneKey;break;case 2:r.code=TwoKey;break;case 3:r.code=ThreeKey;break;case 4:r.code=FourKey;break;case 5:r.code=FiveKey;break;case 6:r.code=SixKey;break;case 7:r.code=SevenKey;break;case 8:r.code=EightKey;break;case 9:r.code=NineKey;break;default:console.log("UNKNOWN BUFFER:",bufferNumber);return}r.altKey=!0,L(r)}h("leftEndMoveBack",u.CursorNote)}else{if(e<10&&e>1){var r={};switch(bufferNumber){case 0:r.code=ZeroKey;break;case 1:r.code=OneKey;break;case 2:r.code=TwoKey;break;case 3:r.code=ThreeKey;break;case 4:r.code=FourKey;break;case 5:r.code=FiveKey;break;case 6:r.code=SixKey;break;case 7:r.code=SevenKey;break;case 8:r.code=EightKey;break;case 9:r.code=NineKey;break;default:console.log("UNKNOWN BUFFER:",bufferNumber);return}r.altKey=!0,L(r)}h("leftEndMoveForward",u.CursorNote)}}moveSlurEnd(e){if(e<0){if(e=-e,e<10&&e>1){var r={};switch(bufferNumber){case 0:r.code=ZeroKey;break;case 1:r.code=OneKey;break;case 2:r.code=TwoKey;break;case 3:r.code=ThreeKey;break;case 4:r.code=FourKey;break;case 5:r.code=FiveKey;break;case 6:r.code=SixKey;break;case 7:r.code=SevenKey;break;case 8:r.code=EightKey;break;case 9:r.code=NineKey;break;default:console.log("UNKNOWN BUFFER:",bufferNumber);return}r.altKey=!0,L(r)}h("rightEndMoveBack",u.CursorNote)}else{if(e<10&&e>1){var r={};switch(bufferNumber){case 0:r.code=ZeroKey;break;case 1:r.code=OneKey;break;case 2:r.code=TwoKey;break;case 3:r.code=ThreeKey;break;case 4:r.code=FourKey;break;case 5:r.code=FiveKey;break;case 6:r.code=SixKey;break;case 7:r.code=SevenKey;break;case 8:r.code=EightKey;break;case 9:r.code=NineKey;break;default:console.log("UNKNOWN BUFFER:",bufferNumber);return}r.altKey=!0,L(r)}h("rightEndMoveForward",u.CursorNote)}}adjustNotationScale(e,r){e&&e.shiftKey?I.SCALE=40:(I.SCALE=parseInt(I.SCALE*r+.5),I.SCALE<15?I.SCALE=15:I.SCALE>500&&(I.SCALE=500)),localStorage.SCALE=I.SCALE,T()}increaseTextFontSize(e){e.shiftKey?M.INPUT_FONT_SIZE=1:(M.INPUT_FONT_SIZE*=1.05,M.INPUT_FONT_SIZE>3&&(M.INPUT_FONT_SIZE=3));var r=document.querySelector("#input");!r||(r.style.fontSize=M.INPUT_FONT_SIZE+"rem",localStorage.INPUT_FONT_SIZE=M.INPUT_FONT_SIZE)}resetTextFontSize(e){M.INPUT_FONT_SIZE=1;var r=document.querySelector("#input");!r||(r.style.fontSize=M.INPUT_FONT_SIZE+"rem",localStorage.INPUT_FONT_SIZE=M.INPUT_FONT_SIZE)}decreaseTextFontSize(e){e.shiftKey?M.INPUT_FONT_SIZE=1:(M.INPUT_FONT_SIZE*=.95,M.INPUT_FONT_SIZE<.25&&(M.INPUT_FONT_SIZE=.25));var r=document.querySelector("#input");!r||(r.style.fontSize=M.INPUT_FONT_SIZE+"rem",localStorage.INPUT_FONT_SIZE=M.INPUT_FONT_SIZE)}lineBreaksOff(){I.BREAKS=!0}lineBreaksOn(){I.BREAKS=!1}singlePageView(){var e=document.querySelector("#page-nav");e&&(e.style.display="none");var r=document.querySelector("#multi-page");r&&(r.style.display="block"),T()}multiPageView(){}startSplit(e){e||(e=32),xt.prototype.removeSplits();var r=D.getValue().match(/[^\r\n]+/g),o=D.getCursorPosition(),n,a=0,i=0,s=0,l;for(l=0;l<r.length;l++)if(r[l].match(/^=/)&&(a++,a==e)){r[l]=`!!ignore
`+r[l],l>r.row&&i++,s=1;break}if(!!s){var n="";for(l=0;l<r.length;l++)n+=r[l]+`
`;D.setValue(n,-1),o.row+=i,D.moveCursorToPosition(o)}}nextSplit(e){e||(e=32);var r=D.getValue().match(/[^\r\n]+/g),o=D.getCursorPosition();if(r.length!=0){var n,a=0,i=0,s=-1,l=0;for(n=1;n<r.length;n++)if(r[n]==="!!Xignore"){r[n]="XXX DELETE XXX",i=1;continue}else if(r[n]==="!!ignore"){r[n]="!!Xignore",i=1,s=n;break}if(!!i){for(n=s+1;n<r.length;n++)if(r[n].match(/^=/)&&(l++,l==e)){r[n]=`!!ignore
`+r[n],n>r.row&&a++;break}r[0]!=="!!ignore"&&(r[0]=`!!ignore
`+r[0],a++);var c="";for(n=0;n<r.length;n++)r[n]!=="XXX DELETE XXX"&&(c+=r[n]+`
`);D.setValue(c,-1),o.row+=a,D.moveCursorToPosition(o)}}}previousSplit(e){e||(e=32);var r=D.getValue().match(/[^\r\n]+/g),o=D.getCursorPosition();if(r.length!=0){var n,a=0,i=0,s=-1,l=0;for(n=1;n<r.length;n++)r[n]==="!!Xignore"?(r[n]="!!ignore",i=1,s=n):r[n]==="!!ignore"&&(r[n]="XXX DELETE XXX");if(!!i){for(n=s-2;n>0;n--)if(r[n].match(/^=/)&&(l++,l==e-1)){r[n]=`!!Xignore
`+r[n],n>r.row&&a++;break}r[0]!=="!!ignore"&&(r[0]=`!!ignore
`+r[0],a++);var c="";for(n=0;n<r.length;n++)r[n]!=="XXX DELETE XXX"&&(c+=r[n]+`
`);D.setValue(c,-1),o.row+=a,D.moveCursorToPosition(o)}}}removeSplits(){var e=D.getValue().match(/[^\r\n]+/g),r="",o=D.getCursorPosition(),n=o.row;o.column;for(var a=0,i=0;i<e.length;i++){if(e[i]==="!!ignore"){i<n&&n--,a++;continue}if(e[i]==="!!Xignore"){i<n&&n--,a++;continue}r+=e[i]+`
`}a&&(D.setValue(r,-1),o.row=n,D.moveCursorToPosition(o))}undo(){D.undo()}convertToHumdrum(){to()}trimTabsInEditor(){Va()}mimeEncode(){for(var e=lt(),r=btoa(e).match(/.{1,80}/g),o="",n=0;n<r.length;n++)n<r.length-1?o+=r[n]+`
`:o+=r[n].replace(/=/g,"")+`
`;D.setValue(o,-1)}mimeDecode(){var e=lt();D.setValue(e,-1)}convertToMusicXmlAndSave(){bi()}}let ot;function Te(){return typeof ot=="undefined"&&(ot=new xt,ot.initialize()),ot}let Ur=ve();if(!Ur)throw new Error("Verovio worker is undefined");let D=P();if(!D)throw new Error("Ace Editor is undefined");function zr(t){Wr(t,-1)}function Vr(t){Wr(t,1)}function Wr(t,e){if(!!t){var r=t.id;qt(t);var o=Ni(r,e);!o||Z(o)}}function Ei(t){for(var e=t;e;){if(e.nodeName==="svg")return!0;e=e.parentNode}return!1}function Si(){var t=document.querySelector("#output"),e,r,o=function(a,i){var s=t.querySelector("svg");if(s){let c=s.querySelectorAll("g.dir.problem tspan.rend tspan.text tspan.text");for(e=0;e<c.length;e++)r=c[e],r.innerHTML==="P"&&(r.innerHTML="&#xf071;",r.classList.add("p"));for(c=s.querySelectorAll("g.dir.sic tspan.rend tspan.text tspan.text"),e=0;e<c.length;e++)r=c[e],r.innerHTML==="S"&&(r.innerHTML="&#xf071;",r.classList.add("s"))}for(var l in a)s&&s.isSameNode(a[l].target)&&document.body.classList.remove("busy")},n=new MutationObserver(o);n.observe(t,{childList:!0,subtree:!0})}function Yr(){for(var t=document.querySelector("svg"),e=t.querySelectorAll(".highlight"),r=0;r<e.length;r++){var o=e[r].className.baseVal;o=o.replace(/\bhighlight\b/,""),e[r].className.className=o,e[r].className.baseVal=o,e[r].className.animVal=o}}function Ni(t,e){var r=t.match(/^[^-]+-[^-]*L(\d+)/),o=-1;if(r)o=parseInt(r[1]);else return;if(o!=-1){var n=document.querySelector("svg"),a=n.querySelectorAll('*[id]:not([id=""])'),i=new RegExp("^[^-]+-[^-]*L"+o+"(?!d)"),s=[],l,c;for(c=0;c<a.length;c++)if(a[c].id.match(i)){if(l=a[c].id.replace(/-.*/,""),!(l=="note"||l=="rest"||l=="mrest"))continue;s.push(a[c])}if(s.sort(function(v,b){var y=at(v),E=at(b),k=y.staff|0,O=E.staff|0,U=y.layer|0,te=E.layer|0;if(k>O)return-1;if(k<O)return 1;if(U>te)return-1;if(U<te)return 1;var re,ye=0,Wt=0,ut=0,dt=0;return(re=v.className.baseVal.match(/oct-(-?\d+)/))&&(ye=parseInt(re[1])),(re=b.className.baseVal.match(/oct-(-?\d+)/))&&(Wt=parseInt(re[1])),(re=v.className.baseVal.match(/b40c-(\d+)/))&&(ut=ye*40+parseInt(re[1])),(re=b.className.baseVal.match(/b40c-(\d+)/))&&(dt=Wt*40+parseInt(re[1])),ut<dt?-1:ut>dt?1:0}),s.length!=1){for(var d=0;d<s.length;d++)at(s[d]);var m=-1;for(c=0;c<s.length;c++)if(s[c].id===t){m=c;break}if(!(m<0)){var p=m+e;return p<0?p=s.length-1:p>=s.length&&(p=0),s[p].id}}}}function qt(t){if(t){for(var e=t.getAttribute("class"),r=e.split(" "),o="",n=0;n<r.length;n++)r[n]!="highlight"&&(o+=" "+r[n]);t.setAttribute("class",o)}}function nt(t,e,r){for(var o=[0,0,0,0,0,0,0,0,0,0,0,0],n=0;n<t.length;n++){var a=Ht(t[n].id);if(a.staff==e&&(o[a.layer]=t[n],a.layer==r&&!t[n].id.match(/space/)))return t[n].id}if(o.length==1)return o[0].id;for(n=r;n>0;n--)if(!!o[n]&&!(o[n].id&&o[n].id.match(/space/)))return o[n].id;for(n=r;n<o.length;n++)if(!!o[n]&&!(o[n].id&&o[n].id.match(/space/)))return o[n].id;for(n=r;n>0;n--)if(!!o[n])return o[n].id;for(n=r;n<o.length;n++)if(!!o[n])return o[n].id}function Ai(t){for(var e=0,r=t;r;)r.className.baseVal.match(/staff/)&&e++,r=r.previousElementSibling;return e}function wi(t){for(var e=0,r=t;r;)r.className.baseVal.match(/layer/)&&e++,r=r.previousElementSibling;return e}function Ht(t){var e=document.querySelector("#"+t);return at(e)}function at(t){if(!t)return{};t.id;var e=0,r=0,o=t;for(o=o.parentNode;o&&o.className.baseVal;)o.className.baseVal.match(/layer/)?r=wi(o):o.className.baseVal.match(/staff/)&&(e=Ai(o)),o=o.parentNode;return{layer:r,staff:e}}function Ii(t){for(var e=document.querySelectorAll("."+t),r=document.querySelectorAll(".r"+t),o=[],n=0;n<e.length;n++){let s=e[n].className.baseVal.match(/qon-([^\s]+)/);if(s)var a=s[1];else a="xyz";if(s=e[n].className.baseVal.match(/qoff-([^\s]+)/),s)var i=s[1];else i="xyz";a!==i&&o.push(e[n])}for(var n=0;n<r.length;n++)o.push(r[n]);return o}function Bt(t){for(var e=document.querySelectorAll("."+t),r=document.querySelectorAll(".r"+t),o=[],n,a,i,s=0;s<e.length;s++)n=e[s].className.baseVal.match(/qon-([^\s]+)/),n?a=n[1]:a="xyz",n=e[s].className.baseVal.match(/qoff-([^\s]+)/),n?i=n[1]:i="xyz",a!==i&&o.push(e[s]);for(var s=0;s<r.length;s++)o.push(r[s]);return o}let j=ve();if(!j)throw new Error("Verovio worker is undefined");function jr(t){var e=document.querySelector("#"+t);if(!e){console.log("CANNOT FIND ITEM ",t);return}var r=Ht(e.id),o=e.className.baseVal.match(/qon-([^\s]+)/);if(!o){console.log("CANNOT FIND QON IN",e.className);return}var n=o[1];if(n!=0){var a="qoff-"+n,i=Ii(a),s;if(!!i)if(qt(e),i.length==1)Z(i[0].id);else if(i.length==0){if(j.page==1){console.log("AT FIRST PAGE, so not continuing further");return}j.gotoPage(j.page-1).then(function(l){var c=l.page||j.page;$("#overlay").hide().css("cursor","auto"),$("#jump_text").val(c),j.renderPage(c).then(function(d){$("#output").html(d)}).then(function(){i=Bt(a),i.length==1?Z(i[0].id):(s=nt(i,r.staff,r.layer),s&&(M.EDITINGID=s,Z(s)))})})}else s=nt(i,r.staff,r.layer),s&&(M.EDITINGID=s,Z(s))}}function Zr(t){var e=document.querySelector("#"+t);if(!!e){var r=Ht(e.id),o=e.className.baseVal.match(/qoff-([^\s]+)/);if(!!o){var n=o[1],a="qon-"+n,i=Bt(a),s;if(!!i)if(qt(e),i.length==1)Z(i[0].id);else if(i.length==0){if(j.pageCount>0&&j.pageCount==j.page)return;j.gotoPage(j.page+1).then(function(l){var c=l.page||j.page;$("#overlay").hide().css("cursor","auto"),$("#jump_text").val(c),j.renderPage(c).then(function(d){$("#output").html(d)}).then(function(){i=Bt(a),i.length==1?Z(i[0].id):(s=nt(i,r.staff,r.layer),s&&(M.EDITINGID=s,Z(s)))})})}else s=nt(i,r.staff,r.layer),s&&(M.EDITINGID=s,Z(s))}}}function ki(){var t=document.querySelector("#appoggiatura-color-stylesheet");if(t){var e=t.parentNode;e.removeChild(t);return}t=document.createElement("style");var r="";r+="g.appoggiatura-start { fill: limegreen; }",r+="g.appoggiatura-stop { fill: forestgreen; }",t.innerHTML=r,t.id="appoggiatura-color-stylesheet",document.body.appendChild(t)}function Li(){var t=document.querySelector("#layer-color-stylesheet");if(t){var e=t.parentNode;e.removeChild(t);return}t=document.createElement("style");var r="";r+=`g[id^='layer-'][id*='N2'] { fill: #00cc00; }
`,r+=`g[id^='layer-'][id*='N3'] { fill: #cc00aa; }
`,r+=`g[id^='layer-'][id*='N4'] { fill: #0088cc; }
`,r+=`g[id^='layer-'][id*='N5'] { fill: #0000cc; }
`,r+=`g[id^='layer-'][id*='N6'] { fill: #cc0000; }
`,r+=`g[id^='layer-'][id*='N7'] { fill: #00cc00; }
`,r+="g.clef { fill: black !important; }",t.innerHTML=r,t.id="layer-color-stylesheet",document.body.appendChild(t)}function Mi(){var t=document.querySelector("#placed-color-stylesheet");if(t){var e=t.parentNode;e.removeChild(t);return}t=document.createElement("style");var r="g.placed { fill: orange; } ";r+="g.placed path { stroke: orange; } ",t.innerHTML=r,t.id="placed-color-stylesheet",document.body.appendChild(t)}function Qr(t){if(!!t){var e=document.querySelector("#"+t);if(!!e){var r,o=t.match(/L(\d+)/);if(o)r=parseInt(r);else return;Pt(e,r)}}}function Pt(t,e){if(t||(t=u.CursorNote),!!t){if(M.EditorLine=e,u.CursorNote){for(var r=u.CursorNote.getAttribute("class"),o=r.split(" "),n="",a=0;a<o.length;a++)o[a]!="highlight"&&(n+=" "+o[a]);n=n.replace(/^\s+/,""),u.CursorNote.setAttribute("class",n)}if(t&&as(t),u.CursorNote){for(var r=u.CursorNote.getAttribute("class"),o=r.split(" "),n="",a=0;a<o.length;a++)o[a]!="highlight"&&(n+=" "+o[a]);n+=" highlight",u.CursorNote.setAttribute("class",n)}}}function Ti(){if(!!u.CursorNote)for(var t=document.querySelectorAll("svg .highlight"),e=0;e<t.length;e++){for(var r=u.CursorNote.getAttribute("class"),o=r.split(" "),n="",e=0;e<o.length;e++)o[e]!="highlight"&&(n+=" "+o[e]);n=n.replace(/^\s+/,""),u.CursorNote.setAttribute("class",n)}}function Z(t,e){if(Ti(),!t){console.log("NO ID so not changing to another element");return}let r=t.match(/^([^-]+)-[^-]*L(\d+)F(\d+)/);if(!r)return;r[1];var o=r[2],n=r[3],a=0;(r=t.match(/-.*L\d+F\d+S(\d+)/))&&(a=r[1]);const i=P();if(!i)throw new Error("Ace Editor is undefined");var s=i.session.getLine(o-1),l=0;if(n>1){var c=0;for(let b=0;b<s.length&&(l++,s[b]=="	"&&b>0&&s[b-1]!="	"&&c++,c!=n-1);b++);}if(a>=1){for(var d=1;l<s.length&&d<a;)if(l++,s[l]==" "&&(d++,d==a)){l++;break}}let m=l;for(var p=s[m];m<s.length&&(m++,s[m]!=" ");){if(s[m]=="	")break;p+=s[m]}u.CursorNote=document.querySelector("#"+t),Te().showCursorNoteMenu(u.CursorNote),i.gotoLine(o,l);let v=document.getElementById(t);if(v.classList.contains("harm")&&v.classList.contains("highlight")){let b=i.session.doc.getLine(o-1),y=l;Y.current=b.substring(l,y),console.log({chord:Y,line:b.substring(l,y),elmnt:v})}i.renderer.scrollCursorIntoView({row:o-1,column:l},.5),Ci()}let se=P();if(!se)throw new Error("Ace Editor is undefined");function Ci(){let t=P().renderer.$cursorLayer.getPixelPosition(0).left,e=se.renderer.$size.scrollerWidth;t>e/2&&se.renderer.scrollToX(t-e/2)}const Fi={humdrum:{theme:"ace/theme/humdrum_light"},xml:{theme:"ace/theme/solarized_light"},musedata:{theme:"ace/theme/solarized_light"}};function Ce(){if(se){const t=ae();se.setTheme(Fi[t].theme),se.getSession().setMode("ace/mode/"+t)}}function Ri(t){if(ae()!="xml"){var e=t.match(/-[^-]*L(\d+)/);if(!!e){var r=parseInt(e[1]);se.gotoLine(r,0),se.centerSelection()}}}function $t(t){return t?t.match(/^\s*</)?"xml":t.substring(0,2e3).match(/Group memberships:/)?"musedata":t.substring(0,2e3).match(/^[A-Za-z0-9+\/\s]+$/)?"mime":"humdrum":"humdrum"}function _i(t,e){var r;if(!t||!e){var o=se.selection.getCursor();r=o.row,e=o.column}r=t;var n=se.session.getLine(r),a=Ko(n,e),i=a.field,s=a.subspine,l=u.HIGHLIGHTQUERY;u.HIGHLIGHTQUERY="",l||(l="L"+(r+1)+"F"+i,s>0&&(l+="S"+s));var c,d=document.getElementById("output").querySelectorAll("g[id$='"+l+"']");if(d.length!=0){for(var m=0;m<d.length;m++)if(d[m].className.baseVal.match(/qon/)){c=d[m];break}return c||(c=d[d.length-1]),c.id.match(/^accid/)&&(c=d[d.length-2]),Pt(c),c}}let R=ve();if(!R)throw new Error("Verovio worker is undefined");function T(t,e,r){if(!R.initialized||g.FreezeRendering&&!e)return;let o=Q();if(!o)return;if(o.match(/^\s*$/)){console.log("Editor contents is empty (2)");return}let n=qe();o.match(/CUT[[]/)&&(n.inputFrom="esac"),o.match(/Group memberships:/)&&(n.inputFrom="musedata"),Jt(n),R.renderData(n,o,t,e).then(function(a){let i=!0;(o.charAt(0)=="<"||o.match(/CUT[[]/)||o.match(/Group memberships:/))&&(i=!1);let s=document.querySelector("#output"),l=s.querySelectorAll("svg");l.length>0&&l.forEach(d=>{d.classList.contains("bi")||d.remove()});let c=document.createElement("svg");return s.appendChild(c),c.outerHTML=a,i&&(r?Qr(r):u.RestoreCursorNote&&Qr(u.RestoreCursorNote),Xt(o),e||document.querySelector("body").classList.remove("invalid")),Hr(),!0}).catch(function(a){return document.querySelector("body").classList.add("invalid"),console.log(">>>>>>>>>> ERROR LOG:",a),!1}).finally(function(){let a=document.querySelector("#index");a.style.visibility="invisibile",a.style.display="none",g.UndoHide&&(Ki(!0),g.UndoHide=!1),g.ApplyZoom&&(Be(),g.ApplyZoom=!1),g.ApplyZoom&&(Be(),g.ApplyZoom=!1),g.ShowingIndex=!1,$("html").css("cursor","auto")})}window.displayNotation=T;function Oi(){g.FreezeRendering=!g.FreezeRendering,document.querySelector("body").classList.toggle("frozen"),g.FreezeRendering||T();let t=document.querySelector("#text-freeze-icon"),e="";t&&(g.FreezeRendering?e="<div title='Unfreeze notation (alt-f)' class='nav-icon fas fa-lock'></div>":e="<div title='Freeze notation (alt-f)' class='nav-icon fas fa-unlock'></div>",t.innerHTML=e)}const X=P();if(!X)throw new Error("Ace Editor is undefined");function Jr(t){let e=document.querySelector("#input");g.InputVisible?(g.LastInputWidth==0&&(g.LastInputWidth=400),ue.send("HIDE_TEXT")):(ue.send("SHOW_TEXT"),g.LastInputWidth=parseInt(e.style.width)),g.InputVisible=!g.InputVisible,X.resize()}window.toggleTextVisibility=Jr;function it(t){let e=document.querySelector("#input");g.InputVisible?(g.LastInputWidth==0&&(g.LastInputWidth=400),G.setPositionX(g.LastInputWidth)):(g.LastInputWidth=parseInt(e.style.width),G.setPositionX(0)),t||Be(),X.resize()}function Ki(t){g.InputVisible=!0,G.setPositionX(g.LastInputWidth),t||Be(),X.resize()}let st="",eo={};function Di(t){if(t||(t="#work-navigator"),st.match(/^\s*$/))return;er(eo);let e=document.querySelector(t);e.innerHTML=st,st=""}function Gi(t){t||(t="#work-navigator");let e=document.querySelector(t);st=e.innerHTML,eo=F,e.innerHTML=""}function xi(t){t||(t="#work-navigator");let e="";const r=document.querySelector(t);if(!r){console.log("Error: cannot find work navigator");return}F["previous-work"]&&(e+=`<span style="cursor:pointer" onclick="displayWork('`,e+=F["previous-work"],e+=`');"`,e+=" title='previous work/movement (&#8679;+&#8592;)'",e+=">",e+="<span class='nav-icon fas fa-arrow-circle-left'></span>",e+="</span>"),F["previous-work"]&&F["next-work"]&&F["has-index"]=="true"&&(e+="&nbsp;"),F["has-index"]=="true"&&(e+=`<span style="cursor:pointer" onclick="displayIndex('`,e+=F.location,e+=`');"`,e+=" title='repertory index (&#8679;+&#8593;)'",e+=">",e+="<span class='nav-icon fas fa-arrow-circle-up'></span>",e+="</span>"),F["previous-work"]&&F["next-work"]&&F["has-index"]=="true"&&(e+="&nbsp;"),F["previous-work"]&&F["next-work"]&&F["has-index"]!="true"&&(e+="&nbsp;"),F["next-work"]&&(e+=`<span style="cursor:pointer" onclick="displayWork('`,e+=F["next-work"],e+=`');"`,e+=" title='next work/movement (&#8679;+&#8594;)'",e+=">",e+="<span class='nav-icon fas fa-arrow-circle-right'></span>",e+="</span>"),F.file&&(e+='<span style="padding-left:3px; cursor:pointer" onclick="displayKeyscape();"',e+=" title='Keyscape'",e+=">",e+="<span class='nav-icon fa fa-key'></span>",e+="</span>"),F["has-index"]=="true"&&(e+=`<span style="padding-left:3px; cursor:pointer" onclick="copyRepertoryUrl('`,e+=F.location,e+="/",e+=F.file,e+=`')"`,e+=" title='copy link for work'",e+=">",e+="<span class='nav-icon fas fa-link'></span>",e+="</span>"),(F["previous-work"]||F["next-work"])&&(e+="&nbsp;&nbsp;"),r.innerHTML=e}function Xt(t){let e=Fo(t);t.split(/\r?\n/);let r="",o="",n;e.title&&!e.title.match(/^\s*$/)?r=e.title:e.OTL&&!e.OTL.match(/^\s*$/)&&(r=e.OTL),e.COM&&!e.COM.match(/^\s*$/)&&((n=e.COM.match(/^\s*([^,]+),/))?o=n[1]:o=e.COM),r=r.replace(/-sharp/g,"&#9839;"),r=r.replace(/-flat/g,"&#9837;");let a;a=document.querySelector("#title"),a&&(a.innerHTML=r),a=document.querySelector("#composer");let i="";a&&!o.match(/^\s*$/)&&(i+=o+", "),a.innerHTML=i,xi("#work-navigator")}async function Ut(t){if(!t)return;console.log(t),co(),R.page=1,$("html").css("cursor","wait"),et({file:t,previous:!0,next:!0});let{docId:e}=we(["docId"]);await an(e,{data:{clientId:C.awareness.clientID},onSuccess:console.log,onError:console.error})}window.displayWork=Ut;function to(t,e){if(t||(t=Q()),!t){console.log("No content to convert to Humdrum");return}R.page=1,e=e||R.page;let r=null;if($t(t),t.slice(0,1e3).match(/<score-partwise/))r=oi();else if(t.slice(0,2e3).match(/Group memberships:/))r=ni();else if(t.slice(0,1e3).match(/<mei/))r=ai();else if(t.slice(0,1e3).match(/CUT[[]/))r=ii();else{alert("Cannot convert data to Humdrum");return}r&&(r.inputFrom=="musedata"||r.inputFrom=="musedata-hum"||r.inputFrom=="musicxml"||r.inputFrom=="musicxml-hum"?R.filterData(r,t,"humdrum").then(ct):R.filterData(r,t,"humdrum").then(function(o){let n=g.FreezeRendering;g.FreezeRendering==!1&&(g.FreezeRendering=!0),ge(o),g.FreezeRendering=n,T(e)}))}function Be(){if(!document.querySelector("#output svg"))return;let e=qe();Jt(e),stop(),R.HEIGHT=e.pageHeight,R.WIDTH=e.pageWidth,R.redoLayout(e,1,R.page).then(function(){Fe(R.page)})}function Fe(t){t=t||R.page,$("#overlay").hide().css("cursor","auto"),$("#jump_text").val(t),R.renderPage(t).then(function(e){$("#output").html(e),Hr()})}function qi(){R.gotoPage(R.page-1).then(function(){Fe(R.page)})}function Hi(){R.gotoPage(R.page+1).then(function(){Fe(R.page)})}function Bi(){R.gotoPage(0).then(function(){Fe(R.page)})}function Pi(){R.gotoPage(1).then(function(){Fe(R.page)})}let Pe="";function $i(){ae()=="musedata"?(be("humdrum"),Ce(),Xi()):(be("humdrum"),Ce(),Pe.match(/^\s*$/)||(le(Pe,R.page),Pe=""))}function Xi(){let t=qe();R.filterData(t,Q(),"humdrum").then(Ui)}function Ui(t){ae()=="musedata"&&Q(),ge(t)}function Q(){let t=X.getValue();if(!t)return"";if(t=ro(t),t.length<5)return t;if(t.substring(0,100).match(/^[\nA-Za-z0-9/+=]+$/))try{t=atob(t),t=ro(t)}catch{}return t}function Re(){return X.getValue()}function lt(){let t=X.getValue();if(!t)return"";if(t.length<5)return t;if(t.substring(0,100).match(/^[\nA-Za-z0-9/+=]+$/))try{t=atob(t)}catch{}return t}function ro(t){let e=t.split(`
`),r=0,o=0;for(let n=0;n<e.length&&!(!e[n].match(/^!!/)&&(o++,e[n].match(/,/)&&r++,o>10));n++);return o&&o==r?_r(e):t}function ge(t){console.log("setTextInEditor",{splash:t}),t?t.charAt(t.length-1)===`
`?(X.setValue(t,-1),console.log("else if")):(X.setValue(t,-1),console.log("else",{text:t})):X.setValue(""),X.getSession().selection.clearSelection()}function ct(t){g.ShowingIndex||(be("xml"),Ce(),Pe.match(/^\s*$/)&&(Pe=Q()),le(t,R.page))}function zi(){let t=qe();t.humType=0;let e=Q();R.filterData(t,e,"mei").then(function(r){ct(r)})}function Vi(){R.getMEI().then(function(t){ct(t)})}function Wi(){if(ae()==="humdrum"&&Yi(),!F["has-pdf"]||F["has-pdf"]!="true")return;let t="https://kern.humdrum.org/data?l="+F.location;t+="&file="+F.file,t+="&format=pdf&#view=FitH",no(t)}function Yi(){let t=ji(),e="",r;if(N>1){for(r=0;r<t.length;r++)if(t[r].number==N){e=t[r].url;break}}else for(r=0;r<t.length;r++)if(t[r].number<=1){e=t[r].url;break}return e?(no(e),1):0}function ji(){if(ae()!=="humdrum")return 0;let t=Q();if(!t)return[];let e=t.split(/\r?\n/),r={},o=[],n;n="^!!!URL(\\d*)-pdf:\\s*((?:ftp|https?)://[^\\s]+)",n+="\\s+(.*)\\s*$";let a=new RegExp(n),i;for(i=0;i<e.length;i++){let s=e[i],l=s.match(a);if(l){let c={};l[1]?c.number=parseInt(l[1]):c.number=-1,c.url=l[2],c.title=l[3],o.push(c)}if(l=s.match(/^!!!([^:]+)\s*:\s*(.*)\s*$/),l){let c={};c.key=l[1],c.value=l[2],r[c.key]||(r[c.key]=[]),r[c.key].push(c)}}for(let s=0;s<o.length;s++)o[s].title=Zi(o[s].title,r);return o}function Zi(t,e){let r=t.match(/@{(.*?)}/);if(!r)return t;let o=oo(r[1],e),n=new RegExp("@{"+r[1]+"}","g");for(t=t.replace(n,o),r=t.match(/@{(.*?)}/);r;)o=oo(r[1],e),n=new RegExp("@{"+r[1]+"}","g"),t=t.replace(n,o),r=t.match(/@{(.*?)}/);return t}function oo(t,e){let r=e[t];return r?r[0].value:""}function no(t,e){if(!t)return;console.log("Loading URL",t);let r="left=0";r+=",top="+parseInt(screen.height*2/3),r+=",width="+screen.width,r+=",height="+parseInt(screen.height/3),r+=",resizeable",r+=",scrollbars",r+=",location=false";let o=window.open(t,"",r);e||window.focus&&o.focus()}function Qi(){for(let t in sessionStorage)sessionStorage.hasOwnProperty(t)&&/^basket-/.test(t)&&(console.log("DELETING",t),delete sessionStorage[t])}function Ji(){lo(),T()}function es(t){ae()=="xml"?ts(t):rs(t)}function ts(t){let e=t.target;e.id;let r,o;for(;e;){if(!e.id){e=e.parentNode;continue}let n=e.id;if(!n){e=e.parentNode;continue}if(!n.match(/-L\d+F\d+/)){o='xml:id="'+e.id+'"',r=new RegExp(o),X.find(r,{wrap:!0,caseSensitive:!0,wholeWord:!0});break}o='xml:id="'+e.id+'"',r=new RegExp(o),X.find(r,{wrap:!0,caseSensitive:!0,wholeWord:!0});break}}function rs(t){let e;typeof t=="string"?e=document.querySelector("#"+t):e=t.target;let r;for(;e;){if(!e.id){e=e.parentNode;continue}if(r=e.id.match(/-[^-]*L(\d+)F(\d+)/),!r){e=e.parentNode;continue}if(e.id.match(/^harm-L(\d+)F(\d+)/)){let o=parseInt(r[1],10),n=parseInt(r[2],10);if(Number.isInteger(o)&&Number.isInteger(n)){let a=A(o,n);document.getElementById("chord-editor").value=a}}u.HIGHLIGHTQUERY=e.id,Z(e.id);break}}function le(t,e){let r=$t(t);r!=ae()&&(be(r),Ce()),ge(t),T(e)}function ao(){if(console.log("converting from CSV TO TSV"),ae()=="xml")return;let e=lt().split(`
`);for(let r=0;r<e.length;r++)if(e[r].match(/^\*\*/)){e[r].match(/,/)?(console.log("CONVERTING TO TSV"),ge(_r(e))):(console.log("CONVERTING TO CSV"),ge(Wa(e)));break}}function io(){M.TABSIZE--,M.TABSIZE<1&&(M.TABSIZE=1),X.getSession().setTabSize(M.TABSIZE)}function os(){M.TABSIZE++,M.TABSIZE>100&&(M.TABSIZE=100),X.getSession().setTabSize(M.TABSIZE)}let zt="";function ns(){let t=lt();if(co(),t.match(/^\s*$/))ge(zt),Xt(zt),Di();else{zt=t,ge("");let e=document.querySelector("#output");e&&(e.innerHTML=""),Xt(""),Gi()}X.focus()}function so(){if(u.CursorNote&&u.CursorNote.id){let t=u.CursorNote.id;R.getTimeForElement(t).then(function(e){br(e)})}else br()}function as(t,e){u.CursorNote=t,Te().showCursorNoteMenu(u.CursorNote)}function is(){let t=document.querySelector("#index");if(t&&t.style.display!="none"){t.style.display="none";let e=document.querySelector("#output");e&&(console.log("FOCUSING ON OUTPUT"),e.focus()),g.ShowingIndex=0}}function lo(){if(!X)return;let t=Re();if(!t)return;let e=t.substring(0,2e3),r=$t(e);r!==ae()&&(be(r),Ce(),console.log("Changing to",r,"mode."))}function co(){I.GOTOTOPOFNOTATION=!0}function ss(t){let e=0;return t.match(/bravura/i)?(t="Bravura",e=1):t.match(/goo?tvil?e?/i)?(t="Gootville",e=1):t.match(/leipzig/i)?(t="Leipzig",e=1):t.match(/leland/i)?(t="Leland",e=1):t.match(/petaluma/i)&&(t="Petaluma",e=1),e||(t="Leland"),t}var Vt="";function ls(t){t||(t="#dropArea");var e=document.querySelector(t);Vt=e,window.addEventListener("dragenter",function(r){cs()}),e.addEventListener("dragenter",fo),e.addEventListener("dragover",fo),e.addEventListener("dragleave",function(r){uo()}),e.addEventListener("drop",us)}function cs(t){t||(t=Vt),t.style.visibility="visible"}function uo(t){t||(t=Vt),t.style.visibility="hidden"}function fo(t){t.dataTransfer.dropEffect="copy",t.preventDefault()}function us(t){t.preventDefault(),$("html").css("cursor","wait"),uo();for(var e,r=t.dataTransfer.files,o=0;o<r.length;o++){e=r[o];var n=new FileReader;n.readAsText(e,"UTF-8");var a=t;n.onload=function(i){var s=n.result;a.shiftKey?to(s):P().setValue(s,-1),$("html").css("cursor","auto")};break}}class ds{constructor(e,r,o,n){Ae(this,"mutationCallback",e=>{for(let r of e)if(r.type==="attributes"&&r.attributeName==="class"){let o=r.target.classList.contains(this.classToWatch);this.lastClassState!==o&&(this.lastClassState=o,o?this.classAddedCallback():this.classRemovedCallback())}});this.targetNode=e,this.classToWatch=r,this.classAddedCallback=o,this.classRemovedCallback=n,this.observer=null,this.lastClassState=e.classList.contains(this.classToWatch),this.init()}init(){this.observer=new MutationObserver(this.mutationCallback),this.observe()}observe(){this.observer.observe(this.targetNode,{attributes:!0})}disconnect(){this.observer.disconnect()}}const f=Te();document.querySelector("#save-editor-contents__submenu-item").addEventListener("click",()=>f.saveTextEditorContents());document.querySelector("#save-as-pdf__submenu-item").addEventListener("click",()=>f.createPdf());document.querySelector("#save-view-as-pdf__submenu-item").addEventListener("click",()=>f.createPdfPage());document.querySelector("#save-view-as-svg__submenu-item").addEventListener("click",()=>f.saveSvgData());document.querySelector("#save-as-musicxml__submenu-item").addEventListener("click",()=>f.convertToMusicXmlAndSave());document.querySelector("#display-mei-data__submenu-item").addEventListener("click",()=>f.displayMeiData());document.querySelector("#display-humdrum-data__submenu-item").addEventListener("click",()=>f.displayHumdrumData());document.querySelector("#save-to-buffer-1__submenu-item").addEventListener("click",()=>f.saveToBuffer(1));document.querySelector("#save-to-buffer-2__submenu-item").addEventListener("click",()=>f.saveToBuffer(2));document.querySelector("#save-to-buffer-3__submenu-item").addEventListener("click",()=>f.saveToBuffer(3));document.querySelector("#save-to-buffer-4__submenu-item").addEventListener("click",()=>f.saveToBuffer(4));document.querySelector("#save-to-buffer-5__submenu-item").addEventListener("click",()=>f.saveToBuffer(5));document.querySelector("#save-to-buffer-6__submenu-item").addEventListener("click",()=>f.saveToBuffer(6));document.querySelector("#save-to-buffer-7__submenu-item").addEventListener("click",()=>f.saveToBuffer(7));document.querySelector("#save-to-buffer-8__submenu-item").addEventListener("click",()=>f.saveToBuffer(8));document.querySelector("#save-to-buffer-9__submenu-item").addEventListener("click",()=>f.saveToBuffer(9));document.querySelector("#load-from-buffer-1__submenu-item").addEventListener("click",()=>f.loadFromBuffer(1));document.querySelector("#load-from-buffer-2__submenu-item").addEventListener("click",()=>f.loadFromBuffer(2));document.querySelector("#load-from-buffer-3__submenu-item").addEventListener("click",()=>f.loadFromBuffer(3));document.querySelector("#load-from-buffer-4__submenu-item").addEventListener("click",()=>f.loadFromBuffer(4));document.querySelector("#load-from-buffer-5__submenu-item").addEventListener("click",()=>f.loadFromBuffer(5));document.querySelector("#load-from-buffer-6__submenu-item").addEventListener("click",()=>f.loadFromBuffer(6));document.querySelector("#load-from-buffer-7__submenu-item").addEventListener("click",()=>f.loadFromBuffer(7));document.querySelector("#load-from-buffer-8__submenu-item").addEventListener("click",()=>f.loadFromBuffer(8));document.querySelector("#load-from-buffer-9__submenu-item").addEventListener("click",()=>f.loadFromBuffer(9));document.querySelector("#load-from-autosave-buffer__submenu-item").addEventListener("click",()=>f.loadFromBuffer(0));document.querySelector("#reload-data-from-source__submenu-item").addEventListener("click",()=>f.reloadFromSource());document.querySelector("#convert-to-humdrum__submenu-item").addEventListener("click",()=>f.convertToHumdrum());document.querySelector("#toggle-csv-tsv__submenu-item").addEventListener("click",()=>f.toggleCsvTsv());document.querySelector("#play-pause-midi-performance__submenu-item").addEventListener("click",()=>f.toggleMidiPlayback());document.querySelector("#make-notation-larger__submenu-item").addEventListener("click",()=>f.adjustNotationScale(event,1.05));document.querySelector("#make-notation-smaller__submenu-item").addEventListener("click",()=>f.adjustNotationScale(event,.95));document.querySelector("#increase-horizontal-notation-spacing__submenu-item").addEventListener("click",()=>f.increaseNotationSpacing());document.querySelector("#decrease-horizontal-notation-spacing__submenu-item").addEventListener("click",()=>f.decreaseNotationSpacing());document.querySelector("#increase-vertical-staff-spacing__submenu-item").addEventListener("click",()=>f.increaseStaffSpacing());document.querySelector("#decrease-vertical-staff-spacing__submenu-item").addEventListener("click",()=>f.decreaseStaffSpacing());document.querySelector("#increase-vertical-system-spacing__submenu-item").addEventListener("click",()=>f.increaseSystemSpacing());document.querySelector("#decrease-vertical-system-spacing__submenu-item").addEventListener("click",()=>f.decreaseSystemSpacing());document.querySelector("#ignore-encoded-line-breaks__submenu-item").addEventListener("click",()=>f.lineBreaksOff());document.querySelector("#display-with-encoded-line-breaks__submenu-item").addEventListener("click",()=>f.lineBreaksOn());document.querySelector("#increase-text-size__submenu-item").addEventListener("click",()=>f.increaseLyricSize());document.querySelector("#decrease-text-size__submenu-item").addEventListener("click",()=>f.decreaseLyricSize());document.querySelector("#auto-tab-width__submenu-item").addEventListener("click",()=>f.fitTabSizeToData());document.querySelector("#increase-tab-width__submenu-item").addEventListener("click",()=>f.increaseTabSize());document.querySelector("#decrease-tab-width__submenu-item").addEventListener("click",()=>f.decreaseTabSize());document.querySelector("#start-splitting--32-measure-splits-__submenu-item").addEventListener("click",()=>f.startSplit(32));document.querySelector("#next-split__submenu-item").addEventListener("click",()=>f.nextSplit(32));document.querySelector("#previous-split__submenu-item").addEventListener("click",()=>f.previousSplit(32));document.querySelector("#remove-splits__submenu-item").addEventListener("click",()=>f.removeSplits());document.querySelector("#bravura__submenu-item").addEventListener("click",()=>f.useBravuraFont());document.querySelector("#gootville__submenu-item").addEventListener("click",()=>f.useGootvilleFont());document.querySelector("#leipzig__submenu-item").addEventListener("click",()=>f.useLeipzigFont());document.querySelector("#leland__submenu-item").addEventListener("click",()=>f.useLelandFont());document.querySelector("#petaluma__submenu-item").addEventListener("click",()=>f.usePetalumaFont());document.querySelector("#toggle-text-display__submenu-item").addEventListener("click",()=>f.toggleDataDisplay());document.querySelector("#increase-font-size__submenu-item").addEventListener("click",t=>f.increaseTextFontSize(t));document.querySelector("#decrease-font-size__submenu-item").addEventListener("click",t=>f.decreaseTextFontSize(t));document.querySelector("#toggle-csv-tsv-humdrum-display__submenu-item").addEventListener("click",()=>f.toggleCsvTsv());document.querySelector("#toggle-layer-highlighting__submenu-item").addEventListener("click",()=>f.toggleLayerHighlighting());document.querySelector("#freeze-unfreeze-notation-rendering__submenu-item").addEventListener("click",()=>f.toggleNotationFreezing());document.querySelector("#toggle-original-clefs__submenu-item").addEventListener("click",()=>f.toggleOriginalClefs());document.querySelector("#clear-text-editor__submenu-item").addEventListener("click",()=>f.clearEditorContents());document.querySelector("#undo-last-change__submenu-item").addEventListener("click",()=>f.undo());document.querySelector("#compile-embedded-filters__submenu-item").addEventListener("click",()=>f.compileEmbeddedFilters());document.querySelector("#remove-trailing-tabs__submenu-item").addEventListener("click",()=>f.trimTabsInEditor());document.querySelector("#beam-by-meter__submenu-item").addEventListener("click",()=>f.applyFilter("autobeam"));document.querySelector("#split-beams-by-lyrics__submenu-item").addEventListener("click",()=>f.applyFilter("autobeam -l"));document.querySelector("#remove-beams__submenu-item").addEventListener("click",()=>f.applyFilter("autobeam -r"));document.querySelector("#sort-chords-highest-note-first__submenu-item").addEventListener("click",()=>f.applyFilter("chord -d"));document.querySelector("#sort-chords-lowest-note-first__submenu-item").addEventListener("click",()=>f.applyFilter("chord -u"));document.querySelector("#extract-first-note-in-chord__submenu-item").addEventListener("click",()=>f.applyFilter("chord -f"));document.querySelector("#extract-last-note-in-chord__submenu-item").addEventListener("click",()=>f.applyFilter("chord -l"));document.querySelector("#highest-note-in-chord__submenu-item").addEventListener("click",()=>f.applyFilter("chord -d | chord -f"));document.querySelector("#lowest-note-in-chord__submenu-item").addEventListener("click",()=>f.applyFilter("chord -u | chord -f"));document.querySelector("#compress-chords__submenu-item").addEventListener("click",()=>f.applyFilter("chord -m"));document.querySelector("#expand-chords__submenu-item").addEventListener("click",()=>f.applyFilter("chord -M"));document.querySelector("#bass-melody-chord-notes--for-grand-staff-scores-__submenu-item").addEventListener("click",()=>f.applyFilter("chord -u | chord -fs1 | chord -ls2"));document.querySelector("#insert-local-comment-line--above-cursor-__submenu-item").addEventListener("click",()=>f.insertLocalCommentLine());document.querySelector("#insert-null-data-line--above-cursor-__submenu-item").addEventListener("click",()=>f.insertNullDataLine());document.querySelector("#insert-barline--above-cursor-__submenu-item").addEventListener("click",()=>f.insertBarline());document.querySelector("#remove-null-lines__submenu-item").addEventListener("click",()=>f.applyFilter("rid -glid"));document.querySelector("#remove-null-data-lines__submenu-item").addEventListener("click",()=>f.applyFilter("rid -d"));document.querySelector("#remove-null-interpretation-lines__submenu-item").addEventListener("click",()=>f.applyFilter("rid -i"));document.querySelector("#remove-null-local-comment-lines__submenu-item").addEventListener("click",()=>f.applyFilter("rid -l"));document.querySelector("#remove-accidentals-from-trills-and-ornaments__submenu-item").addEventListener("click",()=>f.applyFilter("trillspell"));document.querySelector("#remove-non-kern-spines__submenu-item").addEventListener("click",()=>f.applyFilter("extract -i kern"));document.querySelector("#add-staff-above-system__submenu-item").addEventListener("click",()=>f.applyFilter("extract -s 1-$,0 | restfill -i blank"));document.querySelector("#add-staff-above-system-with-hidden-rests__submenu-item").addEventListener("click",()=>f.applyFilter("extract -s 1-$,0 | restfill -yi blank"));document.querySelector("#add-staff-below-system__submenu-item").addEventListener("click",()=>f.applyFilter("extract -s 0,1-$ | restfill -i blank"));document.querySelector("#add-staff-below-system-with-hidden-rests__submenu-item").addEventListener("click",()=>f.applyFilter("extract -s 0,1-$ | restfill -yi blank"));document.querySelector("#add-note-stem-directions__submenu-item").addEventListener("click",()=>f.applyFilter("autostem"));document.querySelector("#remove-note-stem-directions__submenu-item").addEventListener("click",()=>f.applyFilter("autostem -r"));document.querySelector("#add-lyric-verse-to-top-staff__submenu-item").addEventListener("click",()=>f.applyFilter("extract -s 1-$,0 -n text"));document.querySelector("#remove-lyric-text__submenu-item").addEventListener("click",()=>f.applyFilter("extract -I text"));document.querySelector("#split-beams-by-lyrics__submenu-item").addEventListener("click",()=>f.applyFilter("autobeam -l"));document.querySelector("#tonic-to-c__submenu-item").addEventListener("click",()=>f.applyFilter("transpose -k c"));document.querySelector("#tonic-to-c-sharp-__submenu-item").addEventListener("click",()=>f.applyFilter("transpose -k c#"));document.querySelector("#tonic-to-d-flat-__submenu-item").addEventListener("click",()=>f.applyFilter("transpose -k d-"));document.querySelector("#tonic-to-d__submenu-item").addEventListener("click",()=>f.applyFilter("transpose -k d"));document.querySelector("#tonic-to-e-flat-__submenu-item").addEventListener("click",()=>f.applyFilter("transpose -k e-"));document.querySelector("#tonic-to-e__submenu-item").addEventListener("click",()=>f.applyFilter("transpose -k e"));document.querySelector("#tonic-to-f__submenu-item").addEventListener("click",()=>f.applyFilter("transpose -k f"));document.querySelector("#tonic-to-f-sharp-__submenu-item").addEventListener("click",()=>f.applyFilter("transpose -k f#"));document.querySelector("#tonic-to-g__submenu-item").addEventListener("click",()=>f.applyFilter("transpose -k g"));document.querySelector("#tonic-to-a-flat-__submenu-item").addEventListener("click",()=>f.applyFilter("transpose -k a-"));document.querySelector("#tonic-to-a__submenu-item").addEventListener("click",()=>f.applyFilter("transpose -k a"));document.querySelector("#tonic-to-b-flat-__submenu-item").addEventListener("click",()=>f.applyFilter("transpose -k b-"));document.querySelector("#tonic-to-b__submenu-item").addEventListener("click",()=>f.applyFilter("transpose -k b"));document.querySelector("#up-a-minor-second__submenu-item").addEventListener("click",()=>f.applyFilter("transpose -t m2"));document.querySelector("#up-a-major-second__submenu-item").addEventListener("click",()=>f.applyFilter("transpose -t M2"));document.querySelector("#up-a-minor-third__submenu-item").addEventListener("click",()=>f.applyFilter("transpose -t m3"));document.querySelector("#up-a-major-third__submenu-item").addEventListener("click",()=>f.applyFilter("transpose -t M3"));document.querySelector("#up-a-perfect-fourth__submenu-item").addEventListener("click",()=>f.applyFilter("transpose -t P4"));document.querySelector("#up-an-augmented-fourth__submenu-item").addEventListener("click",()=>f.applyFilter("transpose -t A4"));document.querySelector("#up-a-diminished-fifth__submenu-item").addEventListener("click",()=>f.applyFilter("transpose -t d5"));document.querySelector("#up-a-perfect-fifth__submenu-item").addEventListener("click",()=>f.applyFilter("transpose -t P5"));document.querySelector("#up-a-minor-sixth__submenu-item").addEventListener("click",()=>f.applyFilter("transpose -t m6"));document.querySelector("#up-a-major-sixth__submenu-item").addEventListener("click",()=>f.applyFilter("transpose -t M6"));document.querySelector("#up-a-minor-seventh__submenu-item").addEventListener("click",()=>f.applyFilter("transpose -t m7"));document.querySelector("#up-a-major-seventh__submenu-item").addEventListener("click",()=>f.applyFilter("transpose -t M7"));document.querySelector("#up-a-perfect-octave__submenu-item").addEventListener("click",()=>f.applyFilter("transpose -t P8"));document.querySelector("#down-a-minor-second__submenu-item").addEventListener("click",()=>f.applyFilter("transpose -t -m2"));document.querySelector("#down-a-major-second__submenu-item").addEventListener("click",()=>f.applyFilter("transpose -t -M2"));document.querySelector("#down-a-minor-third__submenu-item").addEventListener("click",()=>f.applyFilter("transpose -t -m3"));document.querySelector("#down-a-major-third__submenu-item").addEventListener("click",()=>f.applyFilter("transpose -t -M3"));document.querySelector("#down-a-perfect-fourth__submenu-item").addEventListener("click",()=>f.applyFilter("transpose -t -P4"));document.querySelector("#down-an-augmented-fourth__submenu-item").addEventListener("click",()=>f.applyFilter("transpose -t -A4"));document.querySelector("#down-an-diminished-fifth__submenu-item").addEventListener("click",()=>f.applyFilter("transpose -t -d5"));document.querySelector("#down-a-perfect-fifth__submenu-item").addEventListener("click",()=>f.applyFilter("transpose -t -P5"));document.querySelector("#down-a-minor-sixth__submenu-item").addEventListener("click",()=>f.applyFilter("transpose -t -m6"));document.querySelector("#down-a-major-sixth__submenu-item").addEventListener("click",()=>f.applyFilter("transpose -t -M6"));document.querySelector("#down-a-minor-seventh__submenu-item").addEventListener("click",()=>f.applyFilter("transpose -t -m7"));document.querySelector("#down-a-major-seventh__submenu-item").addEventListener("click",()=>f.applyFilter("transpose -t -M7"));document.querySelector("#down-a-perfect-octave__submenu-item").addEventListener("click",()=>f.applyFilter("transpose -t -P8"));document.querySelector("#tassoize__submenu-item").addEventListener("click",()=>f.applyFilter("tassoize"));document.querySelector("#force-beam-above__submenu-item").addEventListener("click",()=>f.forceBeamAbove());document.querySelector("#force-beam-below__submenu-item").addEventListener("click",()=>f.forceBeamBelow());document.querySelector("#clear-beam-direction__submenu-item").addEventListener("click",()=>f.removeBeamOrientation());document.querySelector("#next-melodic-note__submenu-item").addEventListener("click",()=>f.nextMelodicNote());document.querySelector("#previous-melodic-note__submenu-item").addEventListener("click",()=>f.previousMelodicNote());document.querySelector("#next-harmonic-note__submenu-item").addEventListener("click",()=>f.nextHarmonicNote());document.querySelector("#previous-harmonic-note__submenu-item").addEventListener("click",()=>f.previousHarmonicNote());document.querySelector("#up-a-step__submenu-item").addEventListener("click",()=>f.pitchUpStep(1));document.querySelector("#down-a-step__submenu-item").addEventListener("click",()=>f.pitchDownStep(1));document.querySelector("#up-an-octave__submenu-item").addEventListener("click",()=>f.pitchUpOctave(1));document.querySelector("#down-an-octave__submenu-item").addEventListener("click",()=>f.pitchDownOctave(1));document.querySelector("#up-a-fifth__submenu-item").addEventListener("click",()=>f.pitchUpStep(5));document.querySelector("#down-a-third__submenu-item").addEventListener("click",()=>f.pitchDownStep(3));document.querySelector("#force-stem-above__submenu-item").addEventListener("click",()=>f.forceNoteStemUp());document.querySelector("#force-stem-below__submenu-item").addEventListener("click",()=>f.forceNoteStemUp());document.querySelector("#clear-stem-direction__submenu-item").addEventListener("click",()=>f.removeStemDirection());document.querySelector("#toggle-natural-accidental__submenu-item").addEventListener("click",()=>f.toggleNaturalAccidental());document.querySelector("#toggle-sharp-accidental__submenu-item").addEventListener("click",()=>f.toggleSharpAccidental());document.querySelector("#toggle-flat-accidental__submenu-item").addEventListener("click",()=>f.toggleFlatAccidental());document.querySelector("#toggle-forced-display-of-accidental__submenu-item").addEventListener("click",()=>f.toggleForcedDisplay());document.querySelector("#toggle-editorial-accidental__submenu-item").addEventListener("click",()=>f.toggleEditorialAccidental());document.querySelector("#toggle-staccato__submenu-item").addEventListener("click",()=>f.toggleStaccato());document.querySelector("#toggle-staccatissimo__submenu-item").addEventListener("click",()=>f.toggleStaccatissimo());document.querySelector("#toggle-tenuto__submenu-item").addEventListener("click",()=>f.toggleTenuto());document.querySelector("#toggle-accent__submenu-item").addEventListener("click",()=>f.toggleAccent());document.querySelector("#toggle-marcato__submenu-item").addEventListener("click",()=>f.toggleMarcato());document.querySelector("#toggle-fermata__submenu-item").addEventListener("click",()=>f.toggleFermata());document.querySelector("#toggle-arpeggio__submenu-item").addEventListener("click",()=>f.toggleArpeggio());document.querySelector("#toggle-minor-trill__submenu-item").addEventListener("click",()=>f.toggleMinorTrill());document.querySelector("#toggle-major-trill__submenu-item").addEventListener("click",()=>f.toggleMajorTrill());document.querySelector("#toggle-minor-lower-mordent__submenu-item").addEventListener("click",()=>f.toggleMinorLowerMordent());document.querySelector("#toggle-major-lower-mordent__submenu-item").addEventListener("click",()=>f.toggleMajorLowerMordent());document.querySelector("#toggle-minor-upper-mordent__submenu-item").addEventListener("click",()=>f.toggleMinorUpperMordent());document.querySelector("#toggle-major-upper-mordent__submenu-item").addEventListener("click",()=>f.toggleMajorUpperMordent());document.querySelector("#add-slur-to-next-note__submenu-item").addEventListener("click",()=>f.addSlur(1));document.querySelector("#break-beam-before-note__submenu-item").addEventListener("click",()=>f.breakBeamBeforeNote());document.querySelector("#break-beam-after-note__submenu-item").addEventListener("click",()=>f.breakBeamAfterNote());document.querySelector("#toggle-pedal-down-before-note__submenu-item").addEventListener("click",()=>f.togglePedalDown());document.querySelector("#toggle-pedal-up-after-note__submenu-item").addEventListener("click",()=>f.togglePedalUp());document.querySelector("#toggle-gracenote-style__submenu-item").addEventListener("click",()=>f.toggleGraceNoteStyle());document.querySelector("#toggle---mark__submenu-item").addEventListener("click",()=>f.toggleAtMark());document.querySelector("#next-melodic-note__submenu-item").addEventListener("click",()=>f.nextMelodicNote());document.querySelector("#previous-melodic-note__submenu-item").addEventListener("click",()=>f.previousMelodicNote());document.querySelector("#next-harmonic-note__submenu-item").addEventListener("click",()=>f.nextHarmonicNote());document.querySelector("#previous-harmonic-note__submenu-item").addEventListener("click",()=>f.previousHarmonicNote());document.querySelector("#make-rest-invisible__submenu-item").addEventListener("click",()=>f.makeRestInvisible());document.querySelector("#force-slur-above__submenu-item").addEventListener("click",()=>f.forceSlurAbove());document.querySelector("#force-slur-below__submenu-item").addEventListener("click",()=>f.forceSlurBelow());document.querySelector("#clear-slur-direction__submenu-item").addEventListener("click",()=>f.removeSlurOrientation());document.querySelector("#delete-slur__submenu-item").addEventListener("click",()=>f.deleteSlur());document.querySelector("#move-slur-start-left__submenu-item").addEventListener("click",()=>f.moveSlurStart(-1));document.querySelector("#move-slur-start-right__submenu-item").addEventListener("click",()=>f.moveSlurStart(1));document.querySelector("#move-slur-end-left__submenu-item").addEventListener("click",()=>f.moveSlurEnd(-1));document.querySelector("#move-slur-end-right__submenu-item").addEventListener("click",()=>f.moveSlurEnd(1));document.querySelector("#move-slur-end-3-notes-right__submenu-item").addEventListener("click",()=>f.moveSlurEnd(3));document.querySelector("#force-tie-above__submenu-item").addEventListener("click",()=>f.forceTieAbove());document.querySelector("#force-tie-below__submenu-item").addEventListener("click",()=>f.forceTieBelow());document.querySelector("#clear-tie-direction__submenu-item").addEventListener("click",()=>f.removeTieOrientation());document.querySelector("#bach-370-chorales__submenu-item").addEventListener("click",()=>f.loadRepertory("chorales"));document.querySelector("#bach-wtc-fugues__submenu-item").addEventListener("click",()=>f.loadRepertory("bach-wtc-fugues"));document.querySelector("#beethoven-piano-sonatas__submenu-item").addEventListener("click",()=>f.loadRepertory("beethoven/sonatas"));document.querySelector("#beethoven-string-quartets__submenu-item").addEventListener("click",()=>f.loadRepertory("beethoven/quartets"));document.querySelector("#chopin-first-editions__submenu-item").addEventListener("click",()=>f.loadRepertory("chopin-first-editions"));document.querySelector("#chopin-mazurkas__submenu-item").addEventListener("click",()=>f.loadRepertory("chopin/mazurkas"));document.querySelector("#haydn-keyboard-sonatas__submenu-item").addEventListener("click",()=>f.loadRepertory("haydn/sonatas"));document.querySelector("#hummel-preludes--op--67__submenu-item").addEventListener("click",()=>f.loadRepertory("hummel/preludes"));document.querySelector("#joplin__submenu-item").addEventListener("click",()=>f.loadRepertory("joplin"));document.querySelector("#mozart-piano-sonatas__submenu-item").addEventListener("click",()=>f.loadRepertory("mozart/sonatas"));document.querySelector("#mozart--100-contradances--k-sup-6--sup--anh--c30-01__submenu-item").addEventListener("click",()=>f.loadRepertory("mozart/sonatas"));document.querySelector("#scarlatti-sonatas__submenu-item").addEventListener("click",()=>f.loadRepertory("scarlatti/sonatas"));document.querySelector("#barbershop-quartets__submenu-item").addEventListener("click",()=>f.loadRepertory("osu/barbershop"));document.querySelector("#barbershop-quartets--grand-staff-__submenu-item").addEventListener("click",()=>f.loadRepertory("osu/barbershop",satb2gs));document.querySelector("#deutscher-liderschatz__submenu-item").addEventListener("click",()=>f.loadRepertory("liederschatz1"));document.querySelector("#polyrhythm-project__submenu-item").addEventListener("click",()=>f.loadRepertory("poly"));document.querySelector("#show-comments__submenu-item").addEventListener("click",()=>f.showComments());document.querySelector("#hide-comments__submenu-item").addEventListener("click",()=>f.hideComments());document.querySelectorAll("li.dropdown").forEach(t=>new ds(t,"show",()=>{document.documentElement.style.setProperty("--collab-layer-zIndex",1)},()=>{document.documentElement.style.setProperty("--collab-layer-zIndex",1e3)}));export{C as y};
