var to=Object.defineProperty,eo=Object.defineProperties;var no=Object.getOwnPropertyDescriptors;var zr=Object.getOwnPropertySymbols;var ro=Object.prototype.hasOwnProperty,io=Object.prototype.propertyIsEnumerable;var Yr=(n,t,e)=>t in n?to(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e,He=(n,t)=>{for(var e in t||(t={}))ro.call(t,e)&&Yr(n,e,t[e]);if(zr)for(var e of zr(t))io.call(t,e)&&Yr(n,e,t[e]);return n},Gr=(n,t)=>eo(n,no(t));const lt=()=>new Map,Pe=n=>{const t=lt();return n.forEach((e,r)=>{t.set(r,e)}),t},dt=(n,t,e)=>{let r=n.get(t);return r===void 0&&n.set(t,r=e()),r},so=(n,t)=>{const e=[];for(const[r,i]of n)e.push(t(i,r));return e},oo=(n,t)=>{for(const[e,r]of n)if(t(r,e))return!0;return!1},ce=()=>new Set,$n=n=>n[n.length-1],lo=(n,t)=>{for(let e=0;e<t.length;e++)n.push(t[e])},Wr=Array.from;class Je{constructor(){this._observers=lt()}on(t,e){dt(this._observers,t,ce).add(e)}once(t,e){const r=(...i)=>{this.off(t,r),e(...i)};this.on(t,r)}off(t,e){const r=this._observers.get(t);r!==void 0&&(r.delete(e),r.size===0&&this._observers.delete(t))}emit(t,e){return Wr((this._observers.get(t)||lt()).values()).forEach(r=>r(...e))}destroy(){this._observers=lt()}}const ae=Math.floor,On=Math.abs,co=Math.log10,Mn=(n,t)=>n<t?n:t,At=(n,t)=>n>t?n:t,Xr=n=>n!==0?n<0:1/n<0,ao=String.fromCharCode,ho=n=>n.toLowerCase(),uo=/^\s*/g,fo=n=>n.replace(uo,""),go=/([A-Z])/g,Kr=(n,t)=>fo(n.replace(go,e=>`${t}${ho(e)}`));typeof TextEncoder!="undefined"&&new TextEncoder;let Un=typeof TextDecoder=="undefined"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});Un&&Un.decode(new Uint8Array).length===1&&(Un=null);const qr=n=>n===void 0?null:n;class po{constructor(){this.map=new Map}setItem(t,e){this.map.set(t,e)}getItem(t){return this.map.get(t)}}let Zr=new po,Qr=!0;try{typeof localStorage!="undefined"&&(Zr=localStorage,Qr=!1)}catch{}const ti=Zr,yo=n=>Qr||addEventListener("storage",n),ze=typeof process!="undefined"&&process.release&&/node|io\.js/.test(process.release.name),ei=typeof window!="undefined"&&!ze;typeof navigator!="undefined"&&/Mac/.test(navigator.platform);let ct;const vo=()=>{if(ct===void 0)if(ze){ct=lt();const n=process.argv;let t=null;for(let e=0;e<n.length;e++){const r=n[e];r[0]==="-"?(t!==null&&ct.set(t,""),t=r):t!==null&&(ct.set(t,r),t=null)}t!==null&&ct.set(t,"")}else typeof location=="object"?(ct=lt(),(location.search||"?").slice(1).split("&").forEach(n=>{if(n.length!==0){const[t,e]=n.split("=");ct.set(`--${Kr(t,"-")}`,e),ct.set(`-${Kr(t,"-")}`,e)}})):ct=lt();return ct},wo=n=>vo().has(n),mo=n=>qr(ze?process.env[n.toUpperCase()]:ti.getItem(n)),So=n=>wo("--"+n)||mo(n)!==null;So("production");const ni=1,ri=2,Rn=4,Bn=8,he=32,gt=64,et=128,Ye=31,Fn=63,xt=127,bo=2147483647;class Ge{constructor(t){this.arr=t,this.pos=0}}const mt=n=>new Ge(n),_o=n=>n.pos!==n.arr.length,ko=(n,t)=>{const e=Pn(n.arr.buffer,n.pos+n.arr.byteOffset,t);return n.pos+=t,e},q=n=>ko(n,b(n)),Ft=n=>n.arr[n.pos++],b=n=>{let t=0,e=0;for(;;){const r=n.arr[n.pos++];if(t=t|(r&xt)<<e,e+=7,r<et)return t>>>0;if(e>35)throw new Error("Integer out of range!")}},jn=n=>{let t=n.arr[n.pos++],e=t&Fn,r=6;const i=(t&gt)>0?-1:1;if((t&et)==0)return i*e;for(;;){if(t=n.arr[n.pos++],e=e|(t&xt)<<r,r+=7,t<et)return i*(e>>>0);if(r>41)throw new Error("Integer out of range!")}},St=n=>{let t=b(n);if(t===0)return"";{let e=String.fromCodePoint(Ft(n));if(--t<100)for(;t--;)e+=String.fromCodePoint(Ft(n));else for(;t>0;){const r=t<1e4?t:1e4,i=n.arr.subarray(n.pos,n.pos+r);n.pos+=r,e+=String.fromCodePoint.apply(null,i),t-=r}return decodeURIComponent(escape(e))}},Vn=(n,t)=>{const e=new DataView(n.arr.buffer,n.arr.byteOffset+n.pos,t);return n.pos+=t,e},Eo=n=>Vn(n,4).getFloat32(0,!1),Ao=n=>Vn(n,8).getFloat64(0,!1),xo=n=>Vn(n,8).getBigInt64(0,!1),Do=[n=>{},n=>null,jn,Eo,Ao,xo,n=>!1,n=>!0,St,n=>{const t=b(n),e={};for(let r=0;r<t;r++){const i=St(n);e[i]=ue(n)}return e},n=>{const t=b(n),e=[];for(let r=0;r<t;r++)e.push(ue(n));return e},q],ue=n=>Do[127-Ft(n)](n);class ii extends Ge{constructor(t,e){super(t);this.reader=e,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),_o(this)?this.count=b(this)+1:this.count=-1),this.count--,this.s}}class We extends Ge{constructor(t){super(t);this.s=0,this.count=0}read(){if(this.count===0){this.s=jn(this);const t=Xr(this.s);this.count=1,t&&(this.s=-this.s,this.count=b(this)+2)}return this.count--,this.s}}class Hn extends Ge{constructor(t){super(t);this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){const t=jn(this),e=t&1;this.diff=t>>1,this.count=1,e&&(this.count=b(this)+2)}return this.s+=this.diff,this.count--,this.s}}class Co{constructor(t){this.decoder=new We(t),this.str=St(this.decoder),this.spos=0}read(){const t=this.spos+this.decoder.read(),e=this.str.slice(this.spos,t);return this.spos=t,e}}const si=n=>new Uint8Array(n),Pn=(n,t,e)=>new Uint8Array(n,t,e),Io=n=>new Uint8Array(n),To=n=>{let t="";for(let e=0;e<n.byteLength;e++)t+=ao(n[e]);return btoa(t)},Lo=n=>Buffer.from(n.buffer,n.byteOffset,n.byteLength).toString("base64"),No=n=>{const t=atob(n),e=si(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e},$o=n=>{const t=Buffer.from(n,"base64");return new Uint8Array(t.buffer,t.byteOffset,t.byteLength)},Oo=ei?To:Lo,Mo=ei?No:$o,Uo=n=>{const t=si(n.byteLength);return t.set(n),t},Ro=Number.isInteger||(n=>typeof n=="number"&&isFinite(n)&&ae(n)===n);class fe{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const X=()=>new fe,Jn=n=>{let t=n.cpos;for(let e=0;e<n.bufs.length;e++)t+=n.bufs[e].length;return t},R=n=>{const t=new Uint8Array(Jn(n));let e=0;for(let r=0;r<n.bufs.length;r++){const i=n.bufs[r];t.set(i,e),e+=i.length}return t.set(Pn(n.cbuf.buffer,0,n.cpos),e),t},Bo=(n,t)=>{const e=n.cbuf.length;e-n.cpos<t&&(n.bufs.push(Pn(n.cbuf.buffer,0,n.cpos)),n.cbuf=new Uint8Array(At(e,t)*2),n.cpos=0)},Y=(n,t)=>{const e=n.cbuf.length;n.cpos===e&&(n.bufs.push(n.cbuf),n.cbuf=new Uint8Array(e*2),n.cpos=0),n.cbuf[n.cpos++]=t},zn=Y,m=(n,t)=>{for(;t>xt;)Y(n,et|xt&t),t>>>=7;Y(n,xt&t)},Yn=(n,t)=>{const e=Xr(t);for(e&&(t=-t),Y(n,(t>Fn?et:0)|(e?gt:0)|Fn&t),t>>>=6;t>0;)Y(n,(t>xt?et:0)|xt&t),t>>>=7},Dt=(n,t)=>{const e=unescape(encodeURIComponent(t)),r=e.length;m(n,r);for(let i=0;i<r;i++)Y(n,e.codePointAt(i))},Xe=(n,t)=>{const e=n.cbuf.length,r=n.cpos,i=Mn(e-r,t.length),s=t.length-i;n.cbuf.set(t.subarray(0,i),r),n.cpos+=i,s>0&&(n.bufs.push(n.cbuf),n.cbuf=new Uint8Array(At(e*2,s)),n.cbuf.set(t.subarray(i)),n.cpos=s)},V=(n,t)=>{m(n,t.byteLength),Xe(n,t)},Gn=(n,t)=>{Bo(n,t);const e=new DataView(n.cbuf.buffer,n.cpos,t);return n.cpos+=t,e},Fo=(n,t)=>Gn(n,4).setFloat32(0,t,!1),jo=(n,t)=>Gn(n,8).setFloat64(0,t,!1),Vo=(n,t)=>Gn(n,8).setBigInt64(0,t,!1),oi=new DataView(new ArrayBuffer(4)),Ho=n=>(oi.setFloat32(0,n),oi.getFloat32(0)===n),de=(n,t)=>{switch(typeof t){case"string":Y(n,119),Dt(n,t);break;case"number":Ro(t)&&t<=bo?(Y(n,125),Yn(n,t)):Ho(t)?(Y(n,124),Fo(n,t)):(Y(n,123),jo(n,t));break;case"bigint":Y(n,122),Vo(n,t);break;case"object":if(t===null)Y(n,126);else if(t instanceof Array){Y(n,117),m(n,t.length);for(let e=0;e<t.length;e++)de(n,t[e])}else if(t instanceof Uint8Array)Y(n,116),V(n,t);else{Y(n,118);const e=Object.keys(t);m(n,e.length);for(let r=0;r<e.length;r++){const i=e[r];Dt(n,i),de(n,t[i])}}break;case"boolean":Y(n,t?120:121);break;default:Y(n,127)}};class li extends fe{constructor(t){super();this.w=t,this.s=null,this.count=0}write(t){this.s===t?this.count++:(this.count>0&&m(this,this.count-1),this.count=1,this.w(this,t),this.s=t)}}const ci=n=>{n.count>0&&(Yn(n.encoder,n.count===1?n.s:-n.s),n.count>1&&m(n.encoder,n.count-2))};class Ke{constructor(){this.encoder=new fe,this.s=0,this.count=0}write(t){this.s===t?this.count++:(ci(this),this.count=1,this.s=t)}toUint8Array(){return ci(this),R(this.encoder)}}const ai=n=>{if(n.count>0){const t=n.diff<<1|(n.count===1?0:1);Yn(n.encoder,t),n.count>1&&m(n.encoder,n.count-2)}};class Wn{constructor(){this.encoder=new fe,this.s=0,this.count=0,this.diff=0}write(t){this.diff===t-this.s?(this.s=t,this.count++):(ai(this),this.count=1,this.diff=t-this.s,this.s=t)}toUint8Array(){return ai(this),R(this.encoder)}}class Po{constructor(){this.sarr=[],this.s="",this.lensE=new Ke}write(t){this.s+=t,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(t.length)}toUint8Array(){const t=new fe;return this.sarr.push(this.s),this.s="",Dt(t,this.sarr.join("")),Xe(t,this.lensE.toUint8Array()),R(t)}}const hi=typeof crypto=="undefined"?null:crypto,Jo=hi!==null?n=>{const t=new ArrayBuffer(n),e=new Uint8Array(t);return hi.getRandomValues(e),t}:n=>{const t=new ArrayBuffer(n),e=new Uint8Array(t);for(let r=0;r<n;r++)e[r]=Math.ceil(Math.random()*4294967295>>>0);return t},ui=()=>new Uint32Array(Jo(4))[0],zo=[1e7]+-1e3+-4e3+-8e3+-1e11,Yo=()=>zo.replace(/[018]/g,n=>(n^ui()&15>>n/4).toString(16)),qe=n=>new Error(n),at=()=>{throw qe("Method unimplemented")},ht=()=>{throw qe("Unexpected case")},Go=Object.keys,Wo=(n,t)=>{const e=[];for(const r in n)e.push(t(n[r],r));return e},Ze=n=>Go(n).length,Xo=(n,t)=>{for(const e in n)if(!t(n[e],e))return!1;return!0},fi=(n,t)=>Object.prototype.hasOwnProperty.call(n,t),Ko=(n,t)=>n===t||Ze(n)===Ze(t)&&Xo(n,(e,r)=>(e!==void 0||fi(t,r))&&t[r]===e),Xn=(n,t,e=0)=>{try{for(;e<n.length;e++)n[e](...t)}finally{e<n.length&&Xn(n,t,e+1)}},qo=(n,t)=>n===t,ge=(n,t)=>{if(n==null||t==null)return qo(n,t);if(n.constructor!==t.constructor)return!1;if(n===t)return!0;switch(n.constructor){case ArrayBuffer:n=new Uint8Array(n),t=new Uint8Array(t);case Uint8Array:{if(n.byteLength!==t.byteLength)return!1;for(let e=0;e<n.length;e++)if(n[e]!==t[e])return!1;break}case Set:{if(n.size!==t.size)return!1;for(const e of n)if(!t.has(e))return!1;break}case Map:{if(n.size!==t.size)return!1;for(const e of n.keys())if(!t.has(e)||!ge(n.get(e),t.get(e)))return!1;break}case Object:if(Ze(n)!==Ze(t))return!1;for(const e in n)if(!fi(n,e)||!ge(n[e],t[e]))return!1;break;case Array:if(n.length!==t.length)return!1;for(let e=0;e<n.length;e++)if(!ge(n[e],t[e]))return!1;break;default:return!1}return!0},pt=Symbol;class Zo{constructor(t,e){this.left=t,this.right=e}}const yt=(n,t)=>new Zo(n,t),Ct=typeof document!="undefined"?document:{};typeof DOMParser!="undefined"&&new DOMParser;const Qo=n=>so(n,(t,e)=>`${e}:${t};`).join("");Ct.ELEMENT_NODE;Ct.TEXT_NODE;Ct.CDATA_SECTION_NODE;Ct.COMMENT_NODE;Ct.DOCUMENT_NODE;Ct.DOCUMENT_TYPE_NODE;Ct.DOCUMENT_FRAGMENT_NODE;const bt=Date.now,Kn=pt(),qn=pt(),di=pt(),gi=pt(),pi=pt(),Zn=pt(),yi=pt(),Qn=pt(),vi=pt(),tl={[Kn]:yt("font-weight","bold"),[qn]:yt("font-weight","normal"),[di]:yt("color","blue"),[pi]:yt("color","green"),[gi]:yt("color","grey"),[Zn]:yt("color","red"),[yi]:yt("color","purple"),[Qn]:yt("color","orange"),[vi]:yt("color","black")},el={[Kn]:"[1m",[qn]:"[2m",[di]:"[34m",[pi]:"[32m",[gi]:"[37m",[Zn]:"[31m",[yi]:"[35m",[Qn]:"[38;5;208m",[vi]:"[0m"},nl=n=>{const t=[],e=[],r=lt();let i=[],s=0;for(;s<n.length;s++){const o=n[s],l=tl[o];if(l!==void 0)r.set(l.left,l.right);else if(o.constructor===String||o.constructor===Number){const c=Qo(r);s>0||c.length>0?(t.push("%c"+o),e.push(c)):t.push(o)}else break}for(s>0&&(i=e,i.unshift(t.join("")));s<n.length;s++){const o=n[s];o instanceof Symbol||i.push(o)}return i},rl=n=>{const t=[],e=[];let r=0;for(;r<n.length;r++){const i=n[r],s=el[i];if(s!==void 0)t.push(s);else if(i.constructor===String||i.constructor===Number)t.push(i);else break}for(r>0&&(t.push("[0m"),e.push(t.join("")));r<n.length;r++){const i=n[r];i instanceof Symbol||e.push(i)}return e},il=ze?rl:nl,sl=(...n)=>{console.log(...il(n)),ol.forEach(t=>t.print(n))},ol=new Set,wi=n=>({[Symbol.iterator](){return this},next:n}),ll=(n,t)=>wi(()=>{let e;do e=n.next();while(!e.done&&!t(e.value));return e}),tr=(n,t)=>wi(()=>{const{done:e,value:r}=n.next();return{done:e,value:e?void 0:t(r)}});class er{constructor(t,e){this.clock=t,this.len=e}}class jt{constructor(){this.clients=new Map}}const It=(n,t,e)=>t.clients.forEach((r,i)=>{const s=n.doc.store.clients.get(i);for(let o=0;o<r.length;o++){const l=r[o];Ui(n,s,l.clock,l.len,e)}}),cl=(n,t)=>{let e=0,r=n.length-1;for(;e<=r;){const i=ae((e+r)/2),s=n[i],o=s.clock;if(o<=t){if(t<o+s.len)return i;e=i+1}else r=i-1}return null},nr=(n,t)=>{const e=n.clients.get(t.client);return e!==void 0&&cl(e,t.clock)!==null},rr=n=>{n.clients.forEach(t=>{t.sort((i,s)=>i.clock-s.clock);let e,r;for(e=1,r=1;e<t.length;e++){const i=t[r-1],s=t[e];i.clock+i.len>=s.clock?i.len=At(i.len,s.clock+s.len-i.clock):(r<e&&(t[r]=s),r++)}t.length=r})},ir=n=>{const t=new jt;for(let e=0;e<n.length;e++)n[e].clients.forEach((r,i)=>{if(!t.clients.has(i)){const s=r.slice();for(let o=e+1;o<n.length;o++)lo(s,n[o].clients.get(i)||[]);t.clients.set(i,s)}});return rr(t),t},pe=(n,t,e,r)=>{dt(n.clients,t,()=>[]).push(new er(e,r))},mi=()=>new jt,al=n=>{const t=mi();return n.clients.forEach((e,r)=>{const i=[];for(let s=0;s<e.length;s++){const o=e[s];if(o.deleted){const l=o.id.clock;let c=o.length;if(s+1<e.length)for(let a=e[s+1];s+1<e.length&&a.deleted;a=e[++s+1])c+=a.length;i.push(new er(l,c))}}i.length>0&&t.clients.set(r,i)}),t},Vt=(n,t)=>{m(n.restEncoder,t.clients.size),t.clients.forEach((e,r)=>{n.resetDsCurVal(),m(n.restEncoder,r);const i=e.length;m(n.restEncoder,i);for(let s=0;s<i;s++){const o=e[s];n.writeDsClock(o.clock),n.writeDsLen(o.len)}})},sr=n=>{const t=new jt,e=b(n.restDecoder);for(let r=0;r<e;r++){n.resetDsCurVal();const i=b(n.restDecoder),s=b(n.restDecoder);if(s>0){const o=dt(t.clients,i,()=>[]);for(let l=0;l<s;l++)o.push(new er(n.readDsClock(),n.readDsLen()))}}return t},Si=(n,t,e)=>{const r=new jt,i=b(n.restDecoder);for(let s=0;s<i;s++){n.resetDsCurVal();const o=b(n.restDecoder),l=b(n.restDecoder),c=e.clients.get(o)||[],a=P(e,o);for(let h=0;h<l;h++){const u=n.readDsClock(),f=u+n.readDsLen();if(u<a){a<f&&pe(r,o,a,f-a);let d=ut(c,u),g=c[d];for(!g.deleted&&g.id.clock<u&&(c.splice(d+1,0,vn(t,g,u-g.id.clock)),d++);d<c.length&&(g=c[d++],g.id.clock<f);)g.deleted||(f<g.id.clock+g.length&&c.splice(d,0,vn(t,g,f-g.id.clock)),g.delete(t))}else pe(r,o,u,f-u)}}if(r.clients.size>0){const s=new Tt;return m(s.restEncoder,0),Vt(s,r),s.toUint8Array()}return null},bi=ui;class ye extends Je{constructor({guid:t=Yo(),collectionid:e=null,gc:r=!0,gcFilter:i=()=>!0,meta:s=null,autoLoad:o=!1}={}){super();this.gc=r,this.gcFilter=i,this.clientID=bi(),this.guid=t,this.collectionid=e,this.share=new Map,this.store=new $i,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=o,this.autoLoad=o,this.meta=s}load(){const t=this._item;t!==null&&!this.shouldLoad&&O(t.parent.doc,e=>{e.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(Array.from(this.subdocs).map(t=>t.guid))}transact(t,e=null){O(this,t,e)}get(t,e=G){const r=dt(this.share,t,()=>{const s=new e;return s._integrate(this,null),s}),i=r.constructor;if(e!==G&&i!==e)if(i===G){const s=new e;s._map=r._map,r._map.forEach(o=>{for(;o!==null;o=o.left)o.parent=s}),s._start=r._start;for(let o=s._start;o!==null;o=o.right)o.parent=s;return s._length=r._length,this.share.set(t,s),s._integrate(this,null),s}else throw new Error(`Type with the name ${t} has already been defined with a different constructor`);return r}getArray(t=""){return this.get(t,Jt)}getText(t=""){return this.get(t,Gt)}getMap(t=""){return this.get(t,zt)}getXmlFragment(t=""){return this.get(t,Lt)}toJSON(){const t={};return this.share.forEach((e,r)=>{t[r]=e.toJSON()}),t}destroy(){Wr(this.subdocs).forEach(e=>e.destroy());const t=this._item;if(t!==null){this._item=null;const e=t.content;t.deleted?e.doc=null:(e.doc=new ye(He({guid:this.guid},e.opts)),e.doc._item=t),O(t.parent.doc,r=>{t.deleted||r.subdocsAdded.add(e.doc),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}on(t,e){super.on(t,e)}off(t,e){super.off(t,e)}}class _i{constructor(t){this.restDecoder=t}resetDsCurVal(){}readDsClock(){return b(this.restDecoder)}readDsLen(){return b(this.restDecoder)}}class ki extends _i{readLeftID(){return k(b(this.restDecoder),b(this.restDecoder))}readRightID(){return k(b(this.restDecoder),b(this.restDecoder))}readClient(){return b(this.restDecoder)}readInfo(){return Ft(this.restDecoder)}readString(){return St(this.restDecoder)}readParentInfo(){return b(this.restDecoder)===1}readTypeRef(){return b(this.restDecoder)}readLen(){return b(this.restDecoder)}readAny(){return ue(this.restDecoder)}readBuf(){return Uo(q(this.restDecoder))}readJSON(){return JSON.parse(St(this.restDecoder))}readKey(){return St(this.restDecoder)}}class hl{constructor(t){this.dsCurrVal=0,this.restDecoder=t}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=b(this.restDecoder),this.dsCurrVal}readDsLen(){const t=b(this.restDecoder)+1;return this.dsCurrVal+=t,t}}class Ht extends hl{constructor(t){super(t);this.keys=[],b(t),this.keyClockDecoder=new Hn(q(t)),this.clientDecoder=new We(q(t)),this.leftClockDecoder=new Hn(q(t)),this.rightClockDecoder=new Hn(q(t)),this.infoDecoder=new ii(q(t),Ft),this.stringDecoder=new Co(q(t)),this.parentInfoDecoder=new ii(q(t),Ft),this.typeRefDecoder=new We(q(t)),this.lenDecoder=new We(q(t))}readLeftID(){return new Pt(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new Pt(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return ue(this.restDecoder)}readBuf(){return q(this.restDecoder)}readJSON(){return ue(this.restDecoder)}readKey(){const t=this.keyClockDecoder.read();if(t<this.keys.length)return this.keys[t];{const e=this.stringDecoder.read();return this.keys.push(e),e}}}class Ei{constructor(){this.restEncoder=X()}toUint8Array(){return R(this.restEncoder)}resetDsCurVal(){}writeDsClock(t){m(this.restEncoder,t)}writeDsLen(t){m(this.restEncoder,t)}}class ve extends Ei{writeLeftID(t){m(this.restEncoder,t.client),m(this.restEncoder,t.clock)}writeRightID(t){m(this.restEncoder,t.client),m(this.restEncoder,t.clock)}writeClient(t){m(this.restEncoder,t)}writeInfo(t){zn(this.restEncoder,t)}writeString(t){Dt(this.restEncoder,t)}writeParentInfo(t){m(this.restEncoder,t?1:0)}writeTypeRef(t){m(this.restEncoder,t)}writeLen(t){m(this.restEncoder,t)}writeAny(t){de(this.restEncoder,t)}writeBuf(t){V(this.restEncoder,t)}writeJSON(t){Dt(this.restEncoder,JSON.stringify(t))}writeKey(t){Dt(this.restEncoder,t)}}class Ai{constructor(){this.restEncoder=X(),this.dsCurrVal=0}toUint8Array(){return R(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(t){const e=t-this.dsCurrVal;this.dsCurrVal=t,m(this.restEncoder,e)}writeDsLen(t){t===0&&ht(),m(this.restEncoder,t-1),this.dsCurrVal+=t}}class Tt extends Ai{constructor(){super();this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new Wn,this.clientEncoder=new Ke,this.leftClockEncoder=new Wn,this.rightClockEncoder=new Wn,this.infoEncoder=new li(zn),this.stringEncoder=new Po,this.parentInfoEncoder=new li(zn),this.typeRefEncoder=new Ke,this.lenEncoder=new Ke}toUint8Array(){const t=X();return m(t,0),V(t,this.keyClockEncoder.toUint8Array()),V(t,this.clientEncoder.toUint8Array()),V(t,this.leftClockEncoder.toUint8Array()),V(t,this.rightClockEncoder.toUint8Array()),V(t,R(this.infoEncoder)),V(t,this.stringEncoder.toUint8Array()),V(t,R(this.parentInfoEncoder)),V(t,this.typeRefEncoder.toUint8Array()),V(t,this.lenEncoder.toUint8Array()),Xe(t,R(this.restEncoder)),R(t)}writeLeftID(t){this.clientEncoder.write(t.client),this.leftClockEncoder.write(t.clock)}writeRightID(t){this.clientEncoder.write(t.client),this.rightClockEncoder.write(t.clock)}writeClient(t){this.clientEncoder.write(t)}writeInfo(t){this.infoEncoder.write(t)}writeString(t){this.stringEncoder.write(t)}writeParentInfo(t){this.parentInfoEncoder.write(t?1:0)}writeTypeRef(t){this.typeRefEncoder.write(t)}writeLen(t){this.lenEncoder.write(t)}writeAny(t){de(this.restEncoder,t)}writeBuf(t){V(this.restEncoder,t)}writeJSON(t){de(this.restEncoder,t)}writeKey(t){this.keyMap.get(t)===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(t)):this.keyClockEncoder.write(this.keyClock++)}}const ul=(n,t,e,r)=>{r=At(r,t[0].id.clock);const i=ut(t,r);m(n.restEncoder,t.length-i),n.writeClient(e),m(n.restEncoder,r);const s=t[i];s.write(n,r-s.id.clock);for(let o=i+1;o<t.length;o++)t[o].write(n,0)},or=(n,t,e)=>{const r=new Map;e.forEach((i,s)=>{P(t,s)>i&&r.set(s,i)}),nn(t).forEach((i,s)=>{e.has(s)||r.set(s,0)}),m(n.restEncoder,r.size),Array.from(r.entries()).sort((i,s)=>s[0]-i[0]).forEach(([i,s])=>{ul(n,t.clients.get(i),i,s)})},fl=(n,t)=>{const e=lt(),r=b(n.restDecoder);for(let i=0;i<r;i++){const s=b(n.restDecoder),o=new Array(s),l=n.readClient();let c=b(n.restDecoder);e.set(l,{i:0,refs:o});for(let a=0;a<s;a++){const h=n.readInfo();switch(Ye&h){case 0:{const u=n.readLen();o[a]=new it(k(l,c),u),c+=u;break}case 10:{const u=b(n.restDecoder);o[a]=new st(k(l,c),u),c+=u;break}default:{const u=(h&(gt|et))==0,f=new M(k(l,c),null,(h&et)===et?n.readLeftID():null,null,(h&gt)===gt?n.readRightID():null,u?n.readParentInfo()?t.get(n.readString()):n.readLeftID():null,u&&(h&he)===he?n.readString():null,ls(n,h));o[a]=f,c+=f.length}}}}return e},dl=(n,t,e)=>{const r=[];let i=Array.from(e.keys()).sort((d,g)=>d-g);if(i.length===0)return null;const s=()=>{if(i.length===0)return null;let d=e.get(i[i.length-1]);for(;d.refs.length===d.i;)if(i.pop(),i.length>0)d=e.get(i[i.length-1]);else return null;return d};let o=s();if(o===null&&r.length===0)return null;const l=new $i,c=new Map,a=(d,g)=>{const p=c.get(d);(p==null||p>g)&&c.set(d,g)};let h=o.refs[o.i++];const u=new Map,f=()=>{for(const d of r){const g=d.id.client,p=e.get(g);p?(p.i--,l.clients.set(g,p.refs.slice(p.i)),e.delete(g),p.i=0,p.refs=[]):l.clients.set(g,[d]),i=i.filter(v=>v!==g)}r.length=0};for(;;){if(h.constructor!==st){const g=dt(u,h.id.client,()=>P(t,h.id.client))-h.id.clock;if(g<0)r.push(h),a(h.id.client,h.id.clock-1),f();else{const p=h.getMissing(n,t);if(p!==null){r.push(h);const v=e.get(p)||{refs:[],i:0};if(v.refs.length===v.i)a(p,P(t,p)),f();else{h=v.refs[v.i++];continue}}else(g===0||g<h.length)&&(h.integrate(n,g),u.set(h.id.client,h.id.clock+h.length))}}if(r.length>0)h=r.pop();else if(o!==null&&o.i<o.refs.length)h=o.refs[o.i++];else{if(o=s(),o===null)break;h=o.refs[o.i++]}}if(l.clients.size>0){const d=new Tt;return or(d,l,new Map),m(d.restEncoder,0),{missing:c,update:d.toUint8Array()}}return null},gl=(n,t)=>or(n,t.doc.store,t.beforeState),pl=(n,t,e,r=new Ht(n))=>O(t,i=>{i.local=!1;let s=!1;const o=i.doc,l=o.store,c=fl(r,o),a=dl(i,l,c),h=l.pendingStructs;if(h){for(const[f,d]of h.missing)if(d<P(l,f)){s=!0;break}if(a){for(const[f,d]of a.missing){const g=h.missing.get(f);(g==null||g>d)&&h.missing.set(f,d)}h.update=on([h.update,a.update])}}else l.pendingStructs=a;const u=Si(r,i,l);if(l.pendingDs){const f=new Ht(mt(l.pendingDs));b(f.restDecoder);const d=Si(f,i,l);u&&d?l.pendingDs=on([u,d]):l.pendingDs=u||d}else l.pendingDs=u;if(s){const f=l.pendingStructs.update;l.pendingStructs=null,xi(i.doc,f)}},e,!1),xi=(n,t,e,r=Ht)=>{const i=mt(t);pl(i,n,e,new r(i))},yl=(n,t,e)=>xi(n,t,e,ki),vl=(n,t,e=new Map)=>{or(n,t.store,e),Vt(n,al(t.store))},wl=(n,t=new Uint8Array([0]),e=new Tt)=>{const r=Di(t);vl(e,n,r);const i=[e.toUint8Array()];if(n.store.pendingDs&&i.push(n.store.pendingDs),n.store.pendingStructs&&i.push(Rl(n.store.pendingStructs.update,t)),i.length>1){if(e.constructor===ve)return Ml(i.map((s,o)=>o===0?s:Fl(s)));if(e.constructor===Tt)return on(i)}return i[0]},ml=(n,t)=>wl(n,t,new ve),Sl=n=>{const t=new Map,e=b(n.restDecoder);for(let r=0;r<e;r++){const i=b(n.restDecoder),s=b(n.restDecoder);t.set(i,s)}return t},Di=n=>Sl(new _i(mt(n))),Ci=(n,t)=>(m(n.restEncoder,t.size),t.forEach((e,r)=>{m(n.restEncoder,r),m(n.restEncoder,e)}),n),bl=(n,t)=>Ci(n,nn(t.store)),_l=(n,t=new Ai)=>(n instanceof Map?Ci(t,n):bl(t,n),t.toUint8Array()),kl=n=>_l(n,new Ei);class El{constructor(){this.l=[]}}const Ii=()=>new El,Ti=(n,t)=>n.l.push(t),Li=(n,t)=>{const e=n.l,r=e.length;n.l=e.filter(i=>t!==i),r===n.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},Ni=(n,t,e)=>Xn(n.l,[t,e]);class Pt{constructor(t,e){this.client=t,this.clock=e}}const Qe=(n,t)=>n===t||n!==null&&t!==null&&n.client===t.client&&n.clock===t.clock,k=(n,t)=>new Pt(n,t),Al=n=>{for(const[t,e]of n.doc.share.entries())if(e===n)return t;throw ht()},tn=(n,t)=>{for(;t!==null;){if(t.parent===n)return!0;t=t.parent._item}return!1};class xl{constructor(t,e){this.ds=t,this.sv=e}}const Dl=(n,t)=>new xl(n,t);Dl(mi(),new Map);const we=(n,t)=>t===void 0?!n.deleted:t.sv.has(n.id.client)&&(t.sv.get(n.id.client)||0)>n.id.clock&&!nr(t.ds,n.id),en=(n,t)=>{const e=dt(n.meta,en,ce),r=n.doc.store;e.has(t)||(t.sv.forEach((i,s)=>{i<P(r,s)&&nt(n,k(s,i))}),It(n,t.ds,i=>{}),e.add(t))};class $i{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const nn=n=>{const t=new Map;return n.clients.forEach((e,r)=>{const i=e[e.length-1];t.set(r,i.id.clock+i.length)}),t},P=(n,t)=>{const e=n.clients.get(t);if(e===void 0)return 0;const r=e[e.length-1];return r.id.clock+r.length},Oi=(n,t)=>{let e=n.clients.get(t.id.client);if(e===void 0)e=[],n.clients.set(t.id.client,e);else{const r=e[e.length-1];if(r.id.clock+r.length!==t.id.clock)throw ht()}e.push(t)},ut=(n,t)=>{let e=0,r=n.length-1,i=n[r],s=i.id.clock;if(s===t)return r;let o=ae(t/(s+i.length-1)*r);for(;e<=r;){if(i=n[o],s=i.id.clock,s<=t){if(t<s+i.length)return o;e=o+1}else r=o-1;o=ae((e+r)/2)}throw ht()},Cl=(n,t)=>{const e=n.clients.get(t.client);return e[ut(e,t.clock)]},rn=Cl,lr=(n,t,e)=>{const r=ut(t,e),i=t[r];return i.id.clock<e&&i instanceof M?(t.splice(r+1,0,vn(n,i,e-i.id.clock)),r+1):r},nt=(n,t)=>{const e=n.doc.store.clients.get(t.client);return e[lr(n,e,t.clock)]},Mi=(n,t,e)=>{const r=t.clients.get(e.client),i=ut(r,e.clock),s=r[i];return e.clock!==s.id.clock+s.length-1&&s.constructor!==it&&r.splice(i+1,0,vn(n,s,e.clock-s.id.clock+1)),s},Il=(n,t,e)=>{const r=n.clients.get(t.id.client);r[ut(r,t.id.clock)]=e},Ui=(n,t,e,r,i)=>{if(r===0)return;const s=e+r;let o=lr(n,t,e),l;do l=t[o++],s<l.id.clock+l.length&&lr(n,t,s),i(l);while(o<t.length&&t[o].id.clock<s)};class Tl{constructor(t,e,r){this.doc=t,this.deleteSet=new jt,this.beforeState=nn(t.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=e,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set}}const Ri=(n,t)=>t.deleteSet.clients.size===0&&!oo(t.afterState,(e,r)=>t.beforeState.get(r)!==e)?!1:(rr(t.deleteSet),gl(n,t),Vt(n,t.deleteSet),!0),Bi=(n,t,e)=>{const r=t._item;(r===null||r.id.clock<(n.beforeState.get(r.id.client)||0)&&!r.deleted)&&dt(n.changed,t,ce).add(e)},sn=(n,t)=>{const e=n[t-1],r=n[t];e.deleted===r.deleted&&e.constructor===r.constructor&&e.mergeWith(r)&&(n.splice(t,1),r instanceof M&&r.parentSub!==null&&r.parent._map.get(r.parentSub)===r&&r.parent._map.set(r.parentSub,e))},Ll=(n,t,e)=>{for(const[r,i]of n.clients.entries()){const s=t.clients.get(r);for(let o=i.length-1;o>=0;o--){const l=i[o],c=l.clock+l.len;for(let a=ut(s,l.clock),h=s[a];a<s.length&&h.id.clock<c;h=s[++a]){const u=s[a];if(l.clock+l.len<=u.id.clock)break;u instanceof M&&u.deleted&&!u.keep&&e(u)&&u.gc(t,!1)}}}},Nl=(n,t)=>{n.clients.forEach((e,r)=>{const i=t.clients.get(r);for(let s=e.length-1;s>=0;s--){const o=e[s],l=Mn(i.length-1,1+ut(i,o.clock+o.len-1));for(let c=l,a=i[c];c>0&&a.id.clock>=o.clock;a=i[--c])sn(i,c)}})},Fi=(n,t)=>{if(t<n.length){const e=n[t],r=e.doc,i=r.store,s=e.deleteSet,o=e._mergeStructs;try{rr(s),e.afterState=nn(e.doc.store),r._transaction=null,r.emit("beforeObserverCalls",[e,r]);const l=[];e.changed.forEach((c,a)=>l.push(()=>{(a._item===null||!a._item.deleted)&&a._callObserver(e,c)})),l.push(()=>{e.changedParentTypes.forEach((c,a)=>l.push(()=>{(a._item===null||!a._item.deleted)&&(c=c.filter(h=>h.target._item===null||!h.target._item.deleted),c.forEach(h=>{h.currentTarget=a}),c.sort((h,u)=>h.path.length-u.path.length),Ni(a._dEH,c,e))})),l.push(()=>r.emit("afterTransaction",[e,r]))}),Xn(l,[])}finally{r.gc&&Ll(s,i,r.gcFilter),Nl(s,i),e.afterState.forEach((h,u)=>{const f=e.beforeState.get(u)||0;if(f!==h){const d=i.clients.get(u),g=At(ut(d,f),1);for(let p=d.length-1;p>=g;p--)sn(d,p)}});for(let h=0;h<o.length;h++){const{client:u,clock:f}=o[h].id,d=i.clients.get(u),g=ut(d,f);g+1<d.length&&sn(d,g+1),g>0&&sn(d,g)}if(!e.local&&e.afterState.get(r.clientID)!==e.beforeState.get(r.clientID)&&(r.clientID=bi(),sl(Qn,Kn,"[yjs] ",qn,Zn,"Changed the client-id because another client seems to be using it.")),r.emit("afterTransactionCleanup",[e,r]),r._observers.has("update")){const h=new ve;Ri(h,e)&&r.emit("update",[h.toUint8Array(),e.origin,r,e])}if(r._observers.has("updateV2")){const h=new Tt;Ri(h,e)&&r.emit("updateV2",[h.toUint8Array(),e.origin,r,e])}const{subdocsAdded:l,subdocsLoaded:c,subdocsRemoved:a}=e;(l.size>0||a.size>0||c.size>0)&&(l.forEach(h=>{h.clientID=r.clientID,h.collectionid==null&&(h.collectionid=r.collectionid),r.subdocs.add(h)}),a.forEach(h=>r.subdocs.delete(h)),r.emit("subdocs",[{loaded:c,added:l,removed:a},r,e]),a.forEach(h=>h.destroy())),n.length<=t+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,n])):Fi(n,t+1)}}},O=(n,t,e=null,r=!0)=>{const i=n._transactionCleanups;let s=!1;n._transaction===null&&(s=!0,n._transaction=new Tl(n,e,r),i.push(n._transaction),i.length===1&&n.emit("beforeAllTransactions",[n]),n.emit("beforeTransaction",[n._transaction,n]));try{t(n._transaction)}finally{s&&i[0]===n._transaction&&Fi(i,0)}};class $l{constructor(t,e){this.insertions=e,this.deletions=t,this.meta=new Map}}const ji=(n,t,e)=>{let r=null,i=null;const s=n.doc,o=n.scope;if(O(s,l=>{for(;t.length>0&&r===null;){const c=s.store,a=t.pop(),h=new Set,u=[];let f=!1;It(l,a.insertions,d=>{if(d instanceof M){if(d.redone!==null){let{item:g,diff:p}=_c(c,d.id);p>0&&(g=nt(l,k(g.id.client,g.id.clock+p))),d=g}!d.deleted&&o.some(g=>tn(g,d))&&u.push(d)}}),It(l,a.deletions,d=>{d instanceof M&&o.some(g=>tn(g,d))&&!nr(a.insertions,d.id)&&h.add(d)}),h.forEach(d=>{f=os(l,d,h,u)!==null||f});for(let d=u.length-1;d>=0;d--){const g=u[d];n.deleteFilter(g)&&(g.delete(l),f=!0)}r=f?a:null}l.changed.forEach((c,a)=>{c.has(null)&&a._searchMarker&&(a._searchMarker.length=0)}),i=l},n),r!=null){const l=i.changedParentTypes;n.emit("stack-item-popped",[{stackItem:r,type:e,changedParentTypes:l},n])}return r};class Za extends Je{constructor(t,{captureTimeout:e=500,deleteFilter:r=()=>!0,trackedOrigins:i=new Set([null])}={}){super();this.scope=t instanceof Array?t:[t],this.deleteFilter=r,i.add(this),this.trackedOrigins=i,this.undoStack=[],this.redoStack=[],this.undoing=!1,this.redoing=!1,this.doc=this.scope[0].doc,this.lastChange=0,this.doc.on("afterTransaction",s=>{if(!this.scope.some(u=>s.changedParentTypes.has(u))||!this.trackedOrigins.has(s.origin)&&(!s.origin||!this.trackedOrigins.has(s.origin.constructor)))return;const o=this.undoing,l=this.redoing,c=o?this.redoStack:this.undoStack;o?this.stopCapturing():l||(this.redoStack=[]);const a=new jt;s.afterState.forEach((u,f)=>{const d=s.beforeState.get(f)||0,g=u-d;g>0&&pe(a,f,d,g)});const h=bt();if(h-this.lastChange<e&&c.length>0&&!o&&!l){const u=c[c.length-1];u.deletions=ir([u.deletions,s.deleteSet]),u.insertions=ir([u.insertions,a])}else c.push(new $l(s.deleteSet,a));!o&&!l&&(this.lastChange=h),It(s,s.deleteSet,u=>{u instanceof M&&this.scope.some(f=>tn(f,u))&&mr(u,!0)}),this.emit("stack-item-added",[{stackItem:c[c.length-1],origin:s.origin,type:o?"redo":"undo",changedParentTypes:s.changedParentTypes},this])})}clear(){this.doc.transact(t=>{const e=r=>{It(t,r.deletions,i=>{i instanceof M&&this.scope.some(s=>tn(s,i))&&mr(i,!1)})};this.undoStack.forEach(e),this.redoStack.forEach(e)}),this.undoStack=[],this.redoStack=[]}stopCapturing(){this.lastChange=0}undo(){this.undoing=!0;let t;try{t=ji(this,this.undoStack,"undo")}finally{this.undoing=!1}return t}redo(){this.redoing=!0;let t;try{t=ji(this,this.redoStack,"redo")}finally{this.redoing=!1}return t}}function*Ol(n){const t=b(n.restDecoder);for(let e=0;e<t;e++){const r=b(n.restDecoder),i=n.readClient();let s=b(n.restDecoder);for(let o=0;o<r;o++){const l=n.readInfo();if(l===10){const c=b(n.restDecoder);yield new st(k(i,s),c),s+=c}else if((Ye&l)!=0){const c=(l&(gt|et))==0,a=new M(k(i,s),null,(l&et)===et?n.readLeftID():null,null,(l&gt)===gt?n.readRightID():null,c?n.readParentInfo()?n.readString():n.readLeftID():null,c&&(l&he)===he?n.readString():null,ls(n,l));yield a,s+=a.length}else{const c=n.readLen();yield new it(k(i,s),c),s+=c}}}}class cr{constructor(t,e){this.gen=Ol(t),this.curr=null,this.done=!1,this.filterSkips=e,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===st);return this.curr}}class ar{constructor(t){this.currClient=0,this.startClock=0,this.written=0,this.encoder=t,this.clientStructs=[]}}const Ml=n=>on(n,ki,ve),Ul=(n,t)=>{if(n.constructor===it){const{client:e,clock:r}=n.id;return new it(k(e,r+t),n.length-t)}else if(n.constructor===st){const{client:e,clock:r}=n.id;return new st(k(e,r+t),n.length-t)}else{const e=n,{client:r,clock:i}=e.id;return new M(k(r,i+t),null,k(r,i+t-1),null,e.rightOrigin,e.parent,e.parentSub,e.content.splice(t))}},on=(n,t=Ht,e=Tt)=>{if(n.length===1)return n[0];const r=n.map(h=>new t(mt(h)));let i=r.map(h=>new cr(h,!0)),s=null;const o=new e,l=new ar(o);for(;i=i.filter(f=>f.curr!==null),i.sort((f,d)=>{if(f.curr.id.client===d.curr.id.client){const g=f.curr.id.clock-d.curr.id.clock;return g===0?f.curr.constructor===d.curr.constructor?0:f.curr.constructor===st?1:-1:g}else return d.curr.id.client-f.curr.id.client}),i.length!==0;){const h=i[0],u=h.curr.id.client;if(s!==null){let f=h.curr,d=!1;for(;f!==null&&f.id.clock+f.length<=s.struct.id.clock+s.struct.length&&f.id.client>=s.struct.id.client;)f=h.next(),d=!0;if(f===null||f.id.client!==u||d&&f.id.clock>s.struct.id.clock+s.struct.length)continue;if(u!==s.struct.id.client)_t(l,s.struct,s.offset),s={struct:f,offset:0},h.next();else if(s.struct.id.clock+s.struct.length<f.id.clock)if(s.struct.constructor===st)s.struct.length=f.id.clock+f.length-s.struct.id.clock;else{_t(l,s.struct,s.offset);const g=f.id.clock-s.struct.id.clock-s.struct.length;s={struct:new st(k(u,s.struct.id.clock+s.struct.length),g),offset:0}}else{const g=s.struct.id.clock+s.struct.length-f.id.clock;g>0&&(s.struct.constructor===st?s.struct.length-=g:f=Ul(f,g)),s.struct.mergeWith(f)||(_t(l,s.struct,s.offset),s={struct:f,offset:0},h.next())}}else s={struct:h.curr,offset:0},h.next();for(let f=h.curr;f!==null&&f.id.client===u&&f.id.clock===s.struct.id.clock+s.struct.length&&f.constructor!==st;f=h.next())_t(l,s.struct,s.offset),s={struct:f,offset:0}}s!==null&&(_t(l,s.struct,s.offset),s=null),hr(l);const c=r.map(h=>sr(h)),a=ir(c);return Vt(o,a),o.toUint8Array()},Rl=(n,t,e=Ht,r=Tt)=>{const i=Di(t),s=new r,o=new ar(s),l=new e(mt(n)),c=new cr(l,!1);for(;c.curr;){const h=c.curr,u=h.id.client,f=i.get(u)||0;if(c.curr.constructor===st){c.next();continue}if(h.id.clock+h.length>f)for(_t(o,h,At(f-h.id.clock,0)),c.next();c.curr&&c.curr.id.client===u;)_t(o,c.curr,0),c.next();else for(;c.curr&&c.curr.id.client===u&&c.curr.id.clock+c.curr.length<=f;)c.next()}hr(o);const a=sr(l);return Vt(s,a),s.toUint8Array()},Vi=n=>{n.written>0&&(n.clientStructs.push({written:n.written,restEncoder:R(n.encoder.restEncoder)}),n.encoder.restEncoder=X(),n.written=0)},_t=(n,t,e)=>{n.written>0&&n.currClient!==t.id.client&&Vi(n),n.written===0&&(n.currClient=t.id.client,n.encoder.writeClient(t.id.client),m(n.encoder.restEncoder,t.id.clock+e)),t.write(n.encoder,e),n.written++},hr=n=>{Vi(n);const t=n.encoder.restEncoder;m(t,n.clientStructs.length);for(let e=0;e<n.clientStructs.length;e++){const r=n.clientStructs[e];m(t,r.written),Xe(t,r.restEncoder)}},Bl=(n,t,e)=>{const r=new t(mt(n)),i=new cr(r,!1),s=new e,o=new ar(s);for(let c=i.curr;c!==null;c=i.next())_t(o,c,0);hr(o);const l=sr(r);return Vt(s,l),s.toUint8Array()},Fl=n=>Bl(n,Ht,ve);class ln{constructor(t,e){this.target=t,this.currentTarget=t,this.transaction=e,this._changes=null,this._keys=null,this._delta=null}get path(){return jl(this.currentTarget,this.target)}deletes(t){return nr(this.transaction.deleteSet,t.id)}get keys(){if(this._keys===null){const t=new Map,e=this.target;this.transaction.changed.get(e).forEach(i=>{if(i!==null){const s=e._map.get(i);let o,l;if(this.adds(s)){let c=s.left;for(;c!==null&&this.adds(c);)c=c.left;if(this.deletes(s))if(c!==null&&this.deletes(c))o="delete",l=$n(c.content.getContent());else return;else c!==null&&this.deletes(c)?(o="update",l=$n(c.content.getContent())):(o="add",l=void 0)}else if(this.deletes(s))o="delete",l=$n(s.content.getContent());else return;t.set(i,{action:o,oldValue:l})}}),this._keys=t}return this._keys}get delta(){return this.changes.delta}adds(t){return t.id.clock>=(this.transaction.beforeState.get(t.id.client)||0)}get changes(){let t=this._changes;if(t===null){const e=this.target,r=ce(),i=ce(),s=[];if(t={added:r,deleted:i,delta:s,keys:this.keys},this.transaction.changed.get(e).has(null)){let l=null;const c=()=>{l&&s.push(l)};for(let a=e._start;a!==null;a=a.right)a.deleted?this.deletes(a)&&!this.adds(a)&&((l===null||l.delete===void 0)&&(c(),l={delete:0}),l.delete+=a.length,i.add(a)):this.adds(a)?((l===null||l.insert===void 0)&&(c(),l={insert:[]}),l.insert=l.insert.concat(a.content.getContent()),r.add(a)):((l===null||l.retain===void 0)&&(c(),l={retain:0}),l.retain+=a.length);l!==null&&l.retain===void 0&&c()}this._changes=t}return t}}const jl=(n,t)=>{const e=[];for(;t._item!==null&&t!==n;){if(t._item.parentSub!==null)e.unshift(t._item.parentSub);else{let r=0,i=t._item.parent._start;for(;i!==t._item&&i!==null;)i.deleted||r++,i=i.right;e.unshift(r)}t=t._item.parent}return e},Hi=80;let ur=0;class Vl{constructor(t,e){t.marker=!0,this.p=t,this.index=e,this.timestamp=ur++}}const Hl=n=>{n.timestamp=ur++},Pi=(n,t,e)=>{n.p.marker=!1,n.p=t,t.marker=!0,n.index=e,n.timestamp=ur++},Pl=(n,t,e)=>{if(n.length>=Hi){const r=n.reduce((i,s)=>i.timestamp<s.timestamp?i:s);return Pi(r,t,e),r}else{const r=new Vl(t,e);return n.push(r),r}},cn=(n,t)=>{if(n._start===null||t===0||n._searchMarker===null)return null;const e=n._searchMarker.length===0?null:n._searchMarker.reduce((s,o)=>On(t-s.index)<On(t-o.index)?s:o);let r=n._start,i=0;for(e!==null&&(r=e.p,i=e.index,Hl(e));r.right!==null&&i<t;){if(!r.deleted&&r.countable){if(t<i+r.length)break;i+=r.length}r=r.right}for(;r.left!==null&&i>t;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);return e!==null&&On(e.index-i)<r.parent.length/Hi?(Pi(e,r,i),e):Pl(n._searchMarker,r,i)},me=(n,t,e)=>{for(let r=n.length-1;r>=0;r--){const i=n[r];if(e>0){let s=i.p;for(s.marker=!1;s&&(s.deleted||!s.countable);)s=s.left,s&&!s.deleted&&s.countable&&(i.index-=s.length);if(s===null||s.marker===!0){n.splice(r,1);continue}i.p=s,s.marker=!0}(t<i.index||e>0&&t===i.index)&&(i.index=At(t,i.index+e))}},an=(n,t,e)=>{const r=n,i=t.changedParentTypes;for(;dt(i,n,()=>[]).push(e),n._item!==null;)n=n._item.parent;Ni(r._eH,e,t)};class G{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=Ii(),this._dEH=Ii(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(t,e){this.doc=t,this._item=e}_copy(){throw at()}clone(){throw at()}_write(t){}get _first(){let t=this._start;for(;t!==null&&t.deleted;)t=t.right;return t}_callObserver(t,e){!t.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(t){Ti(this._eH,t)}observeDeep(t){Ti(this._dEH,t)}unobserve(t){Li(this._eH,t)}unobserveDeep(t){Li(this._dEH,t)}toJSON(){}}const Ji=(n,t,e)=>{t<0&&(t=n._length+t),e<0&&(e=n._length+e);let r=e-t;const i=[];let s=n._start;for(;s!==null&&r>0;){if(s.countable&&!s.deleted){const o=s.content.getContent();if(o.length<=t)t-=o.length;else{for(let l=t;l<o.length&&r>0;l++)i.push(o[l]),r--;t=0}}s=s.right}return i},zi=n=>{const t=[];let e=n._start;for(;e!==null;){if(e.countable&&!e.deleted){const r=e.content.getContent();for(let i=0;i<r.length;i++)t.push(r[i])}e=e.right}return t},hn=(n,t)=>{let e=0,r=n._start;for(;r!==null;){if(r.countable&&!r.deleted){const i=r.content.getContent();for(let s=0;s<i.length;s++)t(i[s],e++,n)}r=r.right}},Yi=(n,t)=>{const e=[];return hn(n,(r,i)=>{e.push(t(r,i,n))}),e},Jl=n=>{let t=n._start,e=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(e===null){for(;t!==null&&t.deleted;)t=t.right;if(t===null)return{done:!0,value:void 0};e=t.content.getContent(),r=0,t=t.right}const i=e[r++];return e.length<=r&&(e=null),{done:!1,value:i}}}},Gi=(n,t)=>{const e=cn(n,t);let r=n._start;for(e!==null&&(r=e.p,t-=e.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(t<r.length)return r.content.getContent()[t];t-=r.length}},fr=(n,t,e,r)=>{let i=e;const s=n.doc,o=s.clientID,l=s.store,c=e===null?t._start:e.right;let a=[];const h=()=>{a.length>0&&(i=new M(k(o,P(l,o)),i,i&&i.lastId,c,c&&c.id,t,null,new $t(a)),i.integrate(n,0),a=[])};r.forEach(u=>{if(u===null)a.push(u);else switch(u.constructor){case Number:case Object:case Boolean:case Array:case String:a.push(u);break;default:switch(h(),u.constructor){case Uint8Array:case ArrayBuffer:i=new M(k(o,P(l,o)),i,i&&i.lastId,c,c&&c.id,t,null,new be(new Uint8Array(u))),i.integrate(n,0);break;case ye:i=new M(k(o,P(l,o)),i,i&&i.lastId,c,c&&c.id,t,null,new ke(u)),i.integrate(n,0);break;default:if(u instanceof G)i=new M(k(o,P(l,o)),i,i&&i.lastId,c,c&&c.id,t,null,new vt(u)),i.integrate(n,0);else throw new Error("Unexpected content type in insert operation")}}}),h()},Wi=qe("Length exceeded!"),Xi=(n,t,e,r)=>{if(e>t._length)throw Wi;if(e===0)return t._searchMarker&&me(t._searchMarker,e,r.length),fr(n,t,null,r);const i=e,s=cn(t,e);let o=t._start;for(s!==null&&(o=s.p,e-=s.index,e===0&&(o=o.prev,e+=o&&o.countable&&!o.deleted?o.length:0));o!==null;o=o.right)if(!o.deleted&&o.countable){if(e<=o.length){e<o.length&&nt(n,k(o.id.client,o.id.clock+e));break}e-=o.length}return t._searchMarker&&me(t._searchMarker,i,r.length),fr(n,t,o,r)},Ki=(n,t,e,r)=>{if(r===0)return;const i=e,s=r,o=cn(t,e);let l=t._start;for(o!==null&&(l=o.p,e-=o.index);l!==null&&e>0;l=l.right)!l.deleted&&l.countable&&(e<l.length&&nt(n,k(l.id.client,l.id.clock+e)),e-=l.length);for(;r>0&&l!==null;)l.deleted||(r<l.length&&nt(n,k(l.id.client,l.id.clock+r)),l.delete(n),r-=l.length),l=l.right;if(r>0)throw Wi;t._searchMarker&&me(t._searchMarker,i,-s+r)},un=(n,t,e)=>{const r=t._map.get(e);r!==void 0&&r.delete(n)},dr=(n,t,e,r)=>{const i=t._map.get(e)||null,s=n.doc,o=s.clientID;let l;if(r==null)l=new $t([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:l=new $t([r]);break;case Uint8Array:l=new be(r);break;case ye:l=new ke(r);break;default:if(r instanceof G)l=new vt(r);else throw new Error("Unexpected content type")}new M(k(o,P(s.store,o)),i,i&&i.lastId,null,null,t,e,l).integrate(n,0)},gr=(n,t)=>{const e=n._map.get(t);return e!==void 0&&!e.deleted?e.content.getContent()[e.length-1]:void 0},qi=n=>{const t={};return n._map.forEach((e,r)=>{e.deleted||(t[r]=e.content.getContent()[e.length-1])}),t},Zi=(n,t)=>{const e=n._map.get(t);return e!==void 0&&!e.deleted},fn=n=>ll(n.entries(),t=>!t[1].deleted);class zl extends ln{constructor(t,e){super(t,e);this._transaction=e}}class Jt extends G{constructor(){super();this._prelimContent=[],this._searchMarker=[]}static from(t){const e=new Jt;return e.push(t),e}_integrate(t,e){super._integrate(t,e),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Jt}clone(){const t=new Jt;return t.insert(0,this.toArray().map(e=>e instanceof G?e.clone():e)),t}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}_callObserver(t,e){super._callObserver(t,e),an(this,t,new zl(this,t))}insert(t,e){this.doc!==null?O(this.doc,r=>{Xi(r,this,t,e)}):this._prelimContent.splice(t,0,...e)}push(t){this.insert(this.length,t)}unshift(t){this.insert(0,t)}delete(t,e=1){this.doc!==null?O(this.doc,r=>{Ki(r,this,t,e)}):this._prelimContent.splice(t,e)}get(t){return Gi(this,t)}toArray(){return zi(this)}slice(t=0,e=this.length){return Ji(this,t,e)}toJSON(){return this.map(t=>t instanceof G?t.toJSON():t)}map(t){return Yi(this,t)}forEach(t){hn(this,t)}[Symbol.iterator](){return Jl(this)}_write(t){t.writeTypeRef(gc)}}const Yl=n=>new Jt;class Gl extends ln{constructor(t,e,r){super(t,e);this.keysChanged=r}}class zt extends G{constructor(t){super();this._prelimContent=null,t===void 0?this._prelimContent=new Map:this._prelimContent=new Map(t)}_integrate(t,e){super._integrate(t,e),this._prelimContent.forEach((r,i)=>{this.set(i,r)}),this._prelimContent=null}_copy(){return new zt}clone(){const t=new zt;return this.forEach((e,r)=>{t.set(r,e instanceof G?e.clone():e)}),t}_callObserver(t,e){an(this,t,new Gl(this,t,e))}toJSON(){const t={};return this._map.forEach((e,r)=>{if(!e.deleted){const i=e.content.getContent()[e.length-1];t[r]=i instanceof G?i.toJSON():i}}),t}get size(){return[...fn(this._map)].length}keys(){return tr(fn(this._map),t=>t[0])}values(){return tr(fn(this._map),t=>t[1].content.getContent()[t[1].length-1])}entries(){return tr(fn(this._map),t=>[t[0],t[1].content.getContent()[t[1].length-1]])}forEach(t){const e={};return this._map.forEach((r,i)=>{r.deleted||t(r.content.getContent()[r.length-1],i,this)}),e}[Symbol.iterator](){return this.entries()}delete(t){this.doc!==null?O(this.doc,e=>{un(e,this,t)}):this._prelimContent.delete(t)}set(t,e){return this.doc!==null?O(this.doc,r=>{dr(r,this,t,e)}):this._prelimContent.set(t,e),e}get(t){return gr(this,t)}has(t){return Zi(this,t)}clear(){this.doc!==null?O(this.doc,t=>{this.forEach(function(e,r,i){un(t,i,r)})}):this._prelimContent.clear()}_write(t){t.writeTypeRef(pc)}}const Wl=n=>new zt,kt=(n,t)=>n===t||typeof n=="object"&&typeof t=="object"&&n&&t&&Ko(n,t);class pr{constructor(t,e,r,i){this.left=t,this.right=e,this.index=r,this.currentAttributes=i}forward(){switch(this.right===null&&ht(),this.right.content.constructor){case J:this.right.deleted||Yt(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const Qi=(n,t,e)=>{for(;t.right!==null&&e>0;){switch(t.right.content.constructor){case J:t.right.deleted||Yt(t.currentAttributes,t.right.content);break;default:t.right.deleted||(e<t.right.length&&nt(n,k(t.right.id.client,t.right.id.clock+e)),t.index+=t.right.length,e-=t.right.length);break}t.left=t.right,t.right=t.right.right}return t},dn=(n,t,e)=>{const r=new Map,i=cn(t,e);if(i){const s=new pr(i.p.left,i.p,i.index,r);return Qi(n,s,e-i.index)}else{const s=new pr(null,t._start,0,r);return Qi(n,s,e)}},ts=(n,t,e,r)=>{for(;e.right!==null&&(e.right.deleted===!0||e.right.content.constructor===J&&kt(r.get(e.right.content.key),e.right.content.value));)e.right.deleted||r.delete(e.right.content.key),e.forward();const i=n.doc,s=i.clientID;r.forEach((o,l)=>{const c=e.left,a=e.right,h=new M(k(s,P(i.store,s)),c,c&&c.lastId,a,a&&a.id,t,null,new J(l,o));h.integrate(n,0),e.right=h,e.forward()})},Yt=(n,t)=>{const{key:e,value:r}=t;r===null?n.delete(e):n.set(e,r)},es=(n,t)=>{for(;n.right!==null;){if(!(n.right.deleted||n.right.content.constructor===J&&kt(t[n.right.content.key]||null,n.right.content.value)))break;n.forward()}},ns=(n,t,e,r)=>{const i=n.doc,s=i.clientID,o=new Map;for(const l in r){const c=r[l],a=e.currentAttributes.get(l)||null;if(!kt(a,c)){o.set(l,a);const{left:h,right:u}=e;e.right=new M(k(s,P(i.store,s)),h,h&&h.lastId,u,u&&u.id,t,null,new J(l,c)),e.right.integrate(n,0),e.forward()}}return o},yr=(n,t,e,r,i)=>{e.currentAttributes.forEach((f,d)=>{i[d]===void 0&&(i[d]=null)});const s=n.doc,o=s.clientID;es(e,i);const l=ns(n,t,e,i),c=r.constructor===String?new ft(r):r instanceof G?new vt(r):new Nt(r);let{left:a,right:h,index:u}=e;t._searchMarker&&me(t._searchMarker,e.index,c.getLength()),h=new M(k(o,P(s.store,o)),a,a&&a.lastId,h,h&&h.id,t,null,c),h.integrate(n,0),e.right=h,e.index=u,e.forward(),ts(n,t,e,l)},rs=(n,t,e,r,i)=>{const s=n.doc,o=s.clientID;es(e,i);const l=ns(n,t,e,i);for(;r>0&&e.right!==null;){if(!e.right.deleted)switch(e.right.content.constructor){case J:{const{key:c,value:a}=e.right.content,h=i[c];h!==void 0&&(kt(h,a)?l.delete(c):l.set(c,a),e.right.delete(n));break}default:r<e.right.length&&nt(n,k(e.right.id.client,e.right.id.clock+r)),r-=e.right.length;break}e.forward()}if(r>0){let c="";for(;r>0;r--)c+=`
`;e.right=new M(k(o,P(s.store,o)),e.left,e.left&&e.left.lastId,e.right,e.right&&e.right.id,t,null,new ft(c)),e.right.integrate(n,0),e.forward()}ts(n,t,e,l)},is=(n,t,e,r,i)=>{for(;e&&(!e.countable||e.deleted);)!e.deleted&&e.content.constructor===J&&Yt(i,e.content),e=e.right;let s=0;for(;t!==e;){if(!t.deleted){const o=t.content;switch(o.constructor){case J:{const{key:l,value:c}=o;((i.get(l)||null)!==c||(r.get(l)||null)===c)&&(t.delete(n),s++);break}}}t=t.right}return s},Xl=(n,t)=>{for(;t&&t.right&&(t.right.deleted||!t.right.countable);)t=t.right;const e=new Set;for(;t&&(t.deleted||!t.countable);){if(!t.deleted&&t.content.constructor===J){const r=t.content.key;e.has(r)?t.delete(n):e.add(r)}t=t.left}},Kl=n=>{let t=0;return O(n.doc,e=>{let r=n._start,i=n._start,s=lt();const o=Pe(s);for(;i;){if(i.deleted===!1)switch(i.content.constructor){case J:Yt(o,i.content);break;default:t+=is(e,r,i,s,o),s=Pe(o),r=i;break}i=i.right}}),t},ss=(n,t,e)=>{const r=e,i=Pe(t.currentAttributes),s=t.right;for(;e>0&&t.right!==null;){if(t.right.deleted===!1)switch(t.right.content.constructor){case vt:case Nt:case ft:e<t.right.length&&nt(n,k(t.right.id.client,t.right.id.clock+e)),e-=t.right.length,t.right.delete(n);break}t.forward()}s&&is(n,s,t.right,i,Pe(t.currentAttributes));const o=(t.left||t.right).parent;return o._searchMarker&&me(o._searchMarker,t.index,-r+e),t};class ql extends ln{constructor(t,e,r){super(t,e);this.childListChanged=!1,this.keysChanged=new Set,r.forEach(i=>{i===null?this.childListChanged=!0:this.keysChanged.add(i)})}get changes(){if(this._changes===null){const t={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=t}return this._changes}get delta(){if(this._delta===null){const t=this.target.doc,e=[];O(t,r=>{const i=new Map,s=new Map;let o=this.target._start,l=null;const c={};let a="",h=0,u=0;const f=()=>{if(l!==null){let d;switch(l){case"delete":d={delete:u},u=0;break;case"insert":d={insert:a},i.size>0&&(d.attributes={},i.forEach((g,p)=>{g!==null&&(d.attributes[p]=g)})),a="";break;case"retain":if(d={retain:h},Object.keys(c).length>0){d.attributes={};for(const g in c)d.attributes[g]=c[g]}h=0;break}e.push(d),l=null}};for(;o!==null;){switch(o.content.constructor){case vt:case Nt:this.adds(o)?this.deletes(o)||(f(),l="insert",a=o.content.getContent()[0],f()):this.deletes(o)?(l!=="delete"&&(f(),l="delete"),u+=1):o.deleted||(l!=="retain"&&(f(),l="retain"),h+=1);break;case ft:this.adds(o)?this.deletes(o)||(l!=="insert"&&(f(),l="insert"),a+=o.content.str):this.deletes(o)?(l!=="delete"&&(f(),l="delete"),u+=o.length):o.deleted||(l!=="retain"&&(f(),l="retain"),h+=o.length);break;case J:{const{key:d,value:g}=o.content;if(this.adds(o)){if(!this.deletes(o)){const p=i.get(d)||null;kt(p,g)?o.delete(r):(l==="retain"&&f(),kt(g,s.get(d)||null)?delete c[d]:c[d]=g)}}else if(this.deletes(o)){s.set(d,g);const p=i.get(d)||null;kt(p,g)||(l==="retain"&&f(),c[d]=p)}else if(!o.deleted){s.set(d,g);const p=c[d];p!==void 0&&(kt(p,g)?o.delete(r):(l==="retain"&&f(),g===null?delete c[d]:c[d]=g))}o.deleted||(l==="insert"&&f(),Yt(i,o.content));break}}o=o.right}for(f();e.length>0;){const d=e[e.length-1];if(d.retain!==void 0&&d.attributes===void 0)e.pop();else break}}),this._delta=e}return this._delta}}class Gt extends G{constructor(t){super();this._pending=t!==void 0?[()=>this.insert(0,t)]:[],this._searchMarker=[]}get length(){return this._length}_integrate(t,e){super._integrate(t,e);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new Gt}clone(){const t=new Gt;return t.applyDelta(this.toDelta()),t}_callObserver(t,e){super._callObserver(t,e);const r=new ql(this,t,e),i=t.doc;if(an(this,t,r),!t.local){let s=!1;for(const[o,l]of t.afterState.entries()){const c=t.beforeState.get(o)||0;if(l!==c&&(Ui(t,i.store.clients.get(o),c,l,a=>{!a.deleted&&a.content.constructor===J&&(s=!0)}),s))break}s||It(t,t.deleteSet,o=>{o instanceof it||s||o.parent===this&&o.content.constructor===J&&(s=!0)}),O(i,o=>{s?Kl(this):It(o,o.deleteSet,l=>{l instanceof it||l.parent===this&&Xl(o,l)})})}}toString(){let t="",e=this._start;for(;e!==null;)!e.deleted&&e.countable&&e.content.constructor===ft&&(t+=e.content.str),e=e.right;return t}toJSON(){return this.toString()}applyDelta(t,{sanitize:e=!0}={}){this.doc!==null?O(this.doc,r=>{const i=new pr(null,this._start,0,new Map);for(let s=0;s<t.length;s++){const o=t[s];if(o.insert!==void 0){const l=!e&&typeof o.insert=="string"&&s===t.length-1&&i.right===null&&o.insert.slice(-1)===`
`?o.insert.slice(0,-1):o.insert;(typeof l!="string"||l.length>0)&&yr(r,this,i,l,o.attributes||{})}else o.retain!==void 0?rs(r,this,i,o.retain,o.attributes||{}):o.delete!==void 0&&ss(r,i,o.delete)}}):this._pending.push(()=>this.applyDelta(t))}toDelta(t,e,r){const i=[],s=new Map,o=this.doc;let l="",c=this._start;function a(){if(l.length>0){const h={};let u=!1;s.forEach((d,g)=>{u=!0,h[g]=d});const f={insert:l};u&&(f.attributes=h),i.push(f),l=""}}return O(o,h=>{for(t&&en(h,t),e&&en(h,e);c!==null;){if(we(c,t)||e!==void 0&&we(c,e))switch(c.content.constructor){case ft:{const u=s.get("ychange");t!==void 0&&!we(c,t)?(u===void 0||u.user!==c.id.client||u.state!=="removed")&&(a(),s.set("ychange",r?r("removed",c.id):{type:"removed"})):e!==void 0&&!we(c,e)?(u===void 0||u.user!==c.id.client||u.state!=="added")&&(a(),s.set("ychange",r?r("added",c.id):{type:"added"})):u!==void 0&&(a(),s.delete("ychange")),l+=c.content.str;break}case vt:case Nt:{a();const u={insert:c.content.getContent()[0]};if(s.size>0){const f={};u.attributes=f,s.forEach((d,g)=>{f[g]=d})}i.push(u);break}case J:we(c,t)&&(a(),Yt(s,c.content));break}c=c.right}a()},en),i}insert(t,e,r){if(e.length<=0)return;const i=this.doc;i!==null?O(i,s=>{const o=dn(s,this,t);r||(r={},o.currentAttributes.forEach((l,c)=>{r[c]=l})),yr(s,this,o,e,r)}):this._pending.push(()=>this.insert(t,e,r))}insertEmbed(t,e,r={}){const i=this.doc;i!==null?O(i,s=>{const o=dn(s,this,t);yr(s,this,o,e,r)}):this._pending.push(()=>this.insertEmbed(t,e,r))}delete(t,e){if(e===0)return;const r=this.doc;r!==null?O(r,i=>{ss(i,dn(i,this,t),e)}):this._pending.push(()=>this.delete(t,e))}format(t,e,r){if(e===0)return;const i=this.doc;i!==null?O(i,s=>{const o=dn(s,this,t);o.right!==null&&rs(s,this,o,e,r)}):this._pending.push(()=>this.format(t,e,r))}removeAttribute(t){this.doc!==null?O(this.doc,e=>{un(e,this,t)}):this._pending.push(()=>this.removeAttribute(t))}setAttribute(t,e){this.doc!==null?O(this.doc,r=>{dr(r,this,t,e)}):this._pending.push(()=>this.setAttribute(t,e))}getAttribute(t){return gr(this,t)}getAttributes(t){return qi(this)}_write(t){t.writeTypeRef(yc)}}const Zl=n=>new Gt;class vr{constructor(t,e=()=>!0){this._filter=e,this._root=t,this._currentNode=t._start,this._firstCall=!0}[Symbol.iterator](){return this}next(){let t=this._currentNode,e=t&&t.content&&t.content.type;if(t!==null&&(!this._firstCall||t.deleted||!this._filter(e)))do if(e=t.content.type,!t.deleted&&(e.constructor===Se||e.constructor===Lt)&&e._start!==null)t=e._start;else for(;t!==null;)if(t.right!==null){t=t.right;break}else t.parent===this._root?t=null:t=t.parent._item;while(t!==null&&(t.deleted||!this._filter(t.content.type)));return this._firstCall=!1,t===null?{value:void 0,done:!0}:(this._currentNode=t,{value:t.content.type,done:!1})}}class Lt extends G{constructor(){super();this._prelimContent=[]}get firstChild(){const t=this._first;return t?t.content.getContent()[0]:null}_integrate(t,e){super._integrate(t,e),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Lt}clone(){const t=new Lt;return t.insert(0,this.toArray().map(e=>e instanceof G?e.clone():e)),t}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(t){return new vr(this,t)}querySelector(t){t=t.toUpperCase();const r=new vr(this,i=>i.nodeName&&i.nodeName.toUpperCase()===t).next();return r.done?null:r.value}querySelectorAll(t){return t=t.toUpperCase(),Array.from(new vr(this,e=>e.nodeName&&e.nodeName.toUpperCase()===t))}_callObserver(t,e){an(this,t,new ec(this,e,t))}toString(){return Yi(this,t=>t.toString()).join("")}toJSON(){return this.toString()}toDOM(t=document,e={},r){const i=t.createDocumentFragment();return r!==void 0&&r._createAssociation(i,this),hn(this,s=>{i.insertBefore(s.toDOM(t,e,r),null)}),i}insert(t,e){this.doc!==null?O(this.doc,r=>{Xi(r,this,t,e)}):this._prelimContent.splice(t,0,...e)}insertAfter(t,e){if(this.doc!==null)O(this.doc,r=>{const i=t&&t instanceof G?t._item:t;fr(r,this,i,e)});else{const r=this._prelimContent,i=t===null?0:r.findIndex(s=>s===t)+1;if(i===0&&t!==null)throw qe("Reference item not found");r.splice(i,0,...e)}}delete(t,e=1){this.doc!==null?O(this.doc,r=>{Ki(r,this,t,e)}):this._prelimContent.splice(t,e)}toArray(){return zi(this)}push(t){this.insert(this.length,t)}unshift(t){this.insert(0,t)}get(t){return Gi(this,t)}slice(t=0,e=this.length){return Ji(this,t,e)}_write(t){t.writeTypeRef(wc)}}const Ql=n=>new Lt;class Se extends Lt{constructor(t="UNDEFINED"){super();this.nodeName=t,this._prelimAttrs=new Map}get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_integrate(t,e){super._integrate(t,e),this._prelimAttrs.forEach((r,i)=>{this.setAttribute(i,r)}),this._prelimAttrs=null}_copy(){return new Se(this.nodeName)}clone(){const t=new Se(this.nodeName),e=this.getAttributes();for(const r in e)t.setAttribute(r,e[r]);return t.insert(0,this.toArray().map(r=>r instanceof G?r.clone():r)),t}toString(){const t=this.getAttributes(),e=[],r=[];for(const l in t)r.push(l);r.sort();const i=r.length;for(let l=0;l<i;l++){const c=r[l];e.push(c+'="'+t[c]+'"')}const s=this.nodeName.toLocaleLowerCase(),o=e.length>0?" "+e.join(" "):"";return`<${s}${o}>${super.toString()}</${s}>`}removeAttribute(t){this.doc!==null?O(this.doc,e=>{un(e,this,t)}):this._prelimAttrs.delete(t)}setAttribute(t,e){this.doc!==null?O(this.doc,r=>{dr(r,this,t,e)}):this._prelimAttrs.set(t,e)}getAttribute(t){return gr(this,t)}hasAttribute(t){return Zi(this,t)}getAttributes(t){return qi(this)}toDOM(t=document,e={},r){const i=t.createElement(this.nodeName),s=this.getAttributes();for(const o in s)i.setAttribute(o,s[o]);return hn(this,o=>{i.appendChild(o.toDOM(t,e,r))}),r!==void 0&&r._createAssociation(i,this),i}_write(t){t.writeTypeRef(vc),t.writeKey(this.nodeName)}}const tc=n=>new Se(n.readKey());class ec extends ln{constructor(t,e,r){super(t,r);this.childListChanged=!1,this.attributesChanged=new Set,e.forEach(i=>{i===null?this.childListChanged=!0:this.attributesChanged.add(i)})}}class gn extends zt{constructor(t){super();this.hookName=t}_copy(){return new gn(this.hookName)}clone(){const t=new gn(this.hookName);return this.forEach((e,r)=>{t.set(r,e)}),t}toDOM(t=document,e={},r){const i=e[this.hookName];let s;return i!==void 0?s=i.createDom(this):s=document.createElement(this.hookName),s.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(s,this),s}_write(t){t.writeTypeRef(mc),t.writeKey(this.hookName)}}const nc=n=>new gn(n.readKey());class pn extends Gt{get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_copy(){return new pn}clone(){const t=new pn;return t.applyDelta(this.toDelta()),t}toDOM(t=document,e,r){const i=t.createTextNode(this.toString());return r!==void 0&&r._createAssociation(i,this),i}toString(){return this.toDelta().map(t=>{const e=[];for(const i in t.attributes){const s=[];for(const o in t.attributes[i])s.push({key:o,value:t.attributes[i][o]});s.sort((o,l)=>o.key<l.key?-1:1),e.push({nodeName:i,attrs:s})}e.sort((i,s)=>i.nodeName<s.nodeName?-1:1);let r="";for(let i=0;i<e.length;i++){const s=e[i];r+=`<${s.nodeName}`;for(let o=0;o<s.attrs.length;o++){const l=s.attrs[o];r+=` ${l.key}="${l.value}"`}r+=">"}r+=t.insert;for(let i=e.length-1;i>=0;i--)r+=`</${e[i].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(t){t.writeTypeRef(Sc)}}const rc=n=>new pn;class wr{constructor(t,e){this.id=t,this.length=e}get deleted(){throw at()}mergeWith(t){return!1}write(t,e,r){throw at()}integrate(t,e){throw at()}}const ic=0;class it extends wr{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,e){e>0&&(this.id.clock+=e,this.length-=e),Oi(t.doc.store,this)}write(t,e){t.writeInfo(ic),t.writeLen(this.length-e)}getMissing(t,e){return null}}class be{constructor(t){this.content=t}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new be(this.content)}splice(t){throw at()}mergeWith(t){return!1}integrate(t,e){}delete(t){}gc(t){}write(t,e){t.writeBuf(this.content)}getRef(){return 3}}const sc=n=>new be(n.readBuf());class _e{constructor(t){this.len=t}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new _e(this.len)}splice(t){const e=new _e(this.len-t);return this.len=t,e}mergeWith(t){return this.len+=t.len,!0}integrate(t,e){pe(t.deleteSet,e.id.client,e.id.clock,this.len),e.markDeleted()}delete(t){}gc(t){}write(t,e){t.writeLen(this.len-e)}getRef(){return 1}}const oc=n=>new _e(n.readLen());class ke{constructor(t){t._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=t;const e={};this.opts=e,t.gc||(e.gc=!1),t.autoLoad&&(e.autoLoad=!0),t.meta!==null&&(e.meta=t.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new ke(this.doc)}splice(t){throw at()}mergeWith(t){return!1}integrate(t,e){this.doc._item=e,t.subdocsAdded.add(this.doc),this.doc.shouldLoad&&t.subdocsLoaded.add(this.doc)}delete(t){t.subdocsAdded.has(this.doc)?t.subdocsAdded.delete(this.doc):t.subdocsRemoved.add(this.doc)}gc(t){}write(t,e){t.writeString(this.doc.guid),t.writeAny(this.opts)}getRef(){return 9}}const lc=n=>new ke(new ye(He({guid:n.readString()},n.readAny())));class Nt{constructor(t){this.embed=t}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new Nt(this.embed)}splice(t){throw at()}mergeWith(t){return!1}integrate(t,e){}delete(t){}gc(t){}write(t,e){t.writeJSON(this.embed)}getRef(){return 5}}const cc=n=>new Nt(n.readJSON());class J{constructor(t,e){this.key=t,this.value=e}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new J(this.key,this.value)}splice(t){throw at()}mergeWith(t){return!1}integrate(t,e){e.parent._searchMarker=null}delete(t){}gc(t){}write(t,e){t.writeKey(this.key),t.writeJSON(this.value)}getRef(){return 6}}const ac=n=>new J(n.readString(),n.readJSON());class yn{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new yn(this.arr)}splice(t){const e=new yn(this.arr.slice(t));return this.arr=this.arr.slice(0,t),e}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,e){}delete(t){}gc(t){}write(t,e){const r=this.arr.length;t.writeLen(r-e);for(let i=e;i<r;i++){const s=this.arr[i];t.writeString(s===void 0?"undefined":JSON.stringify(s))}}getRef(){return 2}}const hc=n=>{const t=n.readLen(),e=[];for(let r=0;r<t;r++){const i=n.readString();i==="undefined"?e.push(void 0):e.push(JSON.parse(i))}return new yn(e)};class $t{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new $t(this.arr)}splice(t){const e=new $t(this.arr.slice(t));return this.arr=this.arr.slice(0,t),e}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,e){}delete(t){}gc(t){}write(t,e){const r=this.arr.length;t.writeLen(r-e);for(let i=e;i<r;i++){const s=this.arr[i];t.writeAny(s)}}getRef(){return 8}}const uc=n=>{const t=n.readLen(),e=[];for(let r=0;r<t;r++)e.push(n.readAny());return new $t(e)};class ft{constructor(t){this.str=t}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new ft(this.str)}splice(t){const e=new ft(this.str.slice(t));this.str=this.str.slice(0,t);const r=this.str.charCodeAt(t-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,t-1)+"\uFFFD",e.str="\uFFFD"+e.str.slice(1)),e}mergeWith(t){return this.str+=t.str,!0}integrate(t,e){}delete(t){}gc(t){}write(t,e){t.writeString(e===0?this.str:this.str.slice(e))}getRef(){return 4}}const fc=n=>new ft(n.readString()),dc=[Yl,Wl,Zl,tc,Ql,nc,rc],gc=0,pc=1,yc=2,vc=3,wc=4,mc=5,Sc=6;class vt{constructor(t){this.type=t}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new vt(this.type._copy())}splice(t){throw at()}mergeWith(t){return!1}integrate(t,e){this.type._integrate(t.doc,e)}delete(t){let e=this.type._start;for(;e!==null;)e.deleted?t._mergeStructs.push(e):e.delete(t),e=e.right;this.type._map.forEach(r=>{r.deleted?t._mergeStructs.push(r):r.delete(t)}),t.changed.delete(this.type)}gc(t){let e=this.type._start;for(;e!==null;)e.gc(t,!0),e=e.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(t,!0),r=r.left}),this.type._map=new Map}write(t,e){this.type._write(t)}getRef(){return 7}}const bc=n=>new vt(dc[n.readTypeRef()](n)),_c=(n,t)=>{let e=t,r=0,i;do r>0&&(e=k(e.client,e.clock+r)),i=rn(n,e),r=e.clock-i.id.clock,e=i.redone;while(e!==null&&i instanceof M);return{item:i,diff:r}},mr=(n,t)=>{for(;n!==null&&n.keep!==t;)n.keep=t,n=n.parent._item},vn=(n,t,e)=>{const{client:r,clock:i}=t.id,s=new M(k(r,i+e),t,k(r,i+e-1),t.right,t.rightOrigin,t.parent,t.parentSub,t.content.splice(e));return t.deleted&&s.markDeleted(),t.keep&&(s.keep=!0),t.redone!==null&&(s.redone=k(t.redone.client,t.redone.clock+e)),t.right=s,s.right!==null&&(s.right.left=s),n._mergeStructs.push(s),s.parentSub!==null&&s.right===null&&s.parent._map.set(s.parentSub,s),t.length=e,s},os=(n,t,e,r)=>{const i=n.doc,s=i.store,o=i.clientID,l=t.redone;if(l!==null)return nt(n,l);let c=t.parent._item,a,h;if(t.parentSub===null)a=t.left,h=t;else{for(a=t;a.right!==null;)if(a=a.right,a.id.client!==o)return null;a.right!==null&&(a=t.parent._map.get(t.parentSub)),h=null}if(c!==null&&c.deleted===!0&&c.redone===null&&(!e.has(c)||os(n,c,e,r)===null))return null;if(c!==null&&c.redone!==null){for(;c.redone!==null;)c=nt(n,c.redone);for(;a!==null;){let g=a;for(;g!==null&&g.parent._item!==c;)g=g.redone===null?null:nt(n,g.redone);if(g!==null&&g.parent._item===c){a=g;break}a=a.left}for(;h!==null;){let g=h;for(;g!==null&&g.parent._item!==c;)g=g.redone===null?null:nt(n,g.redone);if(g!==null&&g.parent._item===c){h=g;break}h=h.right}for(;a!==null&&a.right!==null&&a.right!==h&&r.findIndex(g=>g===a.right)>=0;)a=a.right}const u=P(s,o),f=k(o,u),d=new M(f,a,a&&a.lastId,h,h&&h.id,c===null?t.parent:c.content.type,t.parentSub,t.content.copy());return t.redone=f,mr(d,!0),d.integrate(n,0),d};class M extends wr{constructor(t,e,r,i,s,o,l,c){super(t,c.getLength());this.origin=r,this.left=e,this.right=i,this.rightOrigin=s,this.parent=o,this.parentSub=l,this.redone=null,this.content=c,this.info=this.content.isCountable()?ri:0}set marker(t){(this.info&Bn)>0!==t&&(this.info^=Bn)}get marker(){return(this.info&Bn)>0}get keep(){return(this.info&ni)>0}set keep(t){this.keep!==t&&(this.info^=ni)}get countable(){return(this.info&ri)>0}get deleted(){return(this.info&Rn)>0}set deleted(t){this.deleted!==t&&(this.info^=Rn)}markDeleted(){this.info|=Rn}getMissing(t,e){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=P(e,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=P(e,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===Pt&&this.id.client!==this.parent.client&&this.parent.clock>=P(e,this.parent.client))return this.parent.client;if(this.origin&&(this.left=Mi(t,e,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=nt(t,this.rightOrigin),this.rightOrigin=this.right.id),(this.left&&this.left.constructor===it||this.right&&this.right.constructor===it)&&(this.parent=null),!this.parent)this.left&&this.left.constructor===M&&(this.parent=this.left.parent,this.parentSub=this.left.parentSub),this.right&&this.right.constructor===M&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===Pt){const r=rn(e,this.parent);r.constructor===it?this.parent=null:this.parent=r.content.type}return null}integrate(t,e){if(e>0&&(this.id.clock+=e,this.left=Mi(t,t.doc.store,k(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(e),this.length-=e),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,i;if(r!==null)i=r.right;else if(this.parentSub!==null)for(i=this.parent._map.get(this.parentSub)||null;i!==null&&i.left!==null;)i=i.left;else i=this.parent._start;const s=new Set,o=new Set;for(;i!==null&&i!==this.right;){if(o.add(i),s.add(i),Qe(this.origin,i.origin)){if(i.id.client<this.id.client)r=i,s.clear();else if(Qe(this.rightOrigin,i.rightOrigin))break}else if(i.origin!==null&&o.has(rn(t.doc.store,i.origin)))s.has(rn(t.doc.store,i.origin))||(r=i,s.clear());else break;i=i.right}this.left=r}if(this.left!==null){const r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(t)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),Oi(t.doc.store,this),this.content.integrate(t,this),Bi(t,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(t)}else new it(this.id,this.length).integrate(t,0)}get next(){let t=this.right;for(;t!==null&&t.deleted;)t=t.right;return t}get prev(){let t=this.left;for(;t!==null&&t.deleted;)t=t.left;return t}get lastId(){return this.length===1?this.id:k(this.id.client,this.id.clock+this.length-1)}mergeWith(t){if(this.constructor===t.constructor&&Qe(t.origin,this.lastId)&&this.right===t&&Qe(this.rightOrigin,t.rightOrigin)&&this.id.client===t.id.client&&this.id.clock+this.length===t.id.clock&&this.deleted===t.deleted&&this.redone===null&&t.redone===null&&this.content.constructor===t.content.constructor&&this.content.mergeWith(t.content)){const e=this.parent._searchMarker;return e&&e.forEach(r=>{r.p===t&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),t.keep&&(this.keep=!0),this.right=t.right,this.right!==null&&(this.right.left=this),this.length+=t.length,!0}return!1}delete(t){if(!this.deleted){const e=this.parent;this.countable&&this.parentSub===null&&(e._length-=this.length),this.markDeleted(),pe(t.deleteSet,this.id.client,this.id.clock,this.length),Bi(t,e,this.parentSub),this.content.delete(t)}}gc(t,e){if(!this.deleted)throw ht();this.content.gc(t),e?Il(t,this,new it(this.id,this.length)):this.content=new _e(this.length)}write(t,e){const r=e>0?k(this.id.client,this.id.clock+e-1):this.origin,i=this.rightOrigin,s=this.parentSub,o=this.content.getRef()&Ye|(r===null?0:et)|(i===null?0:gt)|(s===null?0:he);if(t.writeInfo(o),r!==null&&t.writeLeftID(r),i!==null&&t.writeRightID(i),r===null&&i===null){const l=this.parent;if(l._item!==void 0){const c=l._item;if(c===null){const a=Al(l);t.writeParentInfo(!0),t.writeString(a)}else t.writeParentInfo(!1),t.writeLeftID(c.id)}else l.constructor===String?(t.writeParentInfo(!0),t.writeString(l)):l.constructor===Pt?(t.writeParentInfo(!1),t.writeLeftID(l)):ht();s!==null&&t.writeString(s)}this.content.write(t,e)}}const ls=(n,t)=>kc[t&Ye](n),kc=[()=>{ht()},oc,hc,sc,fc,cc,ac,bc,uc,lc,()=>{ht()}],Ec=10;class st extends wr{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,e){ht()}write(t,e){t.writeInfo(Ec),m(t.restEncoder,this.length-e)}getMissing(t,e){return null}}const cs=typeof window!="undefined"?window:typeof global!="undefined"?global:{},as="__ $YJS$ __";cs[as]===!0&&console.warn("Yjs was already imported. Importing different versions of Yjs often leads to issues.");cs[as]=!0;const Ac=new Map;class xc{constructor(t){this.room=t,this.onmessage=null,yo(e=>e.key===t&&this.onmessage!==null&&this.onmessage({data:Mo(e.newValue||"")}))}postMessage(t){ti.setItem(this.room,Oo(Io(t)))}}const Dc=typeof BroadcastChannel=="undefined"?xc:BroadcastChannel,Sr=n=>dt(Ac,n,()=>{const t=new Set,e=new Dc(n);return e.onmessage=r=>t.forEach(i=>i(r.data)),{bc:e,subs:t}}),Cc=(n,t)=>Sr(n).subs.add(t),Ic=(n,t)=>Sr(n).subs.delete(t),Wt=(n,t)=>{const e=Sr(n);e.bc.postMessage(t),e.subs.forEach(r=>r(t))},hs=0,br=1,us=2,_r=(n,t)=>{m(n,hs);const e=kl(t);V(n,e)},fs=(n,t,e)=>{m(n,br),V(n,ml(t,e))},Tc=(n,t,e)=>fs(t,e,q(n)),ds=(n,t,e)=>{try{yl(t,q(n),e)}catch(r){console.error("Caught error while handling a Yjs update",r)}},Lc=(n,t)=>{m(n,us),V(n,t)},Nc=ds,$c=(n,t,e,r)=>{const i=b(n);switch(i){case hs:Tc(n,t,e);break;case br:ds(n,e,r);break;case us:Nc(n,e,r);break;default:throw new Error("Unknown message type")}return i},Oc=0,Mc=(n,t,e)=>{switch(b(n)){case Oc:e(t,St(n))}},kr=3e4;class Uc extends Je{constructor(t){super();this.doc=t,this.clientID=t.clientID,this.states=new Map,this.meta=new Map,this._checkInterval=setInterval(()=>{const e=bt();this.getLocalState()!==null&&kr/2<=e-this.meta.get(this.clientID).lastUpdated&&this.setLocalState(this.getLocalState());const r=[];this.meta.forEach((i,s)=>{s!==this.clientID&&kr<=e-i.lastUpdated&&this.states.has(s)&&r.push(s)}),r.length>0&&Er(this,r,"timeout")},ae(kr/10)),t.on("destroy",()=>{this.destroy()}),this.setLocalState({})}destroy(){this.emit("destroy",[this]),this.setLocalState(null),super.destroy(),clearInterval(this._checkInterval)}getLocalState(){return this.states.get(this.clientID)||null}setLocalState(t){const e=this.clientID,r=this.meta.get(e),i=r===void 0?0:r.clock+1,s=this.states.get(e);t===null?this.states.delete(e):this.states.set(e,t),this.meta.set(e,{clock:i,lastUpdated:bt()});const o=[],l=[],c=[],a=[];t===null?a.push(e):s==null?t!=null&&o.push(e):(l.push(e),ge(s,t)||c.push(e)),(o.length>0||c.length>0||a.length>0)&&this.emit("change",[{added:o,updated:c,removed:a},"local"]),this.emit("update",[{added:o,updated:l,removed:a},"local"])}setLocalStateField(t,e){const r=this.getLocalState();r!==null&&this.setLocalState(Gr(He({},r),{[t]:e}))}getStates(){return this.states}}const Er=(n,t,e)=>{const r=[];for(let i=0;i<t.length;i++){const s=t[i];if(n.states.has(s)){if(n.states.delete(s),s===n.clientID){const o=n.meta.get(s);n.meta.set(s,{clock:o.clock+1,lastUpdated:bt()})}r.push(s)}}r.length>0&&(n.emit("change",[{added:[],updated:[],removed:r},e]),n.emit("update",[{added:[],updated:[],removed:r},e]))},Ee=(n,t,e=n.states)=>{const r=t.length,i=X();m(i,r);for(let s=0;s<r;s++){const o=t[s],l=e.get(o)||null,c=n.meta.get(o).clock;m(i,o),m(i,c),Dt(i,JSON.stringify(l))}return R(i)},Rc=(n,t,e)=>{const r=mt(t),i=bt(),s=[],o=[],l=[],c=[],a=b(r);for(let h=0;h<a;h++){const u=b(r);let f=b(r);const d=JSON.parse(St(r)),g=n.meta.get(u),p=n.states.get(u),v=g===void 0?0:g.clock;(v<f||v===f&&d===null&&n.states.has(u))&&(d===null?u===n.clientID&&n.getLocalState()!=null?f++:n.states.delete(u):n.states.set(u,d),n.meta.set(u,{clock:f,lastUpdated:i}),g===void 0&&d!==null?s.push(u):g!==void 0&&d===null?c.push(u):d!==null&&(ge(d,p)||l.push(u),o.push(u)))}(s.length>0||l.length>0||c.length>0)&&n.emit("change",[{added:s,updated:l,removed:c},e]),(s.length>0||o.length>0||c.length>0)&&n.emit("update",[{added:s,updated:o,removed:c},e])},Bc=()=>{let n=!0;return(t,e)=>{if(n){n=!1;try{t()}finally{n=!0}}else e!==void 0&&e()}},Fc=n=>Wo(n,(t,e)=>`${encodeURIComponent(e)}=${encodeURIComponent(t)}`).join("&"),Ot=0,gs=3,Xt=1,jc=2,Ae=[];Ae[Ot]=(n,t,e,r,i)=>{m(n,Ot);const s=$c(t,n,e.doc,e);r&&s===br&&!e.synced&&(e.synced=!0)};Ae[gs]=(n,t,e,r,i)=>{m(n,Xt),V(n,Ee(e.awareness,Array.from(e.awareness.getStates().keys())))};Ae[Xt]=(n,t,e,r,i)=>{Rc(e.awareness,q(t),e)};Ae[jc]=(n,t,e,r,i)=>{Mc(t,e.doc,Pc)};const Vc=1200,Hc=2500,ps=3e4,Pc=(n,t)=>console.warn(`Permission denied to access ${n.url}.
${t}`),ys=(n,t,e)=>{const r=mt(t),i=X(),s=b(r),o=n.messageHandlers[s];return o?o(i,r,n,e,s):console.error("Unable to compute message"),i},vs=n=>{if(n.shouldConnect&&n.ws===null){const t=new n._WS(n.url);t.binaryType="arraybuffer",n.ws=t,n.wsconnecting=!0,n.wsconnected=!1,n.synced=!1,t.onmessage=e=>{n.wsLastMessageReceived=bt();const r=ys(n,new Uint8Array(e.data),!0);Jn(r)>1&&t.send(R(r))},t.onclose=()=>{n.ws=null,n.wsconnecting=!1,n.wsconnected?(n.wsconnected=!1,n.synced=!1,Er(n.awareness,Array.from(n.awareness.getStates().keys()).filter(e=>e!==n.doc.clientID),n),n.emit("status",[{status:"disconnected"}])):n.wsUnsuccessfulReconnects++,setTimeout(vs,Mn(co(n.wsUnsuccessfulReconnects+1)*Vc,Hc),n)},t.onopen=()=>{n.wsLastMessageReceived=bt(),n.wsconnecting=!1,n.wsconnected=!0,n.wsUnsuccessfulReconnects=0,n.emit("status",[{status:"connected"}]);const e=X();if(m(e,Ot),_r(e,n.doc),t.send(R(e)),n.awareness.getLocalState()!==null){const r=X();m(r,Xt),V(r,Ee(n.awareness,[n.doc.clientID])),t.send(R(r))}},n.emit("status",[{status:"connecting"}])}},Ar=(n,t)=>{n.wsconnected&&n.ws.send(t),n.bcconnected&&n.mux(()=>{Wt(n.bcChannel,t)})};class Qa extends Je{constructor(t,e,r,{connect:i=!0,awareness:s=new Uc(r),params:o={},WebSocketPolyfill:l=WebSocket,resyncInterval:c=-1}={}){super();for(;t[t.length-1]==="/";)t=t.slice(0,t.length-1);const a=Fc(o);this.bcChannel=t+"/"+e,this.url=t+"/"+e+(a.length===0?"":"?"+a),this.roomname=e,this.doc=r,this._WS=l,this.awareness=s,this.wsconnected=!1,this.wsconnecting=!1,this.bcconnected=!1,this.wsUnsuccessfulReconnects=0,this.messageHandlers=Ae.slice(),this.mux=Bc(),this._synced=!1,this.ws=null,this.wsLastMessageReceived=0,this.shouldConnect=i,this._resyncInterval=0,c>0&&(this._resyncInterval=setInterval(()=>{if(this.ws){const h=X();m(h,Ot),_r(h,r),this.ws.send(R(h))}},c)),this._bcSubscriber=h=>{this.mux(()=>{const u=ys(this,new Uint8Array(h),!1);Jn(u)>1&&Wt(this.bcChannel,R(u))})},this._updateHandler=(h,u)=>{if(u!==this){const f=X();m(f,Ot),Lc(f,h),Ar(this,R(f))}},this.doc.on("update",this._updateHandler),this._awarenessUpdateHandler=({added:h,updated:u,removed:f},d)=>{const g=h.concat(u).concat(f),p=X();m(p,Xt),V(p,Ee(s,g)),Ar(this,R(p))},this._beforeUnloadHandler=()=>{Er(this.awareness,[r.clientID],"window unload")},typeof window!="undefined"?window.addEventListener("beforeunload",this._beforeUnloadHandler):typeof process!="undefined"&&process.on("exit",()=>this._beforeUnloadHandler),s.on("update",this._awarenessUpdateHandler),this._checkInterval=setInterval(()=>{this.wsconnected&&ps<bt()-this.wsLastMessageReceived&&this.ws.close()},ps/10),i&&this.connect()}get synced(){return this._synced}set synced(t){this._synced!==t&&(this._synced=t,this.emit("synced",[t]),this.emit("sync",[t]))}destroy(){this._resyncInterval!==0&&clearInterval(this._resyncInterval),clearInterval(this._checkInterval),this.disconnect(),typeof window!="undefined"?window.removeEventListener("beforeunload",this._beforeUnloadHandler):typeof process!="undefined"&&process.off("exit",()=>this._beforeUnloadHandler),this.awareness.off("update",this._awarenessUpdateHandler),this.doc.off("update",this._updateHandler),super.destroy()}connectBc(){this.bcconnected||(Cc(this.bcChannel,this._bcSubscriber),this.bcconnected=!0),this.mux(()=>{const t=X();m(t,Ot),_r(t,this.doc),Wt(this.bcChannel,R(t));const e=X();m(e,Ot),fs(e,this.doc),Wt(this.bcChannel,R(e));const r=X();m(r,gs),Wt(this.bcChannel,R(r));const i=X();m(i,Xt),V(i,Ee(this.awareness,[this.doc.clientID])),Wt(this.bcChannel,R(i))})}disconnectBc(){const t=X();m(t,Xt),V(t,Ee(this.awareness,[this.doc.clientID],new Map)),Ar(this,R(t)),this.bcconnected&&(Ic(this.bcChannel,this._bcSubscriber),this.bcconnected=!1)}disconnect(){this.shouldConnect=!1,this.disconnectBc(),this.ws!==null&&this.ws.close()}connect(){this.shouldConnect=!0,!this.wsconnected&&this.ws===null&&(vs(this),this.connectBc())}}const th=(n,t)=>{let e=0,r=0;for(;e<n.length&&e<t.length&&n[e]===t[e];)e++;if(e!==n.length||e!==t.length)for(;r+e<n.length&&r+e<t.length&&n[n.length-r-1]===t[t.length-r-1];)r++;return{index:e,remove:n.length-e-r,insert:t.slice(e,t.length-r)}};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */var xr;const Kt=globalThis.trustedTypes,ws=Kt?Kt.createPolicy("lit-html",{createHTML:n=>n}):void 0,Et=`lit$${(Math.random()+"").slice(9)}$`,ms="?"+Et,Jc=`<${ms}>`,qt=document,xe=(n="")=>qt.createComment(n),De=n=>n===null||typeof n!="object"&&typeof n!="function",Ss=Array.isArray,zc=n=>{var t;return Ss(n)||typeof((t=n)===null||t===void 0?void 0:t[Symbol.iterator])=="function"},Ce=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,bs=/-->/g,_s=/>/g,Mt=/>|[ 	\n\r](?:([^\s"'>=/]+)([ 	\n\r]*=[ 	\n\r]*(?:[^ 	\n\r"'`<>=]|("|')|))|$)/g,ks=/'/g,Es=/"/g,As=/^(?:script|style|textarea)$/i,Yc=n=>(t,...e)=>({_$litType$:n,strings:t,values:e}),eh=Yc(1),Zt=Symbol.for("lit-noChange"),z=Symbol.for("lit-nothing"),xs=new WeakMap,nh=(n,t,e)=>{var r,i;const s=(r=e==null?void 0:e.renderBefore)!==null&&r!==void 0?r:t;let o=s._$litPart$;if(o===void 0){const l=(i=e==null?void 0:e.renderBefore)!==null&&i!==void 0?i:null;s._$litPart$=o=new Te(t.insertBefore(xe(),l),l,void 0,e!=null?e:{})}return o._$AI(n),o},Qt=qt.createTreeWalker(qt,129,null,!1),Gc=(n,t)=>{const e=n.length-1,r=[];let i,s=t===2?"<svg>":"",o=Ce;for(let c=0;c<e;c++){const a=n[c];let h,u,f=-1,d=0;for(;d<a.length&&(o.lastIndex=d,u=o.exec(a),u!==null);)d=o.lastIndex,o===Ce?u[1]==="!--"?o=bs:u[1]!==void 0?o=_s:u[2]!==void 0?(As.test(u[2])&&(i=RegExp("</"+u[2],"g")),o=Mt):u[3]!==void 0&&(o=Mt):o===Mt?u[0]===">"?(o=i!=null?i:Ce,f=-1):u[1]===void 0?f=-2:(f=o.lastIndex-u[2].length,h=u[1],o=u[3]===void 0?Mt:u[3]==='"'?Es:ks):o===Es||o===ks?o=Mt:o===bs||o===_s?o=Ce:(o=Mt,i=void 0);const g=o===Mt&&n[c+1].startsWith("/>")?" ":"";s+=o===Ce?a+Jc:f>=0?(r.push(h),a.slice(0,f)+"$lit$"+a.slice(f)+Et+g):a+Et+(f===-2?(r.push(void 0),c):g)}const l=s+(n[e]||"<?>")+(t===2?"</svg>":"");return[ws!==void 0?ws.createHTML(l):l,r]};class Ie{constructor({strings:t,_$litType$:e},r){let i;this.parts=[];let s=0,o=0;const l=t.length-1,c=this.parts,[a,h]=Gc(t,e);if(this.el=Ie.createElement(a,r),Qt.currentNode=this.el.content,e===2){const u=this.el.content,f=u.firstChild;f.remove(),u.append(...f.childNodes)}for(;(i=Qt.nextNode())!==null&&c.length<l;){if(i.nodeType===1){if(i.hasAttributes()){const u=[];for(const f of i.getAttributeNames())if(f.endsWith("$lit$")||f.startsWith(Et)){const d=h[o++];if(u.push(f),d!==void 0){const g=i.getAttribute(d.toLowerCase()+"$lit$").split(Et),p=/([.?@])?(.*)/.exec(d);c.push({type:1,index:s,name:p[2],strings:g,ctor:p[1]==="."?Xc:p[1]==="?"?qc:p[1]==="@"?Zc:wn})}else c.push({type:6,index:s})}for(const f of u)i.removeAttribute(f)}if(As.test(i.tagName)){const u=i.textContent.split(Et),f=u.length-1;if(f>0){i.textContent=Kt?Kt.emptyScript:"";for(let d=0;d<f;d++)i.append(u[d],xe()),Qt.nextNode(),c.push({type:2,index:++s});i.append(u[f],xe())}}}else if(i.nodeType===8)if(i.data===ms)c.push({type:2,index:s});else{let u=-1;for(;(u=i.data.indexOf(Et,u+1))!==-1;)c.push({type:7,index:s}),u+=Et.length-1}s++}}static createElement(t,e){const r=qt.createElement("template");return r.innerHTML=t,r}}function te(n,t,e=n,r){var i,s,o,l;if(t===Zt)return t;let c=r!==void 0?(i=e._$Cl)===null||i===void 0?void 0:i[r]:e._$Cu;const a=De(t)?void 0:t._$litDirective$;return(c==null?void 0:c.constructor)!==a&&((s=c==null?void 0:c._$AO)===null||s===void 0||s.call(c,!1),a===void 0?c=void 0:(c=new a(n),c._$AT(n,e,r)),r!==void 0?((o=(l=e)._$Cl)!==null&&o!==void 0?o:l._$Cl=[])[r]=c:e._$Cu=c),c!==void 0&&(t=te(n,c._$AS(n,t.values),c,r)),t}class Wc{constructor(t,e){this.v=[],this._$AN=void 0,this._$AD=t,this._$AM=e}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}p(t){var e;const{el:{content:r},parts:i}=this._$AD,s=((e=t==null?void 0:t.creationScope)!==null&&e!==void 0?e:qt).importNode(r,!0);Qt.currentNode=s;let o=Qt.nextNode(),l=0,c=0,a=i[0];for(;a!==void 0;){if(l===a.index){let h;a.type===2?h=new Te(o,o.nextSibling,this,t):a.type===1?h=new a.ctor(o,a.name,a.strings,this,t):a.type===6&&(h=new Qc(o,this,t)),this.v.push(h),a=i[++c]}l!==(a==null?void 0:a.index)&&(o=Qt.nextNode(),l++)}return s}m(t){let e=0;for(const r of this.v)r!==void 0&&(r.strings!==void 0?(r._$AI(t,r,e),e+=r.strings.length-2):r._$AI(t[e])),e++}}class Te{constructor(t,e,r,i){var s;this.type=2,this._$AH=z,this._$AN=void 0,this._$AA=t,this._$AB=e,this._$AM=r,this.options=i,this._$Cg=(s=i==null?void 0:i.isConnected)===null||s===void 0||s}get _$AU(){var t,e;return(e=(t=this._$AM)===null||t===void 0?void 0:t._$AU)!==null&&e!==void 0?e:this._$Cg}get parentNode(){let t=this._$AA.parentNode;const e=this._$AM;return e!==void 0&&t.nodeType===11&&(t=e.parentNode),t}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(t,e=this){t=te(this,t,e),De(t)?t===z||t==null||t===""?(this._$AH!==z&&this._$AR(),this._$AH=z):t!==this._$AH&&t!==Zt&&this.$(t):t._$litType$!==void 0?this.T(t):t.nodeType!==void 0?this.S(t):zc(t)?this.M(t):this.$(t)}A(t,e=this._$AB){return this._$AA.parentNode.insertBefore(t,e)}S(t){this._$AH!==t&&(this._$AR(),this._$AH=this.A(t))}$(t){this._$AH!==z&&De(this._$AH)?this._$AA.nextSibling.data=t:this.S(qt.createTextNode(t)),this._$AH=t}T(t){var e;const{values:r,_$litType$:i}=t,s=typeof i=="number"?this._$AC(t):(i.el===void 0&&(i.el=Ie.createElement(i.h,this.options)),i);if(((e=this._$AH)===null||e===void 0?void 0:e._$AD)===s)this._$AH.m(r);else{const o=new Wc(s,this),l=o.p(this.options);o.m(r),this.S(l),this._$AH=o}}_$AC(t){let e=xs.get(t.strings);return e===void 0&&xs.set(t.strings,e=new Ie(t)),e}M(t){Ss(this._$AH)||(this._$AH=[],this._$AR());const e=this._$AH;let r,i=0;for(const s of t)i===e.length?e.push(r=new Te(this.A(xe()),this.A(xe()),this,this.options)):r=e[i],r._$AI(s),i++;i<e.length&&(this._$AR(r&&r._$AB.nextSibling,i),e.length=i)}_$AR(t=this._$AA.nextSibling,e){var r;for((r=this._$AP)===null||r===void 0||r.call(this,!1,!0,e);t&&t!==this._$AB;){const i=t.nextSibling;t.remove(),t=i}}setConnected(t){var e;this._$AM===void 0&&(this._$Cg=t,(e=this._$AP)===null||e===void 0||e.call(this,t))}}class wn{constructor(t,e,r,i,s){this.type=1,this._$AH=z,this._$AN=void 0,this.element=t,this.name=e,this._$AM=i,this.options=s,r.length>2||r[0]!==""||r[1]!==""?(this._$AH=Array(r.length-1).fill(new String),this.strings=r):this._$AH=z}get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}_$AI(t,e=this,r,i){const s=this.strings;let o=!1;if(s===void 0)t=te(this,t,e,0),o=!De(t)||t!==this._$AH&&t!==Zt,o&&(this._$AH=t);else{const l=t;let c,a;for(t=s[0],c=0;c<s.length-1;c++)a=te(this,l[r+c],e,c),a===Zt&&(a=this._$AH[c]),o||(o=!De(a)||a!==this._$AH[c]),a===z?t=z:t!==z&&(t+=(a!=null?a:"")+s[c+1]),this._$AH[c]=a}o&&!i&&this.k(t)}k(t){t===z?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,t!=null?t:"")}}class Xc extends wn{constructor(){super(...arguments),this.type=3}k(t){this.element[this.name]=t===z?void 0:t}}const Kc=Kt?Kt.emptyScript:"";class qc extends wn{constructor(){super(...arguments),this.type=4}k(t){t&&t!==z?this.element.setAttribute(this.name,Kc):this.element.removeAttribute(this.name)}}class Zc extends wn{constructor(t,e,r,i,s){super(t,e,r,i,s),this.type=5}_$AI(t,e=this){var r;if((t=(r=te(this,t,e,0))!==null&&r!==void 0?r:z)===Zt)return;const i=this._$AH,s=t===z&&i!==z||t.capture!==i.capture||t.once!==i.once||t.passive!==i.passive,o=t!==z&&(i===z||s);s&&this.element.removeEventListener(this.name,this,i),o&&this.element.addEventListener(this.name,this,t),this._$AH=t}handleEvent(t){var e,r;typeof this._$AH=="function"?this._$AH.call((r=(e=this.options)===null||e===void 0?void 0:e.host)!==null&&r!==void 0?r:this.element,t):this._$AH.handleEvent(t)}}class Qc{constructor(t,e,r){this.element=t,this.type=6,this._$AN=void 0,this._$AM=e,this.options=r}get _$AU(){return this._$AM._$AU}_$AI(t){te(this,t)}}const Ds=window.litHtmlPolyfillSupport;Ds==null||Ds(Ie,Te),((xr=globalThis.litHtmlVersions)!==null&&xr!==void 0?xr:globalThis.litHtmlVersions=[]).push("2.0.2");/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var y=function(){return y=Object.assign||function(t){for(var e,r=1,i=arguments.length;r<i;r++){e=arguments[r];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s])}return t},y.apply(this,arguments)};function Dr(n,t){var e={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.indexOf(r)<0&&(e[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(e[r[i]]=n[r[i]]);return e}function x(n){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&n[t],r=0;if(e)return e.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function T(n,t){var e=typeof Symbol=="function"&&n[Symbol.iterator];if(!e)return n;var r=e.call(n),i,s=[],o;try{for(;(t===void 0||t-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(l){o={error:l}}finally{try{i&&!i.done&&(e=r.return)&&e.call(r)}finally{if(o)throw o.error}}return s}function H(n,t,e){if(e||arguments.length===2)for(var r=0,i=t.length,s;r<i;r++)(s||!(r in t))&&(s||(s=Array.prototype.slice.call(t,0,r)),s[r]=t[r]);return n.concat(s||Array.prototype.slice.call(t))}var Cs=".",Is={},Cr="xstate.guard",ta="",Le=!0;function U(n){return Object.keys(n)}function Ir(n,t,e){e===void 0&&(e=Cs);var r=Ne(n,e),i=Ne(t,e);return D(i)?D(r)?i===r:!1:D(r)?r in i:U(r).every(function(s){return s in i?Ir(r[s],i[s]):!1})}function Ts(n){try{return D(n)||typeof n=="number"?"".concat(n):n.type}catch{throw new Error("Events must be strings or objects with a string event.type property.")}}function Tr(n,t){try{return ee(n)?n:n.toString().split(t)}catch{throw new Error("'".concat(n,"' is not a valid state path."))}}function ea(n){return typeof n=="object"&&"value"in n&&"context"in n&&"event"in n&&"_event"in n}function Ne(n,t){if(ea(n))return n.value;if(ee(n))return mn(n);if(typeof n!="string")return n;var e=Tr(n,t);return mn(e)}function mn(n){if(n.length===1)return n[0];for(var t={},e=t,r=0;r<n.length-1;r++)r===n.length-2?e[n[r]]=n[r+1]:(e[n[r]]={},e=e[n[r]]);return t}function $e(n,t){for(var e={},r=U(n),i=0;i<r.length;i++){var s=r[i];e[s]=t(n[s],s,n,i)}return e}function Ls(n,t,e){var r,i,s={};try{for(var o=x(U(n)),l=o.next();!l.done;l=o.next()){var c=l.value,a=n[c];!e(a)||(s[c]=t(a,c,n))}}catch(h){r={error:h}}finally{try{l&&!l.done&&(i=o.return)&&i.call(o)}finally{if(r)throw r.error}}return s}var na=function(n){return function(t){var e,r,i=t;try{for(var s=x(n),o=s.next();!o.done;o=s.next()){var l=o.value;i=i[l]}}catch(c){e={error:c}}finally{try{o&&!o.done&&(r=s.return)&&r.call(s)}finally{if(e)throw e.error}}return i}};function ra(n,t){return function(e){var r,i,s=e;try{for(var o=x(n),l=o.next();!l.done;l=o.next()){var c=l.value;s=s[t][c]}}catch(a){r={error:a}}finally{try{l&&!l.done&&(i=o.return)&&i.call(o)}finally{if(r)throw r.error}}return s}}function Sn(n){if(!n)return[[]];if(D(n))return[[n]];var t=B(U(n).map(function(e){var r=n[e];return typeof r!="string"&&(!r||!Object.keys(r).length)?[[e]]:Sn(n[e]).map(function(i){return[e].concat(i)})}));return t}function B(n){var t;return(t=[]).concat.apply(t,H([],T(n),!1))}function Ns(n){return ee(n)?n:[n]}function ot(n){return n===void 0?[]:Ns(n)}function bn(n,t,e){var r,i;if(L(n))return n(t,e.data);var s={};try{for(var o=x(Object.keys(n)),l=o.next();!l.done;l=o.next()){var c=l.value,a=n[c];L(a)?s[c]=a(t,e.data):s[c]=a}}catch(h){r={error:h}}finally{try{l&&!l.done&&(i=o.return)&&i.call(o)}finally{if(r)throw r.error}}return s}function ia(n){return/^(done|error)\./.test(n)}function $s(n){return!!(n instanceof Promise||n!==null&&(L(n)||typeof n=="object")&&L(n.then))}function sa(n){return n!==null&&typeof n=="object"&&"transition"in n&&typeof n.transition=="function"}function Os(n,t){var e,r,i=T([[],[]],2),s=i[0],o=i[1];try{for(var l=x(n),c=l.next();!c.done;c=l.next()){var a=c.value;t(a)?s.push(a):o.push(a)}}catch(h){e={error:h}}finally{try{c&&!c.done&&(r=l.return)&&r.call(l)}finally{if(e)throw e.error}}return[s,o]}function Ms(n,t){return $e(n.states,function(e,r){if(!!e){var i=(D(t)?void 0:t[r])||(e?e.current:void 0);if(!!i)return{current:i,states:Ms(e,i)}}})}function oa(n,t){return{current:t,states:Ms(n,t)}}function Us(n,t,e,r){var i=n&&e.reduce(function(s,o){var l,c,a=o.assignment,h={state:r,action:o,_event:t},u={};if(L(a))u=a(s,t.data,h);else try{for(var f=x(U(a)),d=f.next();!d.done;d=f.next()){var g=d.value,p=a[g];u[g]=L(p)?p(s,t.data,h):p}}catch(v){l={error:v}}finally{try{d&&!d.done&&(c=f.return)&&c.call(f)}finally{if(l)throw l.error}}return Object.assign({},s,u)},n);return i}var Oe=function(){};function ee(n){return Array.isArray(n)}function L(n){return typeof n=="function"}function D(n){return typeof n=="string"}function Rs(n,t){if(!!n)return D(n)?{type:Cr,name:n,predicate:t?t[n]:void 0}:L(n)?{type:Cr,name:n.name,predicate:n}:n}function la(n){try{return"subscribe"in n&&L(n.subscribe)}catch{return!1}}var ca=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function Ut(n){try{return"__xstatenode"in n}catch{return!1}}function aa(n){return!!n&&typeof n.send=="function"}function Lr(n,t){return D(n)||typeof n=="number"?y({type:n},t):n}function Z(n,t){if(!D(n)&&"$$type"in n&&n.$$type==="scxml")return n;var e=Lr(n);return y({name:e.type,data:e,$$type:"scxml",type:"external"},t)}function ne(n,t){var e=Ns(t).map(function(r){return typeof r=="undefined"||typeof r=="string"||Ut(r)?{target:r,event:n}:y(y({},r),{event:n})});return e}function ha(n){if(!(n===void 0||n===ta))return ot(n)}function Bs(n,t,e,r,i){var s=n.options.guards,o={state:i,cond:t,_event:r};if(t.type===Cr)return((s==null?void 0:s[t.name])||t.predicate)(e,r.data,o);var l=s[t.type];if(!l)throw new Error("Guard '".concat(t.type,"' is not implemented on machine '").concat(n.id,"'."));return l(e,r.data,o)}function Fs(n){return typeof n=="string"?{type:n}:n}function js(n,t,e){if(typeof n=="object")return n;var r=function(){};return{next:n,error:t||r,complete:e||r}}var N;(function(n){n.Start="xstate.start",n.Stop="xstate.stop",n.Raise="xstate.raise",n.Send="xstate.send",n.Cancel="xstate.cancel",n.NullEvent="",n.Assign="xstate.assign",n.After="xstate.after",n.DoneState="done.state",n.DoneInvoke="done.invoke",n.Log="xstate.log",n.Init="xstate.init",n.Invoke="xstate.invoke",n.ErrorExecution="error.execution",n.ErrorCommunication="error.communication",n.ErrorPlatform="error.platform",n.ErrorCustom="xstate.error",n.Update="xstate.update",n.Pure="xstate.pure",n.Choose="xstate.choose"})(N||(N={}));var Me;(function(n){n.Parent="#_parent",n.Internal="#_internal"})(Me||(Me={}));var Nr=N.Start,$r=N.Stop,_n=N.Raise,kn=N.Send,Vs=N.Cancel,ua=N.NullEvent,Or=N.Assign;N.After;N.DoneState;var Hs=N.Log,fa=N.Init,Mr=N.Invoke;N.ErrorExecution;var Ps=N.ErrorPlatform,da=N.ErrorCustom,Js=N.Update,ga=N.Choose,pa=N.Pure,En=Z({type:fa});function Ur(n,t){return t&&t[n]||void 0}function Ue(n,t){var e;if(D(n)||typeof n=="number"){var r=Ur(n,t);L(r)?e={type:n,exec:r}:r?e=r:e={type:n,exec:void 0}}else if(L(n))e={type:n.name||n.toString(),exec:n};else{var r=Ur(n.type,t);if(L(r))e=y(y({},n),{exec:r});else if(r){var i=r.type||n.type;e=y(y(y({},r),n),{type:i})}else e=n}return e}var An=function(n,t){if(!n)return[];var e=ee(n)?n:[n];return e.map(function(r){return Ue(r,t)})};function Rr(n){var t=Ue(n);return y(y({id:D(n)?n:t.id},t),{type:t.type})}function ya(n){return D(n)?{type:_n,event:n}:zs(n,{to:Me.Internal})}function va(n){return{type:_n,_event:Z(n.event)}}function zs(n,t){return{to:t?t.to:void 0,type:kn,event:L(n)?n:Lr(n),delay:t?t.delay:void 0,id:t&&t.id!==void 0?t.id:L(n)?n.name:Ts(n)}}function wa(n,t,e,r){var i={_event:e},s=Z(L(n.event)?n.event(t,e.data,i):n.event),o;if(D(n.delay)){var l=r&&r[n.delay];o=L(l)?l(t,e.data,i):l}else o=L(n.delay)?n.delay(t,e.data,i):n.delay;var c=L(n.to)?n.to(t,e.data,i):n.to;return y(y({},n),{to:c,_event:s,event:s.data,delay:o})}var ma=function(n,t,e){return y(y({},n),{value:D(n.expr)?n.expr:n.expr(t,e.data,{_event:e})})},Sa=function(n){return{type:Vs,sendId:n}};function ba(n){var t=Rr(n);return{type:N.Start,activity:t,exec:void 0}}function _a(n){var t=L(n)?n:Rr(n);return{type:N.Stop,activity:t,exec:void 0}}function ka(n,t,e){var r=L(n.activity)?n.activity(t,e.data):n.activity,i=typeof r=="string"?{id:r}:r,s={type:N.Stop,activity:i};return s}var rh=function(n){return{type:Or,assignment:n}};function Ea(n,t){var e=t?"#".concat(t):"";return"".concat(N.After,"(").concat(n,")").concat(e)}function xn(n,t){var e="".concat(N.DoneState,".").concat(n),r={type:e,data:t};return r.toString=function(){return e},r}function Dn(n,t){var e="".concat(N.DoneInvoke,".").concat(n),r={type:e,data:t};return r.toString=function(){return e},r}function Re(n,t){var e="".concat(N.ErrorPlatform,".").concat(n),r={type:e,data:t};return r.toString=function(){return e},r}function Br(n,t,e,r,i,s){s===void 0&&(s=!1);var o=T(s?[[],i]:Os(i,function(f){return f.type===Or}),2),l=o[0],c=o[1],a=l.length?Us(e,r,l,t):e,h=s?[e]:void 0,u=B(c.map(function(f){var d;switch(f.type){case _n:return va(f);case kn:var g=wa(f,a,r,n.options.delays);return g;case Hs:return ma(f,a,r);case ga:{var p=f,v=(d=p.conds.find(function(F){var W=Rs(F.cond,n.options.guards);return!W||Bs(n,W,a,r,t)}))===null||d===void 0?void 0:d.actions;if(!v)return[];var A=T(Br(n,t,a,r,An(ot(v),n.options.actions),s),2),w=A[0],E=A[1];return a=E,h==null||h.push(a),w}case pa:{var v=f.get(a,r.data);if(!v)return[];var $=T(Br(n,t,a,r,An(ot(v),n.options.actions),s),2),I=$[0],j=$[1];return a=j,h==null||h.push(a),I}case $r:return ka(f,a,r);case Or:{a=Us(a,r,[f],t),h==null||h.push(a);break}default:var _=Ue(f,n.options.actions),S=_.exec;if(S&&h){var C=h.length-1;_=y(y({},_),{exec:function(F){for(var W=[],K=1;K<arguments.length;K++)W[K-1]=arguments[K];S.apply(void 0,H([h[C]],T(W),!1))}})}return _}}).filter(function(f){return!!f}));return[u,a]}var Cn=function(n){return n.type==="atomic"||n.type==="final"};function re(n){return U(n.states).map(function(t){return n.states[t]})}function Ys(n){var t=[n];return Cn(n)?t:t.concat(B(re(n).map(Ys)))}function ie(n,t){var e,r,i,s,o,l,c,a,h=new Set(n),u=Fr(h),f=new Set(t);try{for(var d=x(f),g=d.next();!g.done;g=d.next())for(var p=g.value,v=p.parent;v&&!f.has(v);)f.add(v),v=v.parent}catch(C){e={error:C}}finally{try{g&&!g.done&&(r=d.return)&&r.call(d)}finally{if(e)throw e.error}}var A=Fr(f);try{for(var w=x(f),E=w.next();!E.done;E=w.next()){var p=E.value;if(p.type==="compound"&&(!A.get(p)||!A.get(p).length))u.get(p)?u.get(p).forEach(function(F){return f.add(F)}):p.initialStateNodes.forEach(function(F){return f.add(F)});else if(p.type==="parallel")try{for(var $=(o=void 0,x(re(p))),I=$.next();!I.done;I=$.next()){var j=I.value;j.type!=="history"&&(f.has(j)||(f.add(j),u.get(j)?u.get(j).forEach(function(F){return f.add(F)}):j.initialStateNodes.forEach(function(F){return f.add(F)})))}}catch(F){o={error:F}}finally{try{I&&!I.done&&(l=$.return)&&l.call($)}finally{if(o)throw o.error}}}}catch(C){i={error:C}}finally{try{E&&!E.done&&(s=w.return)&&s.call(w)}finally{if(i)throw i.error}}try{for(var _=x(f),S=_.next();!S.done;S=_.next())for(var p=S.value,v=p.parent;v&&!f.has(v);)f.add(v),v=v.parent}catch(C){c={error:C}}finally{try{S&&!S.done&&(a=_.return)&&a.call(_)}finally{if(c)throw c.error}}return f}function Gs(n,t){var e=t.get(n);if(!e)return{};if(n.type==="compound"){var r=e[0];if(r){if(Cn(r))return r.key}else return{}}var i={};return e.forEach(function(s){i[s.key]=Gs(s,t)}),i}function Fr(n){var t,e,r=new Map;try{for(var i=x(n),s=i.next();!s.done;s=i.next()){var o=s.value;r.has(o)||r.set(o,[]),o.parent&&(r.has(o.parent)||r.set(o.parent,[]),r.get(o.parent).push(o))}}catch(l){t={error:l}}finally{try{s&&!s.done&&(e=i.return)&&e.call(i)}finally{if(t)throw t.error}}return r}function Aa(n,t){var e=ie([n],t);return Gs(n,Fr(e))}function In(n,t){return Array.isArray(n)?n.some(function(e){return e===t}):n instanceof Set?n.has(t):!1}function xa(n){return H([],T(new Set(B(H([],T(n.map(function(t){return t.ownEvents})),!1)))),!1)}function Be(n,t){return t.type==="compound"?re(t).some(function(e){return e.type==="final"&&In(n,e)}):t.type==="parallel"?re(t).every(function(e){return Be(n,e)}):!1}function Da(n){return n===void 0&&(n=[]),n.reduce(function(t,e){return e.meta!==void 0&&(t[e.id]=e.meta),t},{})}function Ws(n){return new Set(B(n.map(function(t){return t.tags})))}function Xs(n,t){if(n===t)return!0;if(n===void 0||t===void 0)return!1;if(D(n)||D(t))return n===t;var e=U(n),r=U(t);return e.length===r.length&&e.every(function(i){return Xs(n[i],t[i])})}function Ca(n){return D(n)?!1:"value"in n&&"history"in n}function Ia(n,t){var e=n.exec,r=y(y({},n),{exec:e!==void 0?function(){return e(t.context,t.event,{action:n,state:t,_event:t._event})}:void 0});return r}var Rt=function(){function n(t){var e=this,r;this.actions=[],this.activities=Is,this.meta={},this.events=[],this.value=t.value,this.context=t.context,this._event=t._event,this._sessionid=t._sessionid,this.event=this._event.data,this.historyValue=t.historyValue,this.history=t.history,this.actions=t.actions||[],this.activities=t.activities||Is,this.meta=Da(t.configuration),this.events=t.events||[],this.matches=this.matches.bind(this),this.toStrings=this.toStrings.bind(this),this.configuration=t.configuration,this.transitions=t.transitions,this.children=t.children,this.done=!!t.done,this.tags=(r=Array.isArray(t.tags)?new Set(t.tags):t.tags)!==null&&r!==void 0?r:new Set,this.machine=t.machine,Object.defineProperty(this,"nextEvents",{get:function(){return xa(e.configuration)}})}return n.from=function(t,e){if(t instanceof n)return t.context!==e?new n({value:t.value,context:e,_event:t._event,_sessionid:null,historyValue:t.historyValue,history:t.history,actions:[],activities:t.activities,meta:{},events:[],configuration:[],transitions:[],children:{}}):t;var r=En;return new n({value:t,context:e,_event:r,_sessionid:null,historyValue:void 0,history:void 0,actions:[],activities:void 0,meta:void 0,events:[],configuration:[],transitions:[],children:{}})},n.create=function(t){return new n(t)},n.inert=function(t,e){if(t instanceof n){if(!t.actions.length)return t;var r=En;return new n({value:t.value,context:e,_event:r,_sessionid:null,historyValue:t.historyValue,history:t.history,activities:t.activities,configuration:t.configuration,transitions:[],children:{}})}return n.from(t,e)},n.prototype.toStrings=function(t,e){var r=this;if(t===void 0&&(t=this.value),e===void 0&&(e="."),D(t))return[t];var i=U(t);return i.concat.apply(i,H([],T(i.map(function(s){return r.toStrings(t[s],e).map(function(o){return s+e+o})})),!1))},n.prototype.toJSON=function(){var t=this;t.configuration,t.transitions;var e=t.tags;t.machine;var r=Dr(t,["configuration","transitions","tags","machine"]);return y(y({},r),{tags:Array.from(e)})},n.prototype.matches=function(t){return Ir(t,this.value)},n.prototype.hasTag=function(t){return this.tags.has(t)},n.prototype.can=function(t){var e;return Oe(!!this.machine),!!((e=this.machine)===null||e===void 0?void 0:e.transition(this,t).changed)},n}(),Fe=function(n,t){var e=t(n);return e};function Ks(n){return{id:n,send:function(){},subscribe:function(){return{unsubscribe:function(){}}},getSnapshot:function(){},toJSON:function(){return{id:n}}}}function Ta(n,t,e,r){var i,s=Fs(n.src),o=(i=t==null?void 0:t.options.services)===null||i===void 0?void 0:i[s.type],l=n.data?bn(n.data,e,r):void 0,c=o?La(o,n.id,l):Ks(n.id);return c.meta=n,c}function La(n,t,e){var r=Ks(t);if(r.deferred=!0,Ut(n)){var i=r.state=Fe(void 0,function(){return(e?n.withContext(e):n).initialState});r.getSnapshot=function(){return i}}return r}function Na(n){try{return typeof n.send=="function"}catch{return!1}}function $a(n){return Na(n)&&"id"in n}function Oa(n){return y({subscribe:function(){return{unsubscribe:function(){}}},id:"anonymous",getSnapshot:function(){}},n)}function Ma(n){if(typeof n=="string"){var t={type:n};return t.toString=function(){return n},t}return n}function Tn(n){return y(y({type:Mr},n),{toJSON:function(){n.onDone,n.onError;var t=Dr(n,["onDone","onError"]);return y(y({},t),{type:Mr,src:Ma(n.src)})}})}var se="",jr="#",je="*",oe={},le=function(n){return n[0]===jr},Ua=function(){return{actions:{},guards:{},services:{},activities:{},delays:{}}},Ra=function(n,t,e){var r=e.slice(0,-1).some(function(s){return!("cond"in s)&&!("in"in s)&&(D(s.target)||Ut(s.target))}),i=t===se?"the transient event":"event '".concat(t,"'");Oe(!r,"One or more transitions for ".concat(i," on state '").concat(n.id,"' are unreachable. ")+"Make sure that the default transition is the last one defined.")},Ba=function(){function n(t,e,r){var i=this;r===void 0&&(r="context"in t?t.context:void 0);var s;this.config=t,this._context=r,this.order=-1,this.__xstatenode=!0,this.__cache={events:void 0,relativeValue:new Map,initialStateValue:void 0,initialState:void 0,on:void 0,transitions:void 0,candidates:{},delayedTransitions:void 0},this.idMap={},this.tags=[],this.options=Object.assign(Ua(),e),this.parent=this.options._parent,this.key=this.config.key||this.options._key||this.config.id||"(machine)",this.machine=this.parent?this.parent.machine:this,this.path=this.parent?this.parent.path.concat(this.key):[],this.delimiter=this.config.delimiter||(this.parent?this.parent.delimiter:Cs),this.id=this.config.id||H([this.machine.key],T(this.path),!1).join(this.delimiter),this.version=this.parent?this.parent.version:this.config.version,this.type=this.config.type||(this.config.parallel?"parallel":this.config.states&&U(this.config.states).length?"compound":this.config.history?"history":"atomic"),this.schema=this.parent?this.machine.schema:(s=this.config.schema)!==null&&s!==void 0?s:{},this.description=this.config.description,this.initial=this.config.initial,this.states=this.config.states?$e(this.config.states,function(c,a){var h,u=new n(c,{_parent:i,_key:a});return Object.assign(i.idMap,y((h={},h[u.id]=u,h),u.idMap)),u}):oe;var o=0;function l(c){var a,h;c.order=o++;try{for(var u=x(re(c)),f=u.next();!f.done;f=u.next()){var d=f.value;l(d)}}catch(g){a={error:g}}finally{try{f&&!f.done&&(h=u.return)&&h.call(u)}finally{if(a)throw a.error}}}l(this),this.history=this.config.history===!0?"shallow":this.config.history||!1,this._transient=!!this.config.always||(this.config.on?Array.isArray(this.config.on)?this.config.on.some(function(c){var a=c.event;return a===se}):se in this.config.on:!1),this.strict=!!this.config.strict,this.onEntry=ot(this.config.entry||this.config.onEntry).map(function(c){return Ue(c)}),this.onExit=ot(this.config.exit||this.config.onExit).map(function(c){return Ue(c)}),this.meta=this.config.meta,this.doneData=this.type==="final"?this.config.data:void 0,this.invoke=ot(this.config.invoke).map(function(c,a){var h,u;if(Ut(c))return i.machine.options.services=y((h={},h[c.id]=c,h),i.machine.options.services),Tn({src:c.id,id:c.id});if(D(c.src))return Tn(y(y({},c),{id:c.id||c.src,src:c.src}));if(Ut(c.src)||L(c.src)){var f="".concat(i.id,":invocation[").concat(a,"]");return i.machine.options.services=y((u={},u[f]=c.src,u),i.machine.options.services),Tn(y(y({id:f},c),{src:f}))}else{var d=c.src;return Tn(y(y({id:d.type},c),{src:d}))}}),this.activities=ot(this.config.activities).concat(this.invoke).map(function(c){return Rr(c)}),this.transition=this.transition.bind(this),this.tags=ot(this.config.tags)}return n.prototype._init=function(){this.__cache.transitions||Ys(this).forEach(function(t){return t.on})},n.prototype.withConfig=function(t,e){var r=this.options,i=r.actions,s=r.activities,o=r.guards,l=r.services,c=r.delays;return new n(this.config,{actions:y(y({},i),t.actions),activities:y(y({},s),t.activities),guards:y(y({},o),t.guards),services:y(y({},l),t.services),delays:y(y({},c),t.delays)},e!=null?e:this.context)},n.prototype.withContext=function(t){return new n(this.config,this.options,t)},Object.defineProperty(n.prototype,"context",{get:function(){return L(this._context)?this._context():this._context},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"definition",{get:function(){return{id:this.id,key:this.key,version:this.version,context:this.context,type:this.type,initial:this.initial,history:this.history,states:$e(this.states,function(t){return t.definition}),on:this.on,transitions:this.transitions,entry:this.onEntry,exit:this.onExit,activities:this.activities||[],meta:this.meta,order:this.order||-1,data:this.doneData,invoke:this.invoke,description:this.description,tags:this.tags}},enumerable:!1,configurable:!0}),n.prototype.toJSON=function(){return this.definition},Object.defineProperty(n.prototype,"on",{get:function(){if(this.__cache.on)return this.__cache.on;var t=this.transitions;return this.__cache.on=t.reduce(function(e,r){return e[r.eventType]=e[r.eventType]||[],e[r.eventType].push(r),e},{})},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"after",{get:function(){return this.__cache.delayedTransitions||(this.__cache.delayedTransitions=this.getDelayedTransitions(),this.__cache.delayedTransitions)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"transitions",{get:function(){return this.__cache.transitions||(this.__cache.transitions=this.formatTransitions(),this.__cache.transitions)},enumerable:!1,configurable:!0}),n.prototype.getCandidates=function(t){if(this.__cache.candidates[t])return this.__cache.candidates[t];var e=t===se,r=this.transitions.filter(function(i){var s=i.eventType===t;return e?s:s||i.eventType===je});return this.__cache.candidates[t]=r,r},n.prototype.getDelayedTransitions=function(){var t=this,e=this.config.after;if(!e)return[];var r=function(s,o){var l=L(s)?"".concat(t.id,":delay[").concat(o,"]"):s,c=Ea(l,t.id);return t.onEntry.push(zs(c,{delay:s})),t.onExit.push(Sa(c)),c},i=ee(e)?e.map(function(s,o){var l=r(s.delay,o);return y(y({},s),{event:l})}):B(U(e).map(function(s,o){var l=e[s],c=D(l)?{target:l}:l,a=isNaN(+s)?s:+s,h=r(a,o);return ot(c).map(function(u){return y(y({},u),{event:h,delay:a})})}));return i.map(function(s){var o=s.delay;return y(y({},t.formatTransition(s)),{delay:o})})},n.prototype.getStateNodes=function(t){var e,r=this;if(!t)return[];var i=t instanceof Rt?t.value:Ne(t,this.delimiter);if(D(i)){var s=this.getStateNode(i).initial;return s!==void 0?this.getStateNodes((e={},e[i]=s,e)):[this,this.states[i]]}var o=U(i),l=o.map(function(c){return r.getStateNode(c)});return l.push(this),l.concat(o.reduce(function(c,a){var h=r.getStateNode(a).getStateNodes(i[a]);return c.concat(h)},[]))},n.prototype.handles=function(t){var e=Ts(t);return this.events.includes(e)},n.prototype.resolveState=function(t){var e=Array.from(ie([],this.getStateNodes(t.value)));return new Rt(y(y({},t),{value:this.resolve(t.value),configuration:e,done:Be(e,this),tags:Ws(e)}))},n.prototype.transitionLeafNode=function(t,e,r){var i=this.getStateNode(t),s=i.next(e,r);return!s||!s.transitions.length?this.next(e,r):s},n.prototype.transitionCompoundNode=function(t,e,r){var i=U(t),s=this.getStateNode(i[0]),o=s._transition(t[i[0]],e,r);return!o||!o.transitions.length?this.next(e,r):o},n.prototype.transitionParallelNode=function(t,e,r){var i,s,o={};try{for(var l=x(U(t)),c=l.next();!c.done;c=l.next()){var a=c.value,h=t[a];if(!!h){var u=this.getStateNode(a),f=u._transition(h,e,r);f&&(o[a]=f)}}}catch(w){i={error:w}}finally{try{c&&!c.done&&(s=l.return)&&s.call(l)}finally{if(i)throw i.error}}var d=U(o).map(function(w){return o[w]}),g=B(d.map(function(w){return w.transitions})),p=d.some(function(w){return w.transitions.length>0});if(!p)return this.next(e,r);var v=B(d.map(function(w){return w.entrySet})),A=B(U(o).map(function(w){return o[w].configuration}));return{transitions:g,entrySet:v,exitSet:B(d.map(function(w){return w.exitSet})),configuration:A,source:e,actions:B(U(o).map(function(w){return o[w].actions}))}},n.prototype._transition=function(t,e,r){return D(t)?this.transitionLeafNode(t,e,r):U(t).length===1?this.transitionCompoundNode(t,e,r):this.transitionParallelNode(t,e,r)},n.prototype.next=function(t,e){var r,i,s=this,o=e.name,l=[],c=[],a;try{for(var h=x(this.getCandidates(o)),u=h.next();!u.done;u=h.next()){var f=u.value,d=f.cond,g=f.in,p=t.context,v=g?D(g)&&le(g)?t.matches(Ne(this.getStateNodeById(g).path,this.delimiter)):Ir(Ne(g,this.delimiter),na(this.path.slice(0,-2))(t.value)):!0,A=!1;try{A=!d||Bs(this.machine,d,p,e,t)}catch(I){throw new Error("Unable to evaluate guard '".concat(d.name||d.type,"' in transition for event '").concat(o,"' in state node '").concat(this.id,`':
`).concat(I.message))}if(A&&v){f.target!==void 0&&(c=f.target),l.push.apply(l,H([],T(f.actions),!1)),a=f;break}}}catch(I){r={error:I}}finally{try{u&&!u.done&&(i=h.return)&&i.call(h)}finally{if(r)throw r.error}}if(!!a){if(!c.length)return{transitions:[a],entrySet:[],exitSet:[],configuration:t.value?[this]:[],source:t,actions:l};var w=B(c.map(function(I){return s.getRelativeStateNodes(I,t.historyValue)})),E=!!a.internal,$=E?[]:B(w.map(function(I){return s.nodesFromChild(I)}));return{transitions:[a],entrySet:$,exitSet:E?[]:[this],configuration:w,source:t,actions:l}}},n.prototype.nodesFromChild=function(t){if(t.escapes(this))return[];for(var e=[],r=t;r&&r!==this;)e.push(r),r=r.parent;return e.push(this),e},n.prototype.escapes=function(t){if(this===t)return!1;for(var e=this.parent;e;){if(e===t)return!1;e=e.parent}return!0},n.prototype.getActions=function(t,e,r,i){var s,o,l,c,a=ie([],i?this.getStateNodes(i.value):[this]),h=t.configuration.length?ie(a,t.configuration):a;try{for(var u=x(h),f=u.next();!f.done;f=u.next()){var d=f.value;In(a,d)||t.entrySet.push(d)}}catch(_){s={error:_}}finally{try{f&&!f.done&&(o=u.return)&&o.call(u)}finally{if(s)throw s.error}}try{for(var g=x(a),p=g.next();!p.done;p=g.next()){var d=p.value;(!In(h,d)||In(t.exitSet,d.parent))&&t.exitSet.push(d)}}catch(_){l={error:_}}finally{try{p&&!p.done&&(c=g.return)&&c.call(g)}finally{if(l)throw l.error}}t.source||(t.exitSet=[],t.entrySet.push(this));var v=B(t.entrySet.map(function(_){var S=[];if(_.type!=="final")return S;var C=_.parent;if(!C.parent)return S;S.push(xn(_.id,_.doneData),xn(C.id,_.doneData?bn(_.doneData,e,r):void 0));var F=C.parent;return F.type==="parallel"&&re(F).every(function(W){return Be(t.configuration,W)})&&S.push(xn(F.id)),S}));t.exitSet.sort(function(_,S){return S.order-_.order}),t.entrySet.sort(function(_,S){return _.order-S.order});var A=new Set(t.entrySet),w=new Set(t.exitSet),E=T([B(Array.from(A).map(function(_){return H(H([],T(_.activities.map(function(S){return ba(S)})),!1),T(_.onEntry),!1)})).concat(v.map(ya)),B(Array.from(w).map(function(_){return H(H([],T(_.onExit),!1),T(_.activities.map(function(S){return _a(S)})),!1)}))],2),$=E[0],I=E[1],j=An(I.concat(t.actions).concat($),this.machine.options.actions);return j},n.prototype.transition=function(t,e,r){t===void 0&&(t=this.initialState);var i=Z(e),s;if(t instanceof Rt)s=r===void 0?t:this.resolveState(Rt.from(t,r));else{var o=D(t)?this.resolve(mn(this.getResolvedPath(t))):this.resolve(t),l=r!=null?r:this.machine.context;s=this.resolveState(Rt.from(o,l))}if(!Le&&i.name===je)throw new Error("An event cannot have the wildcard type ('".concat(je,"')"));if(this.strict&&!this.events.includes(i.name)&&!ia(i.name))throw new Error("Machine '".concat(this.id,"' does not accept event '").concat(i.name,"'"));var c=this._transition(s.value,s,i)||{transitions:[],configuration:[],entrySet:[],exitSet:[],source:s,actions:[]},a=ie([],this.getStateNodes(s.value)),h=c.configuration.length?ie(a,c.configuration):a;return c.configuration=H([],T(h),!1),this.resolveTransition(c,s,i)},n.prototype.resolveRaisedTransition=function(t,e,r){var i,s=t.actions;return t=this.transition(t,e),t._event=r,t.event=r.data,(i=t.actions).unshift.apply(i,H([],T(s),!1)),t},n.prototype.resolveTransition=function(t,e,r,i){var s,o,l=this;r===void 0&&(r=En),i===void 0&&(i=this.machine.context);var c=t.configuration,a=!e||t.transitions.length>0,h=a?Aa(this.machine,c):void 0,u=e?e.historyValue?e.historyValue:t.source?this.machine.historyValue(e.value):void 0:void 0,f=e?e.context:i,d=this.getActions(t,f,r,e),g=e?y({},e.activities):{};try{for(var p=x(d),v=p.next();!v.done;v=p.next()){var A=v.value;A.type===Nr?g[A.activity.id||A.activity.type]=A:A.type===$r&&(g[A.activity.id||A.activity.type]=!1)}}catch(tt){s={error:tt}}finally{try{v&&!v.done&&(o=p.return)&&o.call(p)}finally{if(s)throw s.error}}var w=T(Br(this,e,f,r,d,this.machine.config.preserveActionOrder),2),E=w[0],$=w[1],I=T(Os(E,function(tt){return tt.type===_n||tt.type===kn&&tt.to===Me.Internal}),2),j=I[0],_=I[1],S=E.filter(function(tt){var Bt;return tt.type===Nr&&((Bt=tt.activity)===null||Bt===void 0?void 0:Bt.type)===Mr}),C=S.reduce(function(tt,Bt){return tt[Bt.activity.id]=Ta(Bt.activity,l.machine,$,r),tt},e?y({},e.children):{}),F=h?t.configuration:e?e.configuration:[],W=Be(F,this),K=new Rt({value:h||e.value,context:$,_event:r,_sessionid:e?e._sessionid:null,historyValue:h?u?oa(u,h):void 0:e?e.historyValue:void 0,history:!h||t.source?e:void 0,actions:h?_:[],activities:h?g:e?e.activities:{},events:[],configuration:F,transitions:t.transitions,children:C,done:W,tags:e==null?void 0:e.tags,machine:this}),Ve=f!==$;K.changed=r.name===Js||Ve;var wt=K.history;wt&&delete wt.history;var Jr=!W&&(this._transient||c.some(function(tt){return tt._transient}));if(!a&&(!Jr||r.name===se))return K;var Q=K;if(!W)for(Jr&&(Q=this.resolveRaisedTransition(Q,{type:ua},r));j.length;){var Zs=j.shift();Q=this.resolveRaisedTransition(Q,Zs._event,r)}var Qs=Q.changed||(wt?!!Q.actions.length||Ve||typeof wt.value!=typeof Q.value||!Xs(Q.value,wt.value):void 0);return Q.changed=Qs,Q.history=wt,Q.tags=Ws(Q.configuration),Q},n.prototype.getStateNode=function(t){if(le(t))return this.machine.getStateNodeById(t);if(!this.states)throw new Error("Unable to retrieve child state '".concat(t,"' from '").concat(this.id,"'; no child states exist."));var e=this.states[t];if(!e)throw new Error("Child state '".concat(t,"' does not exist on '").concat(this.id,"'"));return e},n.prototype.getStateNodeById=function(t){var e=le(t)?t.slice(jr.length):t;if(e===this.id)return this;var r=this.machine.idMap[e];if(!r)throw new Error("Child state node '#".concat(e,"' does not exist on machine '").concat(this.id,"'"));return r},n.prototype.getStateNodeByPath=function(t){if(typeof t=="string"&&le(t))try{return this.getStateNodeById(t.slice(1))}catch{}for(var e=Tr(t,this.delimiter).slice(),r=this;e.length;){var i=e.shift();if(!i.length)break;r=r.getStateNode(i)}return r},n.prototype.resolve=function(t){var e,r=this;if(!t)return this.initialStateValue||oe;switch(this.type){case"parallel":return $e(this.initialStateValue,function(s,o){return s?r.getStateNode(o).resolve(t[o]||s):oe});case"compound":if(D(t)){var i=this.getStateNode(t);return i.type==="parallel"||i.type==="compound"?(e={},e[t]=i.initialStateValue,e):t}return U(t).length?$e(t,function(s,o){return s?r.getStateNode(o).resolve(s):oe}):this.initialStateValue||{};default:return t||oe}},n.prototype.getResolvedPath=function(t){if(le(t)){var e=this.machine.idMap[t.slice(jr.length)];if(!e)throw new Error("Unable to find state node '".concat(t,"'"));return e.path}return Tr(t,this.delimiter)},Object.defineProperty(n.prototype,"initialStateValue",{get:function(){var t;if(this.__cache.initialStateValue)return this.__cache.initialStateValue;var e;if(this.type==="parallel")e=Ls(this.states,function(r){return r.initialStateValue||oe},function(r){return r.type!=="history"});else if(this.initial!==void 0){if(!this.states[this.initial])throw new Error("Initial state '".concat(this.initial,"' not found on '").concat(this.key,"'"));e=Cn(this.states[this.initial])?this.initial:(t={},t[this.initial]=this.states[this.initial].initialStateValue,t)}else e={};return this.__cache.initialStateValue=e,this.__cache.initialStateValue},enumerable:!1,configurable:!0}),n.prototype.getInitialState=function(t,e){var r=this.getStateNodes(t);return this.resolveTransition({configuration:r,entrySet:r,exitSet:[],transitions:[],source:void 0,actions:[]},void 0,void 0,e)},Object.defineProperty(n.prototype,"initialState",{get:function(){this._init();var t=this.initialStateValue;if(!t)throw new Error("Cannot retrieve initial state from simple state '".concat(this.id,"'."));return this.getInitialState(t)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"target",{get:function(){var t;if(this.type==="history"){var e=this.config;D(e.target)?t=le(e.target)?mn(this.machine.getStateNodeById(e.target).path.slice(this.path.length-1)):e.target:t=e.target}return t},enumerable:!1,configurable:!0}),n.prototype.getRelativeStateNodes=function(t,e,r){return r===void 0&&(r=!0),r?t.type==="history"?t.resolveHistory(e):t.initialStateNodes:[t]},Object.defineProperty(n.prototype,"initialStateNodes",{get:function(){var t=this;if(Cn(this))return[this];if(this.type==="compound"&&!this.initial)return Le||Oe(!1,"Compound state node '".concat(this.id,"' has no initial state.")),[this];var e=Sn(this.initialStateValue);return B(e.map(function(r){return t.getFromRelativePath(r)}))},enumerable:!1,configurable:!0}),n.prototype.getFromRelativePath=function(t){if(!t.length)return[this];var e=T(t),r=e[0],i=e.slice(1);if(!this.states)throw new Error("Cannot retrieve subPath '".concat(r,"' from node with no states"));var s=this.getStateNode(r);if(s.type==="history")return s.resolveHistory();if(!this.states[r])throw new Error("Child state '".concat(r,"' does not exist on '").concat(this.id,"'"));return this.states[r].getFromRelativePath(i)},n.prototype.historyValue=function(t){if(!!U(this.states).length)return{current:t||this.initialStateValue,states:Ls(this.states,function(e,r){if(!t)return e.historyValue();var i=D(t)?void 0:t[r];return e.historyValue(i||e.initialStateValue)},function(e){return!e.history})}},n.prototype.resolveHistory=function(t){var e=this;if(this.type!=="history")return[this];var r=this.parent;if(!t){var i=this.target;return i?B(Sn(i).map(function(o){return r.getFromRelativePath(o)})):r.initialStateNodes}var s=ra(r.path,"states")(t).current;return D(s)?[r.getStateNode(s)]:B(Sn(s).map(function(o){return e.history==="deep"?r.getFromRelativePath(o):[r.states[o[0]]]}))},Object.defineProperty(n.prototype,"stateIds",{get:function(){var t=this,e=B(U(this.states).map(function(r){return t.states[r].stateIds}));return[this.id].concat(e)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"events",{get:function(){var t,e,r,i;if(this.__cache.events)return this.__cache.events;var s=this.states,o=new Set(this.ownEvents);if(s)try{for(var l=x(U(s)),c=l.next();!c.done;c=l.next()){var a=c.value,h=s[a];if(h.states)try{for(var u=(r=void 0,x(h.events)),f=u.next();!f.done;f=u.next()){var d=f.value;o.add("".concat(d))}}catch(g){r={error:g}}finally{try{f&&!f.done&&(i=u.return)&&i.call(u)}finally{if(r)throw r.error}}}}catch(g){t={error:g}}finally{try{c&&!c.done&&(e=l.return)&&e.call(l)}finally{if(t)throw t.error}}return this.__cache.events=Array.from(o)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"ownEvents",{get:function(){var t=new Set(this.transitions.filter(function(e){return!(!e.target&&!e.actions.length&&e.internal)}).map(function(e){return e.eventType}));return Array.from(t)},enumerable:!1,configurable:!0}),n.prototype.resolveTarget=function(t){var e=this;if(t!==void 0)return t.map(function(r){if(!D(r))return r;var i=r[0]===e.delimiter;if(i&&!e.parent)return e.getStateNodeByPath(r.slice(1));var s=i?e.key+r:r;if(e.parent)try{var o=e.parent.getStateNodeByPath(s);return o}catch(l){throw new Error("Invalid transition definition for state node '".concat(e.id,`':
`).concat(l.message))}else return e.getStateNodeByPath(s)})},n.prototype.formatTransition=function(t){var e=this,r=ha(t.target),i="internal"in t?t.internal:r?r.some(function(c){return D(c)&&c[0]===e.delimiter}):!0,s=this.machine.options.guards,o=this.resolveTarget(r),l=y(y({},t),{actions:An(ot(t.actions)),cond:Rs(t.cond,s),target:o,source:this,internal:i,eventType:t.event,toJSON:function(){return y(y({},l),{target:l.target?l.target.map(function(c){return"#".concat(c.id)}):void 0,source:"#".concat(e.id)})}});return l},n.prototype.formatTransitions=function(){var t,e,r=this,i;if(!this.config.on)i=[];else if(Array.isArray(this.config.on))i=this.config.on;else{var s=this.config.on,o=je,l=s[o],c=l===void 0?[]:l,a=Dr(s,[typeof o=="symbol"?o:o+""]);i=B(U(a).map(function(w){!Le&&w===se&&Oe(!1,"Empty string transition configs (e.g., `{ on: { '': ... }}`) for transient transitions are deprecated. Specify the transition in the `{ always: ... }` property instead. "+'Please check the `on` configuration for "#'.concat(r.id,'".'));var E=ne(w,a[w]);return Le||Ra(r,w,E),E}).concat(ne(je,c)))}var h=this.config.always?ne("",this.config.always):[],u=this.config.onDone?ne(String(xn(this.id)),this.config.onDone):[];Le||Oe(!(this.config.onDone&&!this.parent),'Root nodes cannot have an ".onDone" transition. Please check the config of "'.concat(this.id,'".'));var f=B(this.invoke.map(function(w){var E=[];return w.onDone&&E.push.apply(E,H([],T(ne(String(Dn(w.id)),w.onDone)),!1)),w.onError&&E.push.apply(E,H([],T(ne(String(Re(w.id)),w.onError)),!1)),E})),d=this.after,g=B(H(H(H(H([],T(u),!1),T(f),!1),T(i),!1),T(h),!1).map(function(w){return ot(w).map(function(E){return r.formatTransition(E)})}));try{for(var p=x(d),v=p.next();!v.done;v=p.next()){var A=v.value;g.push(A)}}catch(w){t={error:w}}finally{try{v&&!v.done&&(e=p.return)&&e.call(p)}finally{if(t)throw t.error}}return g},n}();function ih(n,t){return new Ba(n,t)}var Fa={deferEvents:!1},qs=function(){function n(t){this.processingEvent=!1,this.queue=[],this.initialized=!1,this.options=y(y({},Fa),t)}return n.prototype.initialize=function(t){if(this.initialized=!0,t){if(!this.options.deferEvents){this.schedule(t);return}this.process(t)}this.flushEvents()},n.prototype.schedule=function(t){if(!this.initialized||this.processingEvent){this.queue.push(t);return}if(this.queue.length!==0)throw new Error("Event queue should be empty when it is not processing events");this.process(t),this.flushEvents()},n.prototype.clear=function(){this.queue=[]},n.prototype.flushEvents=function(){for(var t=this.queue.shift();t;)this.process(t),t=this.queue.shift()},n.prototype.process=function(t){this.processingEvent=!0;try{t()}catch(e){throw this.clear(),e}finally{this.processingEvent=!1}},n}(),Vr=new Map,ja=0,Ln={bookId:function(){return"x:".concat(ja++)},register:function(n,t){return Vr.set(n,t),n},get:function(n){return Vr.get(n)},free:function(n){Vr.delete(n)}};function Hr(){if(typeof globalThis!="undefined")return globalThis;if(typeof self!="undefined")return self;if(typeof window!="undefined")return window;if(typeof global!="undefined")return global}function Va(){var n=Hr();if(n&&"__xstate__"in n)return n.__xstate__}function Ha(n){if(!!Hr()){var t=Va();t&&t.register(n)}}function Pa(n,t){t===void 0&&(t={});var e=n.initialState,r=new Set,i=[],s=!1,o=function(){if(!s){for(s=!0;i.length>0;){var a=i.shift();e=n.transition(e,a,c),r.forEach(function(h){return h.next(e)})}s=!1}},l=Oa({id:t.id,send:function(a){i.push(a),o()},getSnapshot:function(){return e},subscribe:function(a,h,u){var f=js(a,h,u);return r.add(f),f.next(e),{unsubscribe:function(){r.delete(f)}}}}),c={parent:t.parent,self:l,id:t.id||"anonymous",observers:r};return e=n.start?n.start(c):e,l}var Ja={sync:!1,autoForward:!1},rt;(function(n){n[n.NotStarted=0]="NotStarted",n[n.Running=1]="Running",n[n.Stopped=2]="Stopped"})(rt||(rt={}));var za=function(){function n(t,e){var r=this;e===void 0&&(e=n.defaultOptions),this.machine=t,this.scheduler=new qs,this.delayedEventsMap={},this.listeners=new Set,this.contextListeners=new Set,this.stopListeners=new Set,this.doneListeners=new Set,this.eventListeners=new Set,this.sendListeners=new Set,this.initialized=!1,this.status=rt.NotStarted,this.children=new Map,this.forwardTo=new Set,this.init=this.start,this.send=function(h,u){if(ee(h))return r.batch(h),r.state;var f=Z(Lr(h,u));if(r.status===rt.Stopped)return r.state;if(r.status!==rt.Running&&!r.options.deferEvents)throw new Error('Event "'.concat(f.name,'" was sent to uninitialized service "').concat(r.machine.id,`". Make sure .start() is called for this service, or set { deferEvents: true } in the service options.
Event: `).concat(JSON.stringify(f.data)));return r.scheduler.schedule(function(){r.forward(f);var d=r.nextState(f);r.update(d,f)}),r._state},this.sendTo=function(h,u){var f=r.parent&&(u===Me.Parent||r.parent.id===u),d=f?r.parent:D(u)?r.children.get(u)||Ln.get(u):aa(u)?u:void 0;if(!d){if(!f)throw new Error("Unable to send event to child '".concat(u,"' from service '").concat(r.id,"'."));return}"machine"in d?d.send(y(y({},h),{name:h.name===da?"".concat(Re(r.id)):h.name,origin:r.sessionId})):d.send(h.data)};var i=y(y({},n.defaultOptions),e),s=i.clock,o=i.logger,l=i.parent,c=i.id,a=c!==void 0?c:t.id;this.id=a,this.logger=o,this.clock=s,this.parent=l,this.options=i,this.scheduler=new qs({deferEvents:this.options.deferEvents}),this.sessionId=Ln.bookId()}return Object.defineProperty(n.prototype,"initialState",{get:function(){var t=this;return this._initialState?this._initialState:Fe(this,function(){return t._initialState=t.machine.initialState,t._initialState})},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),n.prototype.execute=function(t,e){var r,i;try{for(var s=x(t.actions),o=s.next();!o.done;o=s.next()){var l=o.value;this.exec(l,t,e)}}catch(c){r={error:c}}finally{try{o&&!o.done&&(i=s.return)&&i.call(s)}finally{if(r)throw r.error}}},n.prototype.update=function(t,e){var r,i,s,o,l,c,a,h,u=this;if(t._sessionid=this.sessionId,this._state=t,this.options.execute&&this.execute(this.state),this.children.forEach(function(C){u.state.children[C.id]=C}),this.devTools&&this.devTools.send(e.data,t),t.event)try{for(var f=x(this.eventListeners),d=f.next();!d.done;d=f.next()){var g=d.value;g(t.event)}}catch(C){r={error:C}}finally{try{d&&!d.done&&(i=f.return)&&i.call(f)}finally{if(r)throw r.error}}try{for(var p=x(this.listeners),v=p.next();!v.done;v=p.next()){var g=v.value;g(t,t.event)}}catch(C){s={error:C}}finally{try{v&&!v.done&&(o=p.return)&&o.call(p)}finally{if(s)throw s.error}}try{for(var A=x(this.contextListeners),w=A.next();!w.done;w=A.next()){var E=w.value;E(this.state.context,this.state.history?this.state.history.context:void 0)}}catch(C){l={error:C}}finally{try{w&&!w.done&&(c=A.return)&&c.call(A)}finally{if(l)throw l.error}}var $=Be(t.configuration||[],this.machine);if(this.state.configuration&&$){var I=t.configuration.find(function(C){return C.type==="final"&&C.parent===u.machine}),j=I&&I.doneData?bn(I.doneData,t.context,e):void 0;try{for(var _=x(this.doneListeners),S=_.next();!S.done;S=_.next()){var g=S.value;g(Dn(this.id,j))}}catch(C){a={error:C}}finally{try{S&&!S.done&&(h=_.return)&&h.call(_)}finally{if(a)throw a.error}}this.stop()}},n.prototype.onTransition=function(t){return this.listeners.add(t),this.status===rt.Running&&t(this.state,this.state.event),this},n.prototype.subscribe=function(t,e,r){var i=this;if(!t)return{unsubscribe:function(){}};var s,o=r;return typeof t=="function"?s=t:(s=t.next.bind(t),o=t.complete.bind(t)),this.listeners.add(s),this.status===rt.Running&&s(this.state),o&&this.onDone(o),{unsubscribe:function(){s&&i.listeners.delete(s),o&&i.doneListeners.delete(o)}}},n.prototype.onEvent=function(t){return this.eventListeners.add(t),this},n.prototype.onSend=function(t){return this.sendListeners.add(t),this},n.prototype.onChange=function(t){return this.contextListeners.add(t),this},n.prototype.onStop=function(t){return this.stopListeners.add(t),this},n.prototype.onDone=function(t){return this.doneListeners.add(t),this},n.prototype.off=function(t){return this.listeners.delete(t),this.eventListeners.delete(t),this.sendListeners.delete(t),this.stopListeners.delete(t),this.doneListeners.delete(t),this.contextListeners.delete(t),this},n.prototype.start=function(t){var e=this;if(this.status===rt.Running)return this;Ln.register(this.sessionId,this),this.initialized=!0,this.status=rt.Running;var r=t===void 0?this.initialState:Fe(this,function(){return Ca(t)?e.machine.resolveState(t):e.machine.resolveState(Rt.from(t,e.machine.context))});return this.options.devTools&&this.attachDev(),this.scheduler.initialize(function(){e.update(r,En)}),this},n.prototype.stop=function(){var t,e,r,i,s,o,l,c,a,h,u=this;try{for(var f=x(this.listeners),d=f.next();!d.done;d=f.next()){var g=d.value;this.listeners.delete(g)}}catch(S){t={error:S}}finally{try{d&&!d.done&&(e=f.return)&&e.call(f)}finally{if(t)throw t.error}}try{for(var p=x(this.stopListeners),v=p.next();!v.done;v=p.next()){var g=v.value;g(),this.stopListeners.delete(g)}}catch(S){r={error:S}}finally{try{v&&!v.done&&(i=p.return)&&i.call(p)}finally{if(r)throw r.error}}try{for(var A=x(this.contextListeners),w=A.next();!w.done;w=A.next()){var g=w.value;this.contextListeners.delete(g)}}catch(S){s={error:S}}finally{try{w&&!w.done&&(o=A.return)&&o.call(A)}finally{if(s)throw s.error}}try{for(var E=x(this.doneListeners),$=E.next();!$.done;$=E.next()){var g=$.value;this.doneListeners.delete(g)}}catch(S){l={error:S}}finally{try{$&&!$.done&&(c=E.return)&&c.call(E)}finally{if(l)throw l.error}}if(!this.initialized)return this;this.state.configuration.forEach(function(S){var C,F;try{for(var W=x(S.definition.exit),K=W.next();!K.done;K=W.next()){var Ve=K.value;u.exec(Ve,u.state)}}catch(wt){C={error:wt}}finally{try{K&&!K.done&&(F=W.return)&&F.call(W)}finally{if(C)throw C.error}}}),this.children.forEach(function(S){L(S.stop)&&S.stop()});try{for(var I=x(U(this.delayedEventsMap)),j=I.next();!j.done;j=I.next()){var _=j.value;this.clock.clearTimeout(this.delayedEventsMap[_])}}catch(S){a={error:S}}finally{try{j&&!j.done&&(h=I.return)&&h.call(I)}finally{if(a)throw a.error}}return this.scheduler.clear(),this.initialized=!1,this.status=rt.Stopped,Ln.free(this.sessionId),this},n.prototype.batch=function(t){var e=this;if(!(this.status===rt.NotStarted&&this.options.deferEvents)){if(this.status!==rt.Running)throw new Error("".concat(t.length,' event(s) were sent to uninitialized service "').concat(this.machine.id,'". Make sure .start() is called for this service, or set { deferEvents: true } in the service options.'))}this.scheduler.schedule(function(){var r,i,s=e.state,o=!1,l=[],c=function(f){var d=Z(f);e.forward(d),s=Fe(e,function(){return e.machine.transition(s,d)}),l.push.apply(l,H([],T(s.actions.map(function(g){return Ia(g,s)})),!1)),o=o||!!s.changed};try{for(var a=x(t),h=a.next();!h.done;h=a.next()){var u=h.value;c(u)}}catch(f){r={error:f}}finally{try{h&&!h.done&&(i=a.return)&&i.call(a)}finally{if(r)throw r.error}}s.changed=o,s.actions=l,e.update(s,Z(t[t.length-1]))})},n.prototype.sender=function(t){return this.send.bind(this,t)},n.prototype.nextState=function(t){var e=this,r=Z(t);if(r.name.indexOf(Ps)===0&&!this.state.nextEvents.some(function(s){return s.indexOf(Ps)===0}))throw r.data.data;var i=Fe(this,function(){return e.machine.transition(e.state,r)});return i},n.prototype.forward=function(t){var e,r;try{for(var i=x(this.forwardTo),s=i.next();!s.done;s=i.next()){var o=s.value,l=this.children.get(o);if(!l)throw new Error("Unable to forward event '".concat(t,"' from interpreter '").concat(this.id,"' to nonexistant child '").concat(o,"'."));l.send(t)}}catch(c){e={error:c}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(e)throw e.error}}},n.prototype.defer=function(t){var e=this;this.delayedEventsMap[t.id]=this.clock.setTimeout(function(){t.to?e.sendTo(t._event,t.to):e.send(t._event)},t.delay)},n.prototype.cancel=function(t){this.clock.clearTimeout(this.delayedEventsMap[t]),delete this.delayedEventsMap[t]},n.prototype.exec=function(t,e,r){r===void 0&&(r=this.machine.options.actions);var i=e.context,s=e._event,o=t.exec||Ur(t.type,r),l=L(o)?o:o?o.exec:t.exec;if(l)try{return l(i,s.data,{action:t,state:this.state,_event:s})}catch($){throw this.parent&&this.parent.send({type:"xstate.error",data:$}),$}switch(t.type){case kn:var c=t;if(typeof c.delay=="number"){this.defer(c);return}else c.to?this.sendTo(c._event,c.to):this.send(c._event);break;case Vs:this.cancel(t.sendId);break;case Nr:{var a=t.activity;if(!this.state.activities[a.id||a.type])break;if(a.type===N.Invoke){var h=Fs(a.src),u=this.machine.options.services?this.machine.options.services[h.type]:void 0,f=a.id,d=a.data,g="autoForward"in a?a.autoForward:!!a.forward;if(!u)return;var p=d?bn(d,i,s):void 0;if(typeof u=="string")return;var v=L(u)?u(i,s.data,{data:p,src:h,meta:a.meta}):u;if(!v)return;var A=void 0;Ut(v)&&(v=p?v.withContext(p):v,A={autoForward:g}),this.spawn(v,f,A)}else this.spawnActivity(a);break}case $r:{this.stopChild(t.activity.id);break}case Hs:var w=t.label,E=t.value;w?this.logger(w,E):this.logger(E);break}},n.prototype.removeChild=function(t){var e;this.children.delete(t),this.forwardTo.delete(t),(e=this.state)===null||e===void 0||delete e.children[t]},n.prototype.stopChild=function(t){var e=this.children.get(t);!e||(this.removeChild(t),L(e.stop)&&e.stop())},n.prototype.spawn=function(t,e,r){if($s(t))return this.spawnPromise(Promise.resolve(t),e);if(L(t))return this.spawnCallback(t,e);if($a(t))return this.spawnActor(t,e);if(la(t))return this.spawnObservable(t,e);if(Ut(t))return this.spawnMachine(t,y(y({},r),{id:e}));if(sa(t))return this.spawnBehavior(t,e);throw new Error('Unable to spawn entity "'.concat(e,'" of type "').concat(typeof t,'".'))},n.prototype.spawnMachine=function(t,e){var r=this;e===void 0&&(e={});var i=new n(t,y(y({},this.options),{parent:this,id:e.id||t.id})),s=y(y({},Ja),e);s.sync&&i.onTransition(function(l){r.send(Js,{state:l,id:i.id})});var o=i;return this.children.set(i.id,o),s.autoForward&&this.forwardTo.add(i.id),i.onDone(function(l){r.removeChild(i.id),r.send(Z(l,{origin:i.id}))}).start(),o},n.prototype.spawnBehavior=function(t,e){var r=Pa(t,{id:e,parent:this});return this.children.set(e,r),r},n.prototype.spawnPromise=function(t,e){var r=this,i=!1,s;t.then(function(l){i||(s=l,r.removeChild(e),r.send(Z(Dn(e,l),{origin:e})))},function(l){if(!i){r.removeChild(e);var c=Re(e,l);try{r.send(Z(c,{origin:e}))}catch{r.devTools&&r.devTools.send(c,r.state),r.machine.strict&&r.stop()}}});var o={id:e,send:function(){},subscribe:function(l,c,a){var h=js(l,c,a),u=!1;return t.then(function(f){u||(h.next(f),!u&&h.complete())},function(f){u||h.error(f)}),{unsubscribe:function(){return u=!0}}},stop:function(){i=!0},toJSON:function(){return{id:e}},getSnapshot:function(){return s}};return this.children.set(e,o),o},n.prototype.spawnCallback=function(t,e){var r=this,i=!1,s=new Set,o=new Set,l,c=function(u){l=u,o.forEach(function(f){return f(u)}),!i&&r.send(Z(u,{origin:e}))},a;try{a=t(c,function(u){s.add(u)})}catch(u){this.send(Re(e,u))}if($s(a))return this.spawnPromise(a,e);var h={id:e,send:function(u){return s.forEach(function(f){return f(u)})},subscribe:function(u){return o.add(u),{unsubscribe:function(){o.delete(u)}}},stop:function(){i=!0,L(a)&&a()},toJSON:function(){return{id:e}},getSnapshot:function(){return l}};return this.children.set(e,h),h},n.prototype.spawnObservable=function(t,e){var r=this,i,s=t.subscribe(function(l){i=l,r.send(Z(l,{origin:e}))},function(l){r.removeChild(e),r.send(Z(Re(e,l),{origin:e}))},function(){r.removeChild(e),r.send(Z(Dn(e),{origin:e}))}),o={id:e,send:function(){},subscribe:function(l,c,a){return t.subscribe(l,c,a)},stop:function(){return s.unsubscribe()},getSnapshot:function(){return i},toJSON:function(){return{id:e}}};return this.children.set(e,o),o},n.prototype.spawnActor=function(t,e){return this.children.set(e,t),t},n.prototype.spawnActivity=function(t){var e=this.machine.options&&this.machine.options.activities?this.machine.options.activities[t.type]:void 0;if(!!e){var r=e(this.state.context,t);this.spawnEffect(t.id,r)}},n.prototype.spawnEffect=function(t,e){this.children.set(t,{id:t,send:function(){},subscribe:function(){return{unsubscribe:function(){}}},stop:e||void 0,getSnapshot:function(){},toJSON:function(){return{id:t}}})},n.prototype.attachDev=function(){var t=Hr();if(this.options.devTools&&t){if(t.__REDUX_DEVTOOLS_EXTENSION__){var e=typeof this.options.devTools=="object"?this.options.devTools:void 0;this.devTools=t.__REDUX_DEVTOOLS_EXTENSION__.connect(y(y({name:this.id,autoPause:!0,stateSanitizer:function(r){return{value:r.value,context:r.context,actions:r.actions}}},e),{features:y({jump:!1,skip:!1},e?e.features:void 0)}),this.machine),this.devTools.init(this.state)}Ha(this)}},n.prototype.toJSON=function(){return{id:this.id}},n.prototype[ca]=function(){return this},n.prototype.getSnapshot=function(){return this.status===rt.NotStarted?this.initialState:this._state},n.defaultOptions=function(t){return{execute:!0,deferEvents:!0,clock:{setTimeout:function(e,r){return setTimeout(e,r)},clearTimeout:function(e){return clearTimeout(e)}},logger:t.console.log.bind(console),devTools:!1}}(typeof self!="undefined"?self:global),n.interpret=Ya,n}();function Ya(n,t){var e=new za(n,t);return e}/*! js-cookie v3.0.1 | MIT */function Nn(n){for(var t=1;t<arguments.length;t++){var e=arguments[t];for(var r in e)n[r]=e[r]}return n}var Ga={read:function(n){return n[0]==='"'&&(n=n.slice(1,-1)),n.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(n){return encodeURIComponent(n).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}};function Pr(n,t){function e(i,s,o){if(typeof document!="undefined"){o=Nn({},t,o),typeof o.expires=="number"&&(o.expires=new Date(Date.now()+o.expires*864e5)),o.expires&&(o.expires=o.expires.toUTCString()),i=encodeURIComponent(i).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var l="";for(var c in o)!o[c]||(l+="; "+c,o[c]!==!0&&(l+="="+o[c].split(";")[0]));return document.cookie=i+"="+n.write(s,i)+l}}function r(i){if(!(typeof document=="undefined"||arguments.length&&!i)){for(var s=document.cookie?document.cookie.split("; "):[],o={},l=0;l<s.length;l++){var c=s[l].split("="),a=c.slice(1).join("=");try{var h=decodeURIComponent(c[0]);if(o[h]=n.read(a,h),i===h)break}catch{}}return i?o[i]:o}}return Object.create({set:e,get:r,remove:function(i,s){e(i,"",Nn({},s,{expires:-1}))},withAttributes:function(i){return Pr(this.converter,Nn({},this.attributes,i))},withConverter:function(i){return Pr(Nn({},this.converter,i),this.attributes)}},{attributes:{value:Object.freeze(t)},converter:{value:Object.freeze(n)}})}var sh=Pr(Ga,{path:"/"});/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Wa={ATTRIBUTE:1,CHILD:2,PROPERTY:3,BOOLEAN_ATTRIBUTE:4,EVENT:5,ELEMENT:6},Xa=n=>(...t)=>({_$litDirective$:n,values:t});class Ka{constructor(t){}get _$AU(){return this._$AM._$AU}_$AT(t,e,r){this._$Ct=t,this._$AM=e,this._$Ci=r}_$AS(t,e){return this.update(t,e)}update(t,e){return this.render(...e)}}/**
 * @license
 * Copyright 2018 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const oh=Xa(class extends Ka{constructor(n){var t;if(super(n),n.type!==Wa.ATTRIBUTE||n.name!=="class"||((t=n.strings)===null||t===void 0?void 0:t.length)>2)throw Error("`classMap()` can only be used in the `class` attribute and must be the only part in the attribute.")}render(n){return" "+Object.keys(n).filter(t=>n[t]).join(" ")+" "}update(n,[t]){var e,r;if(this.st===void 0){this.st=new Set,n.strings!==void 0&&(this.et=new Set(n.strings.join(" ").split(/\s/).filter(s=>s!=="")));for(const s in t)t[s]&&!((e=this.et)===null||e===void 0?void 0:e.has(s))&&this.st.add(s);return this.render(t)}const i=n.element.classList;this.st.forEach(s=>{s in t||(i.remove(s),this.st.delete(s))});for(const s in t){const o=!!t[s];o===this.st.has(s)||((r=this.et)===null||r===void 0?void 0:r.has(s))||(o?(i.add(s),this.st.add(s)):(i.remove(s),this.st.delete(s)))}return Zt}});export{ye as D,Za as U,Qa as W,ih as a,rh as b,Bc as c,sh as d,Ya as i,oh as o,eh as p,th as s,nh as w};
//# sourceMappingURL=vendor.7a9baf1f.js.map
