{"version":3,"file":"index.ea5eed30.js","sources":["../../src/js/jitsi/index.js"],"sourcesContent":["import { yProvider } from '../yjs-setup';\nimport { featureIsEnabled } from '../bootstrap.js';\nimport { getURLParams } from '../api/util';\n\nconst JITSI_DOMAIN = '147.95.32.219:8443';\n// const JITSI_DOMAIN = 'meet.jit.si';\nconst JITSI_DEFAULT_OPTIONS = {\n  roomName: 'MusiCoLab Demo',\n  width: '100%',\n  height: '100%',\n  configOverwrite: {\n    prejoinPageEnabled: true,\n  },\n};\n\nclass JitsiAPI {\n  api = null;\n\n  constructor() {\n    this.jitsiContainer = document.getElementById('jitsi-meeting-container');\n    if (!this.jitsiContainer) {\n      throw new Error('Failed to initialize Jitsi. ParentNode was not found.');\n    }\n\n    this.options = {\n      ...JITSI_DEFAULT_OPTIONS,\n      parentNode: this.jitsiContainer,\n    };\n\n    this.setup();\n  }\n\n  setup() {\n    let startJitsi   = document.getElementById('start-jitsi-meet-btn');\n    let meetRoomForm = document.getElementById('meet-room-form');\n    let btnCloseCallJoin = document.getElementById('btnCloseCallJoin');\n\n    btnCloseCallJoin.addEventListener('click', (event) => {\n\t    startJitsi.style.color='green';\n\t    this.destroy();\n\t    this.hide();\n    });\n    startJitsi.addEventListener('click', (event) => {\n\t    startJitsi.style.color='red';\n    });\n    meetRoomForm.addEventListener('submit', (event) => {\n      event.preventDefault();\n      let formData = new FormData(event.target);\n      console.log(Object.fromEntries(formData));\n\n      let meetRoomName = formData.get('meet-room');\n      if (meetRoomName != null) {\n        this.options.roomName = meetRoomName;\n      }\n\n      this.show();\n      this.initAPI();\n    });\n\n      this.jitsiContainer.style.resize=\"height\";\n      this.jitsiContainer.style.minHeight = '100px'; \n\n      $('#meet-room')[0].value = getURLParams().course ?? 'test-room';\n  }\n\n  initAPI() {\n    if (!this.api) {\n      this.api = new JitsiMeetExternalAPI(JITSI_DOMAIN, this.options);\n\n      if (featureIsEnabled('collaboration')) {\n        // Retrieve the name the user entered on Jitsi and assign that name on the Yjs session\n        this.api.addListener('videoConferenceJoined', (localUser) => {\n          console.log(localUser);\n          if (localUser?.displayName.length > 0) {\n            let user = yProvider.awareness.getLocalState().user;\n\n            if (user) {\n              yProvider.awareness.setLocalStateField('user', {\n                ...user,\n                name: localUser.displayName,\n              });\n              console.log({\n                awarenessUser: yProvider.awareness.getLocalState(),\n              });\n            }\n          }\n        });\n      }\n\n      this.api.addEventListener('readyToClose', () => {\n        console.log(\n          'Jitsi call has ended. Jitsi iframe will be hidden and the API will be destroyed.'\n        );\n\n    \tlet startJitsi = document.getElementById('start-jitsi-meet-btn');\n\tstartJitsi.style.color='green';\n        this.destroy();\n        this.hide();\n      });\n    }\n  }\n\n  destroy() {\n    console.log('Destroying Jitsi');\n    this.api.dispose();\n    this.api = null;\n  }\n\n  show() {\n    if (!this.jitsiContainer) {\n      console.error('Jitsi container element was not found. Check index.html');\n      return;\n    }\n\n    $('#jitsi-meeting-container').slideDown('slow', () => {});\n    $('#enter-jitsi-meet-room').modal('hide');\n  }\n\n  hide() {\n    if (!this.jitsiContainer) {\n      console.error('Jitsi container element was not found. Check index.html');\n      return;\n    }\n\n    $('#jitsi-meeting-container').slideUp('slow', () => {\n\t//startJitsi.style.color='red';\n    });\n  }\n}\n\nexport default new JitsiAPI();\n"],"names":["JITSI_DOMAIN","JITSI_DEFAULT_OPTIONS","JitsiAPI","__publicField","startJitsi","meetRoomForm","event","formData","meetRoomName","_a","getURLParams","featureIsEnabled","localUser","user","yProvider","index"],"mappings":"8NAIA,MAAMA,EAAe,qBAEfC,EAAwB,CAC5B,SAAU,iBACV,MAAO,OACP,OAAQ,OACR,gBAAiB,CACf,mBAAoB,EACrB,CACH,EAEA,MAAMC,CAAS,CAGb,aAAc,CAFdC,EAAA,WAAM,MAIJ,GADA,KAAK,eAAiB,SAAS,eAAe,yBAAyB,EACnE,CAAC,KAAK,eACR,MAAM,IAAI,MAAM,uDAAuD,EAGzE,KAAK,QAAU,CACb,GAAGF,EACH,WAAY,KAAK,cACvB,EAEI,KAAK,MAAK,CACX,CAED,OAAQ,OACN,IAAIG,EAAe,SAAS,eAAe,sBAAsB,EAC7DC,EAAe,SAAS,eAAe,gBAAgB,EACpC,SAAS,eAAe,kBAAkB,EAEhD,iBAAiB,QAAUC,GAAU,CACrDF,EAAW,MAAM,MAAM,QACvB,KAAK,QAAO,EACZ,KAAK,KAAI,CACd,CAAK,EACDA,EAAW,iBAAiB,QAAUE,GAAU,CAC/CF,EAAW,MAAM,MAAM,KAC5B,CAAK,EACDC,EAAa,iBAAiB,SAAWC,GAAU,CACjDA,EAAM,eAAc,EACpB,IAAIC,EAAW,IAAI,SAASD,EAAM,MAAM,EACxC,QAAQ,IAAI,OAAO,YAAYC,CAAQ,CAAC,EAExC,IAAIC,EAAeD,EAAS,IAAI,WAAW,EACvCC,GAAgB,OAClB,KAAK,QAAQ,SAAWA,GAG1B,KAAK,KAAI,EACT,KAAK,QAAO,CAClB,CAAK,EAEC,KAAK,eAAe,MAAM,OAAO,SACjC,KAAK,eAAe,MAAM,UAAY,QAEtC,EAAE,YAAY,EAAE,GAAG,OAAQC,EAAAC,EAAc,EAAC,SAAf,KAAAD,EAAyB,WACvD,CAED,SAAU,CACH,KAAK,MACR,KAAK,IAAM,IAAI,qBAAqBT,EAAc,KAAK,OAAO,EAE1DW,EAAiB,eAAe,GAElC,KAAK,IAAI,YAAY,wBAA0BC,GAAc,CAE3D,GADA,QAAQ,IAAIA,CAAS,GACjBA,GAAA,YAAAA,EAAW,YAAY,QAAS,EAAG,CACrC,IAAIC,EAAOC,EAAU,UAAU,cAAa,EAAG,KAE3CD,IACFC,EAAU,UAAU,mBAAmB,OAAQ,CAC7C,GAAGD,EACH,KAAMD,EAAU,WAChC,CAAe,EACD,QAAQ,IAAI,CACV,cAAeE,EAAU,UAAU,cAAe,CAClE,CAAe,EAEJ,CACX,CAAS,EAGH,KAAK,IAAI,iBAAiB,eAAgB,IAAM,CAC9C,QAAQ,IACN,kFACV,EAEK,IAAIV,EAAa,SAAS,eAAe,sBAAsB,EACnEA,EAAW,MAAM,MAAM,QAChB,KAAK,QAAO,EACZ,KAAK,KAAI,CACjB,CAAO,EAEJ,CAED,SAAU,CACR,QAAQ,IAAI,kBAAkB,EAC9B,KAAK,IAAI,UACT,KAAK,IAAM,IACZ,CAED,MAAO,CACL,GAAI,CAAC,KAAK,eAAgB,CACxB,QAAQ,MAAM,yDAAyD,EACvE,MACD,CAED,EAAE,0BAA0B,EAAE,UAAU,OAAQ,IAAM,CAAE,CAAA,EACxD,EAAE,wBAAwB,EAAE,MAAM,MAAM,CACzC,CAED,MAAO,CACL,GAAI,CAAC,KAAK,eAAgB,CACxB,QAAQ,MAAM,yDAAyD,EACvE,MACD,CAED,EAAE,0BAA0B,EAAE,QAAQ,OAAQ,IAAM,CAExD,CAAK,CACF,CACH,CAEA,MAAeW,EAAA,IAAIb"}